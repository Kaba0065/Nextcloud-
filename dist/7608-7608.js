/*! For license information please see 7608-7608.js.LICENSE.txt */
(self.webpackChunknextcloud=self.webpackChunknextcloud||[]).push([[7608],{42761:function(e){"use strict";e.exports="data:image/svg+xml;base64,PCEtLSBUaGlzIGljb24gaXMgcGFydCBvZiBNYXRlcmlhbCBVSSBJY29ucy4gQ29weXJpZ2h0IDIwMjAgR29vZ2xlIEluYy4sIEFwYWNoZS0yLjAgTGljZW5zZSAtLT4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNiAxNiI+PHBhdGggZD0iTS00LTRoMjR2MjRILTRWLTR6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTggMEMzLjYgMCAwIDMuNiAwIDhzMy42IDggOCA4IDgtMy42IDgtOC0zLjYtOC04LTh6IiBmaWxsPSIjZWQ0ODRjIi8+PHBhdGggZD0iTTUgNi41aDZjLjggMCAxLjUuNyAxLjUgMS41cy0uNyAxLjUtMS41IDEuNUg1Yy0uOCAwLTEuNS0uNy0xLjUtMS41UzQuMiA2LjUgNSA2LjV6IiBmaWxsPSIjZmRmZmZmIi8+PC9zdmc+Cg=="},87210:function(e){"use strict";e.exports="data:image/svg+xml;base64,PCEtLSBUaGlzIGljb24gaXMgcGFydCBvZiBNYXRlcmlhbCBVSSBJY29ucy4gQ29weXJpZ2h0IDIwMjAgR29vZ2xlIEluYy4sIEFwYWNoZS0yLjAgTGljZW5zZSAtLT4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNiAxNiI+PHBhdGggZD0iTTQuOCAxMS4yaDYuNFY0LjhINC44djYuNHpNOCAwQzMuNiAwIDAgMy42IDAgOHMzLjYgOCA4IDggOC0zLjYgOC04LTMuNi04LTgtOHoiIGZpbGw9IiM0OWIzODIiLz48L3N2Zz4K"},94659:function(e){"use strict";e.exports="data:image/svg+xml;base64,PCEtLSBUaGlzIGljb24gaXMgcGFydCBvZiBNYXRlcmlhbCBVSSBJY29ucy4gQ29weXJpZ2h0IDIwMjAgR29vZ2xlIEluYy4sIEFwYWNoZS0yLjAgTGljZW5zZSAtLT4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNiAxNiI+PHBhdGggZmlsbD0ibm9uZSIgZD0iTS00LTRoMjR2MjRILTR6Ii8+PHBhdGggZD0iTTYuOS4xQzMgLjYtLjEgNC0uMSA4YzAgNC40IDMuNiA4IDggOCA0IDAgNy40LTMgOC02LjktMS4yIDEuMy0yLjkgMi4xLTQuNyAyLjEtMy41IDAtNi40LTIuOS02LjQtNi40IDAtMS45LjgtMy42IDIuMS00Ljd6IiBmaWxsPSIjZjRhMzMxIi8+PC9zdmc+Cg=="},39896:function(e){"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0iIzIyMiI+PHBhdGggZD0iTTE1LjQgMTYuNkwxMC44IDEybDQuNi00LjZMMTQgNmwtNiA2IDYgNiAxLjQtMS40eiIvPjwvc3ZnPg=="},76899:function(e){"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0iIzIyMiI+PHBhdGggZD0iTTE4LjQgNy40TDE3IDZsLTYgNiA2IDYgMS40LTEuNC00LjYtNC42IDQuNi00LjZtLTYgMEwxMSA2bC02IDYgNiA2IDEuNC0xLjRMNy44IDEybDQuNi00LjZ6Ii8+PC9zdmc+"},88931:function(e){"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0iIzIyMiI+PHBhdGggZD0iTTUuNiA3LjRMNyA2bDYgNi02IDYtMS40LTEuNCA0LjYtNC42LTQuNi00LjZtNiAwTDEzIDZsNiA2LTYgNi0xLjQtMS40IDQuNi00LjYtNC42LTQuNnoiLz48L3N2Zz4="},16556:function(e){"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0iIzIyMiI+PHBhdGggZD0iTTguNiAxNi42bDQuNi00LjYtNC42LTQuNkwxMCA2bDYgNi02IDYtMS40LTEuNHoiLz48L3N2Zz4="},24654:function(){},52361:function(){},94616:function(){},57462:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return V}});var n=i(20144),r=i(64882);function s(e){return"function"==typeof e?e():(0,n.unref)(e)}n.default.util.warn,i(25108);const o="undefined"!=typeof window&&"undefined"!=typeof document;function a(e){const t=Object.create(null);return i=>t[i]||(t[i]=e(i))}Object.prototype.toString;const l=/\B([A-Z])/g,c=(a((e=>e.replace(l,"-$1").toLowerCase())),/-(\w)/g);function u(e){var t;const i=s(e);return null!=(t=null==i?void 0:i.$el)?t:i}a((e=>e.replace(c,((e,t)=>t?t.toUpperCase():"")))),n.default.util.warn,i(25108);const d=o?window:void 0;function p(e,t,i={}){const{window:r=d,...s}=i;let o;const a=function(e){const t=function(){const e=(0,n.ref)(!1);return(0,n.getCurrentInstance)()&&(0,n.onMounted)((()=>{e.value=!0})),e}();return(0,n.computed)((()=>(t.value,Boolean(e()))))}((()=>r&&"ResizeObserver"in r)),l=()=>{o&&(o.disconnect(),o=void 0)},c=(0,n.computed)((()=>Array.isArray(e)?e.map((e=>u(e))):[u(e)])),p=(0,n.watch)(c,(e=>{if(l(),a.value&&r){o=new ResizeObserver(t);for(const t of e)t&&o.observe(t,s)}}),{immediate:!0,flush:"post",deep:!0}),h=()=>{l(),p()};return f=h,!!(0,n.getCurrentScope)()&&(0,n.onScopeDispose)(f),{isSupported:a,stop:h};var f}o&&window.document,o&&window.navigator,o&&window.location,"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self,Number.POSITIVE_INFINITY;var h=i(5656),f=i(31352),m=i(62520),g=i(43554),v=i(93664),w=i(79753),y=i(68188),_=i(74139);function b(e,t,i,n,r,s,o,a){var l,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=i,c._compiled=!0),n&&(c.functional=!0),s&&(c._scopeId="data-v-"+s),o?(l=function(e){!(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)&&typeof __VUE_SSR_CONTEXT__<"u"&&(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},c._ssrRegister=l):r&&(l=a?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),l)if(c.functional){c._injectStyles=l;var u=c.render;c.render=function(e,t){return l.call(t),u(e,t)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,l):[l]}return{exports:e,options:c}}const x=b({name:"FileIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},(function(){var e=this,t=e._self._c;return t("span",e._b({staticClass:"material-design-icon file-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[t("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[t("path",{attrs:{d:"M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z"}},[e.title?t("title",[e._v(e._s(e.title))]):e._e()])])])}),[],!1,null,null,null,null).exports,N=b((0,n.defineComponent)({__name:"DialogButton",props:{callback:null,label:null,icon:{default:void 0},type:{default:"secondary"}},emits:["click"],setup(e,{emit:t}){const i=e;return{__sfc:!0,props:i,emit:t,handleClick:e=>{var n;null==(n=i.callback)||n.call(i),t("click",e)},NcButton:r.P2,NcIconSvgWrapper:r.FK}}}),(function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.NcButton,{attrs:{"aria-label":i.props.label,type:i.props.type},on:{click:i.handleClick},scopedSlots:e._u([void 0!==i.props.icon?{key:"icon",fn:function(){return["string"==typeof i.props.icon?t(i.NcIconSvgWrapper,{attrs:{svg:i.props.icon}}):t(i.props.icon,{tag:"component",attrs:{size:20}})]},proxy:!0}:null],null,!0)},[e._v(" "+e._s(i.props.label)+" ")])}),[],!1,null,null,null,null).exports,C=b((0,n.defineComponent)({__name:"DialogBase",props:{name:null,message:{default:""},additionalTrapElements:{default:()=>[]},container:{default:void 0},size:{default:"small"},buttons:{default:()=>[]},navigationClasses:{default:()=>[]},contentClasses:{default:()=>[]},dialogClasses:{default:()=>[]}},emits:["close"],setup(e,{emit:t}){const i=e,s=(0,n.useSlots)(),o=(0,n.ref)(),{width:a}=function(e,t={width:0,height:0},i={}){const{window:r=d,box:s="content-box"}=i,o=(0,n.computed)((()=>{var t,i;return null==(i=null==(t=u(e))?void 0:t.namespaceURI)?void 0:i.includes("svg")})),a=(0,n.ref)(t.width),l=(0,n.ref)(t.height);return p(e,(([t])=>{const i="border-box"===s?t.borderBoxSize:"content-box"===s?t.contentBoxSize:t.devicePixelContentBoxSize;if(r&&o.value){const t=u(e);if(t){const e=r.getComputedStyle(t);a.value=Number.parseFloat(e.width),l.value=Number.parseFloat(e.height)}}else if(i){const e=Array.isArray(i)?i:[i];a.value=e.reduce(((e,{inlineSize:t})=>e+t),0),l.value=e.reduce(((e,{blockSize:t})=>e+t),0)}else a.value=t.contentRect.width,l.value=t.contentRect.height}),i),(0,n.watch)((()=>u(e)),(e=>{a.value=e?t.width:0,l.value=e?t.height:0})),{width:a,height:l}}(o),l=(0,n.computed)((()=>a.value<876)),c=(0,n.computed)((()=>void 0!==(null==s?void 0:s.navigation))),h=(0,n.ref)(!0),f=(0,n.computed)((()=>({additionalTrapElements:i.additionalTrapElements,container:void 0===i.container?"body":i.container,name:i.name,size:i.size,enableSlideshow:!1,enableSwipe:!1})));return{__sfc:!0,props:i,emit:t,slots:s,wrapper:o,dialogWidth:a,isNavigationCollapsed:l,hasNavigation:c,open:h,handleClose:()=>{h.value=!1,t("close")},modalProps:f,NcModal:r.Jc,DialogButton:N}}}),(function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.open?t(i.NcModal,e._b({staticClass:"dialog__modal",on:{close:i.handleClose}},"NcModal",i.modalProps,!1),[t("h2",{staticClass:"dialog__name",domProps:{textContent:e._s(e.name)}}),t("div",{staticClass:"dialog",class:e.dialogClasses},[t("div",{ref:"wrapper",class:["dialog__wrapper",{"dialog__wrapper--collapsed":i.isNavigationCollapsed}]},[i.hasNavigation?t("nav",{staticClass:"dialog__navigation",class:e.navigationClasses},[e._t("navigation",null,{isCollapsed:i.isNavigationCollapsed})],2):e._e(),t("div",{staticClass:"dialog__content",class:e.contentClasses},[e._t("default",(function(){return[t("p",[e._v(e._s(i.props.message))])]}))],2)]),t("div",{staticClass:"dialog__actions"},[e._t("actions",(function(){return e._l(i.props.buttons,(function(n,r){return t(i.DialogButton,e._b({key:r,on:{click:i.handleClose}},"DialogButton",n,!1))}))}))],2)])]):e._e()}),[],!1,null,"89afd3fd",null,null).exports,k=()=>{var e,t,i;const r=(0,g.j)("files","config",null),s=(0,n.ref)(null!=(e=null==r?void 0:r.show_hidden)&&e),o=(0,n.ref)(null==(t=null==r?void 0:r.sort_favorites_first)||t),a=(0,n.ref)(null==(i=null==r?void 0:r.crop_image_previews)||i);return(0,n.onMounted)((()=>{v.Z.get((0,w.generateUrl)("/apps/files/api/v1/configs")).then((e=>{var t,i,n,r,l,c,u,d,p;s.value=null!=(n=null==(i=null==(t=e.data)?void 0:t.data)?void 0:i.show_hidden)&&n,o.value=null==(c=null==(l=null==(r=e.data)?void 0:r.data)?void 0:l.sort_favorites_first)||c,a.value=null==(p=null==(d=null==(u=e.data)?void 0:u.data)?void 0:d.crop_image_previews)||p}))})),{showHiddenFiles:s,sortFavoritesFirst:o,cropImagePreviews:a}},I=b({name:"MenuUpIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},(function(){var e=this,t=e._self._c;return t("span",e._b({staticClass:"material-design-icon menu-up-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[t("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[t("path",{attrs:{d:"M7,15L12,10L17,15H7Z"}},[e.title?t("title",[e._v(e._s(e.title))]):e._e()])])])}),[],!1,null,null,null,null).exports,S=b({name:"MenuDownIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},(function(){var e=this,t=e._self._c;return t("span",e._b({staticClass:"material-design-icon menu-down-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[t("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[t("path",{attrs:{d:"M7,10L12,15L17,10H7Z"}},[e.title?t("title",[e._v(e._s(e.title))]):e._e()])])])}),[],!1,null,null,null,null).exports,E={"file-picker__file-icon":"_file-picker__file-icon_1vgv4_5"},P=b((0,n.defineComponent)({__name:"LoadingTableRow",props:{showCheckbox:{type:Boolean}},setup(e){return{__sfc:!0,fileListIconStyles:E}}}),(function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t("tr",{staticClass:"file-picker__row loading-row",attrs:{"aria-hidden":"true"}},[e.showCheckbox?t("td",{staticClass:"row-checkbox"},[t("span")]):e._e(),t("td",{staticClass:"row-name"},[t("div",{staticClass:"row-wrapper"},[t("span",{class:i.fileListIconStyles["file-picker__file-icon"]}),t("span")])]),e._m(0),e._m(1)])}),[function(){var e=this._self._c;return this._self._setupProxy,e("td",{staticClass:"row-size"},[e("span")])},function(){var e=this._self._c;return this._self._setupProxy,e("td",{staticClass:"row-modified"},[e("span")])}],!1,null,"6aded0d9",null,null).exports,L=b({name:"FolderIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},(function(){var e=this,t=e._self._c;return t("span",e._b({staticClass:"material-design-icon folder-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[t("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[t("path",{attrs:{d:"M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"}},[e.title?t("title",[e._v(e._s(e.title))]):e._e()])])])}),[],!1,null,null,null,null).exports,T=b((0,n.defineComponent)({name:"FilePreview",props:{node:null},setup(e){const t=e,i=(0,n.ref)(E),{cropImagePreviews:r}=k(),s=(0,n.computed)((()=>function(e,t={}){var i;t={size:32,cropPreview:!1,mimeFallback:!0,...t};try{const n=(null==(i=e.attributes)?void 0:i.previewUrl)||(0,w.generateUrl)("/core/preview?fileId={fileid}",{fileid:e.fileid});let r;try{r=new URL(n)}catch{r=new URL(n,window.location.origin)}return r.searchParams.set("x","".concat(t.size)),r.searchParams.set("y","".concat(t.size)),r.searchParams.set("mimeFallback","".concat(t.mimeFallback)),r.searchParams.set("a",!0===t.cropPreview?"0":"1"),r.searchParams.set("c","".concat(e.attributes.etag)),r}catch{return null}}(t.node,{cropPreview:r.value}))),o=(0,n.computed)((()=>t.node.type===h.Tv.File)),a=(0,n.ref)(!1);return(0,n.watch)(s,(()=>{if(a.value=!1,s.value){const e=document.createElement("img");e.src=s.value.href,e.onerror=()=>e.remove(),e.onload=()=>{a.value=!0,e.remove()},document.body.appendChild(e)}}),{immediate:!0}),{__sfc:!0,fileListIconStyles:i,props:t,cropImagePreviews:r,previewURL:s,isFile:o,canLoadPreview:a,t:y.t,IconFile:x,IconFolder:L}}}),(function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t("div",{class:i.fileListIconStyles["file-picker__file-icon"],style:i.canLoadPreview?{backgroundImage:"url(".concat(i.previewURL,")")}:void 0,attrs:{"aria-label":i.t("MIME type {mime}",{mime:e.node.mime||i.t("unknown")})}},[i.canLoadPreview?e._e():[i.isFile?t(i.IconFile,{attrs:{size:20}}):t(i.IconFolder,{attrs:{size:20}})]],2)}),[],!1,null,null,null,null).exports,A=b((0,n.defineComponent)({__name:"FileListRow",props:{allowPickDirectory:{type:Boolean},selected:{type:Boolean},showCheckbox:{type:Boolean},canPick:{type:Boolean},node:null},emits:["update:selected","enter-directory"],setup(e,{emit:t}){const i=e,s=(0,n.computed)((()=>{var e;return(null==(e=i.node.attributes)?void 0:e.displayName)||i.node.basename.slice(0,i.node.extension?-i.node.extension.length:void 0)})),o=(0,n.computed)((()=>i.node.extension)),a=(0,n.computed)((()=>i.node.type===h.Tv.Folder)),l=(0,n.computed)((()=>i.canPick&&(i.allowPickDirectory||!a.value)));function c(){t("update:selected",!i.selected)}function u(){a.value?t("enter-directory",i.node):c()}return{__sfc:!0,props:i,emit:t,displayName:s,fileExtension:o,isDirectory:a,isPickable:l,toggleSelected:c,handleClick:u,handleKeyDown:function(e){"Enter"===e.key&&u()},formatFileSize:h.sS,NcCheckboxRadioSwitch:r.rw,NcDateTime:r.Jh,t:y.t,FilePreview:T}}}),(function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t("tr",e._g({class:["file-picker__row",{"file-picker__row--selected":e.selected&&!e.showCheckbox}],attrs:{tabindex:e.showCheckbox&&!i.isDirectory?void 0:0,"aria-selected":i.isPickable?e.selected:void 0,"data-filename":e.node.basename,"data-testid":"file-list-row"},on:{click:i.handleClick}},!e.showCheckbox||i.isDirectory?{keydown:i.handleKeyDown}:{}),[e.showCheckbox?t("td",{staticClass:"row-checkbox"},[t(i.NcCheckboxRadioSwitch,{attrs:{disabled:!i.isPickable,checked:e.selected,"aria-label":i.t("Select the row for {nodename}",{nodename:i.displayName}),"data-testid":"row-checkbox"},on:{click:function(e){e.stopPropagation()},"update:checked":i.toggleSelected}})],1):e._e(),t("td",{staticClass:"row-name"},[t("div",{staticClass:"file-picker__name-container",attrs:{"data-testid":"row-name"}},[t(i.FilePreview,{attrs:{node:e.node}}),t("div",{staticClass:"file-picker__file-name",attrs:{title:i.displayName},domProps:{textContent:e._s(i.displayName)}}),t("div",{staticClass:"file-picker__file-extension",domProps:{textContent:e._s(i.fileExtension)}})],1)]),t("td",{staticClass:"row-size"},[e._v(" "+e._s(i.formatFileSize(e.node.size||0))+" ")]),t("td",{staticClass:"row-modified"},[t(i.NcDateTime,{attrs:{timestamp:e.node.mtime,"ignore-seconds":!0}})],1)])}),[],!1,null,"d337ebac",null,null).exports,D=b((0,n.defineComponent)({__name:"FileList",props:{currentView:null,multiselect:{type:Boolean},allowPickDirectory:{type:Boolean},loading:{type:Boolean},files:null,selectedFiles:null,path:null},emits:["update:path","update:selectedFiles"],setup(e,{emit:t}){const i=e,o=(0,n.ref)(),{currentConfig:a}=(e=>{var t,i,r,o,a,l,c,u,d,p,h,f;const m=e=>"asc"===e?"ascending":"desc"===e?"descending":"none",y=(0,g.j)("files","viewConfigs",null),_=(0,n.ref)({sortBy:null!=(i=null==(t=null==y?void 0:y.files)?void 0:t.sorting_mode)?i:"basename",order:m(null!=(o=null==(r=null==y?void 0:y.files)?void 0:r.sorting_direction)?o:"asc")}),b=(0,n.ref)({sortBy:null!=(l=null==(a=null==y?void 0:y.recent)?void 0:a.sorting_mode)?l:"basename",order:m(null!=(u=null==(c=null==y?void 0:y.recent)?void 0:c.sorting_direction)?u:"asc")}),x=(0,n.ref)({sortBy:null!=(p=null==(d=null==y?void 0:y.favorites)?void 0:d.sorting_mode)?p:"basename",order:m(null!=(f=null==(h=null==y?void 0:y.favorites)?void 0:h.sorting_direction)?f:"asc")});(0,n.onMounted)((()=>{v.Z.get((0,w.generateUrl)("/apps/files/api/v1/views")).then((e=>{var t,i,n,r,s,o,a,l,c,u,d,p,h,f,g,v,w,y,N,C,k;_.value={sortBy:null!=(r=null==(n=null==(i=null==(t=e.data)?void 0:t.data)?void 0:i.files)?void 0:n.sorting_mode)?r:"basename",order:m(null==(a=null==(o=null==(s=e.data)?void 0:s.data)?void 0:o.files)?void 0:a.sorting_direction)},x.value={sortBy:null!=(d=null==(u=null==(c=null==(l=e.data)?void 0:l.data)?void 0:c.favorites)?void 0:u.sorting_mode)?d:"basename",order:m(null==(f=null==(h=null==(p=e.data)?void 0:p.data)?void 0:h.favorites)?void 0:f.sorting_direction)},b.value={sortBy:null!=(y=null==(w=null==(v=null==(g=e.data)?void 0:g.data)?void 0:v.recent)?void 0:w.sorting_mode)?y:"basename",order:m(null==(k=null==(C=null==(N=e.data)?void 0:N.data)?void 0:C.recent)?void 0:k.sorting_direction)}}))}));const N=(0,n.computed)((()=>"files"===s(e||"files")?_.value:"recent"===s(e)?b.value:x.value)),C=(0,n.computed)((()=>N.value.sortBy)),k=(0,n.computed)((()=>N.value.order));return{filesViewConfig:_,favoritesViewConfig:x,recentViewConfig:b,currentConfig:N,sortBy:C,order:k}})(i.currentView),l=(0,n.computed)((()=>{var e;return null!=(e=o.value)?e:a.value})),c=(0,n.computed)((()=>"basename"===l.value.sortBy?"none"===l.value.order?void 0:l.value.order:void 0)),u=(0,n.computed)((()=>"size"===l.value.sortBy?"none"===l.value.order?void 0:l.value.order:void 0)),d=(0,n.computed)((()=>"mtime"===l.value.sortBy?"none"===l.value.order?void 0:l.value.order:void 0)),{sortFavoritesFirst:p}=k(),_=(0,n.computed)((()=>{const e={ascending:(e,t,i)=>i(e,t),descending:(e,t,i)=>i(t,e),none:(e,t,i)=>0},t={basename:(e,t)=>{var i,n;return((null==(i=e.attributes)?void 0:i.displayName)||e.basename).localeCompare((null==(n=t.attributes)?void 0:n.displayName)||t.basename,(0,f.aj)())},size:(e,t)=>(e.size||0)-(t.size||0),mtime:(e,t)=>{var i,n,r,s;return((null==(n=null==(i=t.mtime)?void 0:i.getTime)?void 0:n.call(i))||0)-((null==(s=null==(r=e.mtime)?void 0:r.getTime)?void 0:s.call(r))||0)}};return[...i.files].sort(((i,n)=>(n.type===h.Tv.Folder?1:0)-(i.type===h.Tv.Folder?1:0)||(p?(n.attributes.favorite?1:0)-(i.attributes.favorite?1:0):0)||e[l.value.order](i,n,t[l.value.sortBy])))})),b=(0,n.computed)((()=>i.files.filter((e=>i.allowPickDirectory||e.type!==h.Tv.Folder)))),x=(0,n.computed)((()=>!i.loading&&i.selectedFiles.length>0&&i.selectedFiles.length>=b.value.length)),N=(0,n.ref)(4),C=(0,n.ref)();{const e=()=>(0,n.nextTick)((()=>{var e,t,i,n,r;const s=(null==(t=null==(e=C.value)?void 0:e.parentElement)?void 0:t.children)||[];let o=(null==(n=null==(i=C.value)?void 0:i.parentElement)?void 0:n.clientHeight)||450;for(let e=0;e<s.length;e++)null!=(r=C.value)&&r.isSameNode(s[e])||(o-=s[e].clientHeight);N.value=Math.floor((o-50)/50)}));(0,n.onMounted)((()=>{window.addEventListener("resize",e),e()})),(0,n.onUnmounted)((()=>{window.removeEventListener("resize",e)}))}return{__sfc:!0,props:i,emit:t,customSortingConfig:o,filesAppSorting:a,sortingConfig:l,sortByName:c,sortBySize:u,sortByModified:d,toggleSorting:e=>{l.value.sortBy===e?"ascending"===l.value.order?o.value={sortBy:l.value.sortBy,order:"descending"}:o.value={sortBy:l.value.sortBy,order:"ascending"}:o.value={sortBy:e,order:"ascending"}},sortFavoritesFirst:p,sortedFiles:_,selectableFiles:b,allSelected:x,onSelectAll:function(){i.selectedFiles.length<b.value.length?t("update:selectedFiles",b.value):t("update:selectedFiles",[])},onNodeSelected:function(e){i.selectedFiles.includes(e)?t("update:selectedFiles",i.selectedFiles.filter((t=>t.path!==e.path))):i.multiselect?t("update:selectedFiles",[...i.selectedFiles,e]):t("update:selectedFiles",[e])},onChangeDirectory:function(e){t("update:path",(0,m.join)(i.path,e.basename))},skeletonNumber:N,fileContainer:C,NcButton:r.P2,NcCheckboxRadioSwitch:r.rw,t:y.t,IconSortAscending:I,IconSortDescending:S,LoadingTableRow:P,FileListRow:A}}}),(function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t("div",{ref:"fileContainer",staticClass:"file-picker__files"},[t("table",[t("thead",[t("tr",[e.multiselect?t("th",{staticClass:"row-checkbox"},[t("span",{staticClass:"hidden-visually"},[e._v(" "+e._s(i.t("Select entry"))+" ")]),e.multiselect?t(i.NcCheckboxRadioSwitch,{attrs:{"aria-label":i.t("Select all entries"),checked:i.allSelected,"data-testid":"select-all-checkbox"},on:{"update:checked":i.onSelectAll}}):e._e()],1):e._e(),t("th",{staticClass:"row-name",attrs:{"aria-sort":i.sortByName}},[t("div",{staticClass:"header-wrapper"},[t("span",{staticClass:"file-picker__header-preview"}),t(i.NcButton,{attrs:{wide:!0,type:"tertiary","data-test":"file-picker_sort-name"},on:{click:function(e){return i.toggleSorting("basename")}},scopedSlots:e._u([{key:"icon",fn:function(){return["ascending"===i.sortByName?t(i.IconSortAscending,{attrs:{size:20}}):"descending"===i.sortByName?t(i.IconSortDescending,{attrs:{size:20}}):t("span",{staticStyle:{width:"44px"}})]},proxy:!0}])},[e._v(" "+e._s(i.t("Name"))+" ")])],1)]),t("th",{staticClass:"row-size",attrs:{"aria-sort":i.sortBySize}},[t(i.NcButton,{attrs:{wide:!0,type:"tertiary"},on:{click:function(e){return i.toggleSorting("size")}},scopedSlots:e._u([{key:"icon",fn:function(){return["ascending"===i.sortBySize?t(i.IconSortAscending,{attrs:{size:20}}):"descending"===i.sortBySize?t(i.IconSortDescending,{attrs:{size:20}}):t("span",{staticStyle:{width:"44px"}})]},proxy:!0}])},[e._v(" "+e._s(i.t("Size"))+" ")])],1),t("th",{staticClass:"row-modified",attrs:{"aria-sort":i.sortByModified}},[t(i.NcButton,{attrs:{wide:!0,type:"tertiary"},on:{click:function(e){return i.toggleSorting("mtime")}},scopedSlots:e._u([{key:"icon",fn:function(){return["ascending"===i.sortByModified?t(i.IconSortAscending,{attrs:{size:20}}):"descending"===i.sortByModified?t(i.IconSortDescending,{attrs:{size:20}}):t("span",{staticStyle:{width:"44px"}})]},proxy:!0}])},[e._v(" "+e._s(i.t("Modified"))+" ")])],1)])]),t("tbody",[e.loading?e._l(i.skeletonNumber,(function(n){return t(i.LoadingTableRow,{key:n,attrs:{"show-checkbox":e.multiselect}})})):e._l(i.sortedFiles,(function(n){return t(i.FileListRow,{key:n.fileid||n.path,attrs:{"allow-pick-directory":e.allowPickDirectory,"show-checkbox":e.multiselect,"can-pick":e.multiselect||0===e.selectedFiles.length||e.selectedFiles.includes(n),selected:e.selectedFiles.includes(n),node:n},on:{"update:selected":function(e){return i.onNodeSelected(n)},"enter-directory":i.onChangeDirectory}})}))],2)])])}),[],!1,null,"ecc68c3c",null,null).exports,Z=b({name:"HomeIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},(function(){var e=this,t=e._self._c;return t("span",e._b({staticClass:"material-design-icon home-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[t("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[t("path",{attrs:{d:"M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"}},[e.title?t("title",[e._v(e._s(e.title))]):e._e()])])])}),[],!1,null,null,null,null).exports,B=b({name:"PlusIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},(function(){var e=this,t=e._self._c;return t("span",e._b({staticClass:"material-design-icon plus-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[t("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[t("path",{attrs:{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"}},[e.title?t("title",[e._v(e._s(e.title))]):e._e()])])])}),[],!1,null,null,null,null).exports,M=b((0,n.defineComponent)({__name:"FilePickerBreadcrumbs",props:{path:null,showMenu:{type:Boolean}},emits:["update:path","create-node"],setup(e,{emit:t}){const i=e,s=(0,n.ref)(""),o=(0,n.ref)();function a(){var e,t,i,n;const r=s.value.trim(),a=null==(t=null==(e=o.value)?void 0:e.$el)?void 0:t.querySelector("input");let l="";return 0===r.length?l=(0,y.t)("Folder name cannot be empty."):r.includes("/")?l=(0,y.t)('"/" is not allowed inside a folder name.'):["..","."].includes(r)?l=(0,y.t)('"{name}" is an invalid folder name.',{name:r}):null!=(i=window.OC.config)&&i.blacklist_files_regex&&r.match(null==(n=window.OC.config)?void 0:n.blacklist_files_regex)&&(l=(0,y.t)('"{name}" is not an allowed folder name',{name:r})),a&&a.setCustomValidity(l),""===l}const l=(0,n.computed)((()=>i.path.split("/").filter((e=>""!==e)).map(((e,t,i)=>({name:e,path:"/"+i.slice(0,t+1).join("/")})))));return{__sfc:!0,props:i,emit:t,newNodeName:s,nameInput:o,validateInput:a,onSubmit:function(){const e=s.value.trim();a()&&(t("create-node",e),s.value="")},pathElements:l,IconFolder:L,IconHome:Z,IconPlus:B,NcActions:r.O3,NcActionInput:r.Iw,NcBreadcrumbs:r.fg,NcBreadcrumb:r.$U,t:y.t}}}),(function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.NcBreadcrumbs,{staticClass:"file-picker__breadcrumbs",scopedSlots:e._u([{key:"default",fn:function(){return[t(i.NcBreadcrumb,{attrs:{name:i.t("Home"),title:i.t("Home")},on:{click:function(e){return i.emit("update:path","/")}},scopedSlots:e._u([{key:"icon",fn:function(){return[t(i.IconHome,{attrs:{size:20}})]},proxy:!0}])}),e._l(i.pathElements,(function(e){return t(i.NcBreadcrumb,{key:e.path,attrs:{name:e.name,title:e.path},on:{click:function(t){return i.emit("update:path",e.path)}}})}))]},proxy:!0},e.showMenu?{key:"actions",fn:function(){return[t(i.NcActions,{attrs:{"aria-label":i.t("Create directory"),"force-menu":!0,"force-name":!0,"menu-name":i.t("New"),type:"secondary"},on:{close:function(e){i.newNodeName=""}},scopedSlots:e._u([{key:"icon",fn:function(){return[t(i.IconPlus,{attrs:{size:20}})]},proxy:!0}],null,!1,2971667417)},[t(i.NcActionInput,{ref:"nameInput",attrs:{value:i.newNodeName,label:i.t("New folder"),placeholder:i.t("New folder name")},on:{"update:value":function(e){i.newNodeName=e},submit:i.onSubmit,input:i.validateInput},scopedSlots:e._u([{key:"icon",fn:function(){return[t(i.IconFolder,{attrs:{size:20}})]},proxy:!0}],null,!1,1614167509)})],1)]},proxy:!0}:null],null,!0)})}),[],!1,null,"3bc9efa5",null,null).exports,O=b({name:"ClockIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},(function(){var e=this,t=e._self._c;return t("span",e._b({staticClass:"material-design-icon clock-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[t("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[t("path",{attrs:{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.9L16.2,16.2Z"}},[e.title?t("title",[e._v(e._s(e.title))]):e._e()])])])}),[],!1,null,null,null,null).exports,F=b({name:"CloseIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},(function(){var e=this,t=e._self._c;return t("span",e._b({staticClass:"material-design-icon close-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[t("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[t("path",{attrs:{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"}},[e.title?t("title",[e._v(e._s(e.title))]):e._e()])])])}),[],!1,null,null,null,null).exports,R=b({name:"MagnifyIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},(function(){var e=this,t=e._self._c;return t("span",e._b({staticClass:"material-design-icon magnify-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[t("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[t("path",{attrs:{d:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"}},[e.title?t("title",[e._v(e._s(e.title))]):e._e()])])])}),[],!1,null,null,null,null).exports,j=b({name:"StarIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},(function(){var e=this,t=e._self._c;return t("span",e._b({staticClass:"material-design-icon star-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[t("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[t("path",{attrs:{d:"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"}},[e.title?t("title",[e._v(e._s(e.title))]):e._e()])])])}),[],!1,null,null,null,null).exports,z=b((0,n.defineComponent)({__name:"FilePickerNavigation",props:{currentView:null,filterString:null,isCollapsed:{type:Boolean}},emits:["update:currentView","update:filterString"],setup(e,{emit:t}){const i=e,s=[{id:"files",label:(0,y.t)("All files"),icon:L},{id:"recent",label:(0,y.t)("Recent"),icon:O},{id:"favorites",label:(0,y.t)("Favorites"),icon:j}],o=(0,n.computed)((()=>s.filter((e=>e.id===i.currentView))[0]));return{__sfc:!0,allViews:s,props:i,emit:t,currentViewObject:o,updateFilterValue:e=>t("update:filterString",e),IconClose:F,IconMagnify:R,NcButton:r.P2,NcSelect:r.QG,NcTextField:r.h3,t:y.t,Fragment:_.Fragment}}}),(function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.Fragment,[t(i.NcTextField,{staticClass:"file-picker__filter-input",attrs:{value:e.filterString,label:i.t("Filter file list"),"show-trailing-button":!!e.filterString},on:{"update:value":i.updateFilterValue,"trailing-button-click":function(e){return i.updateFilterValue("")}},scopedSlots:e._u([{key:"trailing-button-icon",fn:function(){return[t(i.IconClose,{attrs:{size:16}})]},proxy:!0}])},[t(i.IconMagnify,{attrs:{size:16}})],1),e.isCollapsed?t(i.NcSelect,{attrs:{"aria-label":i.t("Current view selector"),clearable:!1,searchable:!1,options:i.allViews,value:i.currentViewObject},on:{input:e=>i.emit("update:currentView",e.id)}}):t("ul",{staticClass:"file-picker__side",attrs:{role:"tablist","aria-label":i.t("Filepicker sections")}},e._l(i.allViews,(function(n){return t("li",{key:n.id},[t(i.NcButton,{attrs:{"aria-selected":e.currentView===n.id,type:e.currentView===n.id?"primary":"tertiary",wide:!0,role:"tab"},on:{click:function(t){return e.$emit("update:currentView",n.id)}},scopedSlots:e._u([{key:"icon",fn:function(){return[t(n.icon,{tag:"component",attrs:{size:20}})]},proxy:!0}],null,!0)},[e._v(" "+e._s(n.label)+" ")])],1)})),0)],1)}),[],!1,null,"fcfd0f23",null,null).exports,V=b((0,n.defineComponent)({name:"FilePicker",props:{buttons:null,name:null,allowPickDirectory:{type:Boolean,default:!1},container:{default:"body"},filterFn:{default:void 0},mimetypeFilter:{default:()=>[]},multiselect:{type:Boolean,default:!0},path:{default:"/"}},emits:["close"],setup(e,{emit:t}){const i=e,s=(0,n.computed)((()=>({container:i.container,name:i.name,buttons:o.value,size:"large",contentClasses:["file-picker__content"],dialogClasses:["file-picker"],navigationClasses:["file-picker__navigation"]}))),o=(0,n.computed)((()=>("function"==typeof i.buttons?i.buttons(c.value,p.value,a.value):i.buttons).map((e=>({...e,callback:async()=>{const n=0===c.value.length&&i.allowPickDirectory?[await b(p.value)]:c.value;e.callback(n),t("close",c.value)}}))))),a=(0,n.ref)("files"),l=(0,n.computed)((()=>"favorites"===a.value?(0,y.t)("Favorites"):"recent"===a.value?(0,y.t)("Recent"):"")),c=(0,n.ref)([]),u=(0,n.ref)((null==window?void 0:window.sessionStorage.getItem("NC.FilePicker.LastPath"))||"/"),d=(0,n.ref)(),p=(0,n.computed)({get:()=>"files"===a.value?d.value||i.path||u.value:"/",set:e=>{void 0===i.path&&window.sessionStorage.setItem("NC.FilePicker.LastPath",e),d.value=e,c.value=[]}}),f=(0,n.ref)(""),{isSupportedMimeType:g}=function(e){const t=(0,n.computed)((()=>e.value.map((e=>e.split("/")))));return{isSupportedMimeType:e=>{const i=e.split("/");return t.value.some((([e,t])=>!(i[0]!==e&&"*"!==e||i[1]!==t&&"*"!==t)))}}}((0,n.toRef)(i,"mimetypeFilter")),{files:v,isLoading:w,loadFiles:_,getFile:b,client:N}=function(e,t){const i=(0,h.rp)(),r=(0,n.ref)([]),s=(0,n.ref)(!0);async function o(){if(s.value=!0,"favorites"===e.value)r.value=await(0,h.pC)(i,t.value);else if("recent"===e.value){const e=Math.round(Date.now()/1e3)-1209600,{data:t}=await i.search("/",{details:!0,data:(0,h.tB)(e)});r.value=t.results.map((e=>(0,h.RL)(e)))}else{const e=await i.getDirectoryContents("".concat(h._o).concat(t.value),{details:!0,data:(0,h.h7)()});r.value=e.data.map((e=>(0,h.RL)(e)))}s.value=!1}return(0,n.watch)([e,t],(()=>o())),(0,n.onMounted)((()=>o())),{isLoading:s,files:r,loadFiles:()=>o(),getFile:async function(e,t=h._o){const n=await i.stat("".concat(t).concat(e),{details:!0});return(0,h.RL)(n.data)},client:i}}(a,p);(0,n.onMounted)((()=>_()));const{showHiddenFiles:I}=k(),S=(0,n.computed)((()=>{let e=v.value;return I.value||(e=e.filter((e=>!e.basename.startsWith(".")))),i.mimetypeFilter.length>0&&(e=e.filter((e=>"folder"===e.type||e.mime&&g(e.mime)))),f.value&&(e=e.filter((e=>e.basename.toLowerCase().includes(f.value.toLowerCase())))),i.filterFn&&(e=e.filter((e=>i.filterFn(e)))),e})),E=(0,n.computed)((()=>"files"===a.value?(0,y.t)("Upload some content or sync with your devices!"):"recent"===a.value?(0,y.t)("Files and folders you recently modified will show up here."):(0,y.t)("Files and folders you mark as favorite will show up here.")));return{__sfc:!0,props:i,emit:t,dialogProps:s,dialogButtons:o,currentView:a,viewHeadline:l,selectedFiles:c,savedPath:u,navigatedPath:d,currentPath:p,filterString:f,isSupportedMimeType:g,files:v,isLoading:w,loadFiles:_,getFile:b,client:N,showHiddenFiles:I,filteredFiles:S,noFilesDescription:E,onCreateFolder:e=>{N.createDirectory((0,m.join)(h._o,p.value,e)).then((()=>_())).catch((e=>(0,y.k)((0,y.t)("Could not create the new folder"))))},IconFile:x,DialogBase:C,FileList:D,FilePickerBreadcrumbs:M,FilePickerNavigation:z,NcEmptyContent:r.SL,t:y.t}}}),(function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.DialogBase,e._b({on:{close:function(e){return i.emit("close")}},scopedSlots:e._u([{key:"navigation",fn:function({isCollapsed:e}){return[t(i.FilePickerNavigation,{attrs:{"is-collapsed":e,"current-view":i.currentView,"filter-string":i.filterString},on:{"update:currentView":function(e){i.currentView=e},"update:current-view":function(e){i.currentView=e},"update:filterString":function(e){i.filterString=e},"update:filter-string":function(e){i.filterString=e}}})]}}])},"DialogBase",i.dialogProps,!1),[t("div",{staticClass:"file-picker__main"},["files"===i.currentView?t(i.FilePickerBreadcrumbs,{attrs:{path:i.currentPath,"show-menu":e.allowPickDirectory},on:{"update:path":function(e){i.currentPath=e},"create-node":i.onCreateFolder}}):t("div",{staticClass:"file-picker__view"},[t("h3",[e._v(e._s(i.viewHeadline))])]),i.isLoading||i.filteredFiles.length>0?t(i.FileList,{attrs:{"allow-pick-directory":e.allowPickDirectory,"current-view":i.currentView,files:i.filteredFiles,multiselect:e.multiselect,loading:i.isLoading,path:i.currentPath,"selected-files":i.selectedFiles,name:i.viewHeadline},on:{"update:path":[function(e){i.currentPath=e},function(e){i.currentView="files"}],"update:selectedFiles":function(e){i.selectedFiles=e},"update:selected-files":function(e){i.selectedFiles=e}}}):i.filterString?t(i.NcEmptyContent,{attrs:{name:i.t("No matching files"),description:i.t("No files matching your filter were found.")},scopedSlots:e._u([{key:"icon",fn:function(){return[t(i.IconFile)]},proxy:!0}])}):t(i.NcEmptyContent,{attrs:{name:i.t("No files in here"),description:i.noFilesDescription},scopedSlots:e._u([{key:"icon",fn:function(){return[t(i.IconFile)]},proxy:!0}])})],1)])}),[],!1,null,"f979a44d",null,null).exports},5656:function(e,t,i){"use strict";i.d(t,{$B:function(){return O},DT:function(){return w},De:function(){return x},G7:function(){return ut},Ir:function(){return ft},NB:function(){return M},RL:function(){return $},Ti:function(){return U},Tv:function(){return A},Vn:function(){return b},_o:function(){return R},cd:function(){return pt},e4:function(){return B},fs:function(){return P},gt:function(){return F},h7:function(){return E},m0:function(){return I},oE:function(){return ht},p$:function(){return y},p4:function(){return _},pC:function(){return V},rp:function(){return z},sS:function(){return v},sg:function(){return G},tB:function(){return L},w4:function(){return S},y3:function(){return N},zu:function(){return T}});var n=i(77958),r=i(17499),s=i(31352),o=i(62520),a=i(65358),l=i(79753),c=i(14596),u=i(26721);const d=null===(p=(0,n.ts)())?(0,r.IY)().setApp("files").build():(0,r.IY)().setApp("files").setUid(p.uid).build();var p;class h{_entries=[];registerEntry(e){this.validateEntry(e),this._entries.push(e)}unregisterEntry(e){const t="string"==typeof e?this.getEntryIndex(e):this.getEntryIndex(e.id);-1!==t?this._entries.splice(t,1):d.warn("Entry not found, nothing removed",{entry:e,entries:this.getEntries()})}getEntries(e){return e?this._entries.filter((t=>"function"!=typeof t.enabled||t.enabled(e))):this._entries}getEntryIndex(e){return this._entries.findIndex((t=>t.id===e))}validateEntry(e){if(!e.id||!e.displayName||!e.iconSvgInline&&!e.iconClass||!e.handler)throw new Error("Invalid entry");if("string"!=typeof e.id||"string"!=typeof e.displayName)throw new Error("Invalid id or displayName property");if(e.iconClass&&"string"!=typeof e.iconClass||e.iconSvgInline&&"string"!=typeof e.iconSvgInline)throw new Error("Invalid icon provided");if(void 0!==e.enabled&&"function"!=typeof e.enabled)throw new Error("Invalid enabled property");if("function"!=typeof e.handler)throw new Error("Invalid handler property");if("order"in e&&"number"!=typeof e.order)throw new Error("Invalid order property");if(-1!==this.getEntryIndex(e.id))throw new Error("Duplicate entry")}}const f=function(){return typeof window._nc_newfilemenu>"u"&&(window._nc_newfilemenu=new h,d.debug("NewFileMenu initialized")),window._nc_newfilemenu},m=["B","KB","MB","GB","TB","PB"],g=["B","KiB","MiB","GiB","TiB","PiB"];function v(e,t=!1,i=!0){"string"==typeof e&&(e=Number(e));let n=e>0?Math.floor(Math.log(e)/Math.log(i?1024:1e3)):0;n=Math.min((i?g.length:m.length)-1,n);const r=i?g[n]:m[n];let o=(e/Math.pow(i?1024:1e3,n)).toFixed(1);return!0===t&&0===n?("0.0"!==o?"< 1 ":"0 ")+(i?g[1]:m[1]):(o=n<2?parseFloat(o).toFixed(0):parseFloat(o).toLocaleString((0,s.aj)()),o+" "+r)}var w=(e=>(e.DEFAULT="default",e.HIDDEN="hidden",e))(w||{});class y{_action;constructor(e){this.validateAction(e),this._action=e}get id(){return this._action.id}get displayName(){return this._action.displayName}get title(){return this._action.title}get iconSvgInline(){return this._action.iconSvgInline}get enabled(){return this._action.enabled}get exec(){return this._action.exec}get execBatch(){return this._action.execBatch}get order(){return this._action.order}get default(){return this._action.default}get inline(){return this._action.inline}get renderInline(){return this._action.renderInline}validateAction(e){if(!e.id||"string"!=typeof e.id)throw new Error("Invalid id");if(!e.displayName||"function"!=typeof e.displayName)throw new Error("Invalid displayName function");if("title"in e&&"function"!=typeof e.title)throw new Error("Invalid title function");if(!e.iconSvgInline||"function"!=typeof e.iconSvgInline)throw new Error("Invalid iconSvgInline function");if(!e.exec||"function"!=typeof e.exec)throw new Error("Invalid exec function");if("enabled"in e&&"function"!=typeof e.enabled)throw new Error("Invalid enabled function");if("execBatch"in e&&"function"!=typeof e.execBatch)throw new Error("Invalid execBatch function");if("order"in e&&"number"!=typeof e.order)throw new Error("Invalid order");if(e.default&&!Object.values(w).includes(e.default))throw new Error("Invalid default");if("inline"in e&&"function"!=typeof e.inline)throw new Error("Invalid inline function");if("renderInline"in e&&"function"!=typeof e.renderInline)throw new Error("Invalid renderInline function")}}const _=function(e){typeof window._nc_fileactions>"u"&&(window._nc_fileactions=[],d.debug("FileActions initialized")),window._nc_fileactions.find((t=>t.id===e.id))?d.error(`FileAction ${e.id} already registered`,{action:e}):window._nc_fileactions.push(e)},b=function(){return typeof window._nc_fileactions>"u"&&(window._nc_fileactions=[],d.debug("FileActions initialized")),window._nc_fileactions},x=function(){return typeof window._nc_filelistheader>"u"&&(window._nc_filelistheader=[],d.debug("FileListHeaders initialized")),window._nc_filelistheader};var N=(e=>(e[e.NONE=0]="NONE",e[e.CREATE=4]="CREATE",e[e.READ=1]="READ",e[e.UPDATE=2]="UPDATE",e[e.DELETE=8]="DELETE",e[e.SHARE=16]="SHARE",e[e.ALL=31]="ALL",e))(N||{});const C=["d:getcontentlength","d:getcontenttype","d:getetag","d:getlastmodified","d:quota-available-bytes","d:resourcetype","nc:has-preview","nc:is-encrypted","nc:mount-type","nc:share-attributes","oc:comments-unread","oc:favorite","oc:fileid","oc:owner-display-name","oc:owner-id","oc:permissions","oc:share-types","oc:size","ocs:share-permissions"],k={d:"DAV:",nc:"http://nextcloud.org/ns",oc:"http://owncloud.org/ns",ocs:"http://open-collaboration-services.org/ns"},I=function(){return typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...C]),window._nc_dav_properties.map((e=>`<${e} />`)).join(" ")},S=function(){return typeof window._nc_dav_namespaces>"u"&&(window._nc_dav_namespaces={...k}),Object.keys(window._nc_dav_namespaces).map((e=>`xmlns:${e}="${window._nc_dav_namespaces?.[e]}"`)).join(" ")},E=function(){return`<?xml version="1.0"?>\n\t\t<d:propfind ${S()}>\n\t\t\t<d:prop>\n\t\t\t\t${I()}\n\t\t\t</d:prop>\n\t\t</d:propfind>`},P=function(){return`<?xml version="1.0"?>\n\t\t<oc:filter-files ${S()}>\n\t\t\t<d:prop>\n\t\t\t\t${I()}\n\t\t\t</d:prop>\n\t\t\t<oc:filter-rules>\n\t\t\t\t<oc:favorite>1</oc:favorite>\n\t\t\t</oc:filter-rules>\n\t\t</oc:filter-files>`},L=function(e){return`<?xml version="1.0" encoding="UTF-8"?>\n<d:searchrequest ${S()}\n\txmlns:ns="https://github.com/icewind1991/SearchDAV/ns">\n\t<d:basicsearch>\n\t\t<d:select>\n\t\t\t<d:prop>\n\t\t\t\t${I()}\n\t\t\t</d:prop>\n\t\t</d:select>\n\t\t<d:from>\n\t\t\t<d:scope>\n\t\t\t\t<d:href>/files/${(0,n.ts)()?.uid}/</d:href>\n\t\t\t\t<d:depth>infinity</d:depth>\n\t\t\t</d:scope>\n\t\t</d:from>\n\t\t<d:where>\n\t\t\t<d:and>\n\t\t\t\t<d:or>\n\t\t\t\t\t<d:not>\n\t\t\t\t\t\t<d:eq>\n\t\t\t\t\t\t\t<d:prop>\n\t\t\t\t\t\t\t\t<d:getcontenttype/>\n\t\t\t\t\t\t\t</d:prop>\n\t\t\t\t\t\t\t<d:literal>httpd/unix-directory</d:literal>\n\t\t\t\t\t\t</d:eq>\n\t\t\t\t\t</d:not>\n\t\t\t\t\t<d:eq>\n\t\t\t\t\t\t<d:prop>\n\t\t\t\t\t\t\t<oc:size/>\n\t\t\t\t\t\t</d:prop>\n\t\t\t\t\t\t<d:literal>0</d:literal>\n\t\t\t\t\t</d:eq>\n\t\t\t\t</d:or>\n\t\t\t\t<d:gt>\n\t\t\t\t\t<d:prop>\n\t\t\t\t\t\t<d:getlastmodified/>\n\t\t\t\t\t</d:prop>\n\t\t\t\t\t<d:literal>${e}</d:literal>\n\t\t\t\t</d:gt>\n\t\t\t</d:and>\n\t\t</d:where>\n\t\t<d:orderby>\n\t\t\t<d:order>\n\t\t\t\t<d:prop>\n\t\t\t\t\t<d:getlastmodified/>\n\t\t\t\t</d:prop>\n\t\t\t\t<d:descending/>\n\t\t\t</d:order>\n\t\t</d:orderby>\n\t\t<d:limit>\n\t\t\t<d:nresults>100</d:nresults>\n\t\t\t<ns:firstresult>0</ns:firstresult>\n\t\t</d:limit>\n\t</d:basicsearch>\n</d:searchrequest>`},T=function(e=""){let t=N.NONE;return e&&((e.includes("C")||e.includes("K"))&&(t|=N.CREATE),e.includes("G")&&(t|=N.READ),(e.includes("W")||e.includes("N")||e.includes("V"))&&(t|=N.UPDATE),e.includes("D")&&(t|=N.DELETE),e.includes("R")&&(t|=N.SHARE)),t};var A=(e=>(e.Folder="folder",e.File="file",e))(A||{});const D=function(e,t){return null!==e.match(t)},Z=(e,t)=>{if(e.id&&"number"!=typeof e.id)throw new Error("Invalid id type of value");if(!e.source)throw new Error("Missing mandatory source");try{new URL(e.source)}catch{throw new Error("Invalid source format, source must be a valid URL")}if(!e.source.startsWith("http"))throw new Error("Invalid source format, only http(s) is supported");if(e.mtime&&!(e.mtime instanceof Date))throw new Error("Invalid mtime type");if(e.crtime&&!(e.crtime instanceof Date))throw new Error("Invalid crtime type");if(!e.mime||"string"!=typeof e.mime||!e.mime.match(/^[-\w.]+\/[-+\w.]+$/gi))throw new Error("Missing or invalid mandatory mime");if("size"in e&&"number"!=typeof e.size&&void 0!==e.size)throw new Error("Invalid size type");if("permissions"in e&&void 0!==e.permissions&&!("number"==typeof e.permissions&&e.permissions>=N.NONE&&e.permissions<=N.ALL))throw new Error("Invalid permissions");if(e.owner&&null!==e.owner&&"string"!=typeof e.owner)throw new Error("Invalid owner type");if(e.attributes&&"object"!=typeof e.attributes)throw new Error("Invalid attributes type");if(e.root&&"string"!=typeof e.root)throw new Error("Invalid root type");if(e.root&&!e.root.startsWith("/"))throw new Error("Root must start with a leading slash");if(e.root&&!e.source.includes(e.root))throw new Error("Root must be part of the source");if(e.root&&D(e.source,t)){const i=e.source.match(t)[0];if(!e.source.includes((0,o.join)(i,e.root)))throw new Error("The root must be relative to the service. e.g /files/emma")}if(e.status&&!Object.values(B).includes(e.status))throw new Error("Status must be a valid NodeStatus")};var B=(e=>(e.NEW="new",e.FAILED="failed",e.LOADING="loading",e.LOCKED="locked",e))(B||{});class M{_data;_attributes;_knownDavService=/(remote|public)\.php\/(web)?dav/i;constructor(e,t){Z(e,t||this._knownDavService),this._data=e;const i={set:(e,t,i)=>(this.updateMtime(),Reflect.set(e,t,i)),deleteProperty:(e,t)=>(this.updateMtime(),Reflect.deleteProperty(e,t))};this._attributes=new Proxy(e.attributes||{},i),delete this._data.attributes,t&&(this._knownDavService=t)}get source(){return this._data.source.replace(/\/$/i,"")}get encodedSource(){const{origin:e}=new URL(this.source);return e+(0,a.Ec)(this.source.slice(e.length))}get basename(){return(0,o.basename)(this.source)}get extension(){return(0,o.extname)(this.source)}get dirname(){if(this.root){const e=this.source.indexOf(this.root);return(0,o.dirname)(this.source.slice(e+this.root.length)||"/")}const e=new URL(this.source);return(0,o.dirname)(e.pathname)}get mime(){return this._data.mime}get mtime(){return this._data.mtime}get crtime(){return this._data.crtime}get size(){return this._data.size}get attributes(){return this._attributes}get permissions(){return null!==this.owner||this.isDavRessource?void 0!==this._data.permissions?this._data.permissions:N.NONE:N.READ}get owner(){return this.isDavRessource?this._data.owner:null}get isDavRessource(){return D(this.source,this._knownDavService)}get root(){return this._data.root?this._data.root.replace(/^(.+)\/$/,"$1"):this.isDavRessource&&(0,o.dirname)(this.source).split(this._knownDavService).pop()||null}get path(){if(this.root){const e=this.source.indexOf(this.root);return this.source.slice(e+this.root.length)||"/"}return(this.dirname+"/"+this.basename).replace(/\/\//g,"/")}get fileid(){return this._data?.id||this.attributes?.fileid}get status(){return this._data?.status}set status(e){this._data.status=e}move(e){Z({...this._data,source:e},this._knownDavService),this._data.source=e,this.updateMtime()}rename(e){if(e.includes("/"))throw new Error("Invalid basename");this.move((0,o.dirname)(this.source)+"/"+e)}updateMtime(){this._data.mtime&&(this._data.mtime=new Date)}}class O extends M{get type(){return A.File}}class F extends M{constructor(e){super({...e,mime:"httpd/unix-directory"})}get type(){return A.Folder}get extension(){return null}get mime(){return"httpd/unix-directory"}}const R=`/files/${(0,n.ts)()?.uid}`,j=(0,l.generateRemoteUrl)("dav"),z=function(e=j){const t=(0,c.eI)(e,{headers:{requesttoken:(0,n.IH)()||""}});return(0,c.lD)().patch("request",(e=>(e.headers?.method&&(e.method=e.headers.method,delete e.headers.method),(0,u.W)(e)))),t},V=async(e,t="/",i=R)=>(await e.getDirectoryContents(`${i}${t}`,{details:!0,data:P(),headers:{method:"REPORT"},includeSelf:!0})).data.filter((e=>e.filename!==t)).map((e=>$(e,i))),$=function(e,t=R,i=j){const r=e.props,s=T(r?.permissions),o=(0,n.ts)()?.uid,a={id:r?.fileid||0,source:`${i}${e.filename}`,mtime:new Date(Date.parse(e.lastmod)),mime:e.mime,size:r?.size||Number.parseInt(r.getcontentlength||"0"),permissions:s,owner:o,root:t,attributes:{...e,...r,hasPreview:r?.["has-preview"]}};return delete a.attributes?.props,"file"===e.type?new O(a):new F(a)};class H{_views=[];_currentView=null;register(e){if(this._views.find((t=>t.id===e.id)))throw new Error(`View id ${e.id} is already registered`);this._views.push(e)}remove(e){const t=this._views.findIndex((t=>t.id===e));-1!==t&&this._views.splice(t,1)}get views(){return this._views}setActive(e){this._currentView=e}get active(){return this._currentView}}const U=function(){return typeof window._nc_navigation>"u"&&(window._nc_navigation=new H,d.debug("Navigation service initialized")),window._nc_navigation};class G{_column;constructor(e){W(e),this._column=e}get id(){return this._column.id}get title(){return this._column.title}get render(){return this._column.render}get sort(){return this._column.sort}get summary(){return this._column.summary}}const W=function(e){if(!e.id||"string"!=typeof e.id)throw new Error("A column id is required");if(!e.title||"string"!=typeof e.title)throw new Error("A column title is required");if(!e.render||"function"!=typeof e.render)throw new Error("A render function is required");if(e.sort&&"function"!=typeof e.sort)throw new Error("Column sortFunction must be a function");if(e.summary&&"function"!=typeof e.summary)throw new Error("Column summary must be a function");return!0};var q={},Y={};!function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",i="["+t+"]["+t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",n=new RegExp("^"+i+"$");e.isExist=function(e){return typeof e<"u"},e.isEmptyObject=function(e){return 0===Object.keys(e).length},e.merge=function(e,t,i){if(t){const n=Object.keys(t),r=n.length;for(let s=0;s<r;s++)e[n[s]]="strict"===i?[t[n[s]]]:t[n[s]]}},e.getValue=function(t){return e.isExist(t)?t:""},e.isName=function(e){const t=n.exec(e);return!(null===t||typeof t>"u")},e.getAllMatches=function(e,t){const i=[];let n=t.exec(e);for(;n;){const r=[];r.startIndex=t.lastIndex-n[0].length;const s=n.length;for(let e=0;e<s;e++)r.push(n[e]);i.push(r),n=t.exec(e)}return i},e.nameRegexp=i}(Y);const Q=Y,X={allowBooleanAttributes:!1,unpairedTags:[]};function K(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function J(e,t){const i=t;for(;t<e.length;t++)if("?"==e[t]||" "==e[t]){const n=e.substr(i,t-i);if(t>5&&"xml"===n)return ae("InvalidXml","XML declaration allowed only at the start of the document.",ue(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}continue}return t}function ee(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let i=1;for(t+=8;t<e.length;t++)if("<"===e[t])i++;else if(">"===e[t]&&(i--,0===i))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}q.validate=function(e,t){t=Object.assign({},X,t);const i=[];let n=!1,r=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let s=0;s<e.length;s++)if("<"===e[s]&&"?"===e[s+1]){if(s+=2,s=J(e,s),s.err)return s}else{if("<"!==e[s]){if(K(e[s]))continue;return ae("InvalidChar","char '"+e[s]+"' is not expected.",ue(e,s))}{let o=s;if(s++,"!"===e[s]){s=ee(e,s);continue}{let a=!1;"/"===e[s]&&(a=!0,s++);let l="";for(;s<e.length&&">"!==e[s]&&" "!==e[s]&&"\t"!==e[s]&&"\n"!==e[s]&&"\r"!==e[s];s++)l+=e[s];if(l=l.trim(),"/"===l[l.length-1]&&(l=l.substring(0,l.length-1),s--),!ce(l)){let t;return t=0===l.trim().length?"Invalid space after '<'.":"Tag '"+l+"' is an invalid name.",ae("InvalidTag",t,ue(e,s))}const c=ne(e,s);if(!1===c)return ae("InvalidAttr","Attributes for '"+l+"' have open quote.",ue(e,s));let u=c.value;if(s=c.index,"/"===u[u.length-1]){const i=s-u.length;u=u.substring(0,u.length-1);const r=se(u,t);if(!0!==r)return ae(r.err.code,r.err.msg,ue(e,i+r.err.line));n=!0}else if(a){if(!c.tagClosed)return ae("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",ue(e,s));if(u.trim().length>0)return ae("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",ue(e,o));{const t=i.pop();if(l!==t.tagName){let i=ue(e,t.tagStartPos);return ae("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+i.line+", col "+i.col+") instead of closing tag '"+l+"'.",ue(e,o))}0==i.length&&(r=!0)}}else{const a=se(u,t);if(!0!==a)return ae(a.err.code,a.err.msg,ue(e,s-u.length+a.err.line));if(!0===r)return ae("InvalidXml","Multiple possible root nodes found.",ue(e,s));-1!==t.unpairedTags.indexOf(l)||i.push({tagName:l,tagStartPos:o}),n=!0}for(s++;s<e.length;s++)if("<"===e[s]){if("!"===e[s+1]){s++,s=ee(e,s);continue}if("?"!==e[s+1])break;if(s=J(e,++s),s.err)return s}else if("&"===e[s]){const t=oe(e,s);if(-1==t)return ae("InvalidChar","char '&' is not expected.",ue(e,s));s=t}else if(!0===r&&!K(e[s]))return ae("InvalidXml","Extra text at the end",ue(e,s));"<"===e[s]&&s--}}}return n?1==i.length?ae("InvalidTag","Unclosed tag '"+i[0].tagName+"'.",ue(e,i[0].tagStartPos)):!(i.length>0)||ae("InvalidXml","Invalid '"+JSON.stringify(i.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):ae("InvalidXml","Start tag expected.",1)};const te='"',ie="'";function ne(e,t){let i="",n="",r=!1;for(;t<e.length;t++){if(e[t]===te||e[t]===ie)""===n?n=e[t]:n!==e[t]||(n="");else if(">"===e[t]&&""===n){r=!0;break}i+=e[t]}return""===n&&{value:i,index:t,tagClosed:r}}const re=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function se(e,t){const i=Q.getAllMatches(e,re),n={};for(let e=0;e<i.length;e++){if(0===i[e][1].length)return ae("InvalidAttr","Attribute '"+i[e][2]+"' has no space in starting.",de(i[e]));if(void 0!==i[e][3]&&void 0===i[e][4])return ae("InvalidAttr","Attribute '"+i[e][2]+"' is without value.",de(i[e]));if(void 0===i[e][3]&&!t.allowBooleanAttributes)return ae("InvalidAttr","boolean attribute '"+i[e][2]+"' is not allowed.",de(i[e]));const r=i[e][2];if(!le(r))return ae("InvalidAttr","Attribute '"+r+"' is an invalid name.",de(i[e]));if(n.hasOwnProperty(r))return ae("InvalidAttr","Attribute '"+r+"' is repeated.",de(i[e]));n[r]=1}return!0}function oe(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let i=/\d/;for("x"===e[t]&&(t++,i=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(i))break}return-1}(e,++t);let i=0;for(;t<e.length;t++,i++)if(!(e[t].match(/\w/)&&i<20)){if(";"===e[t])break;return-1}return t}function ae(e,t,i){return{err:{code:e,msg:t,line:i.line||i,col:i.col}}}function le(e){return Q.isName(e)}function ce(e){return Q.isName(e)}function ue(e,t){const i=e.substring(0,t).split(/\r?\n/);return{line:i.length,col:i[i.length-1].length+1}}function de(e){return e.startIndex+e[1].length}var pe={};const he={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,i){return e}};pe.buildOptions=function(e){return Object.assign({},he,e)},pe.defaultOptions=he;const fe=Y;function me(e,t){let i="";for(;t<e.length&&"'"!==e[t]&&'"'!==e[t];t++)i+=e[t];if(i=i.trim(),-1!==i.indexOf(" "))throw new Error("External entites are not supported");const n=e[t++];let r="";for(;t<e.length&&e[t]!==n;t++)r+=e[t];return[i,r,t]}function ge(e,t){return"!"===e[t+1]&&"-"===e[t+2]&&"-"===e[t+3]}function ve(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7]}function we(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8]}function ye(e,t){return"!"===e[t+1]&&"A"===e[t+2]&&"T"===e[t+3]&&"T"===e[t+4]&&"L"===e[t+5]&&"I"===e[t+6]&&"S"===e[t+7]&&"T"===e[t+8]}function _e(e,t){return"!"===e[t+1]&&"N"===e[t+2]&&"O"===e[t+3]&&"T"===e[t+4]&&"A"===e[t+5]&&"T"===e[t+6]&&"I"===e[t+7]&&"O"===e[t+8]&&"N"===e[t+9]}function be(e){if(fe.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}const xe=/^[-+]?0x[a-fA-F0-9]+$/,Ne=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Ce={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};const ke=Y,Ie=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){"__proto__"===e&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){"__proto__"===e.tagname&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}},Se=function(e,t){const i={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let n=1,r=!1,s=!1,o="";for(;t<e.length;t++)if("<"!==e[t]||s)if(">"===e[t]){if(s?"-"===e[t-1]&&"-"===e[t-2]&&(s=!1,n--):n--,0===n)break}else"["===e[t]?r=!0:o+=e[t];else{if(r&&ve(e,t))t+=7,[entityName,val,t]=me(e,t+1),-1===val.indexOf("&")&&(i[be(entityName)]={regx:RegExp(`&${entityName};`,"g"),val:val});else if(r&&we(e,t))t+=8;else if(r&&ye(e,t))t+=8;else if(r&&_e(e,t))t+=9;else{if(!ge)throw new Error("Invalid DOCTYPE");s=!0}n++,o=""}if(0!==n)throw new Error("Unclosed DOCTYPE")}return{entities:i,i:t}},Ee=function(e,t={}){if(t=Object.assign({},Ce,t),!e||"string"!=typeof e)return e;let i=e.trim();if(void 0!==t.skipLike&&t.skipLike.test(i))return e;if(t.hex&&xe.test(i))return Number.parseInt(i,16);{const n=Ne.exec(i);if(n){const r=n[1],s=n[2];let o=function(e){return e&&-1!==e.indexOf(".")&&("."===(e=e.replace(/0+$/,""))?e="0":"."===e[0]?e="0"+e:"."===e[e.length-1]&&(e=e.substr(0,e.length-1))),e}(n[3]);const a=n[4]||n[6];if(!t.leadingZeros&&s.length>0&&r&&"."!==i[2])return e;if(!t.leadingZeros&&s.length>0&&!r&&"."!==i[1])return e;{const n=Number(i),l=""+n;return-1!==l.search(/[eE]/)||a?t.eNotation?n:e:-1!==i.indexOf(".")?"0"===l&&""===o||l===o||r&&l==="-"+o?n:e:s?o===l||r+o===l?n:e:i===l||i===r+l?n:e}}return e}};function Pe(e){const t=Object.keys(e);for(let i=0;i<t.length;i++){const n=t[i];this.lastEntities[n]={regex:new RegExp("&"+n+";","g"),val:e[n]}}}function Le(e,t,i,n,r,s,o){if(void 0!==e&&(this.options.trimValues&&!n&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));const n=this.options.tagValueProcessor(t,e,i,r,s);return null==n?e:typeof n!=typeof e||n!==e?n:this.options.trimValues||e.trim()===e?Ve(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function Te(e){if(this.options.removeNSPrefix){const t=e.split(":"),i="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=i+t[1])}return e}"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,ke.nameRegexp);const Ae=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function De(e,t,i){if(!this.options.ignoreAttributes&&"string"==typeof e){const i=ke.getAllMatches(e,Ae),n=i.length,r={};for(let e=0;e<n;e++){const n=this.resolveNameSpace(i[e][1]);let s=i[e][4],o=this.options.attributeNamePrefix+n;if(n.length)if(this.options.transformAttributeName&&(o=this.options.transformAttributeName(o)),"__proto__"===o&&(o="#__proto__"),void 0!==s){this.options.trimValues&&(s=s.trim()),s=this.replaceEntitiesValue(s);const e=this.options.attributeValueProcessor(n,s,t);r[o]=null==e?s:typeof e!=typeof s||e!==s?e:Ve(s,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(r[o]=!0)}if(!Object.keys(r).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=r,e}return r}}const Ze=function(e){e=e.replace(/\r\n?/g,"\n");const t=new Ie("!xml");let i=t,n="",r="";for(let s=0;s<e.length;s++)if("<"===e[s])if("/"===e[s+1]){const t=Re(e,">",s,"Closing Tag is not closed.");let o=e.substring(s+2,t).trim();if(this.options.removeNSPrefix){const e=o.indexOf(":");-1!==e&&(o=o.substr(e+1))}this.options.transformTagName&&(o=this.options.transformTagName(o)),i&&(n=this.saveTextToParentTag(n,i,r));const a=r.substring(r.lastIndexOf(".")+1);if(o&&-1!==this.options.unpairedTags.indexOf(o))throw new Error(`Unpaired tag can not be used as closing tag: </${o}>`);let l=0;a&&-1!==this.options.unpairedTags.indexOf(a)?(l=r.lastIndexOf(".",r.lastIndexOf(".")-1),this.tagsNodeStack.pop()):l=r.lastIndexOf("."),r=r.substring(0,l),i=this.tagsNodeStack.pop(),n="",s=t}else if("?"===e[s+1]){let t=je(e,s,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(n=this.saveTextToParentTag(n,i,r),!(this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags)){const e=new Ie(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,r,t.tagName)),this.addChild(i,e,r)}s=t.closeIndex+1}else if("!--"===e.substr(s+1,3)){const t=Re(e,"--\x3e",s+4,"Comment is not closed.");if(this.options.commentPropName){const o=e.substring(s+4,t-2);n=this.saveTextToParentTag(n,i,r),i.add(this.options.commentPropName,[{[this.options.textNodeName]:o}])}s=t}else if("!D"===e.substr(s+1,2)){const t=Se(e,s);this.docTypeEntities=t.entities,s=t.i}else if("!["===e.substr(s+1,2)){const t=Re(e,"]]>",s,"CDATA is not closed.")-2,o=e.substring(s+9,t);if(n=this.saveTextToParentTag(n,i,r),this.options.cdataPropName)i.add(this.options.cdataPropName,[{[this.options.textNodeName]:o}]);else{let e=this.parseTextData(o,i.tagname,r,!0,!1,!0);null==e&&(e=""),i.add(this.options.textNodeName,e)}s=t+2}else{let o=je(e,s,this.options.removeNSPrefix),a=o.tagName;const l=o.rawTagName;let c=o.tagExp,u=o.attrExpPresent,d=o.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),i&&n&&"!xml"!==i.tagname&&(n=this.saveTextToParentTag(n,i,r,!1));const p=i;if(p&&-1!==this.options.unpairedTags.indexOf(p.tagname)&&(i=this.tagsNodeStack.pop(),r=r.substring(0,r.lastIndexOf("."))),a!==t.tagname&&(r+=r?"."+a:a),this.isItStopNode(this.options.stopNodes,r,a)){let t="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)s=o.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(a))s=o.closeIndex;else{const i=this.readStopNodeData(e,l,d+1);if(!i)throw new Error(`Unexpected end of ${l}`);s=i.i,t=i.tagContent}const n=new Ie(a);a!==c&&u&&(n[":@"]=this.buildAttributesMap(c,r,a)),t&&(t=this.parseTextData(t,a,r,!0,u,!0,!0)),r=r.substr(0,r.lastIndexOf(".")),n.add(this.options.textNodeName,t),this.addChild(i,n,r)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){"/"===a[a.length-1]?(a=a.substr(0,a.length-1),r=r.substr(0,r.length-1),c=a):c=c.substr(0,c.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));const e=new Ie(a);a!==c&&u&&(e[":@"]=this.buildAttributesMap(c,r,a)),this.addChild(i,e,r),r=r.substr(0,r.lastIndexOf("."))}else{const e=new Ie(a);this.tagsNodeStack.push(i),a!==c&&u&&(e[":@"]=this.buildAttributesMap(c,r,a)),this.addChild(i,e,r),i=e}n="",s=d}}else n+=e[s];return t.child};function Be(e,t,i){const n=this.options.updateTag(t.tagname,i,t[":@"]);!1===n||("string"==typeof n&&(t.tagname=n),e.addChild(t))}const Me=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const i=this.docTypeEntities[t];e=e.replace(i.regx,i.val)}for(let t in this.lastEntities){const i=this.lastEntities[t];e=e.replace(i.regex,i.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const i=this.htmlEntities[t];e=e.replace(i.regex,i.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function Oe(e,t,i,n){return e&&(void 0===n&&(n=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,i,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,n))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function Fe(e,t,i){const n="*."+i;for(const i in e){const r=e[i];if(n===r||t===r)return!0}return!1}function Re(e,t,i,n){const r=e.indexOf(t,i);if(-1===r)throw new Error(n);return r+t.length-1}function je(e,t,i,n=">"){const r=function(e,t,i=">"){let n,r="";for(let s=t;s<e.length;s++){let t=e[s];if(n)t===n&&(n="");else if('"'===t||"'"===t)n=t;else if(t===i[0]){if(!i[1])return{data:r,index:s};if(e[s+1]===i[1])return{data:r,index:s}}else"\t"===t&&(t=" ");r+=t}}(e,t+1,n);if(!r)return;let s=r.data;const o=r.index,a=s.search(/\s/);let l=s,c=!0;-1!==a&&(l=s.substr(0,a).replace(/\s\s*$/,""),s=s.substr(a+1));const u=l;if(i){const e=l.indexOf(":");-1!==e&&(l=l.substr(e+1),c=l!==r.data.substr(e+1))}return{tagName:l,tagExp:s,closeIndex:o,attrExpPresent:c,rawTagName:u}}function ze(e,t,i){const n=i;let r=1;for(;i<e.length;i++)if("<"===e[i])if("/"===e[i+1]){const s=Re(e,">",i,`${t} is not closed`);if(e.substring(i+2,s).trim()===t&&(r--,0===r))return{tagContent:e.substring(n,i),i:s};i=s}else if("?"===e[i+1])i=Re(e,"?>",i+1,"StopNode is not closed.");else if("!--"===e.substr(i+1,3))i=Re(e,"--\x3e",i+3,"StopNode is not closed.");else if("!["===e.substr(i+1,2))i=Re(e,"]]>",i,"StopNode is not closed.")-2;else{const n=je(e,i,">");n&&((n&&n.tagName)===t&&"/"!==n.tagExp[n.tagExp.length-1]&&r++,i=n.closeIndex)}}function Ve(e,t,i){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&Ee(e,i)}return ke.isExist(e)?e:""}var $e={};function He(e,t,i){let n;const r={};for(let s=0;s<e.length;s++){const o=e[s],a=Ue(o);let l="";if(l=void 0===i?a:i+"."+a,a===t.textNodeName)void 0===n?n=o[a]:n+=""+o[a];else{if(void 0===a)continue;if(o[a]){let e=He(o[a],t,l);const i=We(e,t);o[":@"]?Ge(e,o[":@"],l,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==r[a]&&r.hasOwnProperty(a)?(Array.isArray(r[a])||(r[a]=[r[a]]),r[a].push(e)):t.isArray(a,l,i)?r[a]=[e]:r[a]=e}}}return"string"==typeof n?n.length>0&&(r[t.textNodeName]=n):void 0!==n&&(r[t.textNodeName]=n),r}function Ue(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const i=t[e];if(":@"!==i)return i}}function Ge(e,t,i,n){if(t){const r=Object.keys(t),s=r.length;for(let o=0;o<s;o++){const s=r[o];n.isArray(s,i+"."+s,!0,!0)?e[s]=[t[s]]:e[s]=t[s]}}}function We(e,t){const{textNodeName:i}=t,n=Object.keys(e).length;return!(0!==n&&(1!==n||!e[i]&&"boolean"!=typeof e[i]&&0!==e[i]))}$e.prettify=function(e,t){return He(e,t)};const{buildOptions:qe}=pe,Ye=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"}},this.addExternalEntities=Pe,this.parseXml=Ze,this.parseTextData=Le,this.resolveNameSpace=Te,this.buildAttributesMap=De,this.isItStopNode=Fe,this.replaceEntitiesValue=Me,this.readStopNodeData=ze,this.saveTextToParentTag=Oe,this.addChild=Be}},{prettify:Qe}=$e,Xe=q;function Ke(e,t,i,n){let r="",s=!1;for(let o=0;o<e.length;o++){const a=e[o],l=Je(a);if(void 0===l)continue;let c="";if(c=0===i.length?l:`${i}.${l}`,l===t.textNodeName){let e=a[l];tt(c,t)||(e=t.tagValueProcessor(l,e),e=it(e,t)),s&&(r+=n),r+=e,s=!1;continue}if(l===t.cdataPropName){s&&(r+=n),r+=`<![CDATA[${a[l][0][t.textNodeName]}]]>`,s=!1;continue}if(l===t.commentPropName){r+=n+`\x3c!--${a[l][0][t.textNodeName]}--\x3e`,s=!0;continue}if("?"===l[0]){const e=et(a[":@"],t),i="?xml"===l?"":n;let o=a[l][0][t.textNodeName];o=0!==o.length?" "+o:"",r+=i+`<${l}${o}${e}?>`,s=!0;continue}let u=n;""!==u&&(u+=t.indentBy);const d=n+`<${l}${et(a[":@"],t)}`,p=Ke(a[l],t,c,u);-1!==t.unpairedTags.indexOf(l)?t.suppressUnpairedNode?r+=d+">":r+=d+"/>":p&&0!==p.length||!t.suppressEmptyNode?p&&p.endsWith(">")?r+=d+`>${p}${n}</${l}>`:(r+=d+">",p&&""!==n&&(p.includes("/>")||p.includes("</"))?r+=n+t.indentBy+p+n:r+=p,r+=`</${l}>`):r+=d+"/>",s=!0}return r}function Je(e){const t=Object.keys(e);for(let i=0;i<t.length;i++){const n=t[i];if(e.hasOwnProperty(n)&&":@"!==n)return n}}function et(e,t){let i="";if(e&&!t.ignoreAttributes)for(let n in e){if(!e.hasOwnProperty(n))continue;let r=t.attributeValueProcessor(n,e[n]);r=it(r,t),!0===r&&t.suppressBooleanAttributes?i+=` ${n.substr(t.attributeNamePrefix.length)}`:i+=` ${n.substr(t.attributeNamePrefix.length)}="${r}"`}return i}function tt(e,t){let i=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let n in t.stopNodes)if(t.stopNodes[n]===e||t.stopNodes[n]==="*."+i)return!0;return!1}function it(e,t){if(e&&e.length>0&&t.processEntities)for(let i=0;i<t.entities.length;i++){const n=t.entities[i];e=e.replace(n.regex,n.val)}return e}const nt=function(e,t){let i="";return t.format&&t.indentBy.length>0&&(i="\n"),Ke(e,t,"",i)},rt={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function st(e){this.options=Object.assign({},rt,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=lt),this.processTextOrObjNode=ot,this.options.format?(this.indentate=at,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function ot(e,t,i){const n=this.j2x(e,i+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextValNode(e[this.options.textNodeName],t,n.attrStr,i):this.buildObjectNode(n.val,t,n.attrStr,i)}function at(e){return this.options.indentBy.repeat(e)}function lt(e){return!(!e.startsWith(this.options.attributeNamePrefix)||e===this.options.textNodeName)&&e.substr(this.attrPrefixLen)}st.prototype.build=function(e){return this.options.preserveOrder?nt(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)},st.prototype.j2x=function(e,t){let i="",n="";for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r))if(typeof e[r]>"u")this.isAttribute(r)&&(n+="");else if(null===e[r])this.isAttribute(r)?n+="":"?"===r[0]?n+=this.indentate(t)+"<"+r+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+r+"/"+this.tagEndChar;else if(e[r]instanceof Date)n+=this.buildTextValNode(e[r],r,"",t);else if("object"!=typeof e[r]){const s=this.isAttribute(r);if(s)i+=this.buildAttrPairStr(s,""+e[r]);else if(r===this.options.textNodeName){let t=this.options.tagValueProcessor(r,""+e[r]);n+=this.replaceEntitiesValue(t)}else n+=this.buildTextValNode(e[r],r,"",t)}else if(Array.isArray(e[r])){const i=e[r].length;let s="";for(let o=0;o<i;o++){const i=e[r][o];typeof i>"u"||(null===i?"?"===r[0]?n+=this.indentate(t)+"<"+r+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+r+"/"+this.tagEndChar:"object"==typeof i?this.options.oneListGroup?s+=this.j2x(i,t+1).val:s+=this.processTextOrObjNode(i,r,t):s+=this.buildTextValNode(i,r,"",t))}this.options.oneListGroup&&(s=this.buildObjectNode(s,r,"",t)),n+=s}else if(this.options.attributesGroupName&&r===this.options.attributesGroupName){const t=Object.keys(e[r]),n=t.length;for(let s=0;s<n;s++)i+=this.buildAttrPairStr(t[s],""+e[r][t[s]])}else n+=this.processTextOrObjNode(e[r],r,t);return{attrStr:i,val:n}},st.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'},st.prototype.buildObjectNode=function(e,t,i,n){if(""===e)return"?"===t[0]?this.indentate(n)+"<"+t+i+"?"+this.tagEndChar:this.indentate(n)+"<"+t+i+this.closeTag(t)+this.tagEndChar;{let r="</"+t+this.tagEndChar,s="";return"?"===t[0]&&(s="?",r=""),!i&&""!==i||-1!==e.indexOf("<")?!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===s.length?this.indentate(n)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(n)+"<"+t+i+s+this.tagEndChar+e+this.indentate(n)+r:this.indentate(n)+"<"+t+i+s+">"+e+r}},st.prototype.closeTag=function(e){let t="";return-1!==this.options.unpairedTags.indexOf(e)?this.options.suppressUnpairedNode||(t="/"):t=this.options.suppressEmptyNode?"/":`></${e}`,t},st.prototype.buildTextValNode=function(e,t,i,n){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(n)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(n)+`\x3c!--${e}--\x3e`+this.newLine;if("?"===t[0])return this.indentate(n)+"<"+t+i+"?"+this.tagEndChar;{let r=this.options.tagValueProcessor(t,e);return r=this.replaceEntitiesValue(r),""===r?this.indentate(n)+"<"+t+i+this.closeTag(t)+this.tagEndChar:this.indentate(n)+"<"+t+i+">"+r+"</"+t+this.tagEndChar}},st.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const i=this.options.entities[t];e=e.replace(i.regex,i.val)}return e};var ct={XMLParser:class{constructor(e){this.externalEntities={},this.options=qe(e)}parse(e,t){if("string"!=typeof e){if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const i=Xe.validate(e,t);if(!0!==i)throw Error(`${i.err.msg}:${i.err.line}:${i.err.col}`)}const i=new Ye(this.options);i.addExternalEntities(this.externalEntities);const n=i.parseXml(e);return this.options.preserveOrder||void 0===n?n:Qe(n,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===t)throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}},XMLValidator:q,XMLBuilder:st};class ut{_view;constructor(e){dt(e),this._view=e}get id(){return this._view.id}get name(){return this._view.name}get caption(){return this._view.caption}get emptyTitle(){return this._view.emptyTitle}get emptyCaption(){return this._view.emptyCaption}get getContents(){return this._view.getContents}get icon(){return this._view.icon}set icon(e){this._view.icon=e}get order(){return this._view.order}set order(e){this._view.order=e}get params(){return this._view.params}set params(e){this._view.params=e}get columns(){return this._view.columns}get emptyView(){return this._view.emptyView}get parent(){return this._view.parent}get sticky(){return this._view.sticky}get expanded(){return this._view.expanded}set expanded(e){this._view.expanded=e}get defaultSortKey(){return this._view.defaultSortKey}}const dt=function(e){if(!e.id||"string"!=typeof e.id)throw new Error("View id is required and must be a string");if(!e.name||"string"!=typeof e.name)throw new Error("View name is required and must be a string");if(e.columns&&e.columns.length>0&&(!e.caption||"string"!=typeof e.caption))throw new Error("View caption is required for top-level views and must be a string");if(!e.getContents||"function"!=typeof e.getContents)throw new Error("View getContents is required and must be a function");if(!e.icon||"string"!=typeof e.icon||!function(e){if("string"!=typeof e)throw new TypeError(`Expected a \`string\`, got \`${typeof e}\``);if(0===(e=e.trim()).length||!0!==ct.XMLValidator.validate(e))return!1;let t;const i=new ct.XMLParser;try{t=i.parse(e)}catch{return!1}return!(!t||!("svg"in t))}(e.icon))throw new Error("View icon is required and must be a valid svg string");if(!("order"in e)||"number"!=typeof e.order)throw new Error("View order is required and must be a number");if(e.columns&&e.columns.forEach((e=>{if(!(e instanceof G))throw new Error("View columns must be an array of Column. Invalid column found")})),e.emptyView&&"function"!=typeof e.emptyView)throw new Error("View emptyView must be a function");if(e.parent&&"string"!=typeof e.parent)throw new Error("View parent must be a string");if("sticky"in e&&"boolean"!=typeof e.sticky)throw new Error("View sticky must be a boolean");if("expanded"in e&&"boolean"!=typeof e.expanded)throw new Error("View expanded must be a boolean");if(e.defaultSortKey&&"string"!=typeof e.defaultSortKey)throw new Error("View defaultSortKey must be a string");return!0},pt=function(e){return f().registerEntry(e)},ht=function(e){return f().unregisterEntry(e)},ft=function(e){return f().getEntries(e).sort(((e,t)=>void 0!==e.order&&void 0!==t.order?e.order-t.order:e.displayName.localeCompare(t.displayName)))}},41604:function(e,t,i){"use strict";i.d(t,{N:function(){return E}});var n=i(59768),r=i(93664),s=i(79753),o=i(76311),a=i(28600),l=i(21955),c=i(10979),u=i(41074),d=i(38878),p=i(27172),h=i(20469),f=i(66875),m=i(72090),g=i(25108);const v=/(\s|^)(https?:\/\/)((?:[-A-Z0-9+_]+\.)+[-A-Z]+(?:\/[-A-Z0-9+&@#%?=~_|!:,.;()]*)*)(\s|$)/gi,w=/(\s|\(|^)((https?:\/\/)((?:[-A-Z0-9+_]+\.)+[-A-Z0-9]+(?::[0-9]+)?(?:\/[-A-Z0-9+&@#%?=~_|!:,.;()]*)*))(?=\s|\)|$)/gi,y={name:"NcReferenceList",components:{NcReferenceWidget:n.N},props:{text:{type:String,default:""},referenceData:{type:Object,default:null},limit:{type:Number,default:1}},data(){return{references:null,loading:!0}},computed:{isVisible(){return this.loading||this.displayedReferences},values(){return this.referenceData?this.referenceData:this.references?Object.values(this.references):[]},firstReference(){var e;return null!=(e=this.values[0])?e:null},displayedReferences(){return this.values.slice(0,this.limit)}},watch:{text:"fetch"},mounted(){this.fetch()},methods:{fetch(){this.loading=!0,this.referenceData?this.loading=!1:new RegExp(v).exec(this.text)?this.resolve().then((e=>{this.references=e.data.ocs.data.references,this.loading=!1})).catch((e=>{g.error("Failed to extract references",e),this.loading=!1})):this.loading=!1},resolve(){const e=new RegExp(v).exec(this.text.trim());return 1===this.limit&&e?r.Z.get((0,s.generateOcsUrl)("references/resolve",2)+`?reference=${encodeURIComponent(e[0])}`):r.Z.post((0,s.generateOcsUrl)("references/extract",2),{text:this.text,resolve:!0,limit:this.limit})}}};var _=function(){var e=this,t=e._self._c;return e.isVisible?t("div",{staticClass:"widgets--list",class:{"icon-loading":e.loading}},e._l(e.displayedReferences,(function(e){var i;return t("div",{key:null==(i=null==e?void 0:e.openGraphObject)?void 0:i.id},[t("NcReferenceWidget",{attrs:{reference:e}})],1)})),0):e._e()},b=[];const x=(0,o.n)(y,_,b,!1,null,"bd1fbb02",null,null).exports,N={name:"NcLink",props:{href:{type:String,required:!0}},render(e){return e("a",{attrs:{href:this.href,rel:"noopener noreferrer",target:"_blank",class:"rich-text--external-link"}},[this.href.trim()])}},C=function({autolink:e,useMarkdown:t}){return function(i){!t||!e||(0,a.Vn)(i,(e=>"text"===e.type),((e,t,i)=>{let n=k(e.value);return n=n.map((e=>"string"==typeof e?(0,c.u)("text",e):(0,c.u)("link",{url:e.props.href},[(0,c.u)("text",e.props.href)]))).filter((e=>e)),i.children.splice(t,1,...n.flat()),[l.AM,t+n.flat().length]}))}},k=e=>{let t=w.exec(e);const i=[];let n=0;for(;null!==t;){let r,s=t[2],o=e.substring(n,t.index+t[1].length);" "===s[0]&&(o+=s[0],s=s.substring(1).trim());const a=s[s.length-1];("."===a||","===a||";"===a||"("===t[0][0]&&")"===a)&&(s=s.substring(0,s.length-1),r=a),i.push(o),i.push({component:N,props:{href:s}}),r&&i.push(r),n=t.index+t[0].length,t=w.exec(e)}return i.push(e.substring(n)),e===i.map((e=>"string"==typeof e?e:e.props.href)).join("")?i:(g.error("Failed to reassemble the chunked text: "+e),e)},I=function(){return function(e){(0,a.Vn)(e,(e=>"text"===e.type),(function(e,t,i){const n=e.value.split(/(\{[a-z\-_.0-9]+\})/gi).map(((e,t,i)=>{const n=e.match(/^\{([a-z\-_.0-9]+)\}$/i);if(!n)return(0,c.u)("text",e);const[,r]=n;return(0,c.u)("element",{tagName:`#${r}`})}));i.children.splice(t,1,...n)}))}},S={name:"NcRichText",components:{NcReferenceList:x},props:{text:{type:String,default:""},arguments:{type:Object,default:()=>({})},referenceLimit:{type:Number,default:0},references:{type:Object,default:null},markdownCssClasses:{type:Object,default:()=>({a:"rich-text--external-link",ol:"rich-text--ordered-list",ul:"rich-text--un-ordered-list",li:"rich-text--list-item",strong:"rich-text--strong",em:"rich-text--italic",h1:"rich-text--heading rich-text--heading-1",h2:"rich-text--heading rich-text--heading-2",h3:"rich-text--heading rich-text--heading-3",h4:"rich-text--heading rich-text--heading-4",h5:"rich-text--heading rich-text--heading-5",h6:"rich-text--heading rich-text--heading-6",hr:"rich-text--hr",table:"rich-text--table",pre:"rich-text--pre",code:"rich-text--code",blockquote:"rich-text--blockquote"})},useMarkdown:{type:Boolean,default:!1},autolink:{type:Boolean,default:!0}},methods:{renderPlaintext(e){const t=this,i=this.text.split(/(\{[a-z\-_.0-9]+\})/gi).map((function(i,n,r){const s=i.match(/^\{([a-z\-_.0-9]+)\}$/i);if(!s)return(({h:e,context:t},i)=>(t.autolink&&(i=k(i)),Array.isArray(i)?i.map((t=>{if("string"==typeof t)return t;const{component:i,props:n}=t,r="NcLink"===i.name?void 0:"rich-text--component";return e(i,{props:n,class:r})})):i))({h:e,context:t},i);const o=s[1],a=t.arguments[o];if("object"==typeof a){const{component:t,props:i}=a;return e(t,{props:i,class:"rich-text--component"})}return a?e("span",{class:"rich-text--fallback"},a):i}));return e("div",{class:"rich-text--wrapper"},[e("div",{},i.flat()),this.referenceLimit>0?e("div",{class:"rich-text--reference-widget"},[e(x,{props:{text:this.text,referenceData:this.references}})]):null])},renderMarkdown(e){const t=(0,u.l)().use(d.Z).use(C,{autolink:this.autolink,useMarkdown:this.useMarkdown}).use(p.Z).use(h.Z,{handlers:{component(e,t){return e(t,t.component,{value:t.value})}}}).use(I).use(m.Z,{target:"_blank",rel:["noopener noreferrer"]}).use(f.Z,{createElement:(t,i,n)=>{if(n=null==n?void 0:n.map((e=>"string"==typeof e?e.replace(/&lt;/gim,"<"):e)),!t.startsWith("#"))return e(t,i,n);const r=this.arguments[t.slice(1)];return r?r.component?e(r.component,{attrs:i,props:r.props,class:"rich-text--component"},n):e("span",i,[r]):e("span",{attrs:i,class:"rich-text--fallback"},[`{${t.slice(1)}}`])},prefix:!1}).processSync(this.text.replace(/</gim,"&lt;").replace(/&gt;/gim,">")).result;return e("div",{class:"rich-text--wrapper rich-text--wrapper-markdown"},[t,this.referenceLimit>0?e("div",{class:"rich-text--reference-widget"},[e(x,{props:{text:this.text,referenceData:this.references}})]):null])}},render(e){return this.useMarkdown?this.renderMarkdown(e):this.renderPlaintext(e)}},E=(0,o.n)(S,null,null,!1,null,"5f33f45b",null,null).exports},59768:function(e,t,i){"use strict";i.d(t,{N:function(){return I},e:function(){return S},f:function(){return P},j:function(){return de},n:function(){return O},r:function(){return x}}),i(47522);var n=i(76311),r=i(74917),s=i(93664),o=i(43554),a=i(79753),l=i(86514),c=i(40873),u=i(61537),d=i(25751),p=i(20435),h=i(49368),f=i(89115),m=i(57274),g=i(6136),v=i(69183),w=i(32219),y=i(82675),_=i(20144),b=i(25108);window._vue_richtext_widgets||(window._vue_richtext_widgets={});const x=(e,t,i=(e=>{}))=>{window._vue_richtext_widgets[e]?b.error("Widget for id "+e+" already registered"):window._vue_richtext_widgets[e]={id:e,callback:t,onDestroy:i}};window._registerWidget=x;const N={name:"NcReferenceWidget",props:{reference:{type:Object,required:!0}},data(){return{compact:3}},computed:{hasCustomWidget(){return e=this.reference.richObjectType,!!window._vue_richtext_widgets[e];var e},noAccess(){return this.reference&&!this.reference.accessible},descriptionStyle(){if(0===this.compact)return{display:"none"};const e=this.compact<4?this.compact:3;return{lineClamp:e,webkitLineClamp:e}},compactLink(){const e=this.reference.openGraphObject.link;return e?e.startsWith("https://")?e.substring(8):e.startsWith("http://")?e.substring(7):e:""}},mounted(){this.renderWidget(),this.observer=new ResizeObserver((e=>{e[0].contentRect.width<450?this.compact=0:e[0].contentRect.width<550?this.compact=1:e[0].contentRect.width<650?this.compact=2:this.compact=3})),this.observer.observe(this.$el)},beforeDestroy(){var e,t;this.observer.disconnect(),e=this.reference.richObjectType,t=this.$el,"open-graph"!==e&&window._vue_richtext_widgets[e]&&window._vue_richtext_widgets[e].onDestroy(t)},methods:{renderWidget(){var e;this.$refs.customWidget&&(this.$refs.customWidget.innerHTML=""),"open-graph"!==(null==(e=null==this?void 0:this.reference)?void 0:e.richObjectType)&&this.$nextTick((()=>{((e,{richObjectType:t,richObject:i,accessible:n})=>{if("open-graph"!==t){if(!window._vue_richtext_widgets[t])return void b.error("Widget for rich object type "+t+" not registered");window._vue_richtext_widgets[t].callback(e,{richObjectType:t,richObject:i,accessible:n})}})(this.$refs.customWidget,this.reference)}))}}};var C=function(){var e=this,t=e._self._c;return t("div",[e.reference&&e.hasCustomWidget?t("div",{staticClass:"widget-custom"},[t("div",{ref:"customWidget"})]):!e.noAccess&&e.reference&&e.reference.openGraphObject&&!e.hasCustomWidget?t("a",{staticClass:"widget-default",attrs:{href:e.reference.openGraphObject.link,rel:"noopener noreferrer",target:"_blank"}},[e.reference.openGraphObject.thumb?t("img",{staticClass:"widget-default--image",attrs:{src:e.reference.openGraphObject.thumb}}):e._e(),t("div",{staticClass:"widget-default--details"},[t("p",{staticClass:"widget-default--name"},[e._v(e._s(e.reference.openGraphObject.name))]),t("p",{staticClass:"widget-default--description",style:e.descriptionStyle},[e._v(e._s(e.reference.openGraphObject.description))]),t("p",{staticClass:"widget-default--link"},[e._v(e._s(e.compactLink))])])]):e._e()])},k=[];const I=(0,n.n)(N,C,k,!1,null,"b1c5a80f",null,null).exports;window._vue_richtext_custom_picker_elements||(window._vue_richtext_custom_picker_elements={});class S{constructor(e,t){this.element=e,this.object=t}}const E=e=>!!window._vue_richtext_custom_picker_elements[e],P=(e,t,i=(e=>{}),n="large")=>{window._vue_richtext_custom_picker_elements[e]?b.error("Custom reference picker element for id "+e+" already registered"):window._vue_richtext_custom_picker_elements[e]={id:e,callback:t,onDestroy:i,size:n}};window._registerCustomPickerElement=P;const L={name:"NcCustomPickerElement",props:{provider:{type:Object,required:!0}},emits:["cancel","submit"],data(){return{isRegistered:E(this.provider.id),renderResult:null}},mounted(){this.isRegistered&&this.renderElement()},beforeDestroy(){var e,t,i;this.isRegistered&&(e=this.provider.id,t=this.$el,i=this.renderResult,window._vue_richtext_custom_picker_elements[e]&&window._vue_richtext_custom_picker_elements[e].onDestroy(t,i))},methods:{renderElement(){this.$refs.domElement&&(this.$refs.domElement.innerHTML="");const e=((e,{providerId:t,accessible:i})=>{if(window._vue_richtext_custom_picker_elements[t])return window._vue_richtext_custom_picker_elements[t].callback(e,{providerId:t,accessible:i});b.error("Custom reference picker element for reference provider ID "+t+" not registered")})(this.$refs.domElement,{providerId:this.provider.id,accessible:!1});Promise.resolve(e).then((e=>{var t,i;this.renderResult=e,null!=(t=this.renderResult.object)&&t._isVue&&null!=(i=this.renderResult.object)&&i.$on&&(this.renderResult.object.$on("submit",this.onSubmit),this.renderResult.object.$on("cancel",this.onCancel)),this.renderResult.element.addEventListener("submit",(e=>{this.onSubmit(e.detail)})),this.renderResult.element.addEventListener("cancel",this.onCancel)}))},onSubmit(e){this.$emit("submit",e)},onCancel(){this.$emit("cancel")}}};var T=function(){return(0,this._self._c)("div",{ref:"domElement"})},A=[];const D=(0,n.n)(L,T,A,!1,null,"cf695ff9",null,null).exports,Z="any-link",B={id:Z,title:(0,r.t)("Any link"),icon_url:(0,a.imagePath)("core","filetypes/link.svg")};function M(){return window._vue_richtext_reference_providers.filter((e=>{const t=!!e.search_providers_ids&&e.search_providers_ids.length>0||E(e.id);return t||b.debug("[smart picker]",e.id,"reference provider is discoverable but does not have any related search provider or custom picker component registered"),t}))}function O(e,t=null){const i=M(),n=e.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&"),r=new RegExp(n,"i"),s=function(e){const t=window._vue_richtext_reference_provider_timestamps;return e.sort(((e,t)=>e.order===t.order?0:e.order>t.order?1:-1)).sort(((e,i)=>{const n=t[e.id],r=t[i.id];return n===r?0:void 0===r?-1:void 0===n?1:n>r?-1:1}))}(i).filter((e=>e.title.match(r))),o=t?s.slice(0,t):s;return(""===e||0===o.length)&&o.push(B),o}window._vue_richtext_reference_providers||(window._vue_richtext_reference_providers=(0,o.j)("core","reference-provider-list",[])),window._vue_richtext_reference_provider_timestamps||(window._vue_richtext_reference_provider_timestamps=(0,o.j)("core","reference-provider-timestamps",{}));let F=0;function R(e,t){return function(){const i=this,n=arguments;clearTimeout(F),F=setTimeout((function(){e.apply(i,n)}),t||0)}}function j(e){try{return!!new URL(e)}catch{return!1}}const z={name:"NcProviderList",components:{NcSelect:u.Z,NcHighlight:c.N,NcEmptyContent:l.Z,LinkVariantIcon:d.default},emits:["select-provider","submit"],data(){return{selectedProvider:null,query:"",multiselectPlaceholder:(0,r.t)("Select provider"),providerIconAlt:(0,r.t)("Provider icon")}},computed:{options(){const e=[];return""!==this.query&&j(this.query)&&e.push({id:this.query,title:this.query,isLink:!0}),e.push(...O(this.query)),e}},methods:{focus(){setTimeout((()=>{var e,t,i;null==(i=null==(t=null==(e=this.$refs["provider-select"])?void 0:e.$el)?void 0:t.querySelector("#provider-select-input"))||i.focus()}),300)},onProviderSelected(e){null!==e&&(e.isLink?this.$emit("submit",e.title):this.$emit("select-provider",e),this.selectedProvider=null)},onSearch(e,t){this.query=e}}};var V=function(){var e=this,t=e._self._c;return t("div",{staticClass:"provider-list"},[t("NcSelect",{ref:"provider-select",staticClass:"provider-list--select",attrs:{"input-id":"provider-select-input",label:"title",placeholder:e.multiselectPlaceholder,options:e.options,"append-to-body":!1,"clear-search-on-select":!0,"clear-search-on-blur":()=>!1,filterable:!1},on:{search:e.onSearch,input:e.onProviderSelected},scopedSlots:e._u([{key:"option",fn:function(i){return[i.isLink?t("div",{staticClass:"provider"},[t("LinkVariantIcon",{staticClass:"link-icon",attrs:{size:20}}),t("span",[e._v(e._s(i.title))])],1):t("div",{staticClass:"provider"},[t("img",{staticClass:"provider-icon",attrs:{src:i.icon_url,alt:e.providerIconAlt}}),t("NcHighlight",{staticClass:"option-text",attrs:{search:e.query,text:i.title}})],1)]}}]),model:{value:e.selectedProvider,callback:function(t){e.selectedProvider=t},expression:"selectedProvider"}}),t("NcEmptyContent",{staticClass:"provider-list--empty-content",scopedSlots:e._u([{key:"icon",fn:function(){return[t("LinkVariantIcon")]},proxy:!0}])})],1)},$=[];const H=(0,n.n)(z,V,$,!1,null,"9d850ea5",null,null).exports,U={name:"NcRawLinkInput",components:{LinkVariantIcon:d.default,NcEmptyContent:l.Z,NcLoadingIcon:p.Z,NcReferenceWidget:I,NcTextField:h.Z},props:{provider:{type:Object,required:!0}},emits:["submit"],data(){return{inputValue:"",loading:!1,reference:null,abortController:null,inputPlaceholder:(0,r.t)("Enter link")}},computed:{isLinkValid(){return j(this.inputValue)}},methods:{focus(){var e;null==(e=this.$refs["url-input"].$el.getElementsByTagName("input")[0])||e.focus()},onSubmit(e){const t=e.target.value;this.isLinkValid&&this.$emit("submit",t)},onClear(){this.inputValue="",this.reference=null},onInput(){this.reference=null,this.abortController&&this.abortController.abort(),this.isLinkValid&&R((()=>{this.updateReference()}),500)()},updateReference(){this.loading=!0,this.abortController=new AbortController,s.Z.get((0,a.generateOcsUrl)("references/resolve",2)+"?reference="+encodeURIComponent(this.inputValue),{signal:this.abortController.signal}).then((e=>{this.reference=e.data.ocs.data.references[this.inputValue]})).catch((e=>{b.error(e)})).then((()=>{this.loading=!1}))}}};var G=function(){var e=this,t=e._self._c;return t("div",{staticClass:"raw-link"},[t("div",{staticClass:"input-wrapper"},[t("NcTextField",{ref:"url-input",attrs:{value:e.inputValue,"show-trailing-button":""!==e.inputValue,label:e.inputPlaceholder},on:{"update:value":[function(t){e.inputValue=t},e.onInput],"trailing-button-click":e.onClear},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSubmit.apply(null,arguments)}}},[e.loading?t("NcLoadingIcon",{attrs:{size:16}}):t("LinkVariantIcon",{attrs:{size:16}})],1)],1),null!==e.reference?t("NcReferenceWidget",{staticClass:"reference-widget",attrs:{reference:e.reference}}):t("NcEmptyContent",{staticClass:"raw-link--empty-content",scopedSlots:e._u([{key:"icon",fn:function(){return[e.provider.icon_url?t("img",{staticClass:"provider-icon",attrs:{src:e.provider.icon_url}}):t("LinkVariantIcon")]},proxy:!0}])})],1)},W=[];const q=(0,n.n)(U,G,W,!1,null,"d0ba247a",null,null).exports,Y={name:"NcSearchResult",components:{NcHighlight:c.N},props:{entry:{type:Object,required:!0},query:{type:String,required:!0}}};var Q=function(){var e=this,t=e._self._c;return t("div",{staticClass:"result"},[e.entry.icon?t("div",{staticClass:"result--icon-class",class:{[e.entry.icon]:!0,rounded:e.entry.rounded}}):t("img",{staticClass:"result--image",class:{rounded:e.entry.rounded},attrs:{src:e.entry.thumbnailUrl}}),t("div",{staticClass:"result--content"},[t("span",{staticClass:"result--content--name"},[t("NcHighlight",{attrs:{search:e.query,text:e.entry.title}})],1),t("span",{staticClass:"result--content--subline"},[t("NcHighlight",{attrs:{search:e.query,text:e.entry.subline}})],1)])])},X=[];const K=(0,n.n)(Y,Q,X,!1,null,"7a394a58",null,null).exports,J={name:"NcSearch",components:{LinkVariantIcon:d.default,DotsHorizontalIcon:f.default,NcEmptyContent:l.Z,NcSelect:u.Z,NcSearchResult:K},props:{provider:{type:Object,required:!0},showEmptyContent:{type:Boolean,default:!0},searchPlaceholder:{type:String,default:null}},emits:["submit"],data(){return{searchQuery:"",selectedResult:null,resultsBySearchProvider:{},searching:!1,searchingMoreOf:null,abortController:null,noOptionsText:(0,r.t)("Start typing to search"),providerIconAlt:(0,r.t)("Provider icon")}},computed:{mySearchPlaceholder(){return this.searchPlaceholder||(0,r.t)("Search")},searchProviderIds(){return this.provider.search_providers_ids},options(){if(""===this.searchQuery)return[];const e=[];return j(this.searchQuery)&&e.push(this.rawLinkEntry),e.push(...this.formattedSearchResults),e},rawLinkEntry(){return{id:"rawLinkEntry",resourceUrl:this.searchQuery,isRawLink:!0}},formattedSearchResults(){const e=[];return this.searchProviderIds.forEach((t=>{if(this.resultsBySearchProvider[t].entries.length>0){(this.searchProviderIds.length>1||this.resultsBySearchProvider[t].entries.length>1)&&e.push({id:"groupTitle-"+t,name:this.resultsBySearchProvider[t].name,isCustomGroupTitle:!0,providerId:t});const i=this.resultsBySearchProvider[t].entries.map(((e,i)=>({id:"provider-"+t+"-entry-"+i,...e})));e.push(...i),this.resultsBySearchProvider[t].isPaginated&&e.push({id:"moreOf-"+t,name:this.resultsBySearchProvider[t].name,isMore:!0,providerId:t,isLoading:this.searchingMoreOf===t})}})),e}},mounted(){this.resetResults()},beforeDestroy(){this.cancelSearchRequests()},methods:{t:r.t,resetResults(){const e={};this.searchProviderIds.forEach((t=>{e[t]={entries:[]}})),this.resultsBySearchProvider=e},focus(){setTimeout((()=>{var e,t,i;null==(i=null==(t=null==(e=this.$refs["search-select"])?void 0:e.$el)?void 0:t.querySelector("#search-select-input"))||i.focus()}),300)},cancelSearchRequests(){this.abortController&&this.abortController.abort()},onSearchInput(e,t){this.searchQuery=e,R((()=>{this.updateSearch()}),500)()},onSelectResultSelected(e){null!==e&&(e.resourceUrl?(this.cancelSearchRequests(),this.$emit("submit",e.resourceUrl)):e.isMore&&this.searchMoreOf(e.providerId).then((()=>{this.selectedResult=null})))},searchMoreOf(e){return this.searchingMoreOf=e,this.cancelSearchRequests(),this.searchProviders(e)},updateSearch(){if(this.cancelSearchRequests(),this.resetResults(),""!==this.searchQuery)return this.searchProviders();this.searching=!1},searchProviders(e=null){var t,i;this.abortController=new AbortController,this.searching=!0;const n=null===e?[...this.searchProviderIds].map((e=>this.searchOneProvider(e))):[this.searchOneProvider(e,null!=(i=null==(t=this.resultsBySearchProvider[e])?void 0:t.cursor)?i:null)];return Promise.allSettled(n).then((e=>{e.find((e=>"rejected"===e.status&&("CanceledError"===e.reason.name||"ERR_CANCELED"===e.reason.code)))||(this.searching=!1,this.searchingMoreOf=null)}))},searchOneProvider(e,t=null){const i=null===t?(0,a.generateOcsUrl)("search/providers/{providerId}/search?term={term}&limit={limit}",{providerId:e,term:this.searchQuery,limit:5}):(0,a.generateOcsUrl)("search/providers/{providerId}/search?term={term}&limit={limit}&cursor={cursor}",{providerId:e,term:this.searchQuery,limit:5,cursor:t});return s.Z.get(i,{signal:this.abortController.signal}).then((t=>{const i=t.data.ocs.data;this.resultsBySearchProvider[e].name=i.name,this.resultsBySearchProvider[e].cursor=i.cursor,this.resultsBySearchProvider[e].isPaginated=i.isPaginated,this.resultsBySearchProvider[e].entries.push(...i.entries)}))}}};var ee=function(){var e=this,t=e._self._c;return t("div",{staticClass:"smart-picker-search",class:{"with-empty-content":e.showEmptyContent}},[t("NcSelect",{ref:"search-select",staticClass:"smart-picker-search--select",attrs:{"input-id":"search-select-input",label:"name",placeholder:e.mySearchPlaceholder,options:e.options,"append-to-body":!1,"close-on-select":!1,"clear-search-on-select":!1,"clear-search-on-blur":()=>!1,"reset-focus-on-options-change":!1,filterable:!1,autoscroll:!0,"reset-on-options-change":!1,loading:e.searching},on:{search:e.onSearchInput,input:e.onSelectResultSelected},scopedSlots:e._u([{key:"option",fn:function(i){return[i.isRawLink?t("div",{staticClass:"custom-option"},[t("LinkVariantIcon",{staticClass:"option-simple-icon",attrs:{size:20}}),t("span",{staticClass:"option-text"},[e._v(" "+e._s(e.t("Raw link {options}",{options:i.resourceUrl}))+" ")])],1):i.resourceUrl?t("NcSearchResult",{staticClass:"search-result",attrs:{entry:i,query:e.searchQuery}}):i.isCustomGroupTitle?t("span",{staticClass:"custom-option group-name"},[e.provider.icon_url?t("img",{staticClass:"provider-icon group-name-icon",attrs:{src:e.provider.icon_url}}):e._e(),t("span",{staticClass:"option-text"},[t("strong",[e._v(e._s(i.name))])])]):i.isMore?t("span",{class:{"custom-option":!0}},[i.isLoading?t("span",{staticClass:"option-simple-icon icon-loading-small"}):t("DotsHorizontalIcon",{staticClass:"option-simple-icon",attrs:{size:20}}),t("span",{staticClass:"option-text"},[e._v(" "+e._s(e.t('Load more "{options}"',{options:i.name}))+" ")])],1):e._e()]}},{key:"no-options",fn:function(){return[e._v(" "+e._s(e.noOptionsText)+" ")]},proxy:!0}]),model:{value:e.selectedResult,callback:function(t){e.selectedResult=t},expression:"selectedResult"}}),e.showEmptyContent?t("NcEmptyContent",{staticClass:"smart-picker-search--empty-content",scopedSlots:e._u([{key:"icon",fn:function(){return[e.provider.icon_url?t("img",{staticClass:"provider-icon",attrs:{alt:e.providerIconAlt,src:e.provider.icon_url}}):t("LinkVariantIcon")]},proxy:!0}],null,!1,2922132592)}):e._e()],1)},te=[];const ie=(0,n.n)(J,ee,te,!1,null,"97d196f0",null,null).exports,ne={providerList:1,standardLinkInput:2,searchInput:3,customElement:4},re={name:"NcReferencePicker",components:{NcCustomPickerElement:D,NcProviderList:H,NcRawLinkInput:q,NcSearch:ie},props:{initialProvider:{type:Object,default:()=>null},width:{type:Number,default:null},focusOnCreate:{type:Boolean,default:!0}},emits:["cancel","cancel-raw-link","cancel-search","provider-selected","submit"],data(){return{MODES:ne,selectedProvider:this.initialProvider}},computed:{mode(){return null===this.selectedProvider?ne.providerList:E(this.selectedProvider.id)?ne.customElement:this.selectedProvider.search_providers_ids?ne.searchInput:ne.standardLinkInput},pickerWrapperStyle(){return{width:this.width?this.width+"px":void 0}}},mounted(){this.focusOnCreate&&(this.initialProvider?setTimeout((()=>{var e;null==(e=this.$refs["url-input"])||e.focus()}),300):this.$nextTick((()=>{var e;null==(e=this.$refs["provider-list"])||e.focus()})))},methods:{onEscapePressed(){null!==this.selectedProvider?this.deselectProvider():this.cancelProviderSelection()},onProviderSelected(e){this.selectedProvider=e,this.$emit("provider-selected",e),this.$nextTick((()=>{var e;null==(e=this.$refs["url-input"])||e.focus()}))},cancelCustomElement(){this.deselectProvider()},cancelSearch(){var e;this.$emit("cancel-search",null==(e=this.selectedProvider)?void 0:e.title),this.deselectProvider()},cancelRawLinkInput(){var e;this.$emit("cancel-raw-link",null==(e=this.selectedProvider)?void 0:e.title),this.deselectProvider()},cancelProviderSelection(){this.$emit("cancel")},submitLink(e){null!==this.selectedProvider&&function(e){const t=Math.floor(Date.now()/1e3),i={timestamp:t},n=(0,a.generateOcsUrl)("references/provider/{providerId}",{providerId:e});s.Z.put(n,i).then((i=>{window._vue_richtext_reference_provider_timestamps[e]=t}))}(this.selectedProvider.id),this.$emit("submit",e),this.deselectProvider()},deselectProvider(){this.selectedProvider=null,this.$emit("provider-selected",null),setTimeout((()=>{var e;null==(e=this.$refs["provider-list"])||e.focus()}),300)}}};var se=function(){var e=this,t=e._self._c;return t("div",{staticClass:"reference-picker",style:e.pickerWrapperStyle,attrs:{tabindex:"-1"},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:(t.stopPropagation(),t.preventDefault(),e.onEscapePressed.apply(null,arguments))}}},[e.mode===e.MODES.providerList?t("NcProviderList",{ref:"provider-list",on:{"select-provider":e.onProviderSelected,submit:e.submitLink,cancel:e.cancelProviderSelection}}):e.mode===e.MODES.standardLinkInput?t("NcRawLinkInput",{ref:"url-input",attrs:{provider:e.selectedProvider},on:{submit:e.submitLink,cancel:e.cancelRawLinkInput}}):e.mode===e.MODES.searchInput?t("NcSearch",{ref:"url-input",attrs:{provider:e.selectedProvider},on:{cancel:e.cancelSearch,submit:e.submitLink}}):e.mode===e.MODES.customElement?t("div",{staticClass:"custom-element-wrapper"},[t("NcCustomPickerElement",{attrs:{provider:e.selectedProvider},on:{submit:e.submitLink,cancel:e.cancelCustomElement}})],1):e._e()],1)},oe=[];const ae={name:"NcReferencePickerModal",components:{NcReferencePicker:(0,n.n)(re,se,oe,!1,null,"aa77d0d3",null,null).exports,NcModal:g.Z,NcButton:m.Z,ArrowLeftIcon:w.default,CloseIcon:y.default},props:{initialProvider:{type:Object,default:()=>null},focusOnCreate:{type:Boolean,default:!0},isInsideViewer:{type:Boolean,default:!1}},emits:["cancel","submit"],data(){return{show:!0,selectedProvider:this.initialProvider,backButtonTitle:(0,r.t)("Back to provider selection"),closeButtonTitle:(0,r.t)("Close"),closeButtonLabel:(0,r.t)("Close Smart Picker")}},computed:{isProviderSelected(){return null!==this.selectedProvider},showBackButton(){return null===this.initialProvider&&this.isProviderSelected},modalSize(){var e;return this.isProviderSelected&&E(this.selectedProvider.id)?null!=(e=(e=>{var t;const i=null==(t=window._vue_richtext_custom_picker_elements[e])?void 0:t.size;return["small","normal","large","full"].includes(i)?i:null})(this.selectedProvider.id))?e:"large":"normal"},showModalName(){return!this.isProviderSelected||!E(this.selectedProvider.id)},modalName(){return this.isProviderSelected?this.selectedProvider.title:(0,r.t)("Smart Picker")}},mounted(){if(this.isInsideViewer){const e=this.$refs.modal_content;(0,v.j8)("viewer:trapElements:changed",e)}},methods:{onCancel(){this.show=!1,this.$emit("cancel")},onSubmit(e){this.show=!1,this.$emit("submit",e)},onProviderSelect(e){this.selectedProvider=e,null===e&&null!==this.initialProvider&&this.onCancel()},onBackClicked(){this.$refs.referencePicker.deselectProvider()}}};var le=function(){var e=this,t=e._self._c;return e.show?t("NcModal",{staticClass:"reference-picker-modal",attrs:{size:e.modalSize,"can-close":!1},on:{close:e.onCancel}},[t("div",{ref:"modal_content",staticClass:"reference-picker-modal--content"},[e.showBackButton?t("NcButton",{staticClass:"back-button",attrs:{"aria-label":e.backButtonTitle,title:e.backButtonTitle},on:{click:e.onBackClicked},scopedSlots:e._u([{key:"icon",fn:function(){return[t("ArrowLeftIcon")]},proxy:!0}],null,!1,3001860362)}):e._e(),t("NcButton",{staticClass:"close-button",attrs:{"aria-label":e.closeButtonLabel,title:e.closeButtonTitle,type:"tertiary"},on:{click:e.onCancel},scopedSlots:e._u([{key:"icon",fn:function(){return[t("CloseIcon")]},proxy:!0}],null,!1,2491825086)}),e.showModalName?t("h2",[e._v(" "+e._s(e.modalName)+" ")]):e._e(),t("NcReferencePicker",{ref:"referencePicker",attrs:{"initial-provider":e.initialProvider,"focus-on-create":e.focusOnCreate},on:{"provider-selected":e.onProviderSelect,submit:e.onSubmit,cancel:e.onCancel}})],1)]):e._e()},ce=[];const ue=(0,n.n)(ae,le,ce,!1,null,"3f1a4ac7",null,null).exports;async function de(e=null,t=void 0){return await new Promise(((i,n)=>{var r;const s=document.createElement("div");s.id="referencePickerModal",document.body.append(s);const o=null===e?null:null!=(r=function(e){return e===Z?B:M().find((t=>t.id===e))}(e))?r:null,a=new(_.default.extend(ue))({propsData:{initialProvider:o,isInsideViewer:t}}).$mount(s);a.$on("cancel",(()=>{a.$destroy(),n(new Error("User cancellation"))})),a.$on("submit",(e=>{a.$destroy(),i(e)}))}))}},64882:function(e,t,i){"use strict";i.d(t,{$U:function(){return T.Z},FK:function(){return Q.Z},Iw:function(){return a.Z},Jc:function(){return ee.Z},Jh:function(){return j.Z},O3:function(){return d.Z},P2:function(){return D.Z},QG:function(){return ce.Z},SL:function(){return G.Z},Z9:function(){return z.Z},fg:function(){return A.Z},h3:function(){return ue.Z},rw:function(){return Z.Z}});var n=i(63416),r=i(66236),s=i(34791),o=i(56562),a=i(46187),l=i(70944),c=i(52300),u=i(25205),d=i(44221),p=i(68763),h=i(60907),f=i(94162),m=i(56071),g=i(27657),v=i(2047),w=i(8784),y=i(82002),_=i(89998),b=i(41705),x=i(61898),N=i(39726),C=i(66845),k=i(87875),I=i(35273),S=i(34739),E=i(80988),P=i(89393),L=i(29113),T=i(36402),A=i(49231),D=i(57274),Z=i(67606),B=i(37776),M=i(73743),O=i(93182),F=i(89241),R=i(96226),j=i(97947),z=i(88276),V=i(37008),$=i(93757),H=i(6318),U=i(78573),G=i(86514),W=i(93428),q=i(93815),Y=i(40873),Q=i(64865),X=i(48741),K=i(88175),J=i(20435),ee=i(6136),te=i(6156),ie=i(16972),ne=i(34246),re=i(34854),se=i(14274),oe=i(22663),ae=i(62719),le=i(41604),ce=(i(59768),i(93664),i(79753),i(61537)),ue=(i(74917),i(25751),i(49368)),de=(i(89115),i(69183),i(32219),i(82675),i(74911)),pe=i(35380),he=i(56857),fe=i(67912),me=i(82176),ge=i(47414),ve=i(16024),we=i(70675),ye=(i(93911),i(85302),i(90318)),_e=i(17593),be=(i(79845),i(84722),i(76692),i(40946),i(73045));n.Z,r.Z,s.Z,o.Z,a.Z,l.Z,c.Z,u.Z,p.Z,h.Z,f.Z,d.Z,m.Z,g.Z,v.Z,w.Z,y.Z,_.Z,b.Z,x.Z,N.Z,C.Z,k.Z,I.Z,S.Z,E.Z,P.Z,ae.Mv,L.N,T.Z,A.Z,D.Z,Z.Z,B.Z,M.Z,O.Z,F.Z,R.Z,j.Z,z.Z,V.Z,$.Z,H.Z,U.Z,G.Z,W.Z,q.Z,Y.N,Q.Z,X.Z,K.Z,J.Z,oe.N,ee.Z,te.Z,ie.Z,ne.Z,re.Z,se.Z,ae.ZP,le.N,de.Z,ce.Z,pe.Z,he.Z,fe.Z,me.N,we.Z,ue.Z,ge.Z,ve.Z,Symbol.toStringTag,ye.X,_e.X,be.VTooltip,Symbol.toStringTag}}]);
//# sourceMappingURL=7608-7608.js.map?v=581ec51a56b912a9b3d4