/*! third party licenses: dist/vendor.LICENSE.txt */
import{bJ as l,bK as d,bN as w,bR as x,bE as s,bD as g,bC as _}from"./core-common.mjs";import{H as C,f as D}from"./chunks/icons-BxSPavMS.mjs";import{m as p}from"./chunks/index-j_UZebeA.mjs";import{L as N,V as L,c as E,y as I,_ as R,D as S,Q as k,N as z,f as A,g as K,I as V}from"./chunks/index-BLIV22dB.mjs";import{u as q}from"./chunks/index-Biv1VH4I.mjs";import{l as B}from"./chunks/logger-CMIEMPjA.mjs";import{e as F}from"./chunks/index-DgCiVkaQ.mjs";import"./chunks/moment-B-oAqI-A.mjs";import"./chunks/moment-B1DRcIE-.mjs";import"./chunks/index-Ca0QcE7e.mjs";var c;const o="/trashbin/".concat((c=l())==null?void 0:c.uid,"/trash"),H=d("dav"+o),u=q(H,{headers:{requesttoken:w()}}),f='<?xml version="1.0"?>\n<d:propfind '.concat(N(),">\n	<d:prop>\n		<nc:trashbin-filename />\n		<nc:trashbin-deletion-time />\n		<nc:trashbin-original-location />\n		<nc:trashbin-title />\n		").concat(L(),"\n	</d:prop>\n</d:propfind>"),b=function(t){var i,e,r,n,m;const h=E((i=t.props)==null?void 0:i.permissions),v=(e=l())==null?void 0:e.uid,y=x("/apps/files_trashbin/preview?fileId={fileid}&x=32&y=32",t.props),a={id:((r=t.props)==null?void 0:r.fileid)||0,source:d("dav"+o+t.filename),mime:t.mime,size:((n=t.props)==null?void 0:n.size)||0,permissions:h,owner:v,root:o,attributes:{...t,...t.props,displayName:(m=t.props)==null?void 0:m["trashbin-filename"],previewUrl:y}};return delete a.attributes.props,t.type==="file"?new I(a):new R(a)},P=async(t="/")=>{const i=await u.stat(t,{details:!0,data:f}),e=await u.getDirectoryContents(t,{details:!0,data:f});return{folder:b(i.data),contents:e.data.map(b)}};S(new k({id:"restore",displayName(){return s("files_trashbin","Restore")},iconSvgInline:()=>C,enabled(t,i){return i.id!=="trashbin"?!1:t.length>0&&t.map(e=>e.permissions).every(e=>(e&z.READ)!==0)},async exec(t){var i;try{const e=d(F("dav/trashbin/".concat((i=l())==null?void 0:i.uid,"/restore/").concat(t.basename)));return await g({method:"MOVE",url:t.encodedSource,headers:{destination:e}}),_("files:node:deleted",t),!0}catch(e){return B.error(e),!1}},async execBatch(t,i,e){return Promise.all(t.map(r=>this.exec(r,i,e)))},order:1,inline:()=>!0}));const Q=A();Q.register(new K({id:"trashbin",name:s("files_trashbin","Deleted files"),caption:s("files_trashbin","List of files that have been deleted."),emptyTitle:s("files_trashbin","No deleted files"),emptyCaption:s("files_trashbin","Files and folders you have deleted will show up here"),icon:D,order:50,sticky:!0,defaultSortKey:"deleted",columns:[new V({id:"deleted",title:s("files_trashbin","Deleted"),render(t){var i;const e=(i=t.attributes)==null?void 0:i["trashbin-deletion-time"],r=document.createElement("span");return e?(r.title=p.unix(e).format("LLL"),r.textContent=p.unix(e).fromNow(),r):(r.textContent=s("files_trashbin","A long time ago"),r)},sort(t,i){var e,r;const n=((e=t.attributes)==null?void 0:e["trashbin-deletion-time"])||(t==null?void 0:t.mtime)||0;return(((r=i.attributes)==null?void 0:r["trashbin-deletion-time"])||(i==null?void 0:i.mtime)||0)-n}})],getContents:P}));
