/*! third party licenses: dist/vendor.LICENSE.txt */
import{Q as f,D as m}from"./chunks/index-BLIV22dB.mjs";import{bE as r,bL as y,aG as T,bQ as C,bD as P,aH as b,F as x,O as I,Q as L,a4 as O,a5 as W}from"./core-common.mjs";import{N as F,n as B,O as E}from"./chunks/icons-BxSPavMS.mjs";import"./chunks/index-Ca0QcE7e.mjs";import{v as o,S}from"./chunks/toast-7xJhDYMn-BrG8uCqw.mjs";import{m as a}from"./chunks/index-j_UZebeA.mjs";import"./chunks/index-DgCiVkaQ.mjs";import"./chunks/index-Biv1VH4I.mjs";import"./chunks/moment-B-oAqI-A.mjs";import"./chunks/moment-B1DRcIE-.mjs";const h="set-reminder-menu",V=new f({id:h,displayName:()=>r("files","Set reminder"),iconSvgInline:()=>F,enabled:()=>!0,async exec(){return null},order:20});var s=(e=>(e.LaterToday="later-today",e.Tomorrow="tomorrow",e.ThisWeekend="this-weekend",e.NextWeek="next-week",e))(s||{});const d=e=>({"later-today":()=>{const t=a(),i=a().startOf("day").add(18,"hour"),n=i.clone().subtract(1,"hour");return t.isSameOrAfter(n)?null:i.toDate()},tomorrow:()=>a().add(1,"day").startOf("day").add(8,"hour").toDate(),"this-weekend":()=>{const t=a();return[5,6,7].includes(t.isoWeekday())?null:a().startOf("isoWeek").add(5,"day").add(8,"hour").toDate()},"next-week":()=>a().isoWeekday()===7?null:a().startOf("isoWeek").add(1,"week").add(8,"hour").toDate()})[e](),p=()=>{const e=a().get("hour");return a().startOf("day").add(e+2,"hour").toDate()},l=e=>{let t={hour:"numeric",minute:"2-digit"};const i=a(e),n=a();return i.isSame(n,"date")||(t={...t,weekday:"short"}),i.isSame(n,"week")||(t={...t,month:"short",day:"numeric"}),e.toLocaleString(y(),t)},D=e=>{const t={weekday:"long",hour:"numeric",minute:"2-digit",month:"long",day:"numeric"};return e.toLocaleString(y(),t)},c=T.getLoggerBuilder().setApp("files_reminders").detectUser().build(),g=async(e,t)=>{const i=C("/apps/files_reminders/api/v1/{fileId}",{fileId:e});return(await P.put(i,{dueDate:t.toISOString()})).data.ocs.data},N={dateTimePreset:s.LaterToday,label:r("files_reminders","Later today"),ariaLabel:r("files_reminders","Set reminder for later today"),dateString:"",verboseDateString:""},v={dateTimePreset:s.Tomorrow,label:r("files_reminders","Tomorrow"),ariaLabel:r("files_reminders","Set reminder for tomorrow"),dateString:"",verboseDateString:""},w={dateTimePreset:s.ThisWeekend,label:r("files_reminders","This weekend"),ariaLabel:r("files_reminders","Set reminder for this weekend"),dateString:"",verboseDateString:""},k={dateTimePreset:s.NextWeek,label:r("files_reminders","Next week"),ariaLabel:r("files_reminders","Set reminder for next week"),dateString:"",verboseDateString:""},M=e=>new f({id:"set-reminder-".concat(e.dateTimePreset),displayName:()=>"".concat(e.label," – ").concat(e.dateString),title:()=>"".concat(e.ariaLabel," – ").concat(e.verboseDateString),iconSvgInline:()=>"<svg></svg>",enabled:()=>!!d(e.dateTimePreset),parent:h,async exec(t){if(!t.fileid)return c.error("Failed to set reminder, missing file id"),o(r("files_reminders","Failed to set reminder")),null;try{await g(t.fileid,d(e.dateTimePreset)),S(r("files_reminders",'Reminder set for "{fileName}"',{fileName:t.basename}))}catch(i){c.error("Failed to set reminder",{error:i}),o(r("files_reminders","Failed to set reminder"))}return null},order:21});[N,v,w,k].forEach(e=>{const t=d(e.dateTimePreset);t&&(e.dateString=l(t),e.verboseDateString=D(t)+setInterval(()=>{const i=d(e.dateTimePreset);i&&(e.dateString=l(i),e.verboseDateString=D(i))},1e3*30*60))});const R=[N,v,w,k].map(M),A=b.extend({name:"SetCustomReminderModal",components:{NcButton:x,NcDateTime:I,NcDateTimePickerNative:L,NcModal:O,NcNoteCard:W},data(){return{node:void 0,opened:!1,isValid:!0,customDueDate:p(),nowDate:new Date}},computed:{fileId(){return this.node.fileid},fileName(){return this.node.basename},title(){return r("files_reminders",'Set reminder for "{fileName}"',{fileName:this.fileName})},label(){return r("files_reminders","Set reminder at custom date & time")},clearAriaLabel(){return r("files_reminders","Clear reminder")}},methods:{t:r,getDateString:l,async open(e){this.node=e,this.isValid=!0,this.opened=!0,this.customDueDate=p(),this.nowDate=new Date,setTimeout(()=>{const t=document.getElementById("set-custom-reminder");t.focus(),t.showPicker()},300)},async setCustom(){if(!(this.customDueDate instanceof Date)||isNaN(this.customDueDate)){o(r("files_reminders","Please choose a valid date & time"));return}try{await g(this.fileId,this.customDueDate),S(r("files_reminders",'Reminder set for "{fileName}"',{fileName:this.fileName})),this.onClose()}catch(e){c.error("Failed to set reminder",{error:e}),o(r("files_reminders","Failed to set reminder"))}},onClose(){this.opened=!1,this.$emit("close")},onInput(){const e=document.getElementById("set-custom-reminder");this.isValid=e.checkValidity()}}});var Q=function(){var e=this,t=e._self._c;return e._self._setupProxy,e.opened?t("NcModal",{attrs:{"out-transition":!0,size:"small"},on:{close:e.onClose}},[t("form",{staticClass:"custom-reminder-modal",on:{submit:function(i){return i.preventDefault(),e.setCustom.apply(null,arguments)}}},[t("h2",{staticClass:"custom-reminder-modal__title"},[e._v(" "+e._s(e.title)+" ")]),t("NcDateTimePickerNative",{attrs:{id:"set-custom-reminder",label:e.label,min:e.nowDate,required:!0,type:"datetime-local"},on:{input:e.onInput},model:{value:e.customDueDate,callback:function(i){e.customDueDate=i},expression:"customDueDate"}}),e.isValid?t("NcNoteCard",{attrs:{type:"info"}},[e._v(" "+e._s(e.t("files_reminders","We will remind you of this file"))+" "),t("NcDateTime",{attrs:{timestamp:e.customDueDate}})],1):t("NcNoteCard",{attrs:{type:"error"}},[e._v(" "+e._s(e.t("files_reminders","Please choose a valid date & time"))+" ")]),t("div",{staticClass:"custom-reminder-modal__buttons"},[t("NcButton",{on:{click:e.onClose}},[e._v(" "+e._s(e.t("files_reminders","Cancel"))+" ")]),t("NcButton",{attrs:{disabled:!e.isValid,"native-type":"submit",type:"primary"}},[e._v(" "+e._s(e.t("files_reminders","Set reminder"))+" ")])],1)],1)]):e._e()},$=[],q=B(A,Q,$,!1,null,"323c8aff",null,null);const z=q.exports,G=b.extend(z),u=document.createElement("div");u.id="set-custom-reminder-modal",document.body.appendChild(u);const _=new G({name:"SetCustomReminderModal",el:u}),H=async e=>(_.open(e),new Promise(t=>{_.$on("close",t)})),U=new f({id:"set-reminder-custom",displayName:()=>r("files","Set custom reminder"),title:()=>r("files_reminders","Set reminder at custom date & time"),iconSvgInline:()=>E,enabled:()=>!0,parent:h,async exec(e){return H(e),null},order:22});m(V),m(U),R.forEach(e=>m(e));
