/*! third party licenses: dist/vendor.LICENSE.txt */
import{Q as y,i as h,D as v,_ as d,N as m,L as b,V as w,f as T,g as E}from"./chunks/index-BLIV22dB.mjs";import{bE as i,bK as g,bJ as f}from"./core-common.mjs";import{g as _}from"./chunks/icons-BxSPavMS.mjs";import{f as L}from"./chunks/api-WoSfe-uM.mjs";import{g as N,r as x}from"./chunks/Files-CiOJEZCE.mjs";import"./chunks/index-Ca0QcE7e.mjs";import"./chunks/index-DgCiVkaQ.mjs";import"./chunks/index-Biv1VH4I.mjs";import"./chunks/util-Bowr8LpN.mjs";import"./chunks/hashUtils-eMmrAEPa.mjs";import"./chunks/url-84ru6Jh_.mjs";import"./chunks/headers-Irz06Lip.mjs";import"./chunks/logger-CMIEMPjA.mjs";const r=function(s){var t,e;const a=(e=(t=s.attributes)==null?void 0:t["system-tags"])==null?void 0:e["system-tag"];return a===void 0?[]:[a].flat()},l=function(s,t=!1){const e=document.createElement("li");return e.classList.add("files-list__system-tag"),e.textContent=s,t&&e.classList.add("files-list__system-tag--more"),e},A=new y({id:"system-tags",displayName:()=>"",iconSvgInline:()=>"",enabled(s){if(s.length!==1)return!1;const t=s[0];return r(t).length!==0},exec:async()=>null,async renderInline(s){const t=r(s);if(t.length===0)return null;const e=document.createElement("ul");if(e.classList.add("files-list__system-tags"),t.length===1)e.setAttribute("aria-label",i("files","This file has the tag {tag}",{tag:t[0]}));else{const a=t.slice(0,-1).join(", "),n=t[t.length-1];e.setAttribute("aria-label",i("files","This file has the tags {firstTags} and {lastTag}",{firstTags:a,lastTag:n}))}if(e.append(l(t[0])),t.length>1){const a=l("+"+(t.length-1),!0);a.setAttribute("title",t.slice(1).join(", ")),e.append(a)}return e},order:0});h("nc:system-tags"),v(A);const C=s=>'<?xml version="1.0"?>\n<oc:filter-files '.concat(b(),">\n	<d:prop>\n		").concat(w(),"\n	</d:prop>\n    <oc:filter-rules>\n        <oc:systemtag>").concat(s,"</oc:systemtag>\n    </oc:filter-rules>\n</oc:filter-files>"),c=function(s){var t;return new d({id:s.id,source:g("dav/systemtags/"+s.id),owner:(t=f())==null?void 0:t.uid,root:"/systemtags",permissions:m.READ,attributes:{...s,"is-tag":!0}})},D=async(s="/")=>{var t;const e=(await L()).filter(o=>o.userVisible);if(s==="/")return{folder:new d({id:0,source:g("dav/systemtags"),owner:(t=f())==null?void 0:t.uid,root:"/systemtags",permissions:m.NONE}),contents:e.map(c)};const a=parseInt(s.replace("/",""),10),n=e.find(o=>o.id===a);if(!n)throw new Error("Tag not found");const u=c(n),p=await N().getDirectoryContents("/",{details:!0,data:C(a),headers:{method:"REPORT"}});return{folder:u,contents:p.data.map(x)}},I=T();I.register(new E({id:"tags",name:i("systemtags","Tags"),caption:i("systemtags","List of tags and their associated files and folders."),emptyTitle:i("systemtags","No tags found"),emptyCaption:i("systemtags","Tags you have created will show up here."),icon:_,order:25,getContents:D}));
