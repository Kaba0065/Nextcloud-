/*! third party licenses: dist/vendor.LICENSE.txt */
import{Q as p,N as c,R as f,Z as H,_ as $,p as Z,h as E,L as X,V as ee,s as te,f as R,g as D,u as ie,o as oe,t as re,e as k,v as ae,D as u,i as A}from"./chunks/index-BLIV22dB.mjs";import{bD as g,bC as h,bE as r,bP as N,bR as x,bQ as J,bJ as v,aH as V,aM as ne,F as se,R as le,aj as de,bO as T,aL as ce,c1 as L,cM as fe}from"./core-common.mjs";import{p as O}from"./chunks/index-Ca0QcE7e.mjs";import{U as ue,v as z,S as me}from"./chunks/toast-7xJhDYMn-BrG8uCqw.mjs";import{J as pe,an as he,ao as we,ap as ve,aq as ye,ar as ge,as as G,at as P,au as Ne,d as be,n as De,av as Ce,aw as Ee,H as Fe}from"./chunks/icons-BxSPavMS.mjs";import{l as d}from"./chunks/logger-CMIEMPjA.mjs";import{e as K}from"./chunks/index-DgCiVkaQ.mjs";import{i as Se,a as Re}from"./chunks/LivePhotos-Ke3kwHul.mjs";import{a as xe}from"./chunks/sidebarAction-TbC0yk8r.mjs";import{p as Te}from"./chunks/index-D0tJKDfW.mjs";import{g as Oe}from"./chunks/fileUtils-pqLuXd9u.mjs";import{_ as Pe}from"./chunks/preload-helper-3Yr03P9X.mjs";import{g as Ie,r as U,a as _e}from"./chunks/Files-CiOJEZCE.mjs";import{h as ke}from"./chunks/hashUtils-eMmrAEPa.mjs";import"./chunks/index-Biv1VH4I.mjs";import"./chunks/index-BqikPZjc.mjs";import"./chunks/util-Bowr8LpN.mjs";import"./chunks/url-84ru6Jh_.mjs";import"./chunks/headers-Irz06Lip.mjs";const y=e=>e.every(t=>t.attributes["is-mount-root"]===!0&&t.attributes["mount-type"]==="shared"),F=e=>e.every(t=>t.attributes["is-mount-root"]===!0&&t.attributes["mount-type"]==="external"),Ae=e=>{if(e.length===1)return!1;const t=e.some(o=>y([o])),i=e.some(o=>!y([o]));return t&&i},Le=e=>!e.some(t=>t.type!==f.File),Ue=e=>!e.some(t=>t.type!==f.Folder),W=(e,t)=>t.id==="trashbin"?r("files","Delete permanently"):Ae(e)?r("files","Delete and unshare"):y(e)?N("files","Leave this share","Leave these shares",e.length):F(e)?N("files","Disconnect storage","Disconnect storages",e.length):Le(e)?N("files","Delete file","Delete files",e.length):Ue(e)?N("files","Delete folder","Delete folders",e.length):r("files","Delete"),We=new p({id:"delete",displayName:W,iconSvgInline:e=>y(e)?pe:F(e)?he:we,enabled(e){return e.length>0&&e.map(t=>t.permissions).every(t=>(t&c.DELETE)!==0)},async exec(e){try{return await g.delete(e.encodedSource),h("files:node:deleted",e),!0}catch(t){return d.error("Error while deleting a file",{error:t,source:e.source,node:e}),!1}},async execBatch(e,t,i){return await new Promise(o=>{if(e.length>=5&&!y(e)&&!F(e)){window.OC.dialogs.confirmDestructive(r("files","You are about to delete {count} items.",{count:e.length}),r("files","Confirm deletion"),{type:window.OC.dialogs.YES_NO_BUTTONS,confirm:W(e,t),confirmClasses:"error",cancel:r("files","Cancel")},n=>{o(n)});return}o(!0)})===!1?(ue(r("files","Deletion cancelled")),Promise.all(e.map(()=>!1))):Promise.all(e.map(o=>this.exec(o,t,i)))},order:100}),Q=function(e){const t=document.createElement("a");t.download="",t.href=e,t.click()},q=function(e,t){const i=Math.random().toString(36).substring(2),o=x("/apps/files/ajax/download.php?dir={dir}&files={files}&downloadStartSecret={secret}",{dir:e,secret:i,files:JSON.stringify(t.map(n=>n.basename))});Q(o)},qe=function(e){if(!(e.permissions&c.READ))return!1;if(e.attributes["mount-type"]==="shared"){const t=JSON.parse(e.attributes["share-attributes"]).find(i=>i.scope==="permissions"&&i.key==="download");if(t!==void 0&&t.enabled===!1)return!1}return!0},Be=new p({id:"download",displayName:()=>r("files","Download"),iconSvgInline:()=>ve,enabled(e){return e.length===0||e.some(t=>t.type===f.Folder)&&e.some(t=>{var i;return!((i=t.root)!=null&&i.startsWith("/files"))})?!1:e.every(qe)},async exec(e,t,i){return e.type===f.Folder?(q(i,[e]),null):(Q(e.encodedSource),null)},async execBatch(e,t,i){return e.length===1?(this.exec(e[0],t,i),[null]):(q(i,e),new Array(e.length).fill(null))},order:30}),Me=async function(e){var t;const i=J("apps/files/api/v1")+"/openlocaleditor?format=json";try{const o=await g.post(i,{path:e}),n=(t=v())==null?void 0:t.uid;let l="nc://open/".concat(n,"@")+window.location.host+K(e);l+="?token="+o.data.ocs.data.token,window.location.href=l}catch{z(r("files","Failed to redirect to client"))}},je=new p({id:"edit-locally",displayName:()=>r("files","Edit locally"),iconSvgInline:()=>ye,enabled(e){return e.length!==1?!1:(e[0].permissions&c.UPDATE)!==0},async exec(e){return Me(e.path),null},order:25}),b=e=>e.some(t=>t.attributes.favorite!==1),B=async(e,t,i)=>{try{const o=x("/apps/files/api/v1/files")+K(e.path);return await g.post(o,{tags:i?[window.OC.TAG_FAVORITE]:[]}),t.id==="favorites"&&!i&&e.dirname==="/"&&h("files:node:deleted",e),V.set(e.attributes,"favorite",i?1:0),i?h("files:favorites:added",e):h("files:favorites:removed",e),!0}catch(o){const n=i?"adding a file to favourites":"removing a file from favourites";return d.error("Error while "+n,{error:o,source:e.source,node:e}),!1}},He=new p({id:"favorite",displayName(e){return b(e)?r("files","Add to favorites"):r("files","Remove from favorites")},iconSvgInline:e=>b(e)?ge:G,enabled(e){return!e.some(t=>{var i,o;return!((o=(i=t.root)==null?void 0:i.startsWith)!=null&&o.call(i,"/files"))})&&e.every(t=>t.permissions!==c.NONE)},async exec(e,t){const i=b([e]);return await B(e,t,i)},async execBatch(e,t){const i=b(e);return Promise.all(e.map(async o=>await B(o,t,i)))},order:-50}),$e=new p({id:"open-folder",displayName(e){const t=e[0].attributes.displayName||e[0].basename;return r("files","Open folder {displayName}",{displayName:t})},iconSvgInline:()=>P,enabled(e){if(e.length!==1)return!1;const t=e[0];return t.isDavRessource?t.type===f.Folder&&(t.permissions&c.READ)!==0:!1},async exec(e,t){return!e||e.type!==f.Folder?!1:(window.OCP.Files.Router.goToRoute(null,{view:t.id,fileid:e.fileid},{dir:e.path}),null)},default:H.HIDDEN,order:-100}),Je=new p({id:"open-in-files-recent",displayName:()=>r("files","Open in Files"),iconSvgInline:()=>"",enabled:(e,t)=>t.id==="recent",async exec(e){let t=e.dirname;return e.type===f.Folder&&(t=t+"/"+e.basename),window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:e.fileid},{dir:t}),null},order:-1e3,default:H.HIDDEN}),Ve=new p({id:"rename",displayName:()=>r("files","Rename"),iconSvgInline:()=>Ne,enabled:e=>e.length>0&&e.map(t=>t.permissions).every(t=>(t&c.UPDATE)!==0),async exec(e){return h("files:node:rename",e),null},order:10}),ze=new p({id:"view-in-folder",displayName(){return r("files","View in folder")},iconSvgInline:()=>be,enabled(e,t){if(t.id==="files"||e.length!==1)return!1;const i=e[0];return!i.isDavRessource||i.permissions===c.NONE?!1:i.type===f.File},async exec(e){return!e||e.type!==f.File?!1:(window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:e.fileid},{dir:e.dirname}),null)},order:80}),Ge=ne({name:"NewNodeDialog",components:{NcButton:se,NcDialog:le,NcTextField:de},props:{defaultName:{type:String,default:r("files","New folder")},otherNames:{type:Array,default:()=>[]},open:{type:Boolean,default:!0},name:{type:String,default:r("files","Create new folder")},label:{type:String,default:r("files","Folder name")}},emits:{close:e=>e===null||e},data(){return{localDefaultName:this.defaultName||r("files","New folder")}},computed:{errorMessage(){return this.isUniqueName?"":r("files","A file or folder with that name already exists.")},uniqueName(){return Oe(this.localDefaultName,this.otherNames)},isUniqueName(){return this.localDefaultName===this.uniqueName}},watch:{defaultName(){this.localDefaultName=this.defaultName||r("files","New folder")}},mounted(){this.localDefaultName=this.uniqueName,this.$nextTick(()=>{var e,t;return(t=(e=this.$refs.input)==null?void 0:e.focus)==null?void 0:t.call(e)})},methods:{t:r,onCreate(){this.$emit("close",this.localDefaultName)},onClose(e){e||this.$emit("close",null)}}});var Ke=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("NcDialog",{attrs:{name:e.name,open:e.open,"close-on-click-outside":"","out-transition":""},on:{"update:open":e.onClose},scopedSlots:e._u([{key:"actions",fn:function(){return[t("NcButton",{attrs:{type:"primary",disabled:!e.isUniqueName},on:{click:e.onCreate}},[e._v(" "+e._s(e.t("files","Create"))+" ")])]},proxy:!0}])},[t("form",{on:{submit:function(i){return i.preventDefault(),e.onCreate.apply(null,arguments)}}},[t("NcTextField",{ref:"input",attrs:{error:!e.isUniqueName,"helper-text":e.errorMessage,label:e.label,value:e.localDefaultName},on:{"update:value":function(i){e.localDefaultName=i}}})],1)])},Qe=[],Ye=De(Ge,Ke,Qe,!1,null,null,null,null);const Ze=Ye.exports;function I(e,t,i={}){const o=t.map(n=>n.basename);return new Promise(n=>{Te(Ze,{...i,defaultName:e,otherNames:o},l=>{n(l)})})}const Xe=async(e,t)=>{const i=e.source+"/"+t,o=e.encodedSource+"/"+encodeURIComponent(t),n=await g({method:"MKCOL",url:o,headers:{Overwrite:"F"}});return{fileid:parseInt(n.headers["oc-fileid"]),source:i}},et={id:"newFolder",displayName:r("files","New folder"),enabled:e=>(e.permissions&c.CREATE)!==0,iconSvgInline:Ce,order:0,async handler(e,t){var i,o;const n=await I(r("files","New folder"),t);if(n!==null){const{fileid:l,source:a}=await Xe(e,n),s=new $({source:a,id:l,mtime:new Date,owner:((i=v())==null?void 0:i.uid)||null,permissions:c.ALL,root:(e==null?void 0:e.root)||"/files/"+((o=v())==null?void 0:o.uid)});me(r("files",'Created new folder "{name}"',{name:O.basename(a)})),d.debug("Created new folder",{folder:s,source:a}),h("files:node:created",s),window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:s.fileid},{dir:e.path})}}};let _=T("files","templates_path",!1);d.debug("Initial templates folder",{templatesPath:_});const tt=async function(e,t){const i=O.join(e.path,t);try{d.debug("Initializing the templates directory",{templatePath:i});const{data:o}=await g.post(J("apps/files/api/v1/templates/path"),{templatePath:i,copySystemTemplates:!0});window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:void 0},{dir:i}),d.info("Created new templates folder",{...o.ocs.data}),_=o.ocs.data.templates_path}catch{d.error("Unable to initialize the templates directory"),z(r("files","Unable to initialize the templates directory"))}},it={id:"template-picker",displayName:r("files","Create new templates folder"),iconSvgInline:Ee,order:10,enabled(e){var t;return _||e.owner!==((t=v())==null?void 0:t.uid)?!1:(e.permissions&c.CREATE)!==0},async handler(e,t){const i=await I(r("files","Templates"),t,{name:r("files","New template folder")});i!==null&&(tt(e,i),Z("template-picker"))}},ot=ce(()=>Pe(()=>import("./chunks/TemplatePicker-ClGNZ5e7.mjs"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url));let C=null;const rt=async()=>{if(C===null){const e=document.createElement("div");e.id="template-picker",document.body.appendChild(e),C=new V({render:t=>t(ot,{ref:"picker"}),methods:{open(...t){this.$refs.picker.open(...t)}},el:e})}return C};function at(){T("files","templates",[]).forEach((e,t)=>{E({id:"template-new-".concat(e.app,"-").concat(t),displayName:e.label,iconClass:e.iconClass||"icon-file",enabled(i){return(i.permissions&c.CREATE)!==0},order:11,async handler(i,o){const n=rt(),l=await I("".concat(e.label).concat(e.extension),o,{label:r("files","Filename"),name:e.label});l!==null&&(await n).open(l,e)}})})}const M=Ie(),nt='<?xml version="1.0"?>\n<oc:filter-files '.concat(X(),">\n	<d:prop>\n		").concat(ee(),"\n	</d:prop>\n	<oc:filter-rules>\n		<oc:favorite>1</oc:favorite>\n	</oc:filter-rules>\n</oc:filter-files>"),Y=async(e="/")=>{const t=te();let i;e==="/"&&(i=await M.stat(e,{details:!0,data:t}));const o=await M.getDirectoryContents(e,{details:!0,data:e==="/"?nt:t,headers:{method:e==="/"?"REPORT":"PROPFIND"},includeSelf:!0}),n=(i==null?void 0:i.data)||o.data[0],l=o.data.filter(a=>a.filename!==e);return{folder:U(n),contents:l.map(U)}},j=function(e,t=0){return new D({id:S(e.path),name:O.basename(e.path),icon:P,order:t,params:{dir:e.path,fileid:e.fileid.toString(),view:"favorites"},parent:"favorites",columns:[],getContents:Y})},S=function(e){return"favorite-".concat(ke(e))},st=()=>{const e=T("files","favoriteFolders",[]),t=e.map((a,s)=>j(a,s));d.debug("Generating favorites view",{favoriteFolders:e});const i=R();i.register(new D({id:"favorites",name:r("files","Favorites"),caption:r("files","List of favorites files and folders."),emptyTitle:r("files","No favorites yet"),emptyCaption:r("files","Files and folders you mark as favorite will show up here"),icon:G,order:5,columns:[],getContents:Y})),t.forEach(a=>i.register(a)),L("files:favorites:added",a=>{var s;if(a.type===f.Folder){if(a.path===null||!((s=a.root)!=null&&s.startsWith("/files"))){d.error("Favorite folder is not within user files root",{node:a});return}n(a)}}),L("files:favorites:removed",a=>{var s;if(a.type===f.Folder){if(a.path===null||!((s=a.root)!=null&&s.startsWith("/files"))){d.error("Favorite folder is not within user files root",{node:a});return}l(a.path)}});const o=function(){e.sort((a,s)=>a.path.localeCompare(s.path,fe(),{ignorePunctuation:!0})),e.forEach((a,s)=>{const m=t.find(w=>w.id===S(a.path));m&&(m.order=s)})},n=function(a){const s={path:a.path,fileid:a.fileid},m=j(s);e.find(w=>w.path===a.path)||(e.push(s),t.push(m),o(),i.register(m))},l=function(a){const s=S(a),m=e.findIndex(w=>w.path===a);m!==-1&&(e.splice(m,1),t.splice(m,1),i.remove(s),o())}},lt=ie(),dt=Math.round(Date.now()/1e3-60*60*24*14),ct=async(e="/")=>{var t;const i=(await lt.getDirectoryContents(e,{details:!0,data:oe(dt),headers:{method:"SEARCH","Content-Type":"application/xml; charset=utf-8"},deep:!0})).data;return{folder:new $({id:0,source:"".concat(re).concat(k),root:k,owner:((t=v())==null?void 0:t.uid)||null,permissions:c.READ}),contents:i.map(o=>ae(o))}},ft=()=>{R().register(new D({id:"recent",name:r("files","Recent"),caption:r("files","List of recently modified files and folders."),emptyTitle:r("files","No recently modified files"),emptyCaption:r("files","Files and folders you recently modified will show up here."),icon:Fe,order:2,defaultSortKey:"mtime",getContents:ct}))},ut=()=>{R().register(new D({id:"files",name:r("files","All files"),caption:r("files","List of your files and folders."),icon:P,order:0,getContents:_e}))},mt=()=>{"serviceWorker"in navigator?window.addEventListener("load",async()=>{try{const e=x("/apps/files/preview-service-worker.js",{},{noRewrite:!0}),t=await navigator.serviceWorker.register(e,{scope:"/"});d.debug("SW registered: ",{registration:t})}catch(e){d.error("SW registration failed: ",{error:e})}}):d.debug("Service Worker is not enabled on this browser.")};u(We),u(Be),u(je),u(He),u(Re),u($e),u(Je),u(Ve),u(xe),u(ze),E(et),E(it),at(),st(),ut(),ft(),mt(),A("nc:hidden",{nc:"http://nextcloud.org/ns"}),A("nc:is-mount-root",{nc:"http://nextcloud.org/ns"}),Se();
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = [OC.filePath('nextcloud', '', 'dist/chunks/TemplatePicker-ClGNZ5e7.mjs'),OC.filePath('nextcloud', '', 'dist/core-common.mjs'),OC.filePath('nextcloud', '', 'dist/chunks/index-Ca0QcE7e.mjs'),OC.filePath('nextcloud', '', 'dist/chunks/toast-7xJhDYMn-BrG8uCqw.mjs'),OC.filePath('nextcloud', '', 'dist/chunks/index-BLIV22dB.mjs'),OC.filePath('nextcloud', '', 'dist/chunks/index-DgCiVkaQ.mjs'),OC.filePath('nextcloud', '', 'dist/chunks/index-Biv1VH4I.mjs'),OC.filePath('nextcloud', '', 'dist/chunks/fileUtils-pqLuXd9u.mjs'),OC.filePath('nextcloud', '', 'dist/chunks/icons-BxSPavMS.mjs'),OC.filePath('nextcloud', '', 'dist/chunks/logger-CMIEMPjA.mjs')]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
