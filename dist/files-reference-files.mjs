/*! third party licenses: dist/vendor.LICENSE.txt */
import{bR as n,aM as a,bE as s,aH as c,c3 as d,c4 as f,c5 as p}from"./core-common.mjs";import{a as h}from"./chunks/index-Ca0QcE7e.mjs";import{n as o}from"./chunks/icons-BxSPavMS.mjs";import{FilePickerVue as m}from"./chunks/index-1zThpkd0-BaccqBs5.mjs";import"./chunks/preload-helper-3Yr03P9X.mjs";const u={name:"ReferenceFileWidget",props:{richObject:{type:Object,required:!0},accessible:{type:Boolean,default:!0}},data(){return{previewUrl:window.OC.MimeType.getIconUrl(this.richObject.mimetype)}},computed:{fileSize(){return window.OC.Util.humanFileSize(this.richObject.size)},fileMtime(){return window.OC.Util.relativeModifiedDate(this.richObject.mtime*1e3)},filePath(){return h.dirname(this.richObject.path)},filePreview(){return this.previewUrl?{backgroundImage:"url("+this.previewUrl+")"}:{backgroundImage:"url("+window.OC.MimeType.getIconUrl(this.richObject.mimetype)+")"}},filePreviewClass(){return this.previewUrl?"widget-file--image--preview":"widget-file--image--icon"}},mounted(){if(this.richObject["preview-available"]){const e=n("/core/preview?fileId={fileId}&x=250&y=250",{fileId:this.richObject.id}),i=new Image;i.onload=()=>{this.previewUrl=e},i.onerror=t=>{console.error("could not load recommendation preview",t)},i.src=e}},methods:{navigate(){if(OCA.Viewer&&OCA.Viewer.mimetypes.indexOf(this.richObject.mimetype)!==-1){OCA.Viewer.open({path:this.richObject.path});return}window.location=this.richObject.link}}};var w=function(){var e=this,i=e._self._c;return e.accessible?i("a",{staticClass:"widget-file",attrs:{href:e.richObject.link},on:{click:function(t){return t.preventDefault(),e.navigate.apply(null,arguments)}}},[i("div",{staticClass:"widget-file--image",class:e.filePreviewClass,style:e.filePreview}),i("div",{staticClass:"widget-file--details"},[i("p",{staticClass:"widget-file--title"},[e._v(e._s(e.richObject.name))]),i("p",{staticClass:"widget-file--description"},[e._v(e._s(e.fileSize)),i("br"),e._v(e._s(e.fileMtime))]),i("p",{staticClass:"widget-file--link"},[e._v(e._s(e.filePath))])])]):i("div",{staticClass:"widget-file widget-file--no-access"},[i("div",{staticClass:"widget-file--image widget-file--image--icon icon-folder"}),i("div",{staticClass:"widget-file--details"},[i("p",{staticClass:"widget-file--title"},[e._v(" "+e._s(e.t("files","File cannot be accessed"))+" ")]),i("p",{staticClass:"widget-file--description"},[e._v(" "+e._s(e.t("files","The file could not be found or you do not have permissions to view it. Ask the sender to share it."))+" ")])])])},b=[],v=o(u,w,b,!1,null,"8280ec17",null,null);const g=v.exports,O=a({name:"FileReferencePickerElement",components:{FilePicker:m},props:{providerId:{type:String,required:!0},accessible:{type:Boolean,default:!1}},computed:{containerId(){return"filepicker-".concat(Math.random().toString(36).slice(7))},filepickerOptions(){return{allowPickDirectory:!1,buttons:this.buttonFactory,container:"#".concat(this.containerId),multiselect:!1,name:s("files","Select file or folder to link to")}}},methods:{t:s,buttonFactory(e){const i=[];return e.length===0?i.push({label:s("files","Choose file"),type:"tertiary",callback:this.onClose}):i.push({label:s("files","Choose {file}",{file:e[0].basename}),type:"primary",callback:this.onClose}),i},onClose(e){e===void 0||e.length===0?this.$emit("cancel"):this.onSubmit(e[0])},onSubmit(e){const i=new URL(window.location.href);i.pathname=n("/f/{fileId}",{fileId:e.fileid}),i.search="",this.$emit("submit",i.href)}}});var C=function(){var e=this,i=e._self._c;return e._self._setupProxy,i("div",{attrs:{id:e.containerId}},[i("FilePicker",e._b({on:{close:e.onClose}},"FilePicker",e.filepickerOptions,!1))],1)},y=[],j=o(O,C,y,!1,null,null,null,null);const k=j.exports;c.mixin({methods:{t:s}}),d("file",(e,{richObjectType:i,richObject:t,accessible:r})=>{const l=c.extend(g);new l({propsData:{richObjectType:i,richObject:t,accessible:r}}).$mount(e)}),f("files",(e,{providerId:i,accessible:t})=>{const r=c.extend(k),l=new r({propsData:{providerId:i,accessible:t}}).$mount(e);return new p(l.$el,l)},(e,i)=>{i.object.$destroy()});
