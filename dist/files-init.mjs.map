{"version":3,"mappings":";ixCAiCA,MAAMA,EAAkBC,GAChBA,EAAM,MAAcC,KAAK,WAAW,eAAe,IAAM,IAC5DA,EAAK,WAAW,YAAY,IAAM,QAAQ,EAGzCC,EAAqBF,GACnBA,EAAM,MAAcC,KAAK,WAAW,eAAe,IAAM,IAC5DA,EAAK,WAAW,YAAY,IAAM,UAAU,EAG3CE,GAA2BH,GAAkB,CAC9C,GAAAA,EAAM,SAAW,EACb,SAGF,MAAAI,EAAiBJ,EAAM,KAAKC,GAAQF,EAAe,CAACE,CAAI,CAAC,CAAC,EAC1DI,EAAiBL,EAAM,KAAKC,GAAQ,CAACF,EAAe,CAACE,CAAI,CAAC,CAAC,EACjE,OAAOG,GAAkBC,CAC1B,EAEMC,GAAcN,GACZ,CAACA,EAAM,QAAaC,EAAK,OAASM,EAAS,IAAI,EAGjDC,GAAgBR,GACd,CAACA,EAAM,QAAaC,EAAK,OAASM,EAAS,MAAM,EAGnDE,EAAc,CAACT,EAAeU,IAI/BA,EAAK,KAAO,WACRC,EAAE,QAAS,oBAAoB,EAMnCR,GAAwBH,CAAK,EACzBW,EAAE,QAAS,oBAAoB,EAOnCZ,EAAeC,CAAK,EAChBY,EAAE,QAAS,mBAAoB,qBAAsBZ,EAAM,MAAM,EAOrEE,EAAkBF,CAAK,EACnBY,EAAE,QAAS,qBAAsB,sBAAuBZ,EAAM,MAAM,EAMxEM,GAAWN,CAAK,EACZY,EAAE,QAAS,cAAe,eAAgBZ,EAAM,MAAM,EAM1DQ,GAAaR,CAAK,EACdY,EAAE,QAAS,gBAAiB,iBAAkBZ,EAAM,MAAM,EAG3DW,EAAE,QAAS,QAAQ,EAGdE,GAAS,IAAIC,EAAW,CACpC,GAAI,SACJ,YAAAL,EACA,cAAgBT,GACXD,EAAeC,CAAK,EAChBe,GAGJb,EAAkBF,CAAK,EACnBgB,GAGDC,GAGR,QAAQjB,EAAe,CACtB,OAAOA,EAAM,OAAS,GAAKA,EACzB,IAAYC,KAAK,WAAW,EAC5B,MAAMiB,IAAeA,EAAaC,EAAW,UAAY,CAAC,CAC7D,EAEA,MAAM,KAAKlB,EAAY,CAClB,IACG,OAAAmB,QAAM,OAAOnB,EAAK,aAAa,EAKrCoB,EAAK,qBAAsBpB,CAAI,EACxB,SACCqB,EAAO,CACR,OAAAC,EAAA,MAAM,8BAA+B,CAAE,MAAAD,EAAO,OAAQrB,EAAK,OAAQ,KAAAA,EAAM,EACzE,EACR,CACD,EAEA,MAAM,UAAUD,EAAeU,EAAYc,EAA0C,CAuBpF,OAtBgB,MAAM,IAAI,QAA4BC,GAAA,CACjD,GAAAzB,EAAM,QAAU,GAAK,CAACD,EAAeC,CAAK,GAAK,CAACE,EAAkBF,CAAK,EAAG,CAE7E,OAAO,GAAG,QAAQ,mBACjBW,EAAE,QAAS,yCAA0C,CAAE,MAAOX,EAAM,OAAQ,EAC5EW,EAAE,QAAS,kBAAkB,EAC7B,CACC,KAAM,OAAO,GAAG,QAAQ,eACxB,QAASF,EAAYT,EAAOU,CAAI,EAChC,eAAgB,QAChB,OAAQC,EAAE,QAAS,QAAQ,CAC5B,EACCe,GAAsB,CACtBD,EAAQC,CAAQ,CACjB,GAED,MACD,CACAD,EAAQ,EAAI,EACZ,IAGe,IACNE,GAAAhB,EAAE,QAAS,oBAAoB,CAAC,EAClC,QAAQ,IAAIX,EAAM,IAAI,IAAM,EAAK,CAAC,GAGnC,QAAQ,IAAIA,EAAM,IAAIC,GAAQ,KAAK,KAAKA,EAAMS,EAAMc,CAAG,CAAC,CAAC,CACjE,EAEA,MAAO,GACR,CAAC,ECvJKI,EAAkB,SAASC,EAAa,CACvC,MAAAC,EAAgB,SAAS,cAAc,GAAG,EAChDA,EAAc,SAAW,GACzBA,EAAc,KAAOD,EACrBC,EAAc,MAAM,CACrB,EAEMC,EAAgB,SAASP,EAAaxB,EAAe,CACpD,MAAAgC,EAAS,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,UAAU,CAAC,EAC/CH,EAAMI,EAAY,qFAAsF,CAC7G,IAAAT,EACA,OAAAQ,EACA,MAAO,KAAK,UAAUhC,EAAM,IAAYC,KAAK,QAAQ,CAAC,EACtD,EACD2B,EAAgBC,CAAG,CACpB,EAEMK,GAAiB,SAASjC,EAAY,CAC3C,GAAK,EAAAA,EAAK,YAAckB,EAAW,MAC3B,SAIR,GAAIlB,EAAK,WAAW,YAAY,IAAM,SAAU,CAC/C,MAAMkC,EAAoB,KAAK,MAAMlC,EAAK,WAAW,kBAAkB,CAAC,EAAE,KAAMmC,GAA8CA,EAAU,QAAU,eAAiBA,EAAU,MAAQ,UAAU,EAC/L,GAAID,IAAsB,QAAaA,EAAkB,UAAY,GAC7D,QAET,CAEO,QACR,EAEatB,GAAS,IAAIC,EAAW,CACpC,GAAI,WACJ,YAAa,IAAMH,EAAE,QAAS,UAAU,EACxC,cAAe,IAAM0B,GAErB,QAAQrC,EAAe,CAQlB,OAPAA,EAAM,SAAW,GAOjBA,EAAM,KAAKC,GAAQA,EAAK,OAASM,EAAS,MAAM,GAChDP,EAAM,KAAUC,GAAA,CAzEtB,IAAAqC,EAyE0B,SAAAA,EAAArC,EAAK,OAAL,MAAAqC,EAAW,WAAW,WAAS,EAC/C,GAGDtC,EAAM,MAAMkC,EAAc,CAClC,EAEA,MAAM,KAAKjC,EAAYS,EAAYc,EAAa,CAC3C,OAAAvB,EAAK,OAASM,EAAS,QACZwB,EAAAP,EAAK,CAACvB,CAAI,CAAC,EAClB,OAGR2B,EAAgB3B,EAAK,aAAa,EAC3B,KACR,EAEA,MAAM,UAAUD,EAAeU,EAAYc,EAAa,CACnD,OAAAxB,EAAM,SAAW,GACpB,KAAK,KAAKA,EAAM,CAAC,EAAGU,EAAMc,CAAG,EACtB,CAAC,IAAI,IAGbO,EAAcP,EAAKxB,CAAK,EACjB,IAAI,MAAMA,EAAM,MAAM,EAAE,KAAK,IAAI,EACzC,EAEA,MAAO,EACR,CAAC,ECtEKuC,GAAkB,eAAeC,EAAc,CA/BrD,IAAAF,EAgCO,MAAAG,EAAOC,EAAe,mBAAmB,EAAI,+BAE/C,IACH,MAAMC,EAAS,MAAMvB,EAAM,KAAKqB,EAAM,CAAE,KAAAD,EAAM,EACxCI,GAAMN,EAAeO,EAAA,IAAf,KAAkB,OAAAP,EAAA,IAC1B,IAAAT,EAAM,aAAa,OAAGe,EAAA,KAAM,OAAO,SAAS,KAAOE,EAAWN,CAAI,EACtEX,GAAO,UAAYc,EAAO,KAAK,IAAI,KAAK,MAExC,OAAO,SAAS,KAAOd,OACR,CACLkB,EAAApC,EAAE,QAAS,8BAA8B,CAAC,CACrD,CACD,EAEaE,GAAS,IAAIC,EAAW,CACpC,GAAI,eACJ,YAAa,IAAMH,EAAE,QAAS,cAAc,EAC5C,cAAe,IAAMqC,GAGrB,QAAQhD,EAAe,CAElB,OAAAA,EAAM,SAAW,EACb,IAGAA,EAAM,CAAC,EAAE,YAAcmB,EAAW,UAAY,CACvD,EAEA,MAAM,KAAKlB,EAAY,CACtB,OAAAsC,GAAgBtC,EAAK,IAAI,EAClB,IACR,EAEA,MAAO,EACR,CAAC,EChCKgD,EAAkBjD,GAChBA,EAAM,KAAKC,GAAQA,EAAK,WAAW,WAAa,CAAC,EAG5CiD,EAAe,MAAOjD,EAAYS,EAAYyC,IAA4C,CAClG,IAEH,MAAMtB,EAAMI,EAAY,0BAA0B,EAAIa,EAAW7C,EAAK,IAAI,EACpE,aAAAmB,EAAM,KAAKS,EAAK,CACrB,KAAMsB,EACH,CAAC,OAAO,GAAG,YAAY,EACvB,CAAC,EACJ,EAKGzC,EAAK,KAAO,aAAe,CAACyC,GAAgBlD,EAAK,UAAY,KAChEoB,EAAK,qBAAsBpB,CAAI,EAIhCmD,EAAI,IAAInD,EAAK,WAAY,WAAYkD,EAAe,EAAI,CAAC,EAGrDA,EACH9B,EAAK,wBAAyBpB,CAAI,EAElCoB,EAAK,0BAA2BpB,CAAI,EAG9B,SACCqB,EAAO,CACTT,QAASsC,EAAe,8BAAgC,kCACvD,OAAA5B,EAAA,MAAM,eAAiBV,EAAQ,CAAE,MAAAS,EAAO,OAAQrB,EAAK,OAAQ,KAAAA,CAAA,CAAM,EACnE,EACR,CACD,EAEaY,GAAS,IAAIC,EAAW,CACpC,GAAI,WACJ,YAAYd,EAAe,CACnB,OAAAiD,EAAejD,CAAK,EACxBW,EAAE,QAAS,kBAAkB,EAC7BA,EAAE,QAAS,uBAAuB,CACtC,EACA,cAAgBX,GACRiD,EAAejD,CAAK,EACxBqD,GACAC,EAGJ,QAAQtD,EAAe,CAEf,OAACA,EAAM,KAAUC,GAAA,CAzF1B,IAAAqC,EAAAiB,EAyF6B,SAACA,GAAKjB,EAAArC,EAAA,OAAL,KAAW,OAAAqC,EAAA,aAAX,MAAwBiB,EAAA,KAAAjB,EAAA,WAAS,GACzDtC,EAAM,SAAcC,EAAK,cAAgBkB,EAAW,IAAI,CAC7D,EAEA,MAAM,KAAKlB,EAAYS,EAAY,CAClC,MAAMyC,EAAeF,EAAe,CAAChD,CAAI,CAAC,EAC1C,OAAO,MAAMiD,EAAajD,EAAMS,EAAMyC,CAAY,CACnD,EACA,MAAM,UAAUnD,EAAeU,EAAY,CACpC,MAAAyC,EAAeF,EAAejD,CAAK,EACzC,OAAO,QAAQ,IAAIA,EAAM,IAAI,MAAMC,GAAQ,MAAMiD,EAAajD,EAAMS,EAAMyC,CAAY,CAAC,CAAC,CACzF,EAEA,MAAO,GACR,CAAC,EC9EYtC,GAAS,IAAIC,EAAW,CACpC,GAAI,cACJ,YAAY0C,EAAe,CAEpB,MAAA/C,EAAc+C,EAAM,CAAC,EAAE,WAAW,aAAeA,EAAM,CAAC,EAAE,SAChE,OAAO7C,EAAE,QAAS,4BAA6B,CAAE,YAAAF,CAAa,EAC/D,EACA,cAAe,IAAMgD,EAErB,QAAQzD,EAAe,CAElB,GAAAA,EAAM,SAAW,EACb,SAGF,MAAAC,EAAOD,EAAM,CAAC,EAEhB,OAACC,EAAK,eAIHA,EAAK,OAASM,EAAS,SACzBN,EAAK,YAAckB,EAAW,QAAU,EAJrC,EAKT,EAEA,MAAM,KAAKlB,EAAYS,EAAY,CAClC,MAAI,CAACT,GAAQA,EAAK,OAASM,EAAS,OAC5B,IAGD,WAAI,MAAM,OAAO,UACvB,KACA,CAAE,KAAMG,EAAK,GAAI,OAAQT,EAAK,MAAO,EACrC,CAAE,IAAKA,EAAK,IAAK,GAEX,KACR,EAGA,QAASyD,EAAY,OACrB,MAAO,IACR,CAAC,ECtCY7C,GAAS,IAAIC,EAAW,CACpC,GAAI,uBACJ,YAAa,IAAMH,EAAE,QAAS,eAAe,EAC7C,cAAe,IAAM,GAErB,QAAS,CAACX,EAAOU,IAASA,EAAK,KAAO,SAEtC,MAAM,KAAKT,EAAY,CACtB,IAAIuB,EAAMvB,EAAK,QACX,OAAAA,EAAK,OAASM,EAAS,SACpBiB,IAAM,IAAMvB,EAAK,UAGjB,WAAI,MAAM,OAAO,UACvB,KACA,CAAE,KAAM,QAAS,OAAQA,EAAK,MAAO,EACrC,CAAE,IAAAuB,CAAI,GAEA,IACR,EAGA,MAAO,KACP,QAASkC,EAAY,MACtB,CAAC,ECxBY7C,GAAS,IAAIC,EAAW,CACpC,GAAI,SACJ,YAAa,IAAMH,EAAE,QAAS,QAAQ,EACtC,cAAe,IAAMgD,GAErB,QAAU3D,GACFA,EAAM,OAAS,GAAKA,EACzB,IAAYC,KAAK,WAAW,EAC5B,MAAMiB,IAAeA,EAAaC,EAAW,UAAY,CAAC,EAG7D,MAAM,KAAKlB,EAAY,CAEtB,OAAAoB,EAAK,oBAAqBpB,CAAI,EACvB,IACR,EAEA,MAAO,EACR,CAAC,ECrBYY,GAAS,IAAIC,EAAW,CACpC,GAAI,iBACJ,aAAc,CACN,OAAAH,EAAE,QAAS,gBAAgB,CACnC,EACA,cAAe,IAAMiD,GAErB,QAAQ5D,EAAeU,EAAY,CAO9B,GALAA,EAAK,KAAO,SAKZV,EAAM,SAAW,EACb,SAGF,MAAAC,EAAOD,EAAM,CAAC,EAMhB,MAJA,CAACC,EAAK,gBAINA,EAAK,cAAgBkB,EAAW,KAC5B,GAGDlB,EAAK,OAASM,EAAS,IAC/B,EAEA,MAAM,KAAKN,EAAY,CACtB,MAAI,CAACA,GAAQA,EAAK,OAASM,EAAS,KAC5B,IAGD,WAAI,MAAM,OAAO,UACvB,KACA,CAAE,KAAM,QAAS,OAAQN,EAAK,MAAO,EACrC,CAAE,IAAKA,EAAK,OAAQ,GAEd,KACR,EAEA,MAAO,EACR,CAAC,ECXD4D,GAAAC,GAAA,CACA,qBACA,qBACAC,GAAA,SACAC,GAAA,YACAC,EACA,EACA,OAIA,aACA,YACA,QAAAtD,EAAA,qBACA,EAIA,YACA,WACA,cACA,EAIA,MACA,aACA,UACA,EAIA,MACA,YACA,QAAAA,EAAA,4BACA,EAIA,OACA,YACA,QAAAA,EAAA,sBACA,CACA,EACA,OACA,MAAAuD,OAAA,MAAAA,CACA,EACA,OACA,OACA,mCAAAvD,EAAA,sBAEA,EACA,UACA,eACA,yBACA,GAEAA,EAAA,0DAEA,EACA,aACA,OAAAwD,GAAA,sCACA,EACA,eACA,8CACA,CACA,EACA,OACA,cACA,wCAAAxD,EAAA,qBACA,CACA,EACA,UAEA,sCACA,mCAAA4C,GAAAjB,EAAA,+BAAAA,EAAA,oBAAAiB,EAAA,KAAAjB,CAAA,GACA,EACA,WACA3B,EACA,WACA,yCACA,EACA,QAAAyD,EAAA,CACAA,GACA,wBAEA,CACA,CACA,0uBCvGO,SAASC,EAAYC,EAAqBC,EAAuBC,EAAkB,GAAI,CAC7F,MAAMC,EAAeF,EAAc,IAAKtE,GAAeA,EAAK,QAAQ,EAE7D,WAAI,QAAsBwB,GAAY,CAC5CiD,GAAYC,GAAe,CAC1B,GAAGH,EACH,YAAAF,EACA,WAAYG,CACb,EAAIG,GAAe,CAClBnD,EAAQmD,CAAyB,EACjC,EACD,CACF,CCfA,MAAMC,GAAkB,MAAOC,EAAcZ,IAAgD,CACtF,MAAAa,EAASD,EAAK,OAAS,IAAMZ,EAC7Bc,EAAgBF,EAAK,cAAgB,IAAM,mBAAmBZ,CAAI,EAElEe,EAAW,MAAM7D,EAAM,CAC5B,OAAQ,QACR,IAAK4D,EACL,QAAS,CACR,UAAW,GACZ,EACA,EACM,OACN,OAAQ,SAASC,EAAS,QAAQ,WAAW,CAAC,EAC9C,OAAAF,CAAA,CAEF,EAEaG,GAAQ,CACpB,GAAI,YACJ,YAAavE,EAAE,QAAS,YAAY,EACpC,QAAUwE,IAAqBA,EAAQ,YAAchE,EAAW,UAAY,EAC5E,cAAeiE,GACf,MAAO,EACP,MAAM,QAAQD,EAAiBE,EAAiB,CAhEjD,IAAA/C,EAAAiB,EAiEE,MAAMW,EAAO,MAAMG,EAAY1D,EAAE,QAAS,YAAY,EAAG0E,CAAO,EAChE,GAAInB,IAAS,KAAM,CAClB,KAAM,CAAE,OAAAoB,EAAQ,OAAAP,GAAW,MAAMF,GAAgBM,EAASjB,CAAI,EAExDqB,EAAS,IAAIC,EAAO,CACzB,OAAAT,EACA,GAAIO,EACJ,UAAW,KACX,QAAOhD,EAAAO,EAAA,gBAAAP,EAAkB,MAAO,KAChC,YAAanB,EAAW,IACxB,MAAegE,iBAAA,OAAQ,YAAY5B,EAAAV,EAAA,SAAkB,OAAAU,EAAA,KACrD,EAEWkC,GAAA9E,EAAE,QAAS,8BAA+B,CAAE,KAAM+E,WAASX,CAAM,CAAG,EAAC,EACjFxD,EAAO,MAAM,qBAAsB,CAAE,OAAAgE,EAAQ,OAAAR,CAAQ,GACrD1D,EAAK,qBAAsBkE,CAAM,EAC1B,WAAI,MAAM,OAAO,UACvB,KACA,CAAE,KAAM,QAAS,OAAQA,EAAO,MAAO,EACvC,CAAE,IAAKJ,EAAQ,IAAK,EAEtB,CACD,CACD,EClDA,IAAIQ,EAAgBC,EAAwB,QAAS,iBAAkB,EAAK,EAC5ErE,EAAO,MAAM,2BAA4B,CAAE,cAAAoE,CAAe,GAO1D,MAAME,GAAsB,eAAeC,EAAmB5B,EAAc,CAC3E,MAAM6B,EAAeC,EAAA,KAAKF,EAAU,KAAM5B,CAAI,EAC1C,IACH3C,EAAO,MAAM,uCAAwC,CAAE,aAAAwE,CAAc,GAC/D,MAAE,KAAAE,GAAS,MAAM7E,EAAM,KAAKsB,EAAe,kCAAkC,EAAG,CACrF,aAAAqD,EACA,oBAAqB,GACrB,EAGM,WAAI,MAAM,OAAO,UACvB,KACA,CAAE,KAAM,QAAS,OAAQ,MAAU,EACnC,CAAE,IAAKA,CAAa,GAGrBxE,EAAO,KAAK,+BAAgC,CAC3C,GAAG0E,EAAK,IAAI,KACZ,EACeN,EAAAM,EAAK,IAAI,KAAK,oBACf,CACf1E,EAAO,MAAM,8CAA8C,EACjDwB,EAAApC,EAAE,QAAS,8CAA8C,CAAC,CACrE,CACD,EAEauE,GAAQ,CACpB,GAAI,kBACJ,YAAavE,EAAE,QAAS,6BAA6B,EACrD,cAAeuF,GACf,MAAO,GACP,QAAQf,EAA0B,CA7EnC,IAAA7C,EAmFE,OAJIqD,GAIAR,EAAQ,UAAU7C,EAAeO,EAAA,IAAf,cAAkB,KAChC,IAEAsC,EAAQ,YAAchE,EAAW,UAAY,CACtD,EACA,MAAM,QAAQgE,EAAiBE,EAAiB,CAC/C,MAAMnB,EAAO,MAAMG,EAAY1D,EAAE,QAAS,WAAW,EAAG0E,EAAS,CAAE,KAAM1E,EAAE,QAAS,qBAAqB,CAAG,GAExGuD,IAAS,OAEZ2B,GAAoBV,EAASjB,CAAI,EAGjCiC,EAAuB,iBAAiB,EAE1C,CACD,EChEMC,GAAoBC,GAAqB,IAAMC,GAAA,WAAO,sCAA6B,EAAC,yDAC1F,IAAIC,EAA4F,KAEhG,MAAMC,GAAoB,SAAY,CACrC,GAAID,IAAmB,KAAM,CAEtB,MAAAE,EAAgB,SAAS,cAAc,KAAK,EAClDA,EAAc,GAAK,kBACV,cAAK,YAAYA,CAAa,EAGvCF,EAAiB,IAAInD,EAAI,CACxB,OAASsD,GAAMA,EAAEN,GAAmB,CAAE,IAAK,SAAU,EACrD,QAAS,CAAE,QAAQO,EAAM,CAAE,KAAK,MAAM,OAAO,KAAK,GAAGA,CAAI,EAAI,EAC7D,GAAIF,CAAA,CACJ,CACF,CACO,OAAAF,CACR,EAKO,SAASK,IAA0B,CACvBhB,EAA0B,QAAS,YAAa,CAAE,GAG1D,QAAQ,CAACiB,EAAUC,IAAU,CAClBC,EAAA,CACnB,GAAI,gBAAgB,OAASF,EAAA,IAAG,GAAI,SAAAC,CAAA,EACpC,YAAaD,EAAS,MAEtB,UAAWA,EAAS,WAAa,YACjC,QAAQ1B,EAA0B,CACzB,OAAAA,EAAQ,YAAchE,EAAW,UAAY,CACtD,EACA,MAAO,GACP,MAAM,QAAQgE,EAAiBE,EAAiB,CAC/C,MAAM2B,EAAiBR,KACjBtC,EAAO,MAAMG,EAAY,GAAG,SAAS,KAAQ,SAAAwC,EAAS,WAAaxB,EAAS,CACjF,MAAO1E,EAAE,QAAS,UAAU,EAC5B,KAAMkG,EAAS,MACf,EAEG3C,IAAS,OAEG,MAAM8C,GACd,KAAK9C,EAAM2C,CAAQ,CAE5B,EACS,EACV,CACF,CC1DA,MAAMI,EAASC,GAAU,EAEnBC,GAAgB,2CACH,OAAAC,EAAkB,sBAEjC,YAAkB,6GAOTC,EAAc,MAAO7E,EAAO,MAAmC,CAC3E,MAAM8E,EAAkBC,KAGpB,IAAAC,EACAhF,IAAS,MACGgF,EAAA,MAAMP,EAAO,KAAKzE,EAAM,CACtC,QAAS,GACT,KAAM8E,CAAA,CACN,GAGF,MAAMG,EAAmB,MAAMR,EAAO,qBAAqBzE,EAAM,CAChE,QAAS,GAET,KAAMA,IAAS,IAAM2E,GAAgBG,EACrC,QAAS,CAER,OAAQ9E,IAAS,IAAM,SAAW,UACnC,EACA,YAAa,GACb,EAEKsC,GAAO0C,iBAAc,OAAQC,EAAiB,KAAK,CAAC,EACpDC,EAAWD,EAAiB,KAAK,OAAexH,KAAK,WAAauC,CAAI,EAErE,OACN,OAAQmF,EAAa7C,CAAI,EACzB,SAAU4C,EAAS,IAAIC,CAAY,EAErC,EC9BaC,EAA6B,SAASrC,EAAyBuB,EAAQ,EAAS,CAC5F,OAAO,IAAIe,EAAK,CACf,GAAIC,EAAmBvC,EAAO,IAAI,EAClC,KAAMG,WAASH,EAAO,IAAI,EAE1B,KAAM9B,EACN,MAAOqD,EACP,OAAQ,CACP,IAAKvB,EAAO,KACZ,OAAQA,EAAO,OAAO,SAAS,EAC/B,KAAM,WACP,EAEA,OAAQ,YAER,QAAS,CAAC,cAEV8B,CAAA,CACA,CACF,EAEaS,EAAqB,SAAStF,EAAsB,CACzD,kBAAY,UAASA,CAAI,EACjC,EAEAuF,GAAe,IAAM,CAEpB,MAAMC,EAAkBpC,EAA6B,QAAS,kBAAmB,CAAE,GAC7EqC,EAAuBD,EAAgB,IAAI,CAACzC,EAAQuB,IAAUc,EAA2BrC,EAAQuB,CAAK,CAAC,EAC7GvF,EAAO,MAAM,4BAA6B,CAAE,gBAAAyG,CAAiB,GAE7D,MAAME,EAAaC,IACRD,EAAA,SAAS,IAAIL,EAAK,CAC5B,GAAI,YACJ,KAAMlH,EAAE,QAAS,WAAW,EAC5B,QAASA,EAAE,QAAS,sCAAsC,EAE1D,WAAYA,EAAE,QAAS,kBAAkB,EACzC,aAAcA,EAAE,QAAS,0DAA0D,EAEnF,KAAM2C,EACN,MAAO,EAEP,QAAS,CAAC,cAEV+D,CACA,EAAC,EAEFY,EAAqB,QAAQvH,GAAQwH,EAAW,SAASxH,CAAI,CAAC,EAKpD0H,EAAA,wBAA0BnI,GAAe,CA9FpD,IAAAqC,EA+FM,GAAArC,EAAK,OAASM,EAAS,OAKvB,CAAAN,KAAK,OAAS,MAAQ,GAACqC,IAAK,OAAL,MAAAA,EAAW,WAAW,QAAW,IAC3Df,EAAO,MAAM,gDAAiD,CAAE,KAAAtB,CAAM,GACtE,MACD,CAEAoI,EAAepI,CAAc,GAC7B,EAKSmI,EAAA,0BAA4BnI,GAAe,CA/GtD,IAAAqC,EAgHM,GAAArC,EAAK,OAASM,EAAS,OAKvB,CAAAN,KAAK,OAAS,MAAQ,GAACqC,IAAK,OAAL,MAAAA,EAAW,WAAW,QAAW,IAC3Df,EAAO,MAAM,gDAAiD,CAAE,KAAAtB,CAAM,GACtE,MACD,CAEAqI,EAAwBrI,EAAK,IAAI,GACjC,EAMD,MAAMsI,EAAqB,UAAW,CACrCP,EAAgB,KAAK,CAAC,EAAGQ,IAAM,EAAE,KAAK,cAAcA,EAAE,KAAMC,GAAe,GAAE,kBAAmB,EAAM,EAAC,EACvFT,EAAA,QAAQ,CAACzC,EAAQuB,IAAU,CACpC,MAAApG,EAAOuH,EAAqB,KAAMvH,GAASA,EAAK,KAAOoH,EAAmBvC,EAAO,IAAI,CAAC,EACxF7E,IACHA,EAAK,MAAQoG,EACd,CACA,GAIIuB,EAAiB,SAASpI,EAAc,CAC7C,MAAMyI,EAAqC,CAAE,KAAMzI,EAAK,KAAM,OAAQA,EAAK,QACrES,EAAOkH,EAA2Bc,CAAiB,EAGrDV,EAAgB,KAAMzC,GAAWA,EAAO,OAAStF,EAAK,IAAI,IAK9D+H,EAAgB,KAAKU,CAAiB,EACtCT,EAAqB,KAAKvH,CAAI,EAGX6H,IACnBL,EAAW,SAASxH,CAAI,IAInB4H,EAA0B,SAAS9F,EAAc,CAChD,MAAAmG,EAAKb,EAAmBtF,CAAI,EAC5BsE,EAAQkB,EAAgB,UAAWzC,GAAWA,EAAO,OAAS/C,CAAI,EAGpEsE,IAAU,KAKEkB,EAAA,OAAOlB,EAAO,CAAC,EACVmB,EAAA,OAAOnB,EAAO,CAAC,EAGpCoB,EAAW,OAAOS,CAAE,EACDJ,IAAA,CAErB,ECpJMtB,GAAS2B,GAAa,EAEtBC,GAAwB,KAAK,MAAO,KAAK,MAAQ,IAAS,GAAK,GAAK,GAAK,EAAG,EAErExB,GAAc,MAAO7E,EAAO,MAAmC,CAhC5E,IAAAF,EA6CC,MAAMoF,GAZmB,MAAMT,GAAO,qBAAqBzE,EAAM,CAChE,QAAS,GACT,KAAMsG,GAAmBD,EAAqB,EAC9C,QAAS,CAER,OAAQ,SAER,eAAgB,gCACjB,EACA,KAAM,GACN,GAEiC,KAE3B,OACN,OAAQ,IAAIrD,EAAO,CAClB,GAAI,EACJ,OAAQ,GAAG,OAAeuD,EAAA,SAAAC,CAAA,EAC1B,KAAMA,EACN,QAAO1G,EAAAO,EAAA,gBAAAP,EAAkB,MAAO,KAChC,YAAanB,EAAW,KACxB,EACD,SAAUuG,EAAS,IAAKuB,GAAMC,GAAgBD,CAAC,CAAC,EAElD,EC9BAE,GAAe,IAAM,CACDhB,IACR,SAAS,IAAIN,EAAK,CAC5B,GAAI,SACJ,KAAMlH,EAAE,QAAS,QAAQ,EACzB,QAASA,EAAE,QAAS,8CAA8C,EAElE,WAAYA,EAAE,QAAS,4BAA4B,EACnD,aAAcA,EAAE,QAAS,4DAA4D,EAErF,KAAMyI,GACN,MAAO,EAEP,eAAgB,QAEhB,YAAA/B,EACA,EAAC,CACH,ECjBAgC,GAAe,IAAM,CACDlB,IACR,SAAS,IAAIN,EAAK,CAC5B,GAAI,QACJ,KAAMlH,EAAE,QAAS,WAAW,EAC5B,QAASA,EAAE,QAAS,iCAAiC,EAErD,KAAM8C,EACN,MAAO,cAEP4D,EACA,EAAC,CACH,ECfAiC,GAAe,IAAM,CAChB,kBAAmB,UAEtB,OAAO,iBAAiB,OAAQ,SAAY,CAC3C,GAAI,CACH,MAAMzH,EAAMI,EAAY,wCAAyC,CAAE,EAAE,CAAE,UAAW,GAAM,EAClFsH,EAAe,MAAM,UAAU,cAAc,SAAS1H,EAAK,CAAE,MAAO,IAAK,EAC/EN,EAAO,MAAM,kBAAmB,CAAE,aAAAgI,CAAY,CAAE,CAChD,OAAQjI,EAAO,CACfC,EAAO,MAAM,2BAA4B,CAAE,MAAAD,CAAK,CAAE,CAClD,CACJ,CAAG,EAEDC,EAAO,MAAM,gDAAgD,CAE/D,ECOAiI,EAAmBC,EAAY,EAC/BD,EAAmBE,EAAc,EACjCF,EAAmBG,EAAiB,EACpCH,EAAmBI,EAAc,EACjCJ,EAAmBK,EAAgB,EACnCL,EAAmBM,EAAgB,EACnCN,EAAmBO,EAAiB,EACpCP,EAAmBQ,EAAY,EAC/BR,EAAmBS,EAAa,EAChCT,EAAmBU,EAAkB,EAGrCnD,EAAoBoD,EAAc,EAClCpD,EAAoBqD,EAAkB,EACtCxD,KAGAmB,KACAsB,KACAF,KAGAG,KAEAe,EAAoB,YAAa,CAAE,GAAI,yBAA2B,GAClEA,EAAoB,mBAAoB,CAAE,GAAI,yBAA2B,GAEzEC,GAAe","names":["canUnshareOnly","nodes","node","canDisconnectOnly","isMixedUnshareAndDelete","hasSharedItems","hasDeleteItems","isAllFiles","FileType","isAllFolders","displayName","view","t","n","action","FileAction","CloseSvg","NetworkOffSvg","TrashCanSvg","permission","Permission","axios","emit","error","logger","dir","resolve","decision","showInfo","triggerDownload","url","hiddenElement","downloadNodes","secret","generateUrl","isDownloadable","downloadAttribute","attribute","ArrowDownSvg","_a","openLocalClient","path","link","generateOcsUrl","result","uid","getCurrentUser","encodePath","showError","LaptopSvg","shouldFavorite","favoriteNode","willFavorite","Vue","StarOutlineSvg","StarSvg","_b","files","FolderSvg","DefaultType","PencilSvg","FolderMoveSvg","_sfc_main","defineComponent","NcButton","NcDialog","NcTextField","name","getUniqueName","state","newNodeName","defaultName","folderContent","labels","contentNames","spawnDialog","NewNodeDialog","folderName","createNewFolder","root","source","encodedSource","response","entry","context","FolderPlusSvg","content","fileid","folder","Folder","showSuccess","basename","templatesPath","loadState","initTemplatesFolder","directory","templatePath","join","data","PlusSvg","removeNewFileMenuEntry","TemplatePickerVue","defineAsyncComponent","__vitePreload","TemplatePicker","getTemplatePicker","mountingPoint","h","args","registerTemplateEntries","provider","index","addNewFileMenuEntry","templatePicker","client","getClient","reportPayload","getDavNameSpaces","getContents","propfindPayload","davGetDefaultPropfind","rootResponse","contentsResponse","contents","resultToNode","generateFavoriteFolderView","View","generateIdFromPath","registerFavoritesView","favoriteFolders","favoriteFoldersViews","Navigation","getNavigation","subscribe","addToFavorites","removePathFromFavorites","updateAndSortViews","b","getLanguage","newFavoriteFolder","id","davGetClient","lastTwoWeeksTimestamp","davGetRecentSearch","davRemoteURL","davRootPath","r","davResultToNode","registerRecentView","HistorySvg","registerFilesView","registerPreviewServiceWorker","registration","registerFileAction","deleteAction","downloadAction","editLocallyAction","favoriteAction","moveOrCopyAction","openFolderAction","openInFilesAction","renameAction","sidebarAction","viewInFolderAction","newFolderEntry","newTemplatesFolder","registerDavProperty","initLivePhotos"],"sources":["../apps/files/src/actions/deleteAction.ts","../apps/files/src/actions/downloadAction.ts","../apps/files/src/actions/editLocallyAction.ts","../apps/files/src/actions/favoriteAction.ts","../apps/files/src/actions/openFolderAction.ts","../apps/files/src/actions/openInFilesAction.ts","../apps/files/src/actions/renameAction.ts","../apps/files/src/actions/viewInFolderAction.ts","../apps/files/src/components/NewNodeDialog.vue","../apps/files/src/utils/newNodeDialog.ts","../apps/files/src/newMenu/newFolder.ts","../apps/files/src/newMenu/newTemplatesFolder.ts","../apps/files/src/newMenu/newFromTemplate.ts","../apps/files/src/services/Favorites.ts","../apps/files/src/views/favorites.ts","../apps/files/src/services/Recent.ts","../apps/files/src/views/recent.ts","../apps/files/src/views/files.ts","../apps/files/src/services/ServiceWorker.js","../apps/files/src/init.ts"],"sourcesContent":["/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { emit } from '@nextcloud/event-bus'\nimport { Permission, Node, View, FileAction, FileType } from '@nextcloud/files'\nimport { showInfo } from '@nextcloud/dialogs'\nimport { translate as t, translatePlural as n } from '@nextcloud/l10n'\nimport axios from '@nextcloud/axios'\n\nimport CloseSvg from '@mdi/svg/svg/close.svg?raw'\nimport NetworkOffSvg from '@mdi/svg/svg/network-off.svg?raw'\nimport TrashCanSvg from '@mdi/svg/svg/trash-can.svg?raw'\n\nimport logger from '../logger.js'\n\nconst canUnshareOnly = (nodes: Node[]) => {\n\treturn nodes.every(node => node.attributes['is-mount-root'] === true\n\t\t&& node.attributes['mount-type'] === 'shared')\n}\n\nconst canDisconnectOnly = (nodes: Node[]) => {\n\treturn nodes.every(node => node.attributes['is-mount-root'] === true\n\t\t&& node.attributes['mount-type'] === 'external')\n}\n\nconst isMixedUnshareAndDelete = (nodes: Node[]) => {\n\tif (nodes.length === 1) {\n\t\treturn false\n\t}\n\n\tconst hasSharedItems = nodes.some(node => canUnshareOnly([node]))\n\tconst hasDeleteItems = nodes.some(node => !canUnshareOnly([node]))\n\treturn hasSharedItems && hasDeleteItems\n}\n\nconst isAllFiles = (nodes: Node[]) => {\n\treturn !nodes.some(node => node.type !== FileType.File)\n}\n\nconst isAllFolders = (nodes: Node[]) => {\n\treturn !nodes.some(node => node.type !== FileType.Folder)\n}\n\nconst displayName = (nodes: Node[], view: View) => {\n\t/**\n\t * If we're in the trashbin, we can only delete permanently\n\t */\n\tif (view.id === 'trashbin') {\n\t\treturn t('files', 'Delete permanently')\n\t}\n\n\t/**\n\t * If we're in the sharing view, we can only unshare\n\t */\n\tif (isMixedUnshareAndDelete(nodes)) {\n\t\treturn t('files', 'Delete and unshare')\n\t}\n\n\t/**\n\t * If those nodes are all the root node of a\n\t * share, we can only unshare them.\n\t */\n\tif (canUnshareOnly(nodes)) {\n\t\treturn n('files', 'Leave this share', 'Leave these shares', nodes.length)\n\t}\n\n\t/**\n\t * If those nodes are all the root node of an\n\t * external storage, we can only disconnect it.\n\t */\n\tif (canDisconnectOnly(nodes)) {\n\t\treturn n('files', 'Disconnect storage', 'Disconnect storages', nodes.length)\n\t}\n\n\t/**\n\t * If we're only selecting files, use proper wording\n\t */\n\tif (isAllFiles(nodes)) {\n\t\treturn n('files', 'Delete file', 'Delete files', nodes.length)\n\t}\n\n\t/**\n\t * If we're only selecting folders, use proper wording\n\t */\n\tif (isAllFolders(nodes)) {\n\t\treturn n('files', 'Delete folder', 'Delete folders', nodes.length)\n\t}\n\n\treturn t('files', 'Delete')\n}\n\nexport const action = new FileAction({\n\tid: 'delete',\n\tdisplayName,\n\ticonSvgInline: (nodes: Node[]) => {\n\t\tif (canUnshareOnly(nodes)) {\n\t\t\treturn CloseSvg\n\t\t}\n\n\t\tif (canDisconnectOnly(nodes)) {\n\t\t\treturn NetworkOffSvg\n\t\t}\n\n\t\treturn TrashCanSvg\n\t},\n\n\tenabled(nodes: Node[]) {\n\t\treturn nodes.length > 0 && nodes\n\t\t\t.map(node => node.permissions)\n\t\t\t.every(permission => (permission & Permission.DELETE) !== 0)\n\t},\n\n\tasync exec(node: Node) {\n\t\ttry {\n\t\t\tawait axios.delete(node.encodedSource)\n\n\t\t\t// Let's delete even if it's moved to the trashbin\n\t\t\t// since it has been removed from the current view\n\t\t\t//  and changing the view will trigger a reload anyway.\n\t\t\temit('files:node:deleted', node)\n\t\t\treturn true\n\t\t} catch (error) {\n\t\t\tlogger.error('Error while deleting a file', { error, source: node.source, node })\n\t\t\treturn false\n\t\t}\n\t},\n\n\tasync execBatch(nodes: Node[], view: View, dir: string): Promise<(boolean | null)[]> {\n\t\tconst confirm = await new Promise<boolean>(resolve => {\n\t\t\tif (nodes.length >= 5 && !canUnshareOnly(nodes) && !canDisconnectOnly(nodes)) {\n\t\t\t\t// TODO use a proper dialog from @nextcloud/dialogs when available\n\t\t\t\twindow.OC.dialogs.confirmDestructive(\n\t\t\t\t\tt('files', 'You are about to delete {count} items.', { count: nodes.length }),\n\t\t\t\t\tt('files', 'Confirm deletion'),\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: window.OC.dialogs.YES_NO_BUTTONS,\n\t\t\t\t\t\tconfirm: displayName(nodes, view),\n\t\t\t\t\t\tconfirmClasses: 'error',\n\t\t\t\t\t\tcancel: t('files', 'Cancel'),\n\t\t\t\t\t},\n\t\t\t\t\t(decision: boolean) => {\n\t\t\t\t\t\tresolve(decision)\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tresolve(true)\n\t\t})\n\n\t\t// If the user cancels the deletion, we don't want to do anything\n\t\tif (confirm === false) {\n\t\t\tshowInfo(t('files', 'Deletion cancelled'))\n\t\t\treturn Promise.all(nodes.map(() => false))\n\t\t}\n\n\t\treturn Promise.all(nodes.map(node => this.exec(node, view, dir)))\n\t},\n\n\torder: 100,\n})\n","/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { generateUrl } from '@nextcloud/router'\nimport { FileAction, Permission, Node, FileType, View } from '@nextcloud/files'\nimport { translate as t } from '@nextcloud/l10n'\nimport ArrowDownSvg from '@mdi/svg/svg/arrow-down.svg?raw'\n\nconst triggerDownload = function(url: string) {\n\tconst hiddenElement = document.createElement('a')\n\thiddenElement.download = ''\n\thiddenElement.href = url\n\thiddenElement.click()\n}\n\nconst downloadNodes = function(dir: string, nodes: Node[]) {\n\tconst secret = Math.random().toString(36).substring(2)\n\tconst url = generateUrl('/apps/files/ajax/download.php?dir={dir}&files={files}&downloadStartSecret={secret}', {\n\t\tdir,\n\t\tsecret,\n\t\tfiles: JSON.stringify(nodes.map(node => node.basename)),\n\t})\n\ttriggerDownload(url)\n}\n\nconst isDownloadable = function(node: Node) {\n\tif ((node.permissions & Permission.READ) === 0) {\n\t\treturn false\n\t}\n\n\t// If the mount type is a share, ensure it got download permissions.\n\tif (node.attributes['mount-type'] === 'shared') {\n\t\tconst downloadAttribute = JSON.parse(node.attributes['share-attributes']).find((attribute: { scope: string; key: string }) => attribute.scope === 'permissions' && attribute.key === 'download')\n\t\tif (downloadAttribute !== undefined && downloadAttribute.enabled === false) {\n\t\t\treturn false\n\t\t}\n\t}\n\n\treturn true\n}\n\nexport const action = new FileAction({\n\tid: 'download',\n\tdisplayName: () => t('files', 'Download'),\n\ticonSvgInline: () => ArrowDownSvg,\n\n\tenabled(nodes: Node[]) {\n\t\tif (nodes.length === 0) {\n\t\t\treturn false\n\t\t}\n\n\t\t// We can download direct dav files. But if we have\n\t\t// some folders, we need to use the /apps/files/ajax/download.php\n\t\t// endpoint, which only supports user root folder.\n\t\tif (nodes.some(node => node.type === FileType.Folder)\n\t\t\t&& nodes.some(node => !node.root?.startsWith('/files'))) {\n\t\t\treturn false\n\t\t}\n\n\t\treturn nodes.every(isDownloadable)\n\t},\n\n\tasync exec(node: Node, view: View, dir: string) {\n\t\tif (node.type === FileType.Folder) {\n\t\t\tdownloadNodes(dir, [node])\n\t\t\treturn null\n\t\t}\n\n\t\ttriggerDownload(node.encodedSource)\n\t\treturn null\n\t},\n\n\tasync execBatch(nodes: Node[], view: View, dir: string) {\n\t\tif (nodes.length === 1) {\n\t\t\tthis.exec(nodes[0], view, dir)\n\t\t\treturn [null]\n\t\t}\n\n\t\tdownloadNodes(dir, nodes)\n\t\treturn new Array(nodes.length).fill(null)\n\t},\n\n\torder: 30,\n})\n","/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { encodePath } from '@nextcloud/paths'\nimport { generateOcsUrl } from '@nextcloud/router'\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { FileAction, Permission, type Node } from '@nextcloud/files'\nimport { showError } from '@nextcloud/dialogs'\nimport { translate as t } from '@nextcloud/l10n'\nimport axios from '@nextcloud/axios'\n\nimport LaptopSvg from '@mdi/svg/svg/laptop.svg?raw'\n\nconst openLocalClient = async function(path: string) {\n\tconst link = generateOcsUrl('apps/files/api/v1') + '/openlocaleditor?format=json'\n\n\ttry {\n\t\tconst result = await axios.post(link, { path })\n\t\tconst uid = getCurrentUser()?.uid\n\t\tlet url = `nc://open/${uid}@` + window.location.host + encodePath(path)\n\t\turl += '?token=' + result.data.ocs.data.token\n\n\t\twindow.location.href = url\n\t} catch (error) {\n\t\tshowError(t('files', 'Failed to redirect to client'))\n\t}\n}\n\nexport const action = new FileAction({\n\tid: 'edit-locally',\n\tdisplayName: () => t('files', 'Edit locally'),\n\ticonSvgInline: () => LaptopSvg,\n\n\t// Only works on single files\n\tenabled(nodes: Node[]) {\n\t\t// Only works on single node\n\t\tif (nodes.length !== 1) {\n\t\t\treturn false\n\t\t}\n\n\t\treturn (nodes[0].permissions & Permission.UPDATE) !== 0\n\t},\n\n\tasync exec(node: Node) {\n\t\topenLocalClient(node.path)\n\t\treturn null\n\t},\n\n\torder: 25,\n})\n","/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { emit } from '@nextcloud/event-bus'\nimport { generateUrl } from '@nextcloud/router'\nimport { Permission, type Node, View, FileAction } from '@nextcloud/files'\nimport { translate as t } from '@nextcloud/l10n'\nimport axios from '@nextcloud/axios'\nimport Vue from 'vue'\n\nimport StarOutlineSvg from '@mdi/svg/svg/star-outline.svg?raw'\nimport StarSvg from '@mdi/svg/svg/star.svg?raw'\n\nimport logger from '../logger.js'\nimport { encodePath } from '@nextcloud/paths'\n\n// If any of the nodes is not favorited, we display the favorite action.\nconst shouldFavorite = (nodes: Node[]): boolean => {\n\treturn nodes.some(node => node.attributes.favorite !== 1)\n}\n\nexport const favoriteNode = async (node: Node, view: View, willFavorite: boolean): Promise<boolean> => {\n\ttry {\n\t\t// TODO: migrate to webdav tags plugin\n\t\tconst url = generateUrl('/apps/files/api/v1/files') + encodePath(node.path)\n\t\tawait axios.post(url, {\n\t\t\ttags: willFavorite\n\t\t\t\t? [window.OC.TAG_FAVORITE]\n\t\t\t\t: [],\n\t\t})\n\n\t\t// Let's delete if we are in the favourites view\n\t\t// AND if it is removed from the user favorites\n\t\t// AND it's in the root of the favorites view\n\t\tif (view.id === 'favorites' && !willFavorite && node.dirname === '/') {\n\t\t\temit('files:node:deleted', node)\n\t\t}\n\n\t\t// Update the node webdav attribute\n\t\tVue.set(node.attributes, 'favorite', willFavorite ? 1 : 0)\n\n\t\t// Dispatch event to whoever is interested\n\t\tif (willFavorite) {\n\t\t\temit('files:favorites:added', node)\n\t\t} else {\n\t\t\temit('files:favorites:removed', node)\n\t\t}\n\n\t\treturn true\n\t} catch (error) {\n\t\tconst action = willFavorite ? 'adding a file to favourites' : 'removing a file from favourites'\n\t\tlogger.error('Error while ' + action, { error, source: node.source, node })\n\t\treturn false\n\t}\n}\n\nexport const action = new FileAction({\n\tid: 'favorite',\n\tdisplayName(nodes: Node[]) {\n\t\treturn shouldFavorite(nodes)\n\t\t\t? t('files', 'Add to favorites')\n\t\t\t: t('files', 'Remove from favorites')\n\t},\n\ticonSvgInline: (nodes: Node[]) => {\n\t\treturn shouldFavorite(nodes)\n\t\t\t? StarOutlineSvg\n\t\t\t: StarSvg\n\t},\n\n\tenabled(nodes: Node[]) {\n\t\t// We can only favorite nodes within files and with permissions\n\t\treturn !nodes.some(node => !node.root?.startsWith?.('/files'))\n\t\t\t&& nodes.every(node => node.permissions !== Permission.NONE)\n\t},\n\n\tasync exec(node: Node, view: View) {\n\t\tconst willFavorite = shouldFavorite([node])\n\t\treturn await favoriteNode(node, view, willFavorite)\n\t},\n\tasync execBatch(nodes: Node[], view: View) {\n\t\tconst willFavorite = shouldFavorite(nodes)\n\t\treturn Promise.all(nodes.map(async node => await favoriteNode(node, view, willFavorite)))\n\t},\n\n\torder: -50,\n})\n","/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { Permission, Node, FileType, View, FileAction, DefaultType } from '@nextcloud/files'\nimport { translate as t } from '@nextcloud/l10n'\nimport FolderSvg from '@mdi/svg/svg/folder.svg?raw'\n\nexport const action = new FileAction({\n\tid: 'open-folder',\n\tdisplayName(files: Node[]) {\n\t\t// Only works on single node\n\t\tconst displayName = files[0].attributes.displayName || files[0].basename\n\t\treturn t('files', 'Open folder {displayName}', { displayName })\n\t},\n\ticonSvgInline: () => FolderSvg,\n\n\tenabled(nodes: Node[]) {\n\t\t// Only works on single node\n\t\tif (nodes.length !== 1) {\n\t\t\treturn false\n\t\t}\n\n\t\tconst node = nodes[0]\n\n\t\tif (!node.isDavRessource) {\n\t\t\treturn false\n\t\t}\n\n\t\treturn node.type === FileType.Folder\n\t\t\t&& (node.permissions & Permission.READ) !== 0\n\t},\n\n\tasync exec(node: Node, view: View) {\n\t\tif (!node || node.type !== FileType.Folder) {\n\t\t\treturn false\n\t\t}\n\n\t\twindow.OCP.Files.Router.goToRoute(\n\t\t\tnull,\n\t\t\t{ view: view.id, fileid: node.fileid },\n\t\t\t{ dir: node.path },\n\t\t)\n\t\treturn null\n\t},\n\n\t// Main action if enabled, meaning folders only\n\tdefault: DefaultType.HIDDEN,\n\torder: -100,\n})\n","/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { translate as t } from '@nextcloud/l10n'\nimport { type Node, FileType, FileAction, DefaultType } from '@nextcloud/files'\n\n/**\n * TODO: Move away from a redirect and handle\n * navigation straight out of the recent view\n */\nexport const action = new FileAction({\n\tid: 'open-in-files-recent',\n\tdisplayName: () => t('files', 'Open in Files'),\n\ticonSvgInline: () => '',\n\n\tenabled: (nodes, view) => view.id === 'recent',\n\n\tasync exec(node: Node) {\n\t\tlet dir = node.dirname\n\t\tif (node.type === FileType.Folder) {\n\t\t\tdir = dir + '/' + node.basename\n\t\t}\n\n\t\twindow.OCP.Files.Router.goToRoute(\n\t\t\tnull, // use default route\n\t\t\t{ view: 'files', fileid: node.fileid },\n\t\t\t{ dir },\n\t\t)\n\t\treturn null\n\t},\n\n\t// Before openFolderAction\n\torder: -1000,\n\tdefault: DefaultType.HIDDEN,\n})\n","/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { emit } from '@nextcloud/event-bus'\nimport { Permission, type Node, FileAction } from '@nextcloud/files'\nimport { translate as t } from '@nextcloud/l10n'\nimport PencilSvg from '@mdi/svg/svg/pencil.svg?raw'\n\nexport const ACTION_DETAILS = 'details'\n\nexport const action = new FileAction({\n\tid: 'rename',\n\tdisplayName: () => t('files', 'Rename'),\n\ticonSvgInline: () => PencilSvg,\n\n\tenabled: (nodes: Node[]) => {\n\t\treturn nodes.length > 0 && nodes\n\t\t\t.map(node => node.permissions)\n\t\t\t.every(permission => (permission & Permission.UPDATE) !== 0)\n\t},\n\n\tasync exec(node: Node) {\n\t\t// Renaming is a built-in feature of the files app\n\t\temit('files:node:rename', node)\n\t\treturn null\n\t},\n\n\torder: 10,\n})\n","/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { Node, FileType, Permission, View, FileAction } from '@nextcloud/files'\nimport { translate as t } from '@nextcloud/l10n'\nimport FolderMoveSvg from '@mdi/svg/svg/folder-move.svg?raw'\n\nexport const action = new FileAction({\n\tid: 'view-in-folder',\n\tdisplayName() {\n\t\treturn t('files', 'View in folder')\n\t},\n\ticonSvgInline: () => FolderMoveSvg,\n\n\tenabled(nodes: Node[], view: View) {\n\t\t// Only works outside of the main files view\n\t\tif (view.id === 'files') {\n\t\t\treturn false\n\t\t}\n\n\t\t// Only works on single node\n\t\tif (nodes.length !== 1) {\n\t\t\treturn false\n\t\t}\n\n\t\tconst node = nodes[0]\n\n\t\tif (!node.isDavRessource) {\n\t\t\treturn false\n\t\t}\n\n\t\tif (node.permissions === Permission.NONE) {\n\t\t\treturn false\n\t\t}\n\n\t\treturn node.type === FileType.File\n\t},\n\n\tasync exec(node: Node) {\n\t\tif (!node || node.type !== FileType.File) {\n\t\t\treturn false\n\t\t}\n\n\t\twindow.OCP.Files.Router.goToRoute(\n\t\t\tnull,\n\t\t\t{ view: 'files', fileid: node.fileid },\n\t\t\t{ dir: node.dirname },\n\t\t)\n\t\treturn null\n\t},\n\n\torder: 80,\n})\n","<!--\n  - @copyright Copyright (c) 2024 Ferdinand Thiessen <opensource@fthiessen.de>\n  -\n  - @author Ferdinand Thiessen <opensource@fthiessen.de>\n  -\n  - @license AGPL-3.0-or-later\n  -\n  - This program is free software: you can redistribute it and/or modify\n  - it under the terms of the GNU Affero General Public License as\n  - published by the Free Software Foundation, either version 3 of the\n  - License, or (at your option) any later version.\n  -\n  - This program is distributed in the hope that it will be useful,\n  - but WITHOUT ANY WARRANTY; without even the implied warranty of\n  - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n  - GNU Affero General Public License for more details.\n  -\n  - You should have received a copy of the GNU Affero General Public License\n  - along with this program. If not, see <http://www.gnu.org/licenses/>.\n  -\n  -->\n<template>\n\t<NcDialog :name=\"name\"\n\t\t:open=\"open\"\n\t\tclose-on-click-outside\n\t\tout-transition\n\t\t@update:open=\"onClose\">\n\t\t<template #actions>\n\t\t\t<NcButton type=\"primary\"\n\t\t\t\t:disabled=\"!isUniqueName\"\n\t\t\t\t@click=\"onCreate\">\n\t\t\t\t{{ t('files', 'Create') }}\n\t\t\t</NcButton>\n\t\t</template>\n\t\t<form @submit.prevent=\"onCreate\">\n\t\t\t<NcTextField ref=\"input\"\n\t\t\t\t:error=\"!isUniqueName\"\n\t\t\t\t:helper-text=\"errorMessage\"\n\t\t\t\t:label=\"label\"\n\t\t\t\t:value.sync=\"localDefaultName\" />\n\t\t</form>\n\t</NcDialog>\n</template>\n\n<script lang=\"ts\">\nimport type { PropType } from 'vue'\n\nimport { defineComponent } from 'vue'\nimport { translate as t } from '@nextcloud/l10n'\nimport { getUniqueName } from '../utils/fileUtils'\n\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\nimport NcDialog from '@nextcloud/vue/dist/Components/NcDialog.js'\nimport NcTextField from '@nextcloud/vue/dist/Components/NcTextField.js'\n\ninterface ICanFocus {\n\tfocus: () => void\n}\n\nexport default defineComponent({\n\tname: 'NewNodeDialog',\n\tcomponents: {\n\t\tNcButton,\n\t\tNcDialog,\n\t\tNcTextField,\n\t},\n\tprops: {\n\t\t/**\n\t\t * The name to be used by default\n\t\t */\n\t\tdefaultName: {\n\t\t\ttype: String,\n\t\t\tdefault: t('files', 'New folder'),\n\t\t},\n\t\t/**\n\t\t * Other files that are in the current directory\n\t\t */\n\t\totherNames: {\n\t\t\ttype: Array as PropType<string[]>,\n\t\t\tdefault: () => [],\n\t\t},\n\t\t/**\n\t\t * Open state of the dialog\n\t\t */\n\t\topen: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\t/**\n\t\t * Dialog name\n\t\t */\n\t\tname: {\n\t\t\ttype: String,\n\t\t\tdefault: t('files', 'Create new folder'),\n\t\t},\n\t\t/**\n\t\t * Input label\n\t\t */\n\t\tlabel: {\n\t\t\ttype: String,\n\t\t\tdefault: t('files', 'Folder name'),\n\t\t},\n\t},\n\temits: {\n\t\tclose: (name: string|null) => name === null || name,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tlocalDefaultName: this.defaultName || t('files', 'New folder'),\n\t\t}\n\t},\n\tcomputed: {\n\t\terrorMessage() {\n\t\t\tif (this.isUniqueName) {\n\t\t\t\treturn ''\n\t\t\t} else {\n\t\t\t\treturn t('files', 'A file or folder with that name already exists.')\n\t\t\t}\n\t\t},\n\t\tuniqueName() {\n\t\t\treturn getUniqueName(this.localDefaultName, this.otherNames)\n\t\t},\n\t\tisUniqueName() {\n\t\t\treturn this.localDefaultName === this.uniqueName\n\t\t},\n\t},\n\twatch: {\n\t\tdefaultName() {\n\t\t\tthis.localDefaultName = this.defaultName || t('files', 'New folder')\n\t\t},\n\t},\n\tmounted() {\n\t\t// on mounted lets use the unique name\n\t\tthis.localDefaultName = this.uniqueName\n\t\tthis.$nextTick(() => (this.$refs.input as unknown as ICanFocus)?.focus?.())\n\t},\n\tmethods: {\n\t\tt,\n\t\tonCreate() {\n\t\t\tthis.$emit('close', this.localDefaultName)\n\t\t},\n\t\tonClose(state: boolean) {\n\t\t\tif (!state) {\n\t\t\t\tthis.$emit('close', null)\n\t\t\t}\n\t\t},\n\t},\n})\n</script>\n","/**\n * @copyright Copyright (c) 2024 Ferdinand Thiessen <opensource@fthiessen.de>\n *\n * @author Ferdinand Thiessen <opensource@fthiessen.de>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport type { Node } from '@nextcloud/files'\nimport { spawnDialog } from '@nextcloud/dialogs'\nimport NewNodeDialog from '../components/NewNodeDialog.vue'\n\ninterface ILabels {\n\t/**\n\t * Dialog heading, defaults to \"New folder name\"\n\t */\n\tname?: string\n\t/**\n\t * Label for input box, defaults to \"New folder\"\n\t */\n\tlabel?: string\n}\n\n/**\n * Ask user for file or folder name\n * @param defaultName Default name to use\n * @param folderContent Nodes with in the current folder to check for unique name\n * @param labels Labels to set on the dialog\n * @return string if successfull otherwise null if aborted\n */\nexport function newNodeName(defaultName: string, folderContent: Node[], labels: ILabels = {}) {\n\tconst contentNames = folderContent.map((node: Node) => node.basename)\n\n\treturn new Promise<string|null>((resolve) => {\n\t\tspawnDialog(NewNodeDialog, {\n\t\t\t...labels,\n\t\t\tdefaultName,\n\t\t\totherNames: contentNames,\n\t\t}, (folderName) => {\n\t\t\tresolve(folderName as string|null)\n\t\t})\n\t})\n}\n","/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport type { Entry, Node } from '@nextcloud/files'\n\nimport { basename } from 'path'\nimport { emit } from '@nextcloud/event-bus'\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { Permission, Folder } from '@nextcloud/files'\nimport { showSuccess } from '@nextcloud/dialogs'\nimport { translate as t } from '@nextcloud/l10n'\nimport axios from '@nextcloud/axios'\n\nimport FolderPlusSvg from '@mdi/svg/svg/folder-plus.svg?raw'\n\nimport { newNodeName } from '../utils/newNodeDialog'\nimport logger from '../logger'\n\ntype createFolderResponse = {\n\tfileid: number\n\tsource: string\n}\n\nconst createNewFolder = async (root: Folder, name: string): Promise<createFolderResponse> => {\n\tconst source = root.source + '/' + name\n\tconst encodedSource = root.encodedSource + '/' + encodeURIComponent(name)\n\n\tconst response = await axios({\n\t\tmethod: 'MKCOL',\n\t\turl: encodedSource,\n\t\theaders: {\n\t\t\tOverwrite: 'F',\n\t\t},\n\t})\n\treturn {\n\t\tfileid: parseInt(response.headers['oc-fileid']),\n\t\tsource,\n\t}\n}\n\nexport const entry = {\n\tid: 'newFolder',\n\tdisplayName: t('files', 'New folder'),\n\tenabled: (context: Folder) => (context.permissions & Permission.CREATE) !== 0,\n\ticonSvgInline: FolderPlusSvg,\n\torder: 0,\n\tasync handler(context: Folder, content: Node[]) {\n\t\tconst name = await newNodeName(t('files', 'New folder'), content)\n\t\tif (name !== null) {\n\t\t\tconst { fileid, source } = await createNewFolder(context, name)\n\t\t\t// Create the folder in the store\n\t\t\tconst folder = new Folder({\n\t\t\t\tsource,\n\t\t\t\tid: fileid,\n\t\t\t\tmtime: new Date(),\n\t\t\t\towner: getCurrentUser()?.uid || null,\n\t\t\t\tpermissions: Permission.ALL,\n\t\t\t\troot: context?.root || '/files/' + getCurrentUser()?.uid,\n\t\t\t})\n\n\t\t\tshowSuccess(t('files', 'Created new folder \"{name}\"', { name: basename(source) }))\n\t\t\tlogger.debug('Created new folder', { folder, source })\n\t\t\temit('files:node:created', folder)\n\t\t\twindow.OCP.Files.Router.goToRoute(\n\t\t\t\tnull, // use default route\n\t\t\t\t{ view: 'files', fileid: folder.fileid },\n\t\t\t\t{ dir: context.path },\n\t\t\t)\n\t\t}\n\t},\n} as Entry\n","/**\n * @copyright Copyright (c) 2020 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n * @author Julius Härtl <jus@bitgrid.net>\n * @author Ferdinand Thiessen <opensource@fthiessen.de>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport type { Entry, Folder, Node } from '@nextcloud/files'\n\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { showError } from '@nextcloud/dialogs'\nimport { Permission, removeNewFileMenuEntry } from '@nextcloud/files'\nimport { loadState } from '@nextcloud/initial-state'\nimport { translate as t } from '@nextcloud/l10n'\nimport { generateOcsUrl } from '@nextcloud/router'\nimport { join } from 'path'\nimport { newNodeName } from '../utils/newNodeDialog'\n\nimport PlusSvg from '@mdi/svg/svg/plus.svg?raw'\nimport axios from '@nextcloud/axios'\nimport logger from '../logger.js'\n\nlet templatesPath = loadState<string|false>('files', 'templates_path', false)\nlogger.debug('Initial templates folder', { templatesPath })\n\n/**\n * Init template folder\n * @param directory Folder where to create the templates folder\n * @param name Name to use or the templates folder\n */\nconst initTemplatesFolder = async function(directory: Folder, name: string) {\n\tconst templatePath = join(directory.path, name)\n\ttry {\n\t\tlogger.debug('Initializing the templates directory', { templatePath })\n\t\tconst { data } = await axios.post(generateOcsUrl('apps/files/api/v1/templates/path'), {\n\t\t\ttemplatePath,\n\t\t\tcopySystemTemplates: true,\n\t\t})\n\n\t\t// Go to template directory\n\t\twindow.OCP.Files.Router.goToRoute(\n\t\t\tnull, // use default route\n\t\t\t{ view: 'files', fileid: undefined },\n\t\t\t{ dir: templatePath },\n\t\t)\n\n\t\tlogger.info('Created new templates folder', {\n\t\t\t...data.ocs.data,\n\t\t})\n\t\ttemplatesPath = data.ocs.data.templates_path as string\n\t} catch (error) {\n\t\tlogger.error('Unable to initialize the templates directory')\n\t\tshowError(t('files', 'Unable to initialize the templates directory'))\n\t}\n}\n\nexport const entry = {\n\tid: 'template-picker',\n\tdisplayName: t('files', 'Create new templates folder'),\n\ticonSvgInline: PlusSvg,\n\torder: 10,\n\tenabled(context: Folder): boolean {\n\t\t// Templates folder already initialized\n\t\tif (templatesPath) {\n\t\t\treturn false\n\t\t}\n\t\t// Allow creation on your own folders only\n\t\tif (context.owner !== getCurrentUser()?.uid) {\n\t\t\treturn false\n\t\t}\n\t\treturn (context.permissions & Permission.CREATE) !== 0\n\t},\n\tasync handler(context: Folder, content: Node[]) {\n\t\tconst name = await newNodeName(t('files', 'Templates'), content, { name: t('files', 'New template folder') })\n\n\t\tif (name !== null) {\n\t\t\t// Create the template folder\n\t\t\tinitTemplatesFolder(context, name)\n\n\t\t\t// Remove the menu entry\n\t\t\tremoveNewFileMenuEntry('template-picker')\n\t\t}\n\t},\n} as Entry\n","/**\n * @copyright Copyright (c) 2020 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n * @author Julius Härtl <jus@bitgrid.net>\n * @author Ferdinand Thiessen <opensource@fthiessen.de>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport type { Entry } from '@nextcloud/files'\nimport type { ComponentInstance } from 'vue'\nimport type { TemplateFile } from '../types.ts'\n\nimport { Folder, Node, Permission, addNewFileMenuEntry } from '@nextcloud/files'\nimport { loadState } from '@nextcloud/initial-state'\nimport { newNodeName } from '../utils/newNodeDialog'\nimport { translate as t } from '@nextcloud/l10n'\nimport Vue, { defineAsyncComponent } from 'vue'\n\n// async to reduce bundle size\nconst TemplatePickerVue = defineAsyncComponent(() => import('../views/TemplatePicker.vue'))\nlet TemplatePicker: ComponentInstance & { open: (n: string, t: TemplateFile) => void } | null = null\n\nconst getTemplatePicker = async () => {\n\tif (TemplatePicker === null) {\n\t\t// Create document root\n\t\tconst mountingPoint = document.createElement('div')\n\t\tmountingPoint.id = 'template-picker'\n\t\tdocument.body.appendChild(mountingPoint)\n\n\t\t// Init vue app\n\t\tTemplatePicker = new Vue({\n\t\t\trender: (h) => h(TemplatePickerVue, { ref: 'picker' }),\n\t\t\tmethods: { open(...args) { this.$refs.picker.open(...args) } },\n\t\t\tel: mountingPoint,\n\t\t})\n\t}\n\treturn TemplatePicker\n}\n\n/**\n * Register all new-file-menu entries for all template providers\n */\nexport function registerTemplateEntries() {\n\tconst templates = loadState<TemplateFile[]>('files', 'templates', [])\n\n\t// Init template files menu\n\ttemplates.forEach((provider, index) => {\n\t\taddNewFileMenuEntry({\n\t\t\tid: `template-new-${provider.app}-${index}`,\n\t\t\tdisplayName: provider.label,\n\t\t\t// TODO: migrate to inline svg\n\t\t\ticonClass: provider.iconClass || 'icon-file',\n\t\t\tenabled(context: Folder): boolean {\n\t\t\t\treturn (context.permissions & Permission.CREATE) !== 0\n\t\t\t},\n\t\t\torder: 11,\n\t\t\tasync handler(context: Folder, content: Node[]) {\n\t\t\t\tconst templatePicker = getTemplatePicker()\n\t\t\t\tconst name = await newNodeName(`${provider.label}${provider.extension}`, content, {\n\t\t\t\t\tlabel: t('files', 'Filename'),\n\t\t\t\t\tname: provider.label,\n\t\t\t\t})\n\n\t\t\t\tif (name !== null) {\n\t\t\t\t\t// Create the file\n\t\t\t\t\tconst picker = await templatePicker\n\t\t\t\t\tpicker.open(name, provider)\n\t\t\t\t}\n\t\t\t},\n\t\t} as Entry)\n\t})\n}\n","/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport type { ContentsWithRoot } from '@nextcloud/files'\nimport type { FileStat, ResponseDataDetailed } from 'webdav'\n\nimport { Folder, getDavNameSpaces, getDavProperties, davGetDefaultPropfind } from '@nextcloud/files'\n\nimport { getClient } from './WebdavClient'\nimport { resultToNode } from './Files'\n\nconst client = getClient()\n\nconst reportPayload = `<?xml version=\"1.0\"?>\n<oc:filter-files ${getDavNameSpaces()}>\n\t<d:prop>\n\t\t${getDavProperties()}\n\t</d:prop>\n\t<oc:filter-rules>\n\t\t<oc:favorite>1</oc:favorite>\n\t</oc:filter-rules>\n</oc:filter-files>`\n\nexport const getContents = async (path = '/'): Promise<ContentsWithRoot> => {\n\tconst propfindPayload = davGetDefaultPropfind()\n\n\t// Get root folder\n\tlet rootResponse\n\tif (path === '/') {\n\t\trootResponse = await client.stat(path, {\n\t\t\tdetails: true,\n\t\t\tdata: propfindPayload,\n\t\t}) as ResponseDataDetailed<FileStat>\n\t}\n\n\tconst contentsResponse = await client.getDirectoryContents(path, {\n\t\tdetails: true,\n\t\t// Only filter favorites if we're at the root\n\t\tdata: path === '/' ? reportPayload : propfindPayload,\n\t\theaders: {\n\t\t\t// Patched in WebdavClient.ts\n\t\t\tmethod: path === '/' ? 'REPORT' : 'PROPFIND',\n\t\t},\n\t\tincludeSelf: true,\n\t}) as ResponseDataDetailed<FileStat[]>\n\n\tconst root = rootResponse?.data || contentsResponse.data[0]\n\tconst contents = contentsResponse.data.filter(node => node.filename !== path)\n\n\treturn {\n\t\tfolder: resultToNode(root) as Folder,\n\t\tcontents: contents.map(resultToNode),\n\t}\n}\n","/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport type { Folder, Node } from '@nextcloud/files'\n\nimport { subscribe } from '@nextcloud/event-bus'\nimport { FileType, View, getNavigation } from '@nextcloud/files'\nimport { loadState } from '@nextcloud/initial-state'\nimport { getLanguage, translate as t } from '@nextcloud/l10n'\nimport { basename } from 'path'\nimport FolderSvg from '@mdi/svg/svg/folder.svg?raw'\nimport StarSvg from '@mdi/svg/svg/star.svg?raw'\n\nimport { getContents } from '../services/Favorites'\nimport { hashCode } from '../utils/hashUtils'\nimport logger from '../logger'\n\n// The return type of the initial state\ninterface IFavoriteFolder {\n\tfileid: number\n\tpath: string\n}\n\nexport const generateFavoriteFolderView = function(folder: IFavoriteFolder, index = 0): View {\n\treturn new View({\n\t\tid: generateIdFromPath(folder.path),\n\t\tname: basename(folder.path),\n\n\t\ticon: FolderSvg,\n\t\torder: index,\n\t\tparams: {\n\t\t\tdir: folder.path,\n\t\t\tfileid: folder.fileid.toString(),\n\t\t\tview: 'favorites',\n\t\t},\n\n\t\tparent: 'favorites',\n\n\t\tcolumns: [],\n\n\t\tgetContents,\n\t})\n}\n\nexport const generateIdFromPath = function(path: string): string {\n\treturn `favorite-${hashCode(path)}`\n}\n\nexport default () => {\n\t// Load state in function for mock testing purposes\n\tconst favoriteFolders = loadState<IFavoriteFolder[]>('files', 'favoriteFolders', [])\n\tconst favoriteFoldersViews = favoriteFolders.map((folder, index) => generateFavoriteFolderView(folder, index)) as View[]\n\tlogger.debug('Generating favorites view', { favoriteFolders })\n\n\tconst Navigation = getNavigation()\n\tNavigation.register(new View({\n\t\tid: 'favorites',\n\t\tname: t('files', 'Favorites'),\n\t\tcaption: t('files', 'List of favorites files and folders.'),\n\n\t\temptyTitle: t('files', 'No favorites yet'),\n\t\temptyCaption: t('files', 'Files and folders you mark as favorite will show up here'),\n\n\t\ticon: StarSvg,\n\t\torder: 5,\n\n\t\tcolumns: [],\n\n\t\tgetContents,\n\t}))\n\n\tfavoriteFoldersViews.forEach(view => Navigation.register(view))\n\n\t/**\n\t * Update favourites navigation when a new folder is added\n\t */\n\tsubscribe('files:favorites:added', (node: Node) => {\n\t\tif (node.type !== FileType.Folder) {\n\t\t\treturn\n\t\t}\n\n\t\t// Sanity check\n\t\tif (node.path === null || !node.root?.startsWith('/files')) {\n\t\t\tlogger.error('Favorite folder is not within user files root', { node })\n\t\t\treturn\n\t\t}\n\n\t\taddToFavorites(node as Folder)\n\t})\n\n\t/**\n\t * Remove favourites navigation when a folder is removed\n\t */\n\tsubscribe('files:favorites:removed', (node: Node) => {\n\t\tif (node.type !== FileType.Folder) {\n\t\t\treturn\n\t\t}\n\n\t\t// Sanity check\n\t\tif (node.path === null || !node.root?.startsWith('/files')) {\n\t\t\tlogger.error('Favorite folder is not within user files root', { node })\n\t\t\treturn\n\t\t}\n\n\t\tremovePathFromFavorites(node.path)\n\t})\n\n\t/**\n\t * Sort the favorites paths array and\n\t * update the order property of the existing views\n\t */\n\tconst updateAndSortViews = function() {\n\t\tfavoriteFolders.sort((a, b) => a.path.localeCompare(b.path, getLanguage(), { ignorePunctuation: true }))\n\t\tfavoriteFolders.forEach((folder, index) => {\n\t\t\tconst view = favoriteFoldersViews.find((view) => view.id === generateIdFromPath(folder.path))\n\t\t\tif (view) {\n\t\t\t\tview.order = index\n\t\t\t}\n\t\t})\n\t}\n\n\t// Add a folder to the favorites paths array and update the views\n\tconst addToFavorites = function(node: Folder) {\n\t\tconst newFavoriteFolder: IFavoriteFolder = { path: node.path, fileid: node.fileid! }\n\t\tconst view = generateFavoriteFolderView(newFavoriteFolder)\n\n\t\t// Skip if already exists\n\t\tif (favoriteFolders.find((folder) => folder.path === node.path)) {\n\t\t\treturn\n\t\t}\n\n\t\t// Update arrays\n\t\tfavoriteFolders.push(newFavoriteFolder)\n\t\tfavoriteFoldersViews.push(view)\n\n\t\t// Update and sort views\n\t\tupdateAndSortViews()\n\t\tNavigation.register(view)\n\t}\n\n\t// Remove a folder from the favorites paths array and update the views\n\tconst removePathFromFavorites = function(path: string) {\n\t\tconst id = generateIdFromPath(path)\n\t\tconst index = favoriteFolders.findIndex((folder) => folder.path === path)\n\n\t\t// Skip if not exists\n\t\tif (index === -1) {\n\t\t\treturn\n\t\t}\n\n\t\t// Update arrays\n\t\tfavoriteFolders.splice(index, 1)\n\t\tfavoriteFoldersViews.splice(index, 1)\n\n\t\t// Update and sort views\n\t\tNavigation.remove(id)\n\t\tupdateAndSortViews()\n\t}\n}\n","/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n * @author Ferdinand Thiessen <opensource@fthiessen.de>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport type { ContentsWithRoot } from '@nextcloud/files'\nimport type { FileStat, ResponseDataDetailed } from 'webdav'\n\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { Folder, Permission, davGetRecentSearch, davGetClient, davResultToNode, davRootPath, davRemoteURL } from '@nextcloud/files'\n\nconst client = davGetClient()\n\nconst lastTwoWeeksTimestamp = Math.round((Date.now() / 1000) - (60 * 60 * 24 * 14))\n\nexport const getContents = async (path = '/'): Promise<ContentsWithRoot> => {\n\tconst contentsResponse = await client.getDirectoryContents(path, {\n\t\tdetails: true,\n\t\tdata: davGetRecentSearch(lastTwoWeeksTimestamp),\n\t\theaders: {\n\t\t\t// Patched in WebdavClient.ts\n\t\t\tmethod: 'SEARCH',\n\t\t\t// Somehow it's needed to get the correct response\n\t\t\t'Content-Type': 'application/xml; charset=utf-8',\n\t\t},\n\t\tdeep: true,\n\t}) as ResponseDataDetailed<FileStat[]>\n\n\tconst contents = contentsResponse.data\n\n\treturn {\n\t\tfolder: new Folder({\n\t\t\tid: 0,\n\t\t\tsource: `${davRemoteURL}${davRootPath}`,\n\t\t\troot: davRootPath,\n\t\t\towner: getCurrentUser()?.uid || null,\n\t\t\tpermissions: Permission.READ,\n\t\t}),\n\t\tcontents: contents.map((r) => davResultToNode(r)),\n\t}\n}\n","/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { translate as t } from '@nextcloud/l10n'\nimport HistorySvg from '@mdi/svg/svg/history.svg?raw'\n\nimport { getContents } from '../services/Recent'\nimport { View, getNavigation } from '@nextcloud/files'\n\nexport default () => {\n\tconst Navigation = getNavigation()\n\tNavigation.register(new View({\n\t\tid: 'recent',\n\t\tname: t('files', 'Recent'),\n\t\tcaption: t('files', 'List of recently modified files and folders.'),\n\n\t\temptyTitle: t('files', 'No recently modified files'),\n\t\temptyCaption: t('files', 'Files and folders you recently modified will show up here.'),\n\n\t\ticon: HistorySvg,\n\t\torder: 2,\n\n\t\tdefaultSortKey: 'mtime',\n\n\t\tgetContents,\n\t}))\n}\n","/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { translate as t } from '@nextcloud/l10n'\nimport FolderSvg from '@mdi/svg/svg/folder.svg?raw'\n\nimport { getContents } from '../services/Files'\nimport { View, getNavigation } from '@nextcloud/files'\n\nexport default () => {\n\tconst Navigation = getNavigation()\n\tNavigation.register(new View({\n\t\tid: 'files',\n\t\tname: t('files', 'All files'),\n\t\tcaption: t('files', 'List of your files and folders.'),\n\n\t\ticon: FolderSvg,\n\t\torder: 0,\n\n\t\tgetContents,\n\t}))\n}\n","/**\n * @copyright Copyright (c) 2019 Gary Kim <gary@garykim.dev>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { generateUrl } from '@nextcloud/router'\nimport logger from '../logger.js'\n\nexport default () => {\n\tif ('serviceWorker' in navigator) {\n\t\t// Use the window load event to keep the page load performant\n\t\twindow.addEventListener('load', async () => {\n\t\t\ttry {\n\t\t\t\tconst url = generateUrl('/apps/files/preview-service-worker.js', {}, { noRewrite: true })\n\t\t\t\tconst registration = await navigator.serviceWorker.register(url, { scope: '/' })\n\t\t\t\tlogger.debug('SW registered: ', { registration })\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error('SW registration failed: ', { error })\n\t\t\t}\n\t\t})\n\t} else {\n\t\tlogger.debug('Service Worker is not enabled on this browser.')\n\t}\n}\n","/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { addNewFileMenuEntry, registerDavProperty, registerFileAction } from '@nextcloud/files'\n\nimport { action as deleteAction } from './actions/deleteAction'\nimport { action as downloadAction } from './actions/downloadAction'\nimport { action as editLocallyAction } from './actions/editLocallyAction'\nimport { action as favoriteAction } from './actions/favoriteAction'\nimport { action as moveOrCopyAction } from './actions/moveOrCopyAction'\nimport { action as openFolderAction } from './actions/openFolderAction'\nimport { action as openInFilesAction } from './actions/openInFilesAction'\nimport { action as renameAction } from './actions/renameAction'\nimport { action as sidebarAction } from './actions/sidebarAction'\nimport { action as viewInFolderAction } from './actions/viewInFolderAction'\nimport { entry as newFolderEntry } from './newMenu/newFolder.ts'\nimport { entry as newTemplatesFolder } from './newMenu/newTemplatesFolder.ts'\nimport { registerTemplateEntries } from './newMenu/newFromTemplate.ts'\n\nimport registerFavoritesView from './views/favorites'\nimport registerRecentView from './views/recent'\nimport registerFilesView from './views/files'\nimport registerPreviewServiceWorker from './services/ServiceWorker.js'\n\n\nimport { initLivePhotos } from './services/LivePhotos'\n\n// Register file actions\nregisterFileAction(deleteAction)\nregisterFileAction(downloadAction)\nregisterFileAction(editLocallyAction)\nregisterFileAction(favoriteAction)\nregisterFileAction(moveOrCopyAction)\nregisterFileAction(openFolderAction)\nregisterFileAction(openInFilesAction)\nregisterFileAction(renameAction)\nregisterFileAction(sidebarAction)\nregisterFileAction(viewInFolderAction)\n\n// Register new menu entry\naddNewFileMenuEntry(newFolderEntry)\naddNewFileMenuEntry(newTemplatesFolder)\nregisterTemplateEntries()\n\n// Register files views\nregisterFavoritesView()\nregisterFilesView()\nregisterRecentView()\n\n// Register preview service worker\nregisterPreviewServiceWorker()\n\nregisterDavProperty('nc:hidden', { nc: 'http://nextcloud.org/ns' })\nregisterDavProperty('nc:is-mount-root', { nc: 'http://nextcloud.org/ns' })\n\ninitLivePhotos()\n"],"file":"dist/files-init.mjs"}