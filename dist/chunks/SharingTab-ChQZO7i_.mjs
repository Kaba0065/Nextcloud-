/*! third party licenses: dist/vendor.LICENSE.txt */
var Ye=Object.defineProperty;var Ue=(e,s,i)=>s in e?Ye(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i;var _e=(e,s,i)=>(Ue(e,typeof s!="symbol"?s+"":s,i),i);import{bH as K,aH as he,bh as J,bD as k,bQ as C,C as L,ad as de,X as Z,b as F,b$ as j,bR as ue,bU as ie,bC as re,bJ as Ae,u as De,x as Re,w as Me,l as Fe,F as Ce,ca as $e,a6 as We,Q as Be,G as qe,a2 as je,cM as Ve,bO as Ge}from"../core-common.mjs";import{T as N}from"./index-YIotKjSS.mjs";import"./index-Ca0QcE7e.mjs";import{S as M,v as pe}from"./toast-7xJhDYMn-BrG8uCqw.mjs";import{n as A,aE as ze,o as Ke,P as xe,aF as Qe,aG as ke,Z as Ie,X as Je,aH as ge,L as me,Y as Se,aI as Q,aJ as Ee,a8 as Xe,aK as Ze,aA as et,aB as tt,aL as st}from"./icons-BxSPavMS.mjs";import{d as le}from"./index-Cf1NFlIs.mjs";import{b as it}from"./index-DgCiVkaQ.mjs";import{P as rt}from"./index-BqikPZjc.mjs";function ce(e){var s=typeof e;return e!=null&&(s=="object"||s=="function")}var at=typeof K=="object"&&K&&K.Object===Object&&K,nt=typeof self=="object"&&self&&self.Object===Object&&self,Ne=at||nt||Function("return this")(),ae=function(){return Ne.Date.now()},ot=/\s/;function ht(e){for(var s=e.length;s--&&ot.test(e.charAt(s)););return s}var lt=/^\s+/;function ct(e){return e&&e.slice(0,ht(e)+1).replace(lt,"")}var X=Ne.Symbol,Le=Object.prototype,dt=Le.hasOwnProperty,ut=Le.toString,q=X?X.toStringTag:void 0;function pt(e){var s=dt.call(e,q),i=e[q];try{e[q]=void 0;var r=!0}catch{}var n=ut.call(e);return r&&(s?e[q]=i:delete e[q]),n}var ft=Object.prototype,_t=ft.toString;function gt(e){return _t.call(e)}var mt="[object Null]",St="[object Undefined]",ye=X?X.toStringTag:void 0;function Et(e){return e==null?e===void 0?St:mt:ye&&ye in Object(e)?pt(e):gt(e)}function yt(e){return e!=null&&typeof e=="object"}var wt="[object Symbol]";function Pt(e){return typeof e=="symbol"||yt(e)&&Et(e)==wt}var we=NaN,vt=/^[-+]0x[0-9a-f]+$/i,Tt=/^0b[01]+$/i,bt=/^0o[0-7]+$/i,At=parseInt;function Pe(e){if(typeof e=="number")return e;if(Pt(e))return we;if(ce(e)){var s=typeof e.valueOf=="function"?e.valueOf():e;e=ce(s)?s+"":s}if(typeof e!="string")return e===0?e:+e;e=ct(e);var i=Tt.test(e);return i||bt.test(e)?At(e.slice(2),i?2:8):vt.test(e)?we:+e}var Dt="Expected a function",Rt=Math.max,Ct=Math.min;function xt(e,s,i){var r,n,c,d,o,p,_=0,D=!1,w=!1,u=!0;if(typeof e!="function")throw new TypeError(Dt);s=Pe(s)||0,ce(i)&&(D=!!i.leading,w="maxWait"in i,c=w?Rt(Pe(i.maxWait)||0,s):c,u="trailing"in i?!!i.trailing:u);function T(l){var g=r,y=n;return r=n=void 0,_=l,d=e.apply(y,g),d}function f(l){return _=l,o=setTimeout(v,s),D?T(l):d}function S(l){var g=l-p,y=l-_,R=s-g;return w?Ct(R,c-y):R}function E(l){var g=l-p,y=l-_;return p===void 0||g>=s||g<0||w&&y>=c}function v(){var l=ae();if(E(l))return W(l);o=setTimeout(v,S(l))}function W(l){return o=void 0,u&&r?T(l):(r=n=void 0,d)}function z(){o!==void 0&&clearTimeout(o),_=0,r=p=n=o=void 0}function a(){return o===void 0?d:W(ae())}function h(){var l=ae(),g=E(l);if(r=arguments,n=this,p=l,g){if(o===void 0)return f(p);if(w)return clearTimeout(o),o=setTimeout(v,s),T(p)}return o===void 0&&(o=setTimeout(v,s)),d}return h.cancel=z,h.flush=a,h}class kt{constructor(){this.http=k}listCollection(s){return this.http.get(C("collaboration/resources/collections/{collectionId}",{collectionId:s}))}renameCollection(s,i){return this.http.put(C("collaboration/resources/collections/{collectionId}",{collectionId:s}),{collectionName:i}).then(r=>r.data.ocs.data)}getCollectionsByResource(s,i){return this.http.get(C("collaboration/resources/{resourceType}/{resourceId}",{resourceType:s,resourceId:i})).then(r=>r.data.ocs.data)}createCollection(s,i,r){return this.http.post(C("collaboration/resources/{resourceType}/{resourceId}",{resourceType:s,resourceId:i}),{name:r}).then(n=>n.data.ocs.data)}addResource(s,i,r){return r=""+r,this.http.post(C("collaboration/resources/collections/{collectionId}",{collectionId:s}),{resourceType:i,resourceId:r}).then(n=>n.data.ocs.data)}removeResource(s,i,r){return this.http.delete(C("collaboration/resources/collections/{collectionId}",{collectionId:s}),{params:{resourceType:i,resourceId:r}}).then(n=>n.data.ocs.data)}search(s){return this.http.get(C("collaboration/resources/collections/search/{query}",{query:s})).then(i=>i.data.ocs.data)}}const Y=new kt,I=he.observable({collections:[]}),U={addCollections(e){J(I,"collections",e)},addCollection(e){I.collections.push(e)},removeCollection(e){J(I,"collections",I.collections.filter(s=>s.id!==e))},updateCollection(e){const s=I.collections.findIndex(i=>i.id===e.id);s!==-1?J(I.collections,s,e):I.collections.push(e)}},x={fetchCollectionsByResource({resourceType:e,resourceId:s}){return Y.getCollectionsByResource(e,s).then(i=>(U.addCollections(i),i))},createCollection({baseResourceType:e,baseResourceId:s,resourceType:i,resourceId:r,name:n}){return Y.createCollection(e,s,n).then(c=>{U.addCollection(c),x.addResourceToCollection({collectionId:c.id,resourceType:i,resourceId:r})})},renameCollection({collectionId:e,name:s}){return Y.renameCollection(e,s).then(i=>(U.updateCollection(i),i))},addResourceToCollection({collectionId:e,resourceType:s,resourceId:i}){return Y.addResource(e,s,i).then(r=>(U.updateCollection(r),r))},removeResource({collectionId:e,resourceType:s,resourceId:i}){return Y.removeResource(e,s,i).then(r=>{r.resources.length>0?U.updateCollection(r):U.removeCollection(r)})},search(e){return Y.search(e)}};function Oe(e,s,i,r,n,c,d,o){var p=typeof e=="function"?e.options:e;s&&(p.render=s,p.staticRenderFns=i,p._compiled=!0),r&&(p.functional=!0),c&&(p._scopeId="data-v-"+c);var _;if(d?(_=function(u){u=u||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!u&&typeof __VUE_SSR_CONTEXT__<"u"&&(u=__VUE_SSR_CONTEXT__),n&&n.call(this,u),u&&u._registeredComponents&&u._registeredComponents.add(d)},p._ssrRegister=_):n&&(_=o?function(){n.call(this,(p.functional?this.parent:this).$root.$options.shadowRoot)}:n),_)if(p.functional){p._injectStyles=_;var D=p.render;p.render=function(u,T){return _.call(T),D(u,T)}}else{var w=p.beforeCreate;p.beforeCreate=w?[].concat(w,_):[_]}return{exports:e,options:p}}const It={name:"CollectionListItem",components:{NcAvatar:L,NcActions:Z,NcActionButton:F},props:{collection:{type:Object,default:null}},data(){return{detailsOpen:!1,newName:null,error:{}}},computed:{getIcon(){return e=>[e.iconClass]},typeClass(){return e=>"resource-type-"+e.type},limitedResources(){return e=>e.resources?e.resources.slice(0,2):[]},iconUrl(){return e=>e.mimetype?OC.MimeType.getIconUrl(e.mimetype):e.iconUrl?e.iconUrl:""}},methods:{toggleDetails(){this.detailsOpen=!this.detailsOpen},showDetails(){this.detailsOpen=!0},hideDetails(){this.detailsOpen=!1},removeResource(e,s){x.removeResource({collectionId:e.id,resourceType:s.type,resourceId:s.id})},openRename(){this.newName=this.collection.name},renameCollection(){if(this.newName===""){this.newName=null;return}x.renameCollection({collectionId:this.collection.id,name:this.newName}).then(e=>{this.newName=null}).catch(e=>{this.$set(this.error,"rename",t("core","Failed to rename the project")),console.error(e),setTimeout(()=>{J(this.error,"rename",null)},3e3)})}}};var Nt=function(){var e=this,s=e._self._c;return s("li",{staticClass:"collection-list-item"},[s("NcAvatar",{staticClass:"collection-avatar",attrs:{"display-name":e.collection.name,"allow-placeholder":""}}),e.newName===null?s("span",{staticClass:"collection-item-name",attrs:{title:""},on:{click:e.showDetails}},[e._v(e._s(e.collection.name))]):s("form",{class:{shouldshake:e.error.rename},on:{submit:function(i){return i.preventDefault(),e.renameCollection.apply(null,arguments)}}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.newName,expression:"newName"}],attrs:{type:"text",autocomplete:"off",autocapitalize:"off"},domProps:{value:e.newName},on:{input:function(i){i.target.composing||(e.newName=i.target.value)}}}),s("input",{staticClass:"icon-confirm",attrs:{type:"submit",value:""}})]),!e.detailsOpen&&e.newName===null?s("div",{staticClass:"linked-icons"},e._l(e.limitedResources(e.collection),function(i){return s("a",{key:i.type+"|"+i.id,class:e.typeClass(i),attrs:{title:i.name,href:i.link}},[s("img",{attrs:{src:e.iconUrl(i)}})])}),0):e._e(),e.newName===null?s("span",{staticClass:"sharingOptionsGroup"},[s("NcActions",[s("NcActionButton",{attrs:{icon:"icon-info"},on:{click:function(i){return i.preventDefault(),e.toggleDetails.apply(null,arguments)}}},[e._v(" "+e._s(e.detailsOpen?e.t("core","Hide details"):e.t("core","Show details"))+" ")]),s("NcActionButton",{attrs:{icon:"icon-rename"},on:{click:function(i){return i.preventDefault(),e.openRename.apply(null,arguments)}}},[e._v(" "+e._s(e.t("core","Rename project"))+" ")])],1)],1):e._e(),s("transition",{attrs:{name:"fade"}},[e.error.rename?s("div",{staticClass:"error"},[e._v(" "+e._s(e.error.rename)+" ")]):e._e()]),s("transition",{attrs:{name:"fade"}},[e.detailsOpen?s("ul",{staticClass:"resource-list-details"},e._l(e.collection.resources,function(i){return s("li",{key:i.type+"|"+i.id,class:e.typeClass(i)},[s("a",{attrs:{href:i.link}},[s("img",{attrs:{src:e.iconUrl(i)}}),s("span",{staticClass:"resource-name"},[e._v(e._s(i.name||""))])]),s("span",{staticClass:"icon-close",on:{click:function(r){return e.removeResource(e.collection,i)}}})])}),0):e._e()])],1)},Lt=[],Ot=Oe(It,Nt,Lt,!1,null,"8e58e0a5",null,null);const Ht=Ot.exports,ve=0,Te=1,Yt=xt(function(e,s){e!==""&&(s(!0),x.search(e).then(i=>{this.searchCollections=i}).catch(i=>{console.error("Failed to search for collections",i)}).finally(()=>{s(!1)}))},500,{}),Ut={name:"CollectionList",components:{CollectionListItem:Ht,NcAvatar:L,NcSelect:de},props:{type:{type:String,default:null},id:{type:String,default:null},name:{type:String,default:""},isActive:{type:Boolean,default:!0}},data(){return{selectIsOpen:!1,generatingCodes:!1,codes:void 0,value:null,model:{},searchCollections:[],error:null,state:I,isSelectOpen:!1}},computed:{collections(){return this.state.collections.filter(e=>typeof e.resources.find(s=>s&&s.id===""+this.id&&s.type===this.type)<"u")},placeholder(){return this.isSelectOpen?t("core","Type to search for existing projects"):t("core","Add to a project")},options(){const e=[];window.OCP.Collaboration.getTypes().sort().forEach(s=>{e.push({method:ve,type:s,title:window.OCP.Collaboration.getLabel(s),class:window.OCP.Collaboration.getIcon(s),action:()=>window.OCP.Collaboration.trigger(s)})});for(const s in this.searchCollections)this.collections.findIndex(i=>i.id===this.searchCollections[s].id)===-1&&e.push({method:Te,title:this.searchCollections[s].name,collectionId:this.searchCollections[s].id});return e}},watch:{type(){this.isActive&&x.fetchCollectionsByResource({resourceType:this.type,resourceId:this.id})},id(){this.isActive&&x.fetchCollectionsByResource({resourceType:this.type,resourceId:this.id})},isActive(e){e&&x.fetchCollectionsByResource({resourceType:this.type,resourceId:this.id})}},mounted(){x.fetchCollectionsByResource({resourceType:this.type,resourceId:this.id})},methods:{select(e,s){e.method===ve&&e.action().then(i=>{x.createCollection({baseResourceType:this.type,baseResourceId:this.id,resourceType:e.type,resourceId:i,name:this.name}).catch(r=>{this.setError(t("core","Failed to create a project"),r)})}).catch(i=>{console.error("No resource selected",i)}),e.method===Te&&x.addResourceToCollection({collectionId:e.collectionId,resourceType:this.type,resourceId:this.id}).catch(i=>{this.setError(t("core","Failed to add the item to the project"),i)})},search(e,s){Yt.bind(this)(e,s)},showSelect(){this.selectIsOpen=!0,this.$refs.select.$el.focus()},hideSelect(){this.selectIsOpen=!1},isVueComponent(e){return e._isVue},setError(e,s){console.error(e,s),this.error=e,setTimeout(()=>{this.error=null},5e3)}}};var Mt=function(){var e=this,s=e._self._c;return e.collections&&e.type&&e.id?s("ul",{staticClass:"collection-list",attrs:{id:"collection-list"}},[s("li",{on:{click:e.showSelect}},[e._m(0),s("div",{attrs:{id:"collection-select-container"}},[s("NcSelect",{ref:"select",attrs:{"aria-label-combobox":e.t("core","Add to a project"),options:e.options,placeholder:e.placeholder,label:"title",limit:5},on:{close:function(i){e.isSelectOpen=!1},open:function(i){e.isSelectOpen=!0},"option:selected":e.select,search:e.search},scopedSlots:e._u([{key:"selected-option",fn:function(i){return[s("span",{staticClass:"option__desc"},[s("span",{staticClass:"option__title"},[e._v(e._s(i.title))])])]}},{key:"option",fn:function(i){return[s("span",{staticClass:"option__wrapper"},[i.class?s("span",{staticClass:"avatar",class:i.class}):i.method!==2?s("NcAvatar",{attrs:{"allow-placeholder":"","display-name":i.title}}):e._e(),s("span",{staticClass:"option__title"},[e._v(e._s(i.title))])],1)]}}],null,!1,2397208459),model:{value:e.value,callback:function(i){e.value=i},expression:"value"}},[s("p",{staticClass:"hint"},[e._v(" "+e._s(e.t("core","Connect items to a project to make them easier to find"))+" ")])])],1)]),s("transition",{attrs:{name:"fade"}},[e.error?s("li",{staticClass:"error"},[e._v(" "+e._s(e.error)+" ")]):e._e()]),e._l(e.collections,function(i){return s("CollectionListItem",{key:i.id,attrs:{collection:i}})})],2):e._e()},Ft=[function(){var e=this,s=e._self._c;return s("div",{staticClass:"avatar"},[s("span",{staticClass:"icon-projects"})])}],$t=Oe(Ut,Mt,Ft,!1,null,"75a4370b",null,null);const Wt=$t.exports;class ee{constructor(){this._capabilities=j()}get defaultPermissions(){var s;return(s=this._capabilities.files_sharing)==null?void 0:s.default_permissions}get isPublicUploadEnabled(){var s;return(s=this._capabilities.files_sharing)==null?void 0:s.public.upload}get isShareWithLinkAllowed(){return document.getElementById("allowShareWithLink")&&document.getElementById("allowShareWithLink").value==="yes"}get federatedShareDocLink(){return OC.appConfig.core.federatedCloudShareDoc}get defaultExpirationDate(){return this.isDefaultExpireDateEnabled?new Date(new Date().setDate(new Date().getDate()+this.defaultExpireDate)):null}get defaultInternalExpirationDate(){return this.isDefaultInternalExpireDateEnabled?new Date(new Date().setDate(new Date().getDate()+this.defaultInternalExpireDate)):null}get defaultRemoteExpirationDateString(){return this.isDefaultRemoteExpireDateEnabled?new Date(new Date().setDate(new Date().getDate()+this.defaultRemoteExpireDate)):null}get enforcePasswordForPublicLink(){return OC.appConfig.core.enforcePasswordForPublicLink===!0}get enableLinkPasswordByDefault(){return OC.appConfig.core.enableLinkPasswordByDefault===!0}get isDefaultExpireDateEnforced(){return OC.appConfig.core.defaultExpireDateEnforced===!0}get isDefaultExpireDateEnabled(){return OC.appConfig.core.defaultExpireDateEnabled===!0}get isDefaultInternalExpireDateEnforced(){return OC.appConfig.core.defaultInternalExpireDateEnforced===!0}get isDefaultRemoteExpireDateEnforced(){return OC.appConfig.core.defaultRemoteExpireDateEnforced===!0}get isDefaultInternalExpireDateEnabled(){return OC.appConfig.core.defaultInternalExpireDateEnabled===!0}get isDefaultRemoteExpireDateEnabled(){return OC.appConfig.core.defaultRemoteExpireDateEnabled===!0}get isRemoteShareAllowed(){return OC.appConfig.core.remoteShareAllowed===!0}get isMailShareAllowed(){var s,i,r,n,c;return((i=(s=this._capabilities)==null?void 0:s.files_sharing)==null?void 0:i.sharebymail)!==void 0&&((c=(n=(r=this._capabilities)==null?void 0:r.files_sharing)==null?void 0:n.public)==null?void 0:c.enabled)===!0}get defaultExpireDate(){return OC.appConfig.core.defaultExpireDate}get defaultInternalExpireDate(){return OC.appConfig.core.defaultInternalExpireDate}get defaultRemoteExpireDate(){return OC.appConfig.core.defaultRemoteExpireDate}get isResharingAllowed(){return OC.appConfig.core.resharingAllowed===!0}get isPasswordForMailSharesRequired(){return this._capabilities.files_sharing.sharebymail===void 0?!1:this._capabilities.files_sharing.sharebymail.password.enforced}get shouldAlwaysShowUnique(){var s,i;return((i=(s=this._capabilities.files_sharing)==null?void 0:s.sharee)==null?void 0:i.always_show_unique)===!0}get allowGroupSharing(){return OC.appConfig.core.allowGroupSharing===!0}get maxAutocompleteResults(){return parseInt(OC.config["sharing.maxAutocompleteResults"],10)||25}get minSearchStringLength(){return parseInt(OC.config["sharing.minSearchStringLength"],10)||0}get passwordPolicy(){return this._capabilities.password_policy?this._capabilities.password_policy:{}}}const Bt=function(e){return e.type===N.SHARE_TYPE_GROUP?t("files_sharing","Shared with you and the group {group} by {owner}",{group:e.shareWithDisplayName,owner:e.ownerDisplayName},void 0,{escape:!1}):e.type===N.SHARE_TYPE_CIRCLE?t("files_sharing","Shared with you and {circle} by {owner}",{circle:e.shareWithDisplayName,owner:e.ownerDisplayName},void 0,{escape:!1}):e.type===N.SHARE_TYPE_ROOM?e.shareWithDisplayName?t("files_sharing","Shared with you and the conversation {conversation} by {owner}",{conversation:e.shareWithDisplayName,owner:e.ownerDisplayName},void 0,{escape:!1}):t("files_sharing","Shared with you in a conversation by {owner}",{owner:e.ownerDisplayName},void 0,{escape:!1}):t("files_sharing","Shared with you by {owner}",{owner:e.ownerDisplayName},void 0,{escape:!1})};class b{constructor(s){_e(this,"_share");var i;if(s.ocs&&s.ocs.data&&s.ocs.data[0]&&(s=s.ocs.data[0]),s.hide_download=!!s.hide_download,s.mail_send=!!s.mail_send,s.attributes)try{s.attributes=JSON.parse(s.attributes)}catch{console.warn('Could not parse share attributes returned by server: "'+s.attributes+'"')}s.attributes=(i=s.attributes)!=null?i:[],this._share=s}get state(){return this._share}get id(){return this._share.id}get type(){return this._share.share_type}get permissions(){return this._share.permissions}get attributes(){return this._share.attributes}set permissions(s){this._share.permissions=s}get owner(){return this._share.uid_owner}get ownerDisplayName(){return this._share.displayname_owner}get shareWith(){return this._share.share_with}get shareWithDisplayName(){return this._share.share_with_displayname||this._share.share_with}get shareWithDisplayNameUnique(){return this._share.share_with_displayname_unique||this._share.share_with}get shareWithLink(){return this._share.share_with_link}get shareWithAvatar(){return this._share.share_with_avatar}get uidFileOwner(){return this._share.uid_file_owner}get displaynameFileOwner(){return this._share.displayname_file_owner||this._share.uid_file_owner}get createdTime(){return this._share.stime}get expireDate(){return this._share.expiration}set expireDate(s){this._share.expiration=s}get token(){return this._share.token}get note(){return this._share.note}set note(s){this._share.note=s}get label(){return this._share.label}set label(s){this._share.label=s}get mailSend(){return this._share.mail_send===!0}get hideDownload(){return this._share.hide_download===!0}set hideDownload(s){this._share.hide_download=s===!0}get password(){return this._share.password}set password(s){this._share.password=s}get passwordExpirationTime(){return this._share.password_expiration_time}set passwordExpirationTime(s){this._share.password_expiration_time=s}get sendPasswordByTalk(){return this._share.send_password_by_talk}set sendPasswordByTalk(s){this._share.send_password_by_talk=s}get path(){return this._share.path}get itemType(){return this._share.item_type}get mimetype(){return this._share.mimetype}get fileSource(){return this._share.file_source}get fileTarget(){return this._share.file_target}get fileParent(){return this._share.file_parent}get hasReadPermission(){return!!(this.permissions&OC.PERMISSION_READ)}get hasCreatePermission(){return!!(this.permissions&OC.PERMISSION_CREATE)}get hasDeletePermission(){return!!(this.permissions&OC.PERMISSION_DELETE)}get hasUpdatePermission(){return!!(this.permissions&OC.PERMISSION_UPDATE)}get hasSharePermission(){return!!(this.permissions&OC.PERMISSION_SHARE)}get hasDownloadPermission(){for(const s in this._share.attributes){const i=this._share.attributes[s];if(i.scope==="permissions"&&i.key==="download")return i.enabled}return!0}set hasDownloadPermission(s){this.setAttribute("permissions","download",!!s)}setAttribute(s,i,r){const n={scope:s,key:i,enabled:r};for(const c in this._share.attributes){const d=this._share.attributes[c];if(d.scope===n.scope&&d.key===n.key){this._share.attributes.splice(c,1,n);return}}this._share.attributes.push(n)}get canEdit(){return this._share.can_edit===!0}get canDelete(){return this._share.can_delete===!0}get viaFileid(){return this._share.via_fileid}get viaPath(){return this._share.via_path}get parent(){return this._share.parent}get storageId(){return this._share.storage_id}get storage(){return this._share.storage}get itemSource(){return this._share.item_source}get status(){return this._share.status}}const O={data(){return{SHARE_TYPES:N}}},qt={name:"SharingEntrySimple",components:{NcActions:Z},props:{title:{type:String,default:"",required:!0},subtitle:{type:String,default:""},isUnique:{type:Boolean,default:!0},ariaExpanded:{type:Boolean,default:null}},computed:{ariaExpandedValue(){return this.ariaExpanded===null?this.ariaExpanded:this.ariaExpanded?"true":"false"}}};var jt=function(){var e=this,s=e._self._c;return s("li",{staticClass:"sharing-entry"},[e._t("avatar"),s("div",{staticClass:"sharing-entry__desc"},[s("span",{staticClass:"sharing-entry__title"},[e._v(e._s(e.title))]),e.subtitle?s("p",[e._v(" "+e._s(e.subtitle)+" ")]):e._e()]),e.$slots.default?s("NcActions",{ref:"actionsComponent",staticClass:"sharing-entry__actions",attrs:{"menu-align":"right","aria-expanded":e.ariaExpandedValue}},[e._t("default")],2):e._e()],2)},Vt=[],Gt=A(qt,jt,Vt,!1,null,"5d40a20b",null,null);const te=Gt.exports,zt={name:"SharingEntryInternal",components:{NcActionButton:F,SharingEntrySimple:te},props:{fileInfo:{type:Object,default:()=>{},required:!0}},data(){return{copied:!1,copySuccess:!1}},computed:{internalLink(){return window.location.protocol+"//"+window.location.host+ue("/f/")+this.fileInfo.id},copyLinkTooltip(){return this.copied?this.copySuccess?"":t("files_sharing","Cannot copy, please copy the link manually"):t("files_sharing","Copy internal link to clipboard")},internalLinkSubtitle(){return this.fileInfo.type==="dir"?t("files_sharing","Only works for users with access to this folder"):t("files_sharing","Only works for users with access to this file")}},methods:{async copyLink(){try{await navigator.clipboard.writeText(this.internalLink),M(t("files_sharing","Link copied")),this.$refs.shareEntrySimple.$refs.actionsComponent.$el.focus(),this.copySuccess=!0,this.copied=!0}catch(e){this.copySuccess=!1,this.copied=!0,console.error(e)}finally{setTimeout(()=>{this.copySuccess=!1,this.copied=!1},4e3)}}}};var Kt=function(){var e=this,s=e._self._c;return s("ul",[s("SharingEntrySimple",{ref:"shareEntrySimple",staticClass:"sharing-entry__internal",attrs:{title:e.t("files_sharing","Internal link"),subtitle:e.internalLinkSubtitle},scopedSlots:e._u([{key:"avatar",fn:function(){return[s("div",{staticClass:"avatar-external icon-external-white"})]},proxy:!0}])},[s("NcActionButton",{attrs:{title:e.copyLinkTooltip,"aria-label":e.copyLinkTooltip,icon:e.copied&&e.copySuccess?"icon-checkmark-color":"icon-clippy"},on:{click:e.copyLink}})],1)],1)},Qt=[],Jt=A(zt,Kt,Qt,!1,null,"9dacf6b3",null,null);const Xt=Jt.exports,ne=new ee,be="abcdefgijkmnopqrstwxyzABCDEFGHJKLMNPQRSTWXYZ23456789";async function V(){if(ne.passwordPolicy.api&&ne.passwordPolicy.api.generate)try{const r=await k.get(ne.passwordPolicy.api.generate);if(r.data.ocs.data.password)return M(t("files_sharing","Password created successfully")),r.data.ocs.data.password}catch(r){console.info("Error generating password from password_policy",r),pe(t("files_sharing","Error generating password from password policy"))}const e=new Uint8Array(10),s=be.length/255;self.crypto.getRandomValues(e);let i="";for(let r=0;r<e.length;r++)i+=be.charAt(e[r]*s);return i}(function(e){var s=function(){try{if(e.URLSearchParams&&new e.URLSearchParams("foo=bar").get("foo")==="bar")return e.URLSearchParams}catch{}return null}(),i=s&&new s({a:1}).toString()==="a=1",r=s&&new s("s=%2B").get("s")==="+",n=s&&"size"in s.prototype,c="__URLSearchParams__",d=s?function(){var a=new s;return a.append("s"," &"),a.toString()==="s=+%26"}():!0,o=_.prototype,p=!!(e.Symbol&&e.Symbol.iterator);if(s&&i&&r&&d&&n)return;function _(a){a=a||"",(a instanceof URLSearchParams||a instanceof _)&&(a=a.toString()),this[c]=E(a)}o.append=function(a,h){v(this[c],a,h)},o.delete=function(a){delete this[c][a]},o.get=function(a){var h=this[c];return this.has(a)?h[a][0]:null},o.getAll=function(a){var h=this[c];return this.has(a)?h[a].slice(0):[]},o.has=function(a){return z(this[c],a)},o.set=function(a,h){this[c][a]=[""+h]},o.toString=function(){var a=this[c],h=[],l,g,y,R;for(g in a)for(y=T(g),l=0,R=a[g];l<R.length;l++)h.push(y+"="+T(R[l]));return h.join("&")};var D=e.Proxy&&s&&(!r||!d||!i||!n),w;D?(w=new Proxy(s,{construct:function(a,h){return new a(new _(h[0]).toString())}}),w.toString=Function.prototype.toString.bind(_)):w=_,Object.defineProperty(e,"URLSearchParams",{value:w});var u=e.URLSearchParams.prototype;u.polyfill=!0,!D&&e.Symbol&&(u[e.Symbol.toStringTag]="URLSearchParams"),"forEach"in u||(u.forEach=function(a,h){var l=E(this.toString());Object.getOwnPropertyNames(l).forEach(function(g){l[g].forEach(function(y){a.call(h,y,g,this)},this)},this)}),"sort"in u||(u.sort=function(){var a=E(this.toString()),h=[],l,g,y;for(l in a)h.push(l);for(h.sort(),g=0;g<h.length;g++)this.delete(h[g]);for(g=0;g<h.length;g++){var R=h[g],H=a[R];for(y=0;y<H.length;y++)this.append(R,H[y])}}),"keys"in u||(u.keys=function(){var a=[];return this.forEach(function(h,l){a.push(l)}),S(a)}),"values"in u||(u.values=function(){var a=[];return this.forEach(function(h){a.push(h)}),S(a)}),"entries"in u||(u.entries=function(){var a=[];return this.forEach(function(h,l){a.push([l,h])}),S(a)}),p&&(u[e.Symbol.iterator]=u[e.Symbol.iterator]||u.entries),"size"in u||Object.defineProperty(u,"size",{get:function(){var a=E(this.toString());if(u===this)throw new TypeError("Illegal invocation at URLSearchParams.invokeGetter");return Object.keys(a).reduce(function(h,l){return h+a[l].length},0)}});function T(a){var h={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(a).replace(/[!'\(\)~]|%20|%00/g,function(l){return h[l]})}function f(a){return a.replace(/[ +]/g,"%20").replace(/(%[a-f0-9]{2})+/ig,function(h){return decodeURIComponent(h)})}function S(a){var h={next:function(){var l=a.shift();return{done:l===void 0,value:l}}};return p&&(h[e.Symbol.iterator]=function(){return h}),h}function E(a){var h={};if(typeof a=="object")if(W(a))for(var l=0;l<a.length;l++){var g=a[l];if(W(g)&&g.length===2)v(h,g[0],g[1]);else throw new TypeError("Failed to construct 'URLSearchParams': Sequence initializer must only contain pair elements")}else for(var y in a)a.hasOwnProperty(y)&&v(h,y,a[y]);else{a.indexOf("?")===0&&(a=a.slice(1));for(var R=a.split("&"),H=0;H<R.length;H++){var B=R[H],se=B.indexOf("=");-1<se?v(h,f(B.slice(0,se)),f(B.slice(se+1))):B&&v(h,f(B),"")}}return h}function v(a,h,l){var g=typeof l=="string"?l:l!=null&&typeof l.toString=="function"?l.toString():JSON.stringify(l);z(a,h)?a[h].push(g):a[h]=[g]}function W(a){return!!a&&Object.prototype.toString.call(a)==="[object Array]"}function z(a,h){return Object.prototype.hasOwnProperty.call(a,h)}})(typeof ie<"u"?ie:typeof window<"u"?window:ie);const oe=C("apps/files_sharing/api/v1/shares"),fe={methods:{async createShare({path:e,permissions:s,shareType:i,shareWith:r,publicUpload:n,password:c,sendPasswordByTalk:d,expireDate:o,label:p,note:_,attributes:D}){var w,u,T,f,S;try{const E=await k.post(oe,{path:e,permissions:s,shareType:i,shareWith:r,publicUpload:n,password:c,sendPasswordByTalk:d,expireDate:o,label:p,note:_,attributes:D});if(!((w=E==null?void 0:E.data)!=null&&w.ocs))throw E;const v=new b(E.data.ocs.data);return re("files_sharing:share:created",{share:v}),v}catch(E){console.error("Error while creating share",E);const v=(S=(f=(T=(u=E==null?void 0:E.response)==null?void 0:u.data)==null?void 0:T.ocs)==null?void 0:f.meta)==null?void 0:S.message;throw OC.Notification.showTemporary(v?t("files_sharing","Error creating the share: {errorMessage}",{errorMessage:v}):t("files_sharing","Error creating the share"),{type:"error"}),E}},async deleteShare(e){var s,i,r,n,c;try{const d=await k.delete(oe+"/".concat(e));if(!((s=d==null?void 0:d.data)!=null&&s.ocs))throw d;return re("files_sharing:share:deleted",{id:e}),!0}catch(d){console.error("Error while deleting share",d);const o=(c=(n=(r=(i=d==null?void 0:d.response)==null?void 0:i.data)==null?void 0:r.ocs)==null?void 0:n.meta)==null?void 0:c.message;throw OC.Notification.showTemporary(o?t("files_sharing","Error deleting the share: {errorMessage}",{errorMessage:o}):t("files_sharing","Error deleting the share"),{type:"error"}),d}},async updateShare(e,s){var i,r,n,c,d;try{const o=await k.put(oe+"/".concat(e),s);if(re("files_sharing:share:updated",{id:e}),(i=o==null?void 0:o.data)==null?void 0:i.ocs)return o.data.ocs.data;throw o}catch(o){if(console.error("Error while updating share",o),o.response.status!==400){const _=(d=(c=(n=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:n.ocs)==null?void 0:c.meta)==null?void 0:d.message;OC.Notification.showTemporary(_?t("files_sharing","Error updating the share: {errorMessage}",{errorMessage:_}):t("files_sharing","Error updating the share"),{type:"error"})}const p=o.response.data.ocs.meta.message;throw new Error(p)}}}},$={methods:{async openSharingDetails(e){let s={};e.handler?(this.suggestions&&(e.suggestions=this.suggestions,e.fileInfo=this.fileInfo,e.query=this.query),s=await e.handler(e),s=new b(s)):s=this.mapShareRequestToShareObject(e);const i={fileInfo:this.fileInfo,share:s};this.$emit("open-sharing-details",i)},openShareDetailsForCustomSettings(e){e.setCustomPermissions=!0,this.openSharingDetails(e)},mapShareRequestToShareObject(e){if(e.id)return e;const s={attributes:[{enabled:!0,key:"download",scope:"permissions"}],share_type:e.shareType,share_with:e.shareWith,is_no_user:e.isNoUser,user:e.shareWith,share_with_displayname:e.displayName,subtitle:e.subtitle,permissions:e.permissions,expiration:""};return new b(s)}}},Zt={name:"SharingInput",components:{NcSelect:de},mixins:[O,fe,$],props:{shares:{type:Array,default:()=>[],required:!0},linkShares:{type:Array,default:()=>[],required:!0},fileInfo:{type:Object,default:()=>{},required:!0},reshare:{type:b,default:null},canReshare:{type:Boolean,required:!0}},data(){return{config:new ee,loading:!1,query:"",recommendations:[],ShareSearch:OCA.Sharing.ShareSearch.state,suggestions:[],value:null}},computed:{externalResults(){return this.ShareSearch.results},inputPlaceholder(){const e=this.config.isRemoteShareAllowed;return this.canReshare?e?t("files_sharing","Name, email, or Federated Cloud ID …"):t("files_sharing","Name or email …"):t("files_sharing","Resharing is not allowed")},isValidQuery(){return this.query&&this.query.trim()!==""&&this.query.length>this.config.minSearchStringLength},options(){return this.isValidQuery?this.suggestions:this.recommendations},noResultText(){return this.loading?t("files_sharing","Searching …"):t("files_sharing","No elements found.")}},mounted(){this.getRecommendations()},methods:{onSelected(e){this.value=null,this.openSharingDetails(e)},async asyncFind(e){this.query=e.trim(),this.isValidQuery&&(this.loading=!0,await this.debounceGetSuggestions(e))},async getSuggestions(e,s=!1){this.loading=!0,j().files_sharing.sharee.query_lookup_default===!0&&(s=!0);const i=[this.SHARE_TYPES.SHARE_TYPE_USER,this.SHARE_TYPES.SHARE_TYPE_GROUP,this.SHARE_TYPES.SHARE_TYPE_REMOTE,this.SHARE_TYPES.SHARE_TYPE_REMOTE_GROUP,this.SHARE_TYPES.SHARE_TYPE_CIRCLE,this.SHARE_TYPES.SHARE_TYPE_ROOM,this.SHARE_TYPES.SHARE_TYPE_GUEST,this.SHARE_TYPES.SHARE_TYPE_DECK,this.SHARE_TYPES.SHARE_TYPE_SCIENCEMESH];j().files_sharing.public.enabled===!0&&i.push(this.SHARE_TYPES.SHARE_TYPE_EMAIL);let r=null;try{r=await k.get(C("apps/files_sharing/api/v1/sharees"),{params:{format:"json",itemType:this.fileInfo.type==="dir"?"folder":"file",search:e,lookup:s,perPage:this.config.maxAutocompleteResults,shareType:i}})}catch(f){console.error("Error fetching suggestions",f);return}const n=r.data.ocs.data,c=r.data.ocs.data.exact;n.exact=[];const d=Object.values(c).reduce((f,S)=>f.concat(S),[]),o=Object.values(n).reduce((f,S)=>f.concat(S),[]),p=this.filterOutExistingShares(d).map(f=>this.formatForMultiselect(f)).sort((f,S)=>f.shareType-S.shareType),_=this.filterOutExistingShares(o).map(f=>this.formatForMultiselect(f)).sort((f,S)=>f.shareType-S.shareType),D=[];n.lookupEnabled&&!s&&D.push({id:"global-lookup",isNoUser:!0,displayName:t("files_sharing","Search globally"),lookup:!0});const w=this.externalResults.filter(f=>!f.condition||f.condition(this)),u=p.concat(_).concat(w).concat(D),T=u.reduce((f,S)=>(S.displayName&&(f[S.displayName]||(f[S.displayName]=0),f[S.displayName]++),f),{});this.suggestions=u.map(f=>T[f.displayName]>1&&!f.desc?{...f,desc:f.shareWithDisplayNameUnique}:f),this.loading=!1,console.info("suggestions",this.suggestions)},debounceGetSuggestions:le(function(...e){this.getSuggestions(...e)},300),async getRecommendations(){this.loading=!0;let e=null;try{e=await k.get(C("apps/files_sharing/api/v1/sharees_recommended"),{params:{format:"json",itemType:this.fileInfo.type}})}catch(r){console.error("Error fetching recommendations",r);return}const s=this.externalResults.filter(r=>!r.condition||r.condition(this)),i=Object.values(e.data.ocs.data.exact).reduce((r,n)=>r.concat(n),[]);this.recommendations=this.filterOutExistingShares(i).map(r=>this.formatForMultiselect(r)).concat(s),this.loading=!1,console.info("recommendations",this.recommendations)},filterOutExistingShares(e){return e.reduce((s,i)=>{if(typeof i!="object")return s;try{if(i.value.shareType===this.SHARE_TYPES.SHARE_TYPE_USER&&(i.value.shareWith===Ae().uid||this.reshare&&i.value.shareWith===this.reshare.owner))return s;if(i.value.shareType===this.SHARE_TYPES.SHARE_TYPE_EMAIL){if(this.linkShares.map(r=>r.shareWith).indexOf(i.value.shareWith.trim())!==-1)return s}else{const r=this.shares.reduce((c,d)=>(c[d.shareWith]=d.type,c),{}),n=i.value.shareWith.trim();if(n in r&&r[n]===i.value.shareType)return s}s.push(i)}catch{return s}return s},[])},shareTypeToIcon(e){switch(e){case this.SHARE_TYPES.SHARE_TYPE_GUEST:return{icon:"icon-user",iconTitle:t("files_sharing","Guest")};case this.SHARE_TYPES.SHARE_TYPE_REMOTE_GROUP:case this.SHARE_TYPES.SHARE_TYPE_GROUP:return{icon:"icon-group",iconTitle:t("files_sharing","Group")};case this.SHARE_TYPES.SHARE_TYPE_EMAIL:return{icon:"icon-mail",iconTitle:t("files_sharing","Email")};case this.SHARE_TYPES.SHARE_TYPE_CIRCLE:return{icon:"icon-circle",iconTitle:t("files_sharing","Circle")};case this.SHARE_TYPES.SHARE_TYPE_ROOM:return{icon:"icon-room",iconTitle:t("files_sharing","Talk conversation")};case this.SHARE_TYPES.SHARE_TYPE_DECK:return{icon:"icon-deck",iconTitle:t("files_sharing","Deck board")};case this.SHARE_TYPES.SHARE_TYPE_SCIENCEMESH:return{icon:"icon-sciencemesh",iconTitle:t("files_sharing","ScienceMesh")};default:return{}}},formatForMultiselect(e){var i,r;let s;return e.value.shareType===this.SHARE_TYPES.SHARE_TYPE_USER&&this.config.shouldAlwaysShowUnique?s=(i=e.shareWithDisplayNameUnique)!=null?i:"":(e.value.shareType===this.SHARE_TYPES.SHARE_TYPE_REMOTE||e.value.shareType===this.SHARE_TYPES.SHARE_TYPE_REMOTE_GROUP)&&e.value.server?s=t("files_sharing","on {server}",{server:e.value.server}):e.value.shareType===this.SHARE_TYPES.SHARE_TYPE_EMAIL?s=e.value.shareWith:s=(r=e.shareWithDescription)!=null?r:"",{shareWith:e.value.shareWith,shareType:e.value.shareType,user:e.uuid||e.value.shareWith,isNoUser:e.value.shareType!==this.SHARE_TYPES.SHARE_TYPE_USER,displayName:e.name||e.label,subtitle:s,shareWithDisplayNameUnique:e.shareWithDisplayNameUnique||"",...this.shareTypeToIcon(e.value.shareType)}},async addShare(e){if(this.value=null,e.lookup)return await this.getSuggestions(this.query,!0),this.$nextTick(()=>{this.$refs.select.$children[0].open=!0}),!0;if(e.handler){const s=await e.handler(this);return this.$emit("add:share",new b(s)),!0}this.loading=!0,console.debug("Adding a new share from the input for",e);try{let s=null;this.config.enforcePasswordForPublicLink&&e.shareType===this.SHARE_TYPES.SHARE_TYPE_EMAIL&&(s=await V());const i=(this.fileInfo.path+"/"+this.fileInfo.name).replace("//","/"),r=await this.createShare({path:i,shareType:e.shareType,shareWith:e.shareWith,password:s,permissions:this.fileInfo.sharePermissions&j().files_sharing.default_permissions,attributes:JSON.stringify(this.fileInfo.shareAttributes)});if(s){r.newPassword=s;const n=await new Promise(c=>{this.$emit("add:share",r,c)});n.open=!0}else this.$emit("add:share",r);await this.getRecommendations()}catch(s){this.$nextTick(()=>{this.$refs.select.$children[0].open=!0}),this.query=e.shareWith,console.error("Error while adding new share",s)}finally{this.loading=!1}}}};var es=function(){var e=this,s=e._self._c;return s("div",{staticClass:"sharing-search"},[s("label",{attrs:{for:"sharing-search-input"}},[e._v(e._s(e.t("files_sharing","Search for share recipients")))]),s("NcSelect",{ref:"select",staticClass:"sharing-search__input",attrs:{"input-id":"sharing-search-input",disabled:!e.canReshare,loading:e.loading,filterable:!1,placeholder:e.inputPlaceholder,"clear-search-on-blur":()=>!1,"user-select":!0,options:e.options},on:{search:e.asyncFind,"option:selected":e.onSelected},scopedSlots:e._u([{key:"no-options",fn:function({search:i}){return[e._v(" "+e._s(i?e.noResultText:e.t("files_sharing","No recommendations. Start typing."))+" ")]}}]),model:{value:e.value,callback:function(i){e.value=i},expression:"value"}})],1)},ts=[],ss=A(Zt,es,ts,!1,null,null,null,null);const is=ss.exports,m={NONE:0,READ:1,UPDATE:2,CREATE:4,DELETE:8,SHARE:16},P={READ_ONLY:m.READ,UPLOAD_AND_UPDATE:m.READ|m.UPDATE|m.CREATE|m.DELETE,FILE_DROP:m.CREATE,ALL:m.UPDATE|m.CREATE|m.READ|m.DELETE|m.SHARE,ALL_FILE:m.UPDATE|m.READ|m.SHARE};function rs(e,s){return e!==m.NONE&&(e&s)===s}const G={mixins:[fe,O],props:{fileInfo:{type:Object,default:()=>{},required:!0},share:{type:b,default:null},isUnique:{type:Boolean,default:!0}},data(){var e;return{config:new ee,errors:{},loading:!1,saving:!1,open:!1,updateQueue:new rt({concurrency:1}),reactiveState:(e=this.share)==null?void 0:e.state}},computed:{hasNote:{get(){return this.share.note!==""},set(e){this.share.note=e?null:""}},dateTomorrow(){return new Date(new Date().setDate(new Date().getDate()+1))},lang(){const e=window.dayNamesShort?window.dayNamesShort:["Sun.","Mon.","Tue.","Wed.","Thu.","Fri.","Sat."],s=window.monthNamesShort?window.monthNamesShort:["Jan.","Feb.","Mar.","Apr.","May.","Jun.","Jul.","Aug.","Sep.","Oct.","Nov.","Dec."];return{formatLocale:{firstDayOfWeek:window.firstDay?window.firstDay:0,monthsShort:s,weekdaysMin:e,weekdaysShort:e},monthFormat:"MMM"}},isFolder(){return this.fileInfo.type==="dir"},isPublicShare(){var s;const e=(s=this.share.shareType)!=null?s:this.share.type;return[this.SHARE_TYPES.SHARE_TYPE_LINK,this.SHARE_TYPES.SHARE_TYPE_EMAIL].includes(e)},isRemoteShare(){return this.share.type===this.SHARE_TYPES.SHARE_TYPE_REMOTE_GROUP||this.share.type===this.SHARE_TYPES.SHARE_TYPE_REMOTE},isShareOwner(){return this.share&&this.share.owner===Ae().uid},isExpiryDateEnforced(){return this.isPublicShare?this.config.isDefaultExpireDateEnforced:this.isRemoteShare?this.config.isDefaultRemoteExpireDateEnforced:this.config.isDefaultInternalExpireDateEnforced},hasCustomPermissions(){return![P.ALL,P.READ_ONLY,P.FILE_DROP].includes(this.share.permissions)},maxExpirationDateEnforced(){return this.isExpiryDateEnforced?this.isPublicShare?this.config.defaultExpirationDate:this.isRemoteShare?this.config.defaultRemoteExpirationDateString:this.config.defaultInternalExpirationDate:null}},methods:{checkShare(e){return!(e.password&&(typeof e.password!="string"||e.password.trim()==="")||e.expirationDate&&!e.expirationDate.isValid())},parseDateString(e){var i;if(!e)return;const s=/([0-9]{4}-[0-9]{2}-[0-9]{2})/i;return new Date((i=e.match(s))==null?void 0:i.pop())},formatDateToString(e){return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())).toISOString().split("T")[0]},onExpirationChange:le(e=>{(void 0).share.expireDate=(void 0).formatDateToString(new Date(e))},500),onExpirationDisable(){this.share.expireDate=""},onNoteChange(e){this.$set(this.share,"newNote",e.trim())},onNoteSubmit(){this.share.newNote&&(this.share.note=this.share.newNote,this.$delete(this.share,"newNote"),this.queueUpdate("note"))},async onDelete(){try{this.loading=!0,this.open=!1,await this.deleteShare(this.share.id),console.debug("Share deleted",this.share.id);const e=this.share.itemType==="file"?t("files_sharing",'File "{path}" has been unshared',{path:this.share.path}):t("files_sharing",'Folder "{path}" has been unshared',{path:this.share.path});M(e),this.$emit("remove:share",this.share)}catch{this.open=!0}finally{this.loading=!1}},queueUpdate(...e){if(e.length!==0){if(this.share.id){const s={};e.forEach(i=>{typeof this.share[i]=="object"?s[i]=JSON.stringify(this.share[i]):s[i]=this.share[i].toString()}),this.updateQueue.add(async()=>{this.saving=!0,this.errors={};try{const i=await this.updateShare(this.share.id,s);e.indexOf("password")>=0&&(this.$delete(this.share,"newPassword"),this.share.passwordExpirationTime=i.password_expiration_time),this.$delete(this.errors,e[0]),M(t("files_sharing","Share {propertyName} saved",{propertyName:e[0]}))}catch({message:i}){i&&i!==""&&(this.onSyncError(e[0],i),pe(t("files_sharing",i)))}finally{this.saving=!1}});return}console.debug("Updated local share",this.share)}},onSyncError(e,s){switch(this.open=!0,e){case"password":case"pending":case"expireDate":case"label":case"note":{this.$set(this.errors,e,s);let i=this.$refs[e];if(i){i.$el&&(i=i.$el);const r=i.querySelector(".focusable");r&&r.focus()}break}case"sendPasswordByTalk":{this.$set(this.errors,e,s),this.share.sendPasswordByTalk=!this.share.sendPasswordByTalk;break}}},debounceQueueUpdate:le(function(e){this.queueUpdate(e)},500)}},as={name:"SharingEntryInherited",components:{NcActionButton:F,NcActionLink:De,NcActionText:Re,NcAvatar:L,SharingEntrySimple:te},mixins:[G],props:{share:{type:b,required:!0}},computed:{viaFileTargetUrl(){return ue("/f/{fileid}",{fileid:this.share.viaFileid})},viaFolderName(){return it(this.share.viaPath)}}};var ns=function(){var e=this,s=e._self._c;return s("SharingEntrySimple",{key:e.share.id,staticClass:"sharing-entry__inherited",attrs:{title:e.share.shareWithDisplayName},scopedSlots:e._u([{key:"avatar",fn:function(){return[s("NcAvatar",{staticClass:"sharing-entry__avatar",attrs:{user:e.share.shareWith,"display-name":e.share.shareWithDisplayName}})]},proxy:!0}])},[s("NcActionText",{attrs:{icon:"icon-user"}},[e._v(" "+e._s(e.t("files_sharing","Added by {initiator}",{initiator:e.share.ownerDisplayName}))+" ")]),e.share.viaPath&&e.share.viaFileid?s("NcActionLink",{attrs:{icon:"icon-folder",href:e.viaFileTargetUrl}},[e._v(" "+e._s(e.t("files_sharing","Via “{folder}”",{folder:e.viaFolderName}))+" ")]):e._e(),e.share.canDelete?s("NcActionButton",{attrs:{icon:"icon-close"},on:{click:function(i){return i.preventDefault(),e.onDelete.apply(null,arguments)}}},[e._v(" "+e._s(e.t("files_sharing","Unshare"))+" ")]):e._e()],1)},os=[],hs=A(as,ns,os,!1,null,"761ebf41",null,null);const ls=hs.exports,cs={name:"SharingInherited",components:{NcActionButton:F,SharingEntryInherited:ls,SharingEntrySimple:te},props:{fileInfo:{type:Object,default:()=>{},required:!0}},data(){return{loaded:!1,loading:!1,showInheritedShares:!1,shares:[]}},computed:{showInheritedSharesIcon(){return this.loading?"icon-loading-small":this.showInheritedShares?"icon-triangle-n":"icon-triangle-s"},mainTitle(){return t("files_sharing","Others with access")},subTitle(){return this.showInheritedShares&&this.shares.length===0?t("files_sharing","No other users with access found"):""},toggleTooltip(){return this.fileInfo.type==="dir"?t("files_sharing","Toggle list of others with access to this directory"):t("files_sharing","Toggle list of others with access to this file")},fullPath(){return"".concat(this.fileInfo.path,"/").concat(this.fileInfo.name).replace("//","/")}},watch:{fileInfo(){this.resetState()}},methods:{toggleInheritedShares(){this.showInheritedShares=!this.showInheritedShares,this.showInheritedShares?this.fetchInheritedShares():this.resetState()},async fetchInheritedShares(){this.loading=!0;try{const e=C("apps/files_sharing/api/v1/shares/inherited?format=json&path={path}",{path:this.fullPath}),s=await k.get(e);this.shares=s.data.ocs.data.map(i=>new b(i)).sort((i,r)=>r.createdTime-i.createdTime),console.info(this.shares),this.loaded=!0}catch{OC.Notification.showTemporary(t("files_sharing","Unable to fetch inherited shares"),{type:"error"})}finally{this.loading=!1}},resetState(){this.loaded=!1,this.loading=!1,this.showInheritedShares=!1,this.shares=[]},removeShare(e){const s=this.shares.findIndex(i=>i===e);this.shares.splice(s,1)}}};var ds=function(){var e=this,s=e._self._c;return s("ul",{attrs:{id:"sharing-inherited-shares"}},[s("SharingEntrySimple",{staticClass:"sharing-entry__inherited",attrs:{title:e.mainTitle,subtitle:e.subTitle,"aria-expanded":e.showInheritedShares},scopedSlots:e._u([{key:"avatar",fn:function(){return[s("div",{staticClass:"avatar-shared icon-more-white"})]},proxy:!0}])},[s("NcActionButton",{attrs:{icon:e.showInheritedSharesIcon,"aria-label":e.toggleTooltip,title:e.toggleTooltip},on:{click:function(i){return i.preventDefault(),i.stopPropagation(),e.toggleInheritedShares.apply(null,arguments)}}})],1),e._l(e.shares,function(i){return s("SharingEntryInherited",{key:i.id,attrs:{"file-info":e.fileInfo,share:i},on:{"remove:share":e.removeShare}})})],2)},us=[],ps=A(cs,ds,us,!1,null,"f49f5740",null,null);const fs=ps.exports,_s={name:"SharingEntryQuickShareSelect",components:{DropdownIcon:ze,NcActions:Z,NcActionButton:F},mixins:[G,$,O],props:{share:{type:Object,required:!0}},emits:["open-sharing-details"],data(){return{selectedOption:""}},computed:{ariaLabel(){return t("files_sharing",'Quick share options, the current selected is "{selectedOption}"',{selectedOption:this.selectedOption})},canViewText(){return t("files_sharing","View only")},canEditText(){return t("files_sharing","Can edit")},fileDropText(){return t("files_sharing","File drop")},customPermissionsText(){return t("files_sharing","Custom permissions")},preSelectedOption(){return(this.share.permissions&~m.SHARE)===P.READ_ONLY?this.canViewText:this.share.permissions===P.ALL||this.share.permissions===P.ALL_FILE?this.canEditText:(this.share.permissions&~m.SHARE)===P.FILE_DROP?this.fileDropText:this.customPermissionsText},options(){const e=[{label:this.canViewText,icon:Ke},{label:this.canEditText,icon:xe}];return this.supportsFileDrop&&e.push({label:this.fileDropText,icon:Qe}),e.push({label:this.customPermissionsText,icon:ke}),e},supportsFileDrop(){var e;if(this.isFolder&&this.config.isPublicUploadEnabled){const s=(e=this.share.type)!=null?e:this.share.shareType;return[this.SHARE_TYPES.SHARE_TYPE_LINK,this.SHARE_TYPES.SHARE_TYPE_EMAIL].includes(s)}return!1},dropDownPermissionValue(){switch(this.selectedOption){case this.canEditText:return this.isFolder?P.ALL:P.ALL_FILE;case this.fileDropText:return P.FILE_DROP;case this.customPermissionsText:return"custom";case this.canViewText:default:return P.READ_ONLY}}},created(){this.selectedOption=this.preSelectedOption},methods:{selectOption(e){this.selectedOption=e,e===this.customPermissionsText?this.$emit("open-sharing-details"):(this.share.permissions=this.dropDownPermissionValue,this.queueUpdate("permissions"),this.$refs.quickShareActions.$refs.menuButton.$el.focus())}}};var gs=function(){var e=this,s=e._self._c;return s("NcActions",{ref:"quickShareActions",staticClass:"share-select",attrs:{"menu-name":e.selectedOption,"aria-label":e.ariaLabel,type:"tertiary-no-background","force-name":""},scopedSlots:e._u([{key:"icon",fn:function(){return[s("DropdownIcon",{attrs:{size:15}})]},proxy:!0}])},e._l(e.options,function(i){return s("NcActionButton",{key:i.label,attrs:{type:"radio","model-value":i.label===e.selectedOption,"close-after-click":""},on:{click:function(r){return e.selectOption(i.label)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s(i.icon,{tag:"component"})]},proxy:!0}],null,!0)},[e._v(" "+e._s(i.label)+" ")])}),1)},ms=[],Ss=A(_s,gs,ms,!1,null,"25f0f821",null,null);const He=Ss.exports,Es={name:"ExternalShareAction",props:{id:{type:String,required:!0},action:{type:Object,default:()=>({})},fileInfo:{type:Object,default:()=>{},required:!0},share:{type:b,default:null}},computed:{data(){return this.action.data(this)}}};var ys=function(){var e=this,s=e._self._c;return s(e.data.is,e._g(e._b({tag:"Component"},"Component",e.data,!1),e.action.handlers),[e._v(" "+e._s(e.data.text)+" ")])},ws=[],Ps=A(Es,ys,ws,!1,null,null,null,null);const vs=Ps.exports,Ts={name:"SharingEntryLink",components:{ExternalShareAction:vs,NcActions:Z,NcActionButton:F,NcActionInput:Me,NcActionLink:De,NcActionText:Re,NcActionSeparator:Fe,NcAvatar:L,Tune:ke,SharingEntryQuickShareSelect:He},mixins:[G,$],props:{canReshare:{type:Boolean,default:!0},index:{type:Number,default:null}},data(){return{copySuccess:!0,copied:!1,pending:!1,ExternalLegacyLinkActions:OCA.Sharing.ExternalLinkActions.state,ExternalShareActions:OCA.Sharing.ExternalShareActions.state}},computed:{title(){if(this.share&&this.share.id){if(!this.isShareOwner&&this.share.ownerDisplayName)return this.isEmailShareType?t("files_sharing","{shareWith} by {initiator}",{shareWith:this.share.shareWith,initiator:this.share.ownerDisplayName}):t("files_sharing","Shared via link by {initiator}",{initiator:this.share.ownerDisplayName});if(this.share.label&&this.share.label.trim()!=="")return this.isEmailShareType?t("files_sharing","Mail share ({label})",{label:this.share.label.trim()}):t("files_sharing","Share link ({label})",{label:this.share.label.trim()});if(this.isEmailShareType)return this.share.shareWith}return this.index>1?t("files_sharing","Share link ({index})",{index:this.index}):t("files_sharing","Share link")},subtitle(){return this.isEmailShareType&&this.title!==this.share.shareWith?this.share.shareWith:null},isPasswordProtected:{get(){return this.config.enforcePasswordForPublicLink||!!this.share.password},async set(e){he.set(this.share,"password",e?await V():""),he.set(this.share,"newPassword",this.share.password)}},passwordExpirationTime(){if(this.share.passwordExpirationTime===null)return null;const e=moment(this.share.passwordExpirationTime);return e.diff(moment())<0?!1:e.fromNow()},isTalkEnabled(){return OC.appswebroots.spreed!==void 0},isPasswordProtectedByTalkAvailable(){return this.isPasswordProtected&&this.isTalkEnabled},isPasswordProtectedByTalk:{get(){return this.share.sendPasswordByTalk},async set(e){this.share.sendPasswordByTalk=e}},isEmailShareType(){return this.share?this.share.type===this.SHARE_TYPES.SHARE_TYPE_EMAIL:!1},canTogglePasswordProtectedByTalkAvailable(){if(this.isPasswordProtected){if(this.isEmailShareType&&!this.hasUnsavedPassword)return!1}else return!1;return!0},pendingPassword(){return this.config.enableLinkPasswordByDefault&&this.share&&!this.share.id},pendingEnforcedPassword(){return this.config.enforcePasswordForPublicLink&&this.share&&!this.share.id},pendingExpirationDate(){return this.config.isDefaultExpireDateEnforced&&this.share&&!this.share.id},hasUnsavedPassword(){return this.share.newPassword!==void 0},shareLink(){return window.location.protocol+"//"+window.location.host+ue("/s/")+this.share.token},actionsTooltip(){return t("files_sharing",'Actions for "{title}"',{title:this.title})},copyLinkTooltip(){return this.copied?this.copySuccess?"":t("files_sharing","Cannot copy, please copy the link manually"):t("files_sharing",'Copy public link of "{title}" to clipboard',{title:this.title})},externalLegacyLinkActions(){return this.ExternalLegacyLinkActions.actions},externalLinkActions(){return this.ExternalShareActions.actions.filter(e=>e.shareType.includes(N.SHARE_TYPE_LINK)||e.shareType.includes(N.SHARE_TYPE_EMAIL))},isPasswordPolicyEnabled(){return typeof this.config.passwordPolicy=="object"},canChangeHideDownload(){const e=s=>s.key==="download"&&s.scope==="permissions"&&s.enabled===!1;return this.fileInfo.shareAttributes.some(e)}},methods:{async onNewLinkShare(){if(this.loading)return;const e={share_type:N.SHARE_TYPE_LINK};if(this.config.isDefaultExpireDateEnforced&&(e.expiration=this.formatDateToString(this.config.defaultExpirationDate)),this.config.enableLinkPasswordByDefault||this.config.enforcePasswordForPublicLink||this.config.isDefaultExpireDateEnforced){if(this.pending=!0,this.share&&!this.share.id)if(this.checkShare(this.share)){try{await this.pushNewLinkShare(this.share,!0)}catch(r){return this.pending=!1,console.error(r),!1}return!0}else return this.open=!0,OC.Notification.showTemporary(t("files_sharing","Error, please enter proper password and/or expiration date")),!1;(this.config.enableLinkPasswordByDefault||this.config.enforcePasswordForPublicLink)&&(e.password=await V());const s=new b(e),i=await new Promise(r=>{this.$emit("add:share",s,r)});this.open=!1,this.pending=!1,i.open=!0}else{const s=new b(e);await this.pushNewLinkShare(s)}},async pushNewLinkShare(e,s){var i,r,n,c;try{if(this.loading)return!0;this.loading=!0,this.errors={};const d={path:(this.fileInfo.path+"/"+this.fileInfo.name).replace("//","/"),shareType:N.SHARE_TYPE_LINK,password:e.password,expireDate:e.expireDate,attributes:JSON.stringify(this.fileInfo.shareAttributes)};console.debug("Creating link share with options",d);const o=await this.createShare(d);this.open=!1,console.debug("Link share created",o);let p;s?p=await new Promise(_=>{this.$emit("update:share",o,_)}):p=await new Promise(_=>{this.$emit("add:share",o,_)}),this.config.enforcePasswordForPublicLink||p.copyLink(),M(t("files_sharing","Link share created"))}catch(d){const o=(c=(n=(r=(i=d==null?void 0:d.response)==null?void 0:i.data)==null?void 0:r.ocs)==null?void 0:n.meta)==null?void 0:c.message;if(!o){pe(t("files_sharing","Error while creating the share")),console.error(d);return}throw o.match(/password/i)?this.onSyncError("password",o):o.match(/date/i)?this.onSyncError("expireDate",o):this.onSyncError("pending",o),d}finally{this.loading=!1}},async copyLink(){try{await navigator.clipboard.writeText(this.shareLink),M(t("files_sharing","Link copied")),this.$refs.copyButton.$el.focus(),this.copySuccess=!0,this.copied=!0}catch(e){this.copySuccess=!1,this.copied=!0,console.error(e)}finally{setTimeout(()=>{this.copySuccess=!1,this.copied=!1},4e3)}},onPasswordChange(e){this.$set(this.share,"newPassword",e)},onPasswordDisable(){this.share.password="",this.$delete(this.share,"newPassword"),this.share.id&&this.queueUpdate("password")},onPasswordSubmit(){this.hasUnsavedPassword&&(this.share.password=this.share.newPassword.trim(),this.queueUpdate("password"))},onPasswordProtectedByTalkChange(){this.hasUnsavedPassword&&(this.share.password=this.share.newPassword.trim()),this.queueUpdate("sendPasswordByTalk","password")},onMenuClose(){this.onPasswordSubmit(),this.onNoteSubmit()},onCancel(){this.$emit("remove:share",this.share)}}};var bs=function(){var e=this,s=e._self._c;return s("li",{staticClass:"sharing-entry sharing-entry__link",class:{"sharing-entry--share":e.share}},[s("NcAvatar",{staticClass:"sharing-entry__avatar",attrs:{"is-no-user":!0,"icon-class":e.isEmailShareType?"avatar-link-share icon-mail-white":"avatar-link-share icon-public-white"}}),s("div",{staticClass:"sharing-entry__summary"},[s("div",{staticClass:"sharing-entry__desc"},[s("span",{staticClass:"sharing-entry__title",attrs:{title:e.title}},[e._v(" "+e._s(e.title)+" ")]),e.subtitle?s("p",[e._v(" "+e._s(e.subtitle)+" ")]):e._e(),e.share&&e.share.permissions!==void 0?s("SharingEntryQuickShareSelect",{attrs:{share:e.share,"file-info":e.fileInfo},on:{"open-sharing-details":function(i){return e.openShareDetailsForCustomSettings(e.share)}}}):e._e()],1),e.share&&!e.isEmailShareType&&e.share.token?s("NcActions",{ref:"copyButton",staticClass:"sharing-entry__copy"},[s("NcActionButton",{attrs:{title:e.copyLinkTooltip,"aria-label":e.copyLinkTooltip,icon:e.copied&&e.copySuccess?"icon-checkmark-color":"icon-clippy"},on:{click:function(i){return i.preventDefault(),e.copyLink.apply(null,arguments)}}})],1):e._e()],1),!e.pending&&(e.pendingPassword||e.pendingEnforcedPassword||e.pendingExpirationDate)?s("NcActions",{staticClass:"sharing-entry__actions",attrs:{"aria-label":e.actionsTooltip,"menu-align":"right",open:e.open},on:{"update:open":function(i){e.open=i},close:e.onCancel}},[e.errors.pending?s("NcActionText",{class:{error:e.errors.pending},attrs:{icon:"icon-error"}},[e._v(" "+e._s(e.errors.pending)+" ")]):s("NcActionText",{attrs:{icon:"icon-info"}},[e._v(" "+e._s(e.t("files_sharing","Please enter the following required information before creating the share"))+" ")]),e.pendingEnforcedPassword?s("NcActionText",{attrs:{icon:"icon-password"}},[e._v(" "+e._s(e.t("files_sharing","Password protection (enforced)"))+" ")]):e.pendingPassword?s("NcActionCheckbox",{staticClass:"share-link-password-checkbox",attrs:{checked:e.isPasswordProtected,disabled:e.config.enforcePasswordForPublicLink||e.saving},on:{"update:checked":function(i){e.isPasswordProtected=i},uncheck:e.onPasswordDisable}},[e._v(" "+e._s(e.t("files_sharing","Password protection"))+" ")]):e._e(),e.pendingEnforcedPassword||e.share.password?s("NcActionInput",{staticClass:"share-link-password",attrs:{value:e.share.password,disabled:e.saving,required:e.config.enableLinkPasswordByDefault||e.config.enforcePasswordForPublicLink,minlength:e.isPasswordPolicyEnabled&&e.config.passwordPolicy.minLength,icon:"",autocomplete:"new-password"},on:{"update:value":function(i){return e.$set(e.share,"password",i)},submit:e.onNewLinkShare}},[e._v(" "+e._s(e.t("files_sharing","Enter a password"))+" ")]):e._e(),e.pendingExpirationDate?s("NcActionText",{attrs:{icon:"icon-calendar-dark"}},[e._v(" "+e._s(e.t("files_sharing","Expiration date (enforced)"))+" ")]):e._e(),e.pendingExpirationDate?s("NcActionInput",{staticClass:"share-link-expire-date",attrs:{disabled:e.saving,"is-native-picker":!0,"hide-label":!0,value:new Date(e.share.expireDate),type:"date",min:e.dateTomorrow,max:e.maxExpirationDateEnforced},on:{input:e.onExpirationChange}},[e._v(" "+e._s(e.t("files_sharing","Enter a date"))+" ")]):e._e(),s("NcActionButton",{attrs:{icon:"icon-checkmark"},on:{click:function(i){return i.preventDefault(),i.stopPropagation(),e.onNewLinkShare.apply(null,arguments)}}},[e._v(" "+e._s(e.t("files_sharing","Create share"))+" ")]),s("NcActionButton",{attrs:{icon:"icon-close"},on:{click:function(i){return i.preventDefault(),i.stopPropagation(),e.onCancel.apply(null,arguments)}}},[e._v(" "+e._s(e.t("files_sharing","Cancel"))+" ")])],1):e.loading?s("div",{staticClass:"icon-loading-small sharing-entry__loading"}):s("NcActions",{staticClass:"sharing-entry__actions",attrs:{"aria-label":e.actionsTooltip,"menu-align":"right",open:e.open},on:{"update:open":function(i){e.open=i},close:e.onMenuClose}},[e.share?[e.share.canEdit&&e.canReshare?[s("NcActionButton",{attrs:{disabled:e.saving,"close-after-click":!0},on:{click:function(i){return i.preventDefault(),e.openSharingDetails.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("Tune")]},proxy:!0}],null,!1,961531849)},[e._v(" "+e._s(e.t("files_sharing","Customize link"))+" ")])]:e._e(),s("NcActionSeparator"),e._l(e.externalLinkActions,function(i){return s("ExternalShareAction",{key:i.id,attrs:{id:i.id,action:i,"file-info":e.fileInfo,share:e.share}})}),e._l(e.externalLegacyLinkActions,function({icon:i,url:r,name:n},c){return s("NcActionLink",{key:c,attrs:{href:r(e.shareLink),icon:i,target:"_blank"}},[e._v(" "+e._s(n)+" ")])}),!e.isEmailShareType&&e.canReshare?s("NcActionButton",{staticClass:"new-share-link",attrs:{icon:"icon-add"},on:{click:function(i){return i.preventDefault(),i.stopPropagation(),e.onNewLinkShare.apply(null,arguments)}}},[e._v(" "+e._s(e.t("files_sharing","Add another link"))+" ")]):e._e(),e.share.canDelete?s("NcActionButton",{attrs:{icon:"icon-close",disabled:e.saving},on:{click:function(i){return i.preventDefault(),e.onDelete.apply(null,arguments)}}},[e._v(" "+e._s(e.t("files_sharing","Unshare"))+" ")]):e._e()]:e.canReshare?s("NcActionButton",{staticClass:"new-share-link",attrs:{title:e.t("files_sharing","Create a new share link"),"aria-label":e.t("files_sharing","Create a new share link"),icon:e.loading?"icon-loading-small":"icon-add"},on:{click:function(i){return i.preventDefault(),i.stopPropagation(),e.onNewLinkShare.apply(null,arguments)}}}):e._e()],2)],1)},As=[],Ds=A(Ts,bs,As,!1,null,"5a3f6056",null,null);const Rs=Ds.exports,Cs={name:"SharingLinkList",components:{SharingEntryLink:Rs},mixins:[O,$],props:{fileInfo:{type:Object,default:()=>{},required:!0},shares:{type:Array,default:()=>[],required:!0},canReshare:{type:Boolean,required:!0}},data(){return{canLinkShare:j().files_sharing.public.enabled}},computed:{hasLinkShares(){return this.shares.filter(e=>e.type===this.SHARE_TYPES.SHARE_TYPE_LINK).length>0},hasShares(){return this.shares.length>0}},methods:{addShare(e,s){this.shares.unshift(e),this.awaitForShare(e,s)},awaitForShare(e,s){this.$nextTick(()=>{const i=this.$children.find(r=>r.share===e);i&&s(i)})},removeShare(e){const s=this.shares.findIndex(i=>i===e);this.shares.splice(s,1)}}};var xs=function(){var e=this,s=e._self._c;return e.canLinkShare?s("ul",{staticClass:"sharing-link-list"},[!e.hasLinkShares&&e.canReshare?s("SharingEntryLink",{attrs:{"can-reshare":e.canReshare,"file-info":e.fileInfo},on:{"add:share":e.addShare}}):e._e(),e.hasShares?e._l(e.shares,function(i,r){return s("SharingEntryLink",{key:i.id,attrs:{index:e.shares.length>1?r+1:null,"can-reshare":e.canReshare,share:e.shares[r],"file-info":e.fileInfo},on:{"update:share":[function(n){return e.$set(e.shares,r,n)},function(n){return e.awaitForShare(...arguments)}],"add:share":function(n){return e.addShare(...arguments)},"remove:share":e.removeShare,"open-sharing-details":function(n){return e.openSharingDetails(i)}}})}):e._e()],2):e._e()},ks=[],Is=A(Cs,xs,ks,!1,null,null,null,null);const Ns=Is.exports,Ls={name:"SharingEntry",components:{NcButton:Ce,NcAvatar:L,DotsHorizontalIcon:Ie,NcSelect:de,SharingEntryQuickShareSelect:He},mixins:[G,$],computed:{title(){let e=this.share.shareWithDisplayName;return this.share.type===this.SHARE_TYPES.SHARE_TYPE_GROUP?e+=" (".concat(t("files_sharing","group"),")"):this.share.type===this.SHARE_TYPES.SHARE_TYPE_ROOM?e+=" (".concat(t("files_sharing","conversation"),")"):this.share.type===this.SHARE_TYPES.SHARE_TYPE_REMOTE?e+=" (".concat(t("files_sharing","remote"),")"):this.share.type===this.SHARE_TYPES.SHARE_TYPE_REMOTE_GROUP?e+=" (".concat(t("files_sharing","remote group"),")"):this.share.type===this.SHARE_TYPES.SHARE_TYPE_GUEST&&(e+=" (".concat(t("files_sharing","guest"),")")),e},tooltip(){if(this.share.owner!==this.share.uidFileOwner){const e={user:this.share.shareWithDisplayName,owner:this.share.ownerDisplayName};return this.share.type===this.SHARE_TYPES.SHARE_TYPE_GROUP?t("files_sharing","Shared with the group {user} by {owner}",e):this.share.type===this.SHARE_TYPES.SHARE_TYPE_ROOM?t("files_sharing","Shared with the conversation {user} by {owner}",e):t("files_sharing","Shared with {user} by {owner}",e)}return null},hasStatus(){return this.share.type!==this.SHARE_TYPES.SHARE_TYPE_USER?!1:typeof this.share.status=="object"&&!Array.isArray(this.share.status)}},methods:{onMenuClose(){this.onNoteSubmit()}}};var Os=function(){var e=this,s=e._self._c;return s("li",{staticClass:"sharing-entry"},[s("NcAvatar",{staticClass:"sharing-entry__avatar",attrs:{"is-no-user":e.share.type!==e.SHARE_TYPES.SHARE_TYPE_USER,user:e.share.shareWith,"display-name":e.share.shareWithDisplayName,"menu-position":"left",url:e.share.shareWithAvatar}}),s("div",{staticClass:"sharing-entry__summary"},[s(e.share.shareWithLink?"a":"div",{tag:"component",staticClass:"sharing-entry__summary__desc",attrs:{title:e.tooltip,"aria-label":e.tooltip,href:e.share.shareWithLink}},[s("span",[e._v(e._s(e.title)+" "),e.isUnique?e._e():s("span",{staticClass:"sharing-entry__summary__desc-unique"},[e._v(" ("+e._s(e.share.shareWithDisplayNameUnique)+")")]),e.hasStatus&&e.share.status.message?s("small",[e._v("("+e._s(e.share.status.message)+")")]):e._e()])]),s("SharingEntryQuickShareSelect",{attrs:{share:e.share,"file-info":e.fileInfo},on:{"open-sharing-details":function(i){return e.openShareDetailsForCustomSettings(e.share)}}})],1),s("NcButton",{staticClass:"sharing-entry__action",attrs:{"aria-label":e.t("files_sharing","Open Sharing Details"),type:"tertiary"},on:{click:function(i){return e.openSharingDetails(e.share)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("DotsHorizontalIcon",{attrs:{size:20}})]},proxy:!0}])})],1)},Hs=[],Ys=A(Ls,Os,Hs,!1,null,"279abf13",null,null);const Us=Ys.exports,Ms={name:"SharingList",components:{SharingEntry:Us},mixins:[O,$],props:{fileInfo:{type:Object,default:()=>{},required:!0},shares:{type:Array,default:()=>[],required:!0}},computed:{hasShares(){return this.shares.length===0},isUnique(){return e=>[...this.shares].filter(s=>e.type===this.SHARE_TYPES.SHARE_TYPE_USER&&e.shareWithDisplayName===s.shareWithDisplayName).length<=1}}};var Fs=function(){var e=this,s=e._self._c;return s("ul",{staticClass:"sharing-sharee-list"},e._l(e.shares,function(i){return s("SharingEntry",{key:i.id,attrs:{"file-info":e.fileInfo,share:i,"is-unique":e.isUnique(i)},on:{"open-sharing-details":function(r){return e.openSharingDetails(i)}}})}),1)},$s=[],Ws=A(Ms,Fs,$s,!1,null,null,null,null);const Bs=Ws.exports,qs={name:"SharingDetailsTab",components:{NcAvatar:L,NcButton:Ce,NcInputField:$e,NcPasswordField:We,NcDateTimePickerNative:Be,NcCheckboxRadioSwitch:qe,NcLoadingIcon:je,CloseIcon:Je,CircleIcon:ge,EditIcon:xe,LinkIcon:me,GroupIcon:Se,ShareIcon:Q,UserIcon:Ee,UploadIcon:Xe,ViewIcon:Ze,MenuDownIcon:et,MenuUpIcon:tt,DotsHorizontalIcon:Ie},mixins:[O,fe,G],props:{shareRequestValue:{type:Object,required:!1},fileInfo:{type:Object,required:!0},share:{type:Object,required:!0}},data(){return{writeNoteToRecipientIsChecked:!1,sharingPermission:P.ALL.toString(),revertSharingPermission:P.ALL.toString(),setCustomPermissions:!1,passwordError:!1,advancedSectionAccordionExpanded:!1,bundledPermissions:P,isFirstComponentLoad:!0,test:!1,creating:!1}},computed:{title(){switch(this.share.type){case this.SHARE_TYPES.SHARE_TYPE_USER:return t("files_sharing","Share with {userName}",{userName:this.share.shareWithDisplayName});case this.SHARE_TYPES.SHARE_TYPE_LINK:return t("files_sharing","Share link");case this.SHARE_TYPES.SHARE_TYPE_GROUP:return t("files_sharing","Share with group");case this.SHARE_TYPES.SHARE_TYPE_ROOM:return t("files_sharing","Share in conversation");case this.SHARE_TYPES.SHARE_TYPE_REMOTE:return t("files_sharing","Share with remote");case this.SHARE_TYPES.SHARE_TYPE_REMOTE_GROUP:return t("files_sharing","Share with remote group");case this.SHARE_TYPES.SHARE_TYPE_GUEST:return t("files_sharing","Share with guest");default:return t("files_sharing","Share with")}},canEdit:{get(){return this.share.hasUpdatePermission},set(e){this.updateAtomicPermissions({isEditChecked:e})}},canCreate:{get(){return this.share.hasCreatePermission},set(e){this.updateAtomicPermissions({isCreateChecked:e})}},canDelete:{get(){return this.share.hasDeletePermission},set(e){this.updateAtomicPermissions({isDeleteChecked:e})}},canReshare:{get(){return this.share.hasSharePermission},set(e){this.updateAtomicPermissions({isReshareChecked:e})}},canDownload:{get(){return this.share.hasDownloadPermission},set(e){this.updateAtomicPermissions({isDownloadChecked:e})}},hasRead:{get(){return this.share.hasReadPermission},set(e){this.updateAtomicPermissions({isReadChecked:e})}},hasExpirationDate:{get(){return this.isValidShareAttribute(this.share.expireDate)},set(e){this.share.expireDate=e?this.formatDateToString(this.defaultExpiryDate):""}},isPasswordProtected:{get(){return this.config.enforcePasswordForPublicLink||!!this.share.password},async set(e){e?(this.share.password=await V(),this.$set(this.share,"newPassword",this.share.password)):(this.share.password="",this.$delete(this.share,"newPassword"))}},isFolder(){return this.fileInfo.type==="dir"},isSetDownloadButtonVisible(){const e=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation"];return this.isFolder||e.includes(this.fileInfo.mimetype)},isPasswordEnforced(){return this.isPublicShare&&this.config.enforcePasswordForPublicLink},defaultExpiryDate(){return(this.isGroupShare||this.isUserShare)&&this.config.isDefaultInternalExpireDateEnabled?new Date(this.config.defaultInternalExpirationDate):this.isRemoteShare&&this.config.isDefaultRemoteExpireDateEnabled?new Date(this.config.defaultRemoteExpireDateEnabled):this.isPublicShare&&this.config.isDefaultExpireDateEnabled?new Date(this.config.defaultExpirationDate):new Date(new Date().setDate(new Date().getDate()+1))},isUserShare(){return this.share.type===this.SHARE_TYPES.SHARE_TYPE_USER},isGroupShare(){return this.share.type===this.SHARE_TYPES.SHARE_TYPE_GROUP},isNewShare(){return this.share.id===null||this.share.id===void 0},allowsFileDrop(){return!!(this.isFolder&&this.config.isPublicUploadEnabled&&(this.share.type===this.SHARE_TYPES.SHARE_TYPE_LINK||this.share.type===this.SHARE_TYPES.SHARE_TYPE_EMAIL))},hasFileDropPermissions(){return this.share.permissions===this.bundledPermissions.FILE_DROP},shareButtonText(){return this.isNewShare?t("files_sharing","Save share"):t("files_sharing","Update share")},canSetEdit(){return this.fileInfo.sharePermissions&OC.PERMISSION_UPDATE||this.canEdit},canSetCreate(){return this.fileInfo.sharePermissions&OC.PERMISSION_CREATE||this.canCreate},canSetDelete(){return this.fileInfo.sharePermissions&OC.PERMISSION_DELETE||this.canDelete},canSetReshare(){return this.fileInfo.sharePermissions&OC.PERMISSION_SHARE||this.canReshare},canSetDownload(){return this.fileInfo.canDownload()||this.canDownload},hasUnsavedPassword(){return this.share.newPassword!==void 0},passwordExpirationTime(){if(!this.isValidShareAttribute(this.share.passwordExpirationTime))return null;const e=moment(this.share.passwordExpirationTime);return e.diff(moment())<0?!1:e.fromNow()},isTalkEnabled(){return OC.appswebroots.spreed!==void 0},isPasswordProtectedByTalkAvailable(){return this.isPasswordProtected&&this.isTalkEnabled},isPasswordProtectedByTalk:{get(){return this.share.sendPasswordByTalk},async set(e){this.share.sendPasswordByTalk=e}},isEmailShareType(){return this.share?this.share.type===this.SHARE_TYPES.SHARE_TYPE_EMAIL:!1},canTogglePasswordProtectedByTalkAvailable(){return!this.isPublicShare||!this.isPasswordProtected||this.isEmailShareType&&!this.hasUnsavedPassword?!1:OC.appswebroots.spreed!==void 0},canChangeHideDownload(){const e=s=>s.key==="download"&&s.scope==="permissions"&&s.enabled===!1;return this.fileInfo.shareAttributes.some(e)},customPermissionsList(){const e={[m.READ]:this.t("files_sharing","Read"),[m.CREATE]:this.t("files_sharing","Create"),[m.UPDATE]:this.t("files_sharing","Edit"),[m.SHARE]:this.t("files_sharing","Share"),[m.DELETE]:this.t("files_sharing","Delete")};return[m.READ,m.CREATE,m.UPDATE,m.SHARE,m.DELETE].filter(s=>rs(this.share.permissions,s)).map((s,i)=>i===0?e[s]:e[s].toLocaleLowerCase(Ve())).join(", ")},advancedControlExpandedValue(){return this.advancedSectionAccordionExpanded?"true":"false"},errorPasswordLabel(){if(this.passwordError)return t("files_sharing","Password field can't be empty")}},watch:{setCustomPermissions(e){e?this.sharingPermission="custom":this.sharingPermission=this.revertSharingPermission}},beforeMount(){this.initializePermissions(),this.initializeAttributes(),console.debug("shareSentIn",this.share),console.debug("config",this.config)},mounted(){var e,s;(s=(e=this.$refs.quickPermissions)==null?void 0:e.querySelector("input:checked"))==null||s.focus()},methods:{updateAtomicPermissions({isReadChecked:e=this.hasRead,isEditChecked:s=this.canEdit,isCreateChecked:i=this.canCreate,isDeleteChecked:r=this.canDelete,isReshareChecked:n=this.canReshare,isDownloadChecked:c=this.canDownload}={}){const d=0|(e?m.READ:0)|(i?m.CREATE:0)|(r?m.DELETE:0)|(s?m.UPDATE:0)|(n?m.SHARE:0);this.share.permissions=d,this.share.hasDownloadPermission!==c&&this.$set(this.share,"hasDownloadPermission",c)},expandCustomPermissions(){this.advancedSectionAccordionExpanded||(this.advancedSectionAccordionExpanded=!0),this.toggleCustomPermissions()},toggleCustomPermissions(e){const s=this.sharingPermission==="custom";this.revertSharingPermission=s?"custom":e,this.setCustomPermissions=s},async initializeAttributes(){if(this.isNewShare){this.isPasswordEnforced&&this.isPublicShare&&(this.share.newPassword=await V(),this.advancedSectionAccordionExpanded=!0),this.isPublicShare&&this.config.isDefaultExpireDateEnabled?this.share.expireDate=this.config.defaultExpirationDate.toDateString():this.isRemoteShare&&this.config.isDefaultRemoteExpireDateEnabled?this.share.expireDate=this.config.defaultRemoteExpirationDateString.toDateString():this.config.isDefaultInternalExpireDateEnabled&&(this.share.expireDate=this.config.defaultInternalExpirationDate.toDateString()),this.isValidShareAttribute(this.share.expireDate)&&(this.advancedSectionAccordionExpanded=!0);return}!this.isValidShareAttribute(this.share.expireDate)&&this.isExpiryDateEnforced&&(this.hasExpirationDate=!0),(this.isValidShareAttribute(this.share.password)||this.isValidShareAttribute(this.share.expireDate)||this.isValidShareAttribute(this.share.label))&&(this.advancedSectionAccordionExpanded=!0)},handleShareType(){this.share.share_type&&(this.share.type=this.share.share_type),"shareType"in this.share&&(this.share.type=this.share.shareType)},handleDefaultPermissions(){if(this.isNewShare){const e=this.config.defaultPermissions;e===P.READ_ONLY||e===P.ALL?this.sharingPermission=e.toString():(this.sharingPermission="custom",this.share.permissions=e,this.advancedSectionAccordionExpanded=!0,this.setCustomPermissions=!0)}},handleCustomPermissions(){!this.isNewShare&&(this.hasCustomPermissions||this.share.setCustomPermissions)?(this.sharingPermission="custom",this.advancedSectionAccordionExpanded=!0,this.setCustomPermissions=!0):this.sharingPermission=this.share.permissions.toString()},initializePermissions(){this.handleShareType(),this.handleDefaultPermissions(),this.handleCustomPermissions()},async saveShare(){const e=["permissions","attributes","note","expireDate"],s=["label","password","hideDownload"];this.isPublicShare&&e.push(...s);const i=parseInt(this.sharingPermission);if(this.setCustomPermissions?this.updateAtomicPermissions():this.share.permissions=i,!this.isFolder&&this.share.permissions===P.ALL&&(this.share.permissions=P.ALL_FILE),this.writeNoteToRecipientIsChecked||(this.share.note=""),this.isPasswordProtected?this.hasUnsavedPassword&&this.isValidShareAttribute(this.share.newPassword)?(this.share.password=this.share.newPassword,this.$delete(this.share,"newPassword")):this.isPasswordEnforced&&!this.isValidShareAttribute(this.share.password)&&(this.passwordError=!0):this.share.password="",this.hasExpirationDate||(this.share.expireDate=""),this.isNewShare){const r={permissions:this.share.permissions,shareType:this.share.type,shareWith:this.share.shareWith,attributes:this.share.attributes,note:this.share.note,fileInfo:this.fileInfo};this.hasExpirationDate&&(r.expireDate=this.share.expireDate),this.isPasswordProtected&&(r.password=this.share.password),this.creating=!0;const n=await this.addShare(r,this.fileInfo);this.creating=!1,this.share=n,this.$emit("add:share",this.share)}else this.queueUpdate(...e);this.$emit("close-sharing-details")},async addShare(e,s){console.debug("Adding a new share from the input for",e);try{const i=(s.path+"/"+s.name).replace("//","/");return await this.createShare({path:i,shareType:e.shareType,shareWith:e.shareWith,permissions:e.permissions,attributes:JSON.stringify(s.shareAttributes),...e.note?{note:e.note}:{},...e.password?{password:e.password}:{},...e.expireDate?{expireDate:e.expireDate}:{}})}catch(i){console.error("Error while adding new share",i)}finally{}},async removeShare(){await this.onDelete(),this.$emit("close-sharing-details")},onPasswordChange(e){this.passwordError=!this.isValidShareAttribute(e),this.$set(this.share,"newPassword",e)},onPasswordProtectedByTalkChange(){this.hasUnsavedPassword&&(this.share.password=this.share.newPassword.trim()),this.queueUpdate("sendPasswordByTalk","password")},isValidShareAttribute(e){return!([null,void 0].includes(e)||!(e.trim().length>0))},getShareTypeIcon(e){switch(e){case this.SHARE_TYPES.SHARE_TYPE_LINK:return me;case this.SHARE_TYPES.SHARE_TYPE_GUEST:return Ee;case this.SHARE_TYPES.SHARE_TYPE_REMOTE_GROUP:case this.SHARE_TYPES.SHARE_TYPE_GROUP:return Se;case this.SHARE_TYPES.SHARE_TYPE_EMAIL:return st;case this.SHARE_TYPES.SHARE_TYPE_CIRCLE:return ge;case this.SHARE_TYPES.SHARE_TYPE_ROOM:return Q;case this.SHARE_TYPES.SHARE_TYPE_DECK:return Q;case this.SHARE_TYPES.SHARE_TYPE_SCIENCEMESH:return Q;default:return null}}}};var js=function(){var i;var e=this,s=e._self._c;return s("div",{staticClass:"sharingTabDetailsView"},[s("div",{staticClass:"sharingTabDetailsView__header"},[s("span",[e.isUserShare?s("NcAvatar",{staticClass:"sharing-entry__avatar",attrs:{"is-no-user":e.share.shareType!==e.SHARE_TYPES.SHARE_TYPE_USER,user:e.share.shareWith,"display-name":e.share.shareWithDisplayName,"menu-position":"left",url:e.share.shareWithAvatar}}):e._e(),s(e.getShareTypeIcon(e.share.type),{tag:"component",attrs:{size:32}})],1),s("span",[s("h1",[e._v(e._s(e.title))])])]),s("div",{staticClass:"sharingTabDetailsView__wrapper"},[s("div",{ref:"quickPermissions",staticClass:"sharingTabDetailsView__quick-permissions"},[s("div",[s("NcCheckboxRadioSwitch",{attrs:{"button-variant":!0,checked:e.sharingPermission,value:e.bundledPermissions.READ_ONLY.toString(),name:"sharing_permission_radio",type:"radio","button-variant-grouped":"vertical"},on:{"update:checked":[function(r){e.sharingPermission=r},e.toggleCustomPermissions]},scopedSlots:e._u([{key:"icon",fn:function(){return[s("ViewIcon",{attrs:{size:20}})]},proxy:!0}])},[e._v(" "+e._s(e.t("files_sharing","View only"))+" ")]),s("NcCheckboxRadioSwitch",{attrs:{"button-variant":!0,checked:e.sharingPermission,value:e.bundledPermissions.ALL.toString(),name:"sharing_permission_radio",type:"radio","button-variant-grouped":"vertical"},on:{"update:checked":[function(r){e.sharingPermission=r},e.toggleCustomPermissions]},scopedSlots:e._u([{key:"icon",fn:function(){return[s("EditIcon",{attrs:{size:20}})]},proxy:!0}])},[e.allowsFileDrop?[e._v(" "+e._s(e.t("files_sharing","Allow upload and editing"))+" ")]:[e._v(" "+e._s(e.t("files_sharing","Allow editing"))+" ")]],2),e.allowsFileDrop?s("NcCheckboxRadioSwitch",{attrs:{"button-variant":!0,checked:e.sharingPermission,value:e.bundledPermissions.FILE_DROP.toString(),name:"sharing_permission_radio",type:"radio","button-variant-grouped":"vertical"},on:{"update:checked":[function(r){e.sharingPermission=r},e.toggleCustomPermissions]},scopedSlots:e._u([{key:"icon",fn:function(){return[s("UploadIcon",{attrs:{size:20}})]},proxy:!0}],null,!1,1083194048)},[e._v(" "+e._s(e.t("files_sharing","File drop"))+" "),s("small",{staticClass:"subline"},[e._v(e._s(e.t("files_sharing","Upload only")))])]):e._e(),s("NcCheckboxRadioSwitch",{attrs:{"button-variant":!0,checked:e.sharingPermission,value:"custom",name:"sharing_permission_radio",type:"radio","button-variant-grouped":"vertical"},on:{"update:checked":[function(r){e.sharingPermission=r},e.expandCustomPermissions]},scopedSlots:e._u([{key:"icon",fn:function(){return[s("DotsHorizontalIcon",{attrs:{size:20}})]},proxy:!0}])},[e._v(" "+e._s(e.t("files_sharing","Custom permissions"))+" "),s("small",{staticClass:"subline"},[e._v(e._s(e.customPermissionsList))])])],1)]),s("div",{staticClass:"sharingTabDetailsView__advanced-control"},[s("NcButton",{attrs:{id:"advancedSectionAccordionAdvancedControl",type:"tertiary",alignment:"end-reverse","aria-controls":"advancedSectionAccordionAdvanced","aria-expanded":e.advancedControlExpandedValue},on:{click:function(r){e.advancedSectionAccordionExpanded=!e.advancedSectionAccordionExpanded}},scopedSlots:e._u([{key:"icon",fn:function(){return[e.advancedSectionAccordionExpanded?s("MenuUpIcon"):s("MenuDownIcon")]},proxy:!0}])},[e._v(" "+e._s(e.t("files_sharing","Advanced settings"))+" ")])],1),e.advancedSectionAccordionExpanded?s("div",{staticClass:"sharingTabDetailsView__advanced",attrs:{id:"advancedSectionAccordionAdvanced","aria-labelledby":"advancedSectionAccordionAdvancedControl",role:"region"}},[s("section",[e.isPublicShare?s("NcInputField",{attrs:{value:e.share.label,type:"text",label:e.t("files_sharing","Share label")},on:{"update:value":function(r){return e.$set(e.share,"label",r)}}}):e._e(),e.isPublicShare?[s("NcCheckboxRadioSwitch",{attrs:{checked:e.isPasswordProtected,disabled:e.isPasswordEnforced},on:{"update:checked":function(r){e.isPasswordProtected=r}}},[e._v(" "+e._s(e.t("files_sharing","Set password"))+" ")]),e.isPasswordProtected?s("NcPasswordField",{attrs:{value:e.hasUnsavedPassword?e.share.newPassword:"",error:e.passwordError,"helper-text":e.errorPasswordLabel,required:e.isPasswordEnforced,label:e.t("files_sharing","Password")},on:{"update:value":e.onPasswordChange}}):e._e(),e.isEmailShareType&&e.passwordExpirationTime?s("span",{attrs:{icon:"icon-info"}},[e._v(" "+e._s(e.t("files_sharing","Password expires {passwordExpirationTime}",{passwordExpirationTime:e.passwordExpirationTime}))+" ")]):e.isEmailShareType&&e.passwordExpirationTime!==null?s("span",{attrs:{icon:"icon-error"}},[e._v(" "+e._s(e.t("files_sharing","Password expired"))+" ")]):e._e()]:e._e(),e.canTogglePasswordProtectedByTalkAvailable?s("NcCheckboxRadioSwitch",{attrs:{checked:e.isPasswordProtectedByTalk},on:{"update:checked":[function(r){e.isPasswordProtectedByTalk=r},e.onPasswordProtectedByTalkChange]}},[e._v(" "+e._s(e.t("files_sharing","Video verification"))+" ")]):e._e(),s("NcCheckboxRadioSwitch",{attrs:{checked:e.hasExpirationDate,disabled:e.isExpiryDateEnforced},on:{"update:checked":function(r){e.hasExpirationDate=r}}},[e._v(" "+e._s(e.isExpiryDateEnforced?e.t("files_sharing","Expiration date (enforced)"):e.t("files_sharing","Set expiration date"))+" ")]),e.hasExpirationDate?s("NcDateTimePickerNative",{attrs:{id:"share-date-picker",value:new Date((i=e.share.expireDate)!=null?i:e.dateTomorrow),min:e.dateTomorrow,max:e.maxExpirationDateEnforced,"hide-label":!0,placeholder:e.t("files_sharing","Expiration date"),type:"date"},on:{input:e.onExpirationChange}}):e._e(),e.isPublicShare?s("NcCheckboxRadioSwitch",{attrs:{disabled:e.canChangeHideDownload,checked:e.share.hideDownload},on:{"update:checked":[function(r){return e.$set(e.share,"hideDownload",r)},function(r){return e.queueUpdate("hideDownload")}]}},[e._v(" "+e._s(e.t("files_sharing","Hide download"))+" ")]):e._e(),e.isPublicShare?e._e():s("NcCheckboxRadioSwitch",{attrs:{disabled:!e.canSetDownload,checked:e.canDownload},on:{"update:checked":function(r){e.canDownload=r}}},[e._v(" "+e._s(e.t("files_sharing","Allow download"))+" ")]),s("NcCheckboxRadioSwitch",{attrs:{checked:e.writeNoteToRecipientIsChecked},on:{"update:checked":function(r){e.writeNoteToRecipientIsChecked=r}}},[e._v(" "+e._s(e.t("files_sharing","Note to recipient"))+" ")]),e.writeNoteToRecipientIsChecked?[s("label",{attrs:{for:"share-note-textarea"}},[e._v(" "+e._s(e.t("files_sharing","Enter a note for the share recipient"))+" ")]),s("textarea",{attrs:{id:"share-note-textarea"},domProps:{value:e.share.note},on:{input:function(r){e.share.note=r.target.value}}})]:e._e(),s("NcCheckboxRadioSwitch",{attrs:{checked:e.setCustomPermissions},on:{"update:checked":function(r){e.setCustomPermissions=r}}},[e._v(" "+e._s(e.t("files_sharing","Custom permissions"))+" ")]),e.setCustomPermissions?s("section",{staticClass:"custom-permissions-group"},[s("NcCheckboxRadioSwitch",{attrs:{disabled:!e.allowsFileDrop&&e.share.type===e.SHARE_TYPES.SHARE_TYPE_LINK,checked:e.hasRead},on:{"update:checked":function(r){e.hasRead=r}}},[e._v(" "+e._s(e.t("files_sharing","Read"))+" ")]),e.isFolder?s("NcCheckboxRadioSwitch",{attrs:{disabled:!e.canSetCreate,checked:e.canCreate},on:{"update:checked":function(r){e.canCreate=r}}},[e._v(" "+e._s(e.t("files_sharing","Create"))+" ")]):e._e(),s("NcCheckboxRadioSwitch",{attrs:{disabled:!e.canSetEdit,checked:e.canEdit},on:{"update:checked":function(r){e.canEdit=r}}},[e._v(" "+e._s(e.t("files_sharing","Edit"))+" ")]),e.config.isResharingAllowed&&e.share.type!==e.SHARE_TYPES.SHARE_TYPE_LINK?s("NcCheckboxRadioSwitch",{attrs:{disabled:!e.canSetReshare,checked:e.canReshare},on:{"update:checked":function(r){e.canReshare=r}}},[e._v(" "+e._s(e.t("files_sharing","Share"))+" ")]):e._e(),s("NcCheckboxRadioSwitch",{attrs:{disabled:!e.canSetDelete,checked:e.canDelete},on:{"update:checked":function(r){e.canDelete=r}}},[e._v(" "+e._s(e.t("files_sharing","Delete"))+" ")])],1):e._e(),s("div",{staticClass:"sharingTabDetailsView__delete"},[e.isNewShare?e._e():s("NcButton",{attrs:{"aria-label":e.t("files_sharing","Delete share"),disabled:!1,readonly:!1,type:"tertiary"},on:{click:function(r){return r.preventDefault(),e.removeShare.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("CloseIcon",{attrs:{size:16}})]},proxy:!0}],null,!1,2746485232)},[e._v(" "+e._s(e.t("files_sharing","Delete share"))+" ")])],1)],2)]):e._e()]),s("div",{staticClass:"sharingTabDetailsView__footer"},[s("div",{staticClass:"button-group"},[s("NcButton",{on:{click:function(r){return e.$emit("close-sharing-details")}}},[e._v(" "+e._s(e.t("files_sharing","Cancel"))+" ")]),s("NcButton",{attrs:{type:"primary"},on:{click:e.saveShare},scopedSlots:e._u([e.creating?{key:"icon",fn:function(){return[s("NcLoadingIcon")]},proxy:!0}:null],null,!0)},[e._v(" "+e._s(e.shareButtonText)+" ")])],1)])])},Vs=[],Gs=A(qs,js,Vs,!1,null,"3fd7e8a9",null,null);const zs=Gs.exports,Ks={name:"SharingTab",components:{NcAvatar:L,CollectionList:Wt,SharingEntryInternal:Xt,SharingEntrySimple:te,SharingInherited:fs,SharingInput:is,SharingLinkList:Ns,SharingList:Bs,SharingDetailsTab:zs},mixins:[O],data(){return{config:new ee,deleteEvent:null,error:"",expirationInterval:null,loading:!0,fileInfo:null,reshare:null,sharedWithMe:{},shares:[],linkShares:[],sections:OCA.Sharing.ShareTabSections.getSections(),projectsEnabled:Ge("core","projects_enabled",!1),showSharingDetailsView:!1,shareDetailsData:{},returnFocusElement:null}},computed:{isSharedWithMe(){return Object.keys(this.sharedWithMe).length>0},canReshare(){return!!(this.fileInfo.permissions&OC.PERMISSION_SHARE)||!!(this.reshare&&this.reshare.hasSharePermission&&this.config.isResharingAllowed)}},methods:{async update(e){this.fileInfo=e,this.resetState(),this.getShares()},async getShares(){var e,s,i;try{this.loading=!0;const r=C("apps/files_sharing/api/v1/shares"),n="json",c=(this.fileInfo.path+"/"+this.fileInfo.name).replace("//","/"),d=k.get(r,{params:{format:n,path:c,reshares:!0}}),o=k.get(r,{params:{format:n,path:c,shared_with_me:!0}}),[p,_]=await Promise.all([d,o]);this.loading=!1,this.processSharedWithMe(_),this.processShares(p)}catch(r){(i=(s=(e=r.response.data)==null?void 0:e.ocs)==null?void 0:s.meta)!=null&&i.message?this.error=r.response.data.ocs.meta.message:this.error=t("files_sharing","Unable to load the shares list"),this.loading=!1,console.error("Error loading the shares list",r)}},resetState(){clearInterval(this.expirationInterval),this.loading=!0,this.error="",this.sharedWithMe={},this.shares=[],this.linkShares=[],this.showSharingDetailsView=!1,this.shareDetailsData={}},updateExpirationSubtitle(e){const s=moment(e.expireDate).unix();this.$set(this.sharedWithMe,"subtitle",t("files_sharing","Expires {relativetime}",{relativetime:OC.Util.relativeModifiedDate(s*1e3)})),moment().unix()>s&&(clearInterval(this.expirationInterval),this.$set(this.sharedWithMe,"subtitle",t("files_sharing","this share just expired.")))},processShares({data:e}){if(e.ocs&&e.ocs.data&&e.ocs.data.length>0){const s=e.ocs.data.map(i=>new b(i)).sort((i,r)=>r.createdTime-i.createdTime);this.linkShares=s.filter(i=>i.type===this.SHARE_TYPES.SHARE_TYPE_LINK||i.type===this.SHARE_TYPES.SHARE_TYPE_EMAIL),this.shares=s.filter(i=>i.type!==this.SHARE_TYPES.SHARE_TYPE_LINK&&i.type!==this.SHARE_TYPES.SHARE_TYPE_EMAIL),console.debug("Processed",this.linkShares.length,"link share(s)"),console.debug("Processed",this.shares.length,"share(s)")}},processSharedWithMe({data:e}){if(e.ocs&&e.ocs.data&&e.ocs.data[0]){const s=new b(e),i=Bt(s),r=s.ownerDisplayName,n=s.owner;this.sharedWithMe={displayName:r,title:i,user:n},this.reshare=s,s.expireDate&&moment(s.expireDate).unix()>moment().unix()&&(this.updateExpirationSubtitle(s),this.expirationInterval=setInterval(this.updateExpirationSubtitle,1e4,s))}else this.fileInfo&&this.fileInfo.shareOwnerId!==void 0&&this.fileInfo.shareOwnerId!==OC.currentUser&&(this.sharedWithMe={displayName:this.fileInfo.shareOwner,title:t("files_sharing","Shared with you by {owner}",{owner:this.fileInfo.shareOwner},void 0,{escape:!1}),user:this.fileInfo.shareOwnerId})},addShare(e,s=()=>{}){e.type===this.SHARE_TYPES.SHARE_TYPE_EMAIL?this.linkShares.unshift(e):this.shares.unshift(e),this.awaitForShare(e,s)},removeShare(e){const s=e.type===this.SHARE_TYPES.SHARE_TYPE_EMAIL||e.type===this.SHARE_TYPES.SHARE_TYPE_LINK?this.linkShares:this.shares,i=s.findIndex(r=>r.id===e.id);i!==-1&&s.splice(i,1)},awaitForShare(e,s){this.$nextTick(()=>{let i=this.$refs.shareList;e.type===this.SHARE_TYPES.SHARE_TYPE_EMAIL&&(i=this.$refs.linkShareList);const r=i.$children.find(n=>n.share===e);r&&s(r)})},toggleShareDetailsView(e){var s;if(!this.showSharingDetailsView)if(Array.from(document.activeElement.classList).some(i=>i.startsWith("action-"))){const i=(s=document.activeElement.closest('[role="menu"]'))==null?void 0:s.id;this.returnFocusElement=document.querySelector('[aria-controls="'.concat(i,'"]'))}else this.returnFocusElement=document.activeElement;e&&(this.shareDetailsData=e),this.showSharingDetailsView=!this.showSharingDetailsView,this.showSharingDetailsView||this.$nextTick(()=>{var i;(i=this.returnFocusElement)==null||i.focus(),this.returnFocusElement=null})}}};var Qs=function(){var e=this,s=e._self._c;return s("div",{staticClass:"sharingTab",class:{"icon-loading":e.loading}},[e.error?s("div",{staticClass:"emptycontent",class:{emptyContentWithSections:e.sections.length>0}},[s("div",{staticClass:"icon icon-error"}),s("h2",[e._v(e._s(e.error))])]):e._e(),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.showSharingDetailsView,expression:"!showSharingDetailsView"}],staticClass:"sharingTab__content"},[s("ul",[e.isSharedWithMe?s("SharingEntrySimple",e._b({staticClass:"sharing-entry__reshare",scopedSlots:e._u([{key:"avatar",fn:function(){return[s("NcAvatar",{staticClass:"sharing-entry__avatar",attrs:{user:e.sharedWithMe.user,"display-name":e.sharedWithMe.displayName}})]},proxy:!0}],null,!1,3197855346)},"SharingEntrySimple",e.sharedWithMe,!1)):e._e()],1),e.loading?e._e():s("SharingInput",{attrs:{"can-reshare":e.canReshare,"file-info":e.fileInfo,"link-shares":e.linkShares,reshare:e.reshare,shares:e.shares},on:{"open-sharing-details":e.toggleShareDetailsView}}),e.loading?e._e():s("SharingLinkList",{ref:"linkShareList",attrs:{"can-reshare":e.canReshare,"file-info":e.fileInfo,shares:e.linkShares},on:{"open-sharing-details":e.toggleShareDetailsView}}),e.loading?e._e():s("SharingList",{ref:"shareList",attrs:{shares:e.shares,"file-info":e.fileInfo},on:{"open-sharing-details":e.toggleShareDetailsView}}),e.canReshare&&!e.loading?s("SharingInherited",{attrs:{"file-info":e.fileInfo}}):e._e(),s("SharingEntryInternal",{attrs:{"file-info":e.fileInfo}}),e.projectsEnabled&&e.fileInfo?s("CollectionList",{attrs:{id:"".concat(e.fileInfo.id),type:"file",name:e.fileInfo.name}}):e._e()],1),e._l(e.sections,function(i,r){return s("div",{directives:[{name:"show",rawName:"v-show",value:!e.showSharingDetailsView,expression:"!showSharingDetailsView"}],key:r,ref:"section-"+r,refInFor:!0,staticClass:"sharingTab__additionalContent"},[s(i(e.$refs["section-"+r],e.fileInfo),{tag:"component",attrs:{"file-info":e.fileInfo}})],1)}),e.showSharingDetailsView?s("SharingDetailsTab",{attrs:{"file-info":e.shareDetailsData.fileInfo,share:e.shareDetailsData.share},on:{"close-sharing-details":e.toggleShareDetailsView,"add:share":e.addShare,"remove:share":e.removeShare}}):e._e()],2)},Js=[],Xs=A(Ks,Qs,Js,!1,null,"4a9f79ac",null,null);const hi=Xs.exports;export{hi as default};
