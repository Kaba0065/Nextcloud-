/*! third party licenses: dist/vendor.LICENSE.txt */
import{aM as I,bg as y,aJ as m,bm as ce,b5 as H,bC as ue,R as de,V as pe,bO as te,bD as ie,bR as R,bw as le,ba as fe,F as ne,G as se,X as me,w as ve,J as _e,D as ge,ad as he,aj as ye,bS as we,bT as ee,bL as Ce,a_ as be,O as ke}from"../core-common.mjs";import{e as M,u as Fe,v as D,d as Se,o as xe,s as Ne,R as $,Y as Be}from"./index-BLIV22dB.mjs";import{u as C,v as Le}from"./toast-7xJhDYMn-BrG8uCqw.mjs";import{p as Pe}from"./index-Ca0QcE7e.mjs";import"./index-DgCiVkaQ.mjs";import"./index-Biv1VH4I.mjs";function b(e,i,t,l,n,a,o,v){var s=typeof e=="function"?e.options:e;i&&(s.render=i,s.staticRenderFns=t,s._compiled=!0),l&&(s.functional=!0),a&&(s._scopeId="data-v-"+a);var u;if(o?(u=function(f){f=f||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!f&&typeof __VUE_SSR_CONTEXT__<"u"&&(f=__VUE_SSR_CONTEXT__),n&&n.call(this,f),f&&f._registeredComponents&&f._registeredComponents.add(o)},s._ssrRegister=u):n&&(u=v?function(){n.call(this,(s.functional?this.parent:this).$root.$options.shadowRoot)}:n),u)if(s.functional){s._injectStyles=u;var c=s.render;s.render=function(f,h){return u.call(h),c(f,h)}}else{var k=s.beforeCreate;s.beforeCreate=k?[].concat(k,u):[u]}return{exports:e,options:s}}const ze={name:"FileIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Ie=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon file-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},Ve=[],$e=b(ze,Ie,Ve,!1,null,null,null,null);const ae=$e.exports,re=()=>{var n,a,o;const e=te("files","config",null),i=y((n=e==null?void 0:e.show_hidden)!=null?n:!1),t=y((a=e==null?void 0:e.sort_favorites_first)!=null?a:!0),l=y((o=e==null?void 0:e.crop_image_previews)!=null?o:!0);return H(()=>{ie.get(R("/apps/files/api/v1/configs")).then(v=>{var s,u,c,k,f,h,F,x,S;i.value=(c=(u=(s=v.data)==null?void 0:s.data)==null?void 0:u.show_hidden)!=null?c:!1,t.value=(h=(f=(k=v.data)==null?void 0:k.data)==null?void 0:f.sort_favorites_first)!=null?h:!0,l.value=(S=(x=(F=v.data)==null?void 0:F.data)==null?void 0:x.crop_image_previews)!=null?S:!0})}),{showHiddenFiles:i,sortFavoritesFirst:t,cropImagePreviews:l}},He=e=>{var u,c,k,f,h,F,x,S,V,L,N,p;const i=w=>w==="asc"?"ascending":w==="desc"?"descending":"none",t=te("files","viewConfigs",null),l=y({sortBy:(c=(u=t==null?void 0:t.files)==null?void 0:u.sorting_mode)!=null?c:"basename",order:i((f=(k=t==null?void 0:t.files)==null?void 0:k.sorting_direction)!=null?f:"asc")}),n=y({sortBy:(F=(h=t==null?void 0:t.recent)==null?void 0:h.sorting_mode)!=null?F:"basename",order:i((S=(x=t==null?void 0:t.recent)==null?void 0:x.sorting_direction)!=null?S:"asc")}),a=y({sortBy:(L=(V=t==null?void 0:t.favorites)==null?void 0:V.sorting_mode)!=null?L:"basename",order:i((p=(N=t==null?void 0:t.favorites)==null?void 0:N.sorting_direction)!=null?p:"asc")});H(()=>{ie.get(R("/apps/files/api/v1/views")).then(w=>{var _,g,r,d,B,P,z,E,T,O,Z,U,j,X,J,K,G,W,q,Y,Q;l.value={sortBy:(d=(r=(g=(_=w.data)==null?void 0:_.data)==null?void 0:g.files)==null?void 0:r.sorting_mode)!=null?d:"basename",order:i((z=(P=(B=w.data)==null?void 0:B.data)==null?void 0:P.files)==null?void 0:z.sorting_direction)},a.value={sortBy:(Z=(O=(T=(E=w.data)==null?void 0:E.data)==null?void 0:T.favorites)==null?void 0:O.sorting_mode)!=null?Z:"basename",order:i((X=(j=(U=w.data)==null?void 0:U.data)==null?void 0:j.favorites)==null?void 0:X.sorting_direction)},n.value={sortBy:(W=(G=(K=(J=w.data)==null?void 0:J.data)==null?void 0:K.recent)==null?void 0:G.sorting_mode)!=null?W:"basename",order:i((Q=(Y=(q=w.data)==null?void 0:q.data)==null?void 0:Y.recent)==null?void 0:Q.sorting_direction)}})});const o=m(()=>ee(e||"files")==="files"?l.value:ee(e)==="recent"?n.value:a.value),v=m(()=>o.value.sortBy),s=m(()=>o.value.order);return{filesViewConfig:l,favoritesViewConfig:a,recentViewConfig:n,currentConfig:o,sortBy:v,order:s}},De={name:"MenuUpIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Me=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon menu-up-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M7,15L12,10L17,15H7Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},Re=[],Ae=b(De,Me,Re,!1,null,null,null,null);const Ee=Ae.exports,Te={name:"MenuDownIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Oe=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon menu-down-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M7,10L12,15L17,10H7Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},Ze=[],Ue=b(Te,Oe,Ze,!1,null,null,null,null);const je=Ue.exports,oe={"file-picker__file-icon":"_file-picker__file-icon_1vgv4_5"},Xe=I({__name:"LoadingTableRow",props:{showCheckbox:{type:Boolean}},setup(e){return{__sfc:!0,fileListIconStyles:oe}}});var Je=function(){var e=this,i=e._self._c,t=e._self._setupProxy;return i("tr",{staticClass:"file-picker__row loading-row",attrs:{"aria-hidden":"true"}},[e.showCheckbox?i("td",{staticClass:"row-checkbox"},[i("span")]):e._e(),i("td",{staticClass:"row-name"},[i("div",{staticClass:"row-wrapper"},[i("span",{class:t.fileListIconStyles["file-picker__file-icon"]}),i("span")])]),e._m(0),e._m(1)])},Ke=[function(){var e=this,i=e._self._c;return e._self._setupProxy,i("td",{staticClass:"row-size"},[i("span")])},function(){var e=this,i=e._self._c;return e._self._setupProxy,i("td",{staticClass:"row-modified"},[i("span")])}],Ge=b(Xe,Je,Ke,!1,null,"6aded0d9",null,null);const We=Ge.exports;function qe(e,i={}){var t;i={size:32,cropPreview:!1,mimeFallback:!0,...i};try{const l=((t=e.attributes)==null?void 0:t.previewUrl)||R("/core/preview?fileId={fileid}",{fileid:e.fileid});let n;try{n=new URL(l)}catch{n=new URL(l,window.location.origin)}return n.searchParams.set("x","".concat(i.size)),n.searchParams.set("y","".concat(i.size)),n.searchParams.set("mimeFallback","".concat(i.mimeFallback)),n.searchParams.set("a",i.cropPreview===!0?"0":"1"),n.searchParams.set("c","".concat(e.attributes.etag)),n}catch{return null}}const Ye={name:"FolderIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Qe=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon folder-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},et=[],tt=b(Ye,Qe,et,!1,null,null,null,null);const A=tt.exports,it={name:"FilePreview"},lt=I({...it,props:{node:null,cropImagePreviews:{type:Boolean}},setup(e){const i=e,t=y(oe),l=m(()=>qe(i.node,{cropPreview:i.cropImagePreviews})),n=m(()=>i.node.type===$.File),a=y(!1);return le(l,()=>{if(a.value=!1,l.value){const o=document.createElement("img");o.src=l.value.href,o.onerror=()=>o.remove(),o.onload=()=>{a.value=!0,o.remove()},document.body.appendChild(o)}},{immediate:!0}),{__sfc:!0,fileListIconStyles:t,props:i,previewURL:l,isFile:n,canLoadPreview:a,IconFile:ae,IconFolder:A}}});var nt=function(){var e=this,i=e._self._c,t=e._self._setupProxy;return i("div",{class:t.fileListIconStyles["file-picker__file-icon"],style:t.canLoadPreview?{backgroundImage:"url(".concat(t.previewURL,")")}:void 0},[t.canLoadPreview?e._e():[t.isFile?i(t.IconFile,{attrs:{size:20}}):i(t.IconFolder,{attrs:{size:20}})]],2)},st=[],at=b(lt,nt,st,!1,null,null,null,null);const rt=at.exports,ot=I({__name:"FileListRow",props:{allowPickDirectory:{type:Boolean},selected:{type:Boolean},showCheckbox:{type:Boolean},canPick:{type:Boolean},node:null,cropImagePreviews:{type:Boolean}},emits:["update:selected","enter-directory"],setup(e,{emit:i}){const t=e,l=m(()=>{var c;return((c=t.node.attributes)==null?void 0:c.displayName)||t.node.basename.slice(0,t.node.extension?-t.node.extension.length:void 0)}),n=m(()=>t.node.extension),a=m(()=>t.node.type===$.Folder),o=m(()=>t.canPick&&(t.allowPickDirectory||!a.value));function v(){i("update:selected",!t.selected)}function s(){a.value?i("enter-directory",t.node):v()}function u(c){c.key==="Enter"&&s()}return{__sfc:!0,props:t,emit:i,displayName:l,fileExtension:n,isDirectory:a,isPickable:o,toggleSelected:v,handleClick:s,handleKeyDown:u,formatFileSize:Be,NcCheckboxRadioSwitch:se,NcDateTime:ke,t:C,FilePreview:rt}}});var ct=function(){var e=this,i=e._self._c,t=e._self._setupProxy;return i("tr",e._g({class:["file-picker__row",{"file-picker__row--selected":e.selected&&!e.showCheckbox}],attrs:{tabindex:e.showCheckbox&&!t.isDirectory?void 0:0,"aria-selected":t.isPickable?e.selected:void 0,"data-filename":e.node.basename,"data-testid":"file-list-row"}},{click:t.handleClick,...!e.showCheckbox||t.isDirectory?{keydown:t.handleKeyDown}:{}}),[e.showCheckbox?i("td",{staticClass:"row-checkbox",on:{click:function(l){return l.stopPropagation(),(()=>{}).apply(null,arguments)}}},[i(t.NcCheckboxRadioSwitch,{attrs:{"aria-label":t.t("Select the row for {nodename}",{nodename:t.displayName}),checked:e.selected,disabled:!t.isPickable,"data-testid":"row-checkbox"},on:{"update:checked":t.toggleSelected}})],1):e._e(),i("td",{staticClass:"row-name"},[i("div",{staticClass:"file-picker__name-container",attrs:{"data-testid":"row-name"}},[i(t.FilePreview,{attrs:{node:e.node,"crop-image-previews":e.cropImagePreviews}}),i("div",{staticClass:"file-picker__file-name",attrs:{title:t.displayName},domProps:{textContent:e._s(t.displayName)}}),i("div",{staticClass:"file-picker__file-extension",domProps:{textContent:e._s(t.fileExtension)}})],1)]),i("td",{staticClass:"row-size"},[e._v(" "+e._s(t.formatFileSize(e.node.size||0))+" ")]),i("td",{staticClass:"row-modified"},[i(t.NcDateTime,{attrs:{timestamp:e.node.mtime,"ignore-seconds":!0}})],1)])},ut=[],dt=b(ot,ct,ut,!1,null,"48df4f27",null,null);const pt=dt.exports,ft=I({__name:"FileList",props:{currentView:null,multiselect:{type:Boolean},allowPickDirectory:{type:Boolean},loading:{type:Boolean},files:null,selectedFiles:null,path:null},emits:["update:path","update:selectedFiles"],setup(e,{emit:i}){const t=e,l=y(),{currentConfig:n}=He(t.currentView),a=m(()=>{var p;return(p=l.value)!=null?p:n.value}),o=m(()=>a.value.sortBy==="basename"?a.value.order==="none"?void 0:a.value.order:void 0),v=m(()=>a.value.sortBy==="size"?a.value.order==="none"?void 0:a.value.order:void 0),s=m(()=>a.value.sortBy==="mtime"?a.value.order==="none"?void 0:a.value.order:void 0),u=p=>{a.value.sortBy===p?a.value.order==="ascending"?l.value={sortBy:a.value.sortBy,order:"descending"}:l.value={sortBy:a.value.sortBy,order:"ascending"}:l.value={sortBy:p,order:"ascending"}},{sortFavoritesFirst:c,cropImagePreviews:k}=re(),f=m(()=>{const p={ascending:(_,g,r)=>r(_,g),descending:(_,g,r)=>r(g,_),none:(_,g,r)=>0},w={basename:(_,g)=>{var r,d;return(((r=_.attributes)==null?void 0:r.displayName)||_.basename).localeCompare(((d=g.attributes)==null?void 0:d.displayName)||g.basename,Ce())},size:(_,g)=>(_.size||0)-(g.size||0),mtime:(_,g)=>{var r,d,B,P;return(((d=(r=g.mtime)==null?void 0:r.getTime)==null?void 0:d.call(r))||0)-(((P=(B=_.mtime)==null?void 0:B.getTime)==null?void 0:P.call(B))||0)}};return[...t.files].sort((_,g)=>(g.type===$.Folder?1:0)-(_.type===$.Folder?1:0)||(c?(g.attributes.favorite?1:0)-(_.attributes.favorite?1:0):0)||p[a.value.order](_,g,w[a.value.sortBy]))}),h=m(()=>t.files.filter(p=>t.allowPickDirectory||p.type!==$.Folder)),F=m(()=>!t.loading&&t.selectedFiles.length>0&&t.selectedFiles.length>=h.value.length);function x(){t.selectedFiles.length<h.value.length?i("update:selectedFiles",h.value):i("update:selectedFiles",[])}function S(p){t.selectedFiles.includes(p)?i("update:selectedFiles",t.selectedFiles.filter(w=>w.path!==p.path)):t.multiselect?i("update:selectedFiles",[...t.selectedFiles,p]):i("update:selectedFiles",[p])}function V(p){i("update:path",p.path)}const L=y(4),N=y();{const p=()=>be(()=>{var g,r,d,B,P;const w=((r=(g=N.value)==null?void 0:g.parentElement)==null?void 0:r.children)||[];let _=((B=(d=N.value)==null?void 0:d.parentElement)==null?void 0:B.clientHeight)||450;for(let z=0;z<w.length;z++)(P=N.value)!=null&&P.isSameNode(w[z])||(_-=w[z].clientHeight);L.value=Math.floor((_-50)/50)});H(()=>{window.addEventListener("resize",p),p()}),fe(()=>{window.removeEventListener("resize",p)})}return{__sfc:!0,props:t,emit:i,customSortingConfig:l,filesAppSorting:n,sortingConfig:a,sortByName:o,sortBySize:v,sortByModified:s,toggleSorting:u,sortFavoritesFirst:c,cropImagePreviews:k,sortedFiles:f,selectableFiles:h,allSelected:F,onSelectAll:x,onNodeSelected:S,onChangeDirectory:V,skeletonNumber:L,fileContainer:N,NcButton:ne,NcCheckboxRadioSwitch:se,t:C,IconSortAscending:Ee,IconSortDescending:je,LoadingTableRow:We,FileListRow:pt}}});var mt=function(){var e=this,i=e._self._c,t=e._self._setupProxy;return i("div",{ref:"fileContainer",staticClass:"file-picker__files"},[i("table",[i("thead",[i("tr",[e.multiselect?i("th",{staticClass:"row-checkbox"},[i("span",{staticClass:"hidden-visually"},[e._v(" "+e._s(t.t("Select entry"))+" ")]),e.multiselect?i(t.NcCheckboxRadioSwitch,{attrs:{"aria-label":t.t("Select all entries"),checked:t.allSelected,"data-testid":"select-all-checkbox"},on:{"update:checked":t.onSelectAll}}):e._e()],1):e._e(),i("th",{staticClass:"row-name",attrs:{"aria-sort":t.sortByName}},[i("div",{staticClass:"header-wrapper"},[i("span",{staticClass:"file-picker__header-preview"}),i(t.NcButton,{attrs:{wide:!0,type:"tertiary","data-test":"file-picker_sort-name"},on:{click:function(l){return t.toggleSorting("basename")}},scopedSlots:e._u([{key:"icon",fn:function(){return[t.sortByName==="ascending"?i(t.IconSortAscending,{attrs:{size:20}}):t.sortByName==="descending"?i(t.IconSortDescending,{attrs:{size:20}}):i("span",{staticStyle:{width:"44px"}})]},proxy:!0}])},[e._v(" "+e._s(t.t("Name"))+" ")])],1)]),i("th",{staticClass:"row-size",attrs:{"aria-sort":t.sortBySize}},[i(t.NcButton,{attrs:{wide:!0,type:"tertiary"},on:{click:function(l){return t.toggleSorting("size")}},scopedSlots:e._u([{key:"icon",fn:function(){return[t.sortBySize==="ascending"?i(t.IconSortAscending,{attrs:{size:20}}):t.sortBySize==="descending"?i(t.IconSortDescending,{attrs:{size:20}}):i("span",{staticStyle:{width:"44px"}})]},proxy:!0}])},[e._v(" "+e._s(t.t("Size"))+" ")])],1),i("th",{staticClass:"row-modified",attrs:{"aria-sort":t.sortByModified}},[i(t.NcButton,{attrs:{wide:!0,type:"tertiary"},on:{click:function(l){return t.toggleSorting("mtime")}},scopedSlots:e._u([{key:"icon",fn:function(){return[t.sortByModified==="ascending"?i(t.IconSortAscending,{attrs:{size:20}}):t.sortByModified==="descending"?i(t.IconSortDescending,{attrs:{size:20}}):i("span",{staticStyle:{width:"44px"}})]},proxy:!0}])},[e._v(" "+e._s(t.t("Modified"))+" ")])],1)])]),i("tbody",[e.loading?e._l(t.skeletonNumber,function(l){return i(t.LoadingTableRow,{key:l,attrs:{"show-checkbox":e.multiselect}})}):e._l(t.sortedFiles,function(l){return i(t.FileListRow,{key:l.fileid||l.path,attrs:{"allow-pick-directory":e.allowPickDirectory,"show-checkbox":e.multiselect,"can-pick":e.multiselect||e.selectedFiles.length===0||e.selectedFiles.includes(l),selected:e.selectedFiles.includes(l),node:l,"crop-image-previews":t.cropImagePreviews},on:{"update:selected":function(n){return t.onNodeSelected(l)},"enter-directory":t.onChangeDirectory}})})],2)])])},vt=[],_t=b(ft,mt,vt,!1,null,"d3c94818",null,null);const gt=_t.exports,ht={name:"HomeIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var yt=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon home-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},wt=[],Ct=b(ht,yt,wt,!1,null,null,null,null);const bt=Ct.exports,kt={name:"PlusIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Ft=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon plus-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},St=[],xt=b(kt,Ft,St,!1,null,null,null,null);const Nt=xt.exports,Bt=I({__name:"FilePickerBreadcrumbs",props:{path:null,showMenu:{type:Boolean}},emits:["update:path","create-node"],setup(e,{emit:i}){const t=e,l=y(""),n=y();function a(){var k,f,h,F;const s=l.value.trim(),u=(f=(k=n.value)==null?void 0:k.$el)==null?void 0:f.querySelector("input");let c="";return s.length===0?c=C("Folder name cannot be empty."):s.includes("/")?c=C('"/" is not allowed inside a folder name.'):["..","."].includes(s)?c=C('"{name}" is an invalid folder name.',{name:s}):(h=window.OC.config)!=null&&h.blacklist_files_regex&&s.match((F=window.OC.config)==null?void 0:F.blacklist_files_regex)&&(c=C('"{name}" is not an allowed folder name',{name:s})),u&&u.setCustomValidity(c),c===""}const o=function(){const s=l.value.trim();a()&&(i("create-node",s),l.value="")},v=m(()=>t.path.split("/").filter(s=>s!=="").map((s,u,c)=>({name:s,path:"/"+c.slice(0,u+1).join("/")})));return{__sfc:!0,props:t,emit:i,newNodeName:l,nameInput:n,validateInput:a,onSubmit:o,pathElements:v,IconFolder:A,IconHome:bt,IconPlus:Nt,NcActions:me,NcActionInput:ve,NcBreadcrumbs:_e,NcBreadcrumb:ge,t:C}}});var Lt=function(){var e=this,i=e._self._c,t=e._self._setupProxy;return i(t.NcBreadcrumbs,{staticClass:"file-picker__breadcrumbs",scopedSlots:e._u([{key:"default",fn:function(){return[i(t.NcBreadcrumb,{attrs:{name:t.t("Home"),title:t.t("Home")},on:{click:function(l){return t.emit("update:path","/")}},scopedSlots:e._u([{key:"icon",fn:function(){return[i(t.IconHome,{attrs:{size:20}})]},proxy:!0}])}),e._l(t.pathElements,function(l){return i(t.NcBreadcrumb,{key:l.path,attrs:{name:l.name,title:l.path},on:{click:function(n){return t.emit("update:path",l.path)}}})})]},proxy:!0},e.showMenu?{key:"actions",fn:function(){return[i(t.NcActions,{attrs:{"aria-label":t.t("Create directory"),"force-menu":!0,"force-name":!0,"menu-name":t.t("New"),type:"secondary"},on:{close:function(l){t.newNodeName=""}},scopedSlots:e._u([{key:"icon",fn:function(){return[i(t.IconPlus,{attrs:{size:20}})]},proxy:!0}],null,!1,2971667417)},[i(t.NcActionInput,{ref:"nameInput",attrs:{value:t.newNodeName,label:t.t("New folder"),placeholder:t.t("New folder name")},on:{"update:value":function(l){t.newNodeName=l},submit:t.onSubmit,input:t.validateInput},scopedSlots:e._u([{key:"icon",fn:function(){return[i(t.IconFolder,{attrs:{size:20}})]},proxy:!0}],null,!1,1614167509)})],1)]},proxy:!0}:null],null,!0)})},Pt=[],zt=b(Bt,Lt,Pt,!1,null,"3bc9efa5",null,null);const It=zt.exports,Vt={name:"ClockIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var $t=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon clock-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.9L16.2,16.2Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},Ht=[],Dt=b(Vt,$t,Ht,!1,null,null,null,null);const Mt=Dt.exports,Rt={name:"CloseIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var At=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon close-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},Et=[],Tt=b(Rt,At,Et,!1,null,null,null,null);const Ot=Tt.exports,Zt={name:"MagnifyIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Ut=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon magnify-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},jt=[],Xt=b(Zt,Ut,jt,!1,null,null,null,null);const Jt=Xt.exports,Kt={name:"StarIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Gt=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon star-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},Wt=[],qt=b(Kt,Gt,Wt,!1,null,null,null,null);const Yt=qt.exports,Qt=I({__name:"FilePickerNavigation",props:{currentView:null,filterString:null,isCollapsed:{type:Boolean}},emits:["update:currentView","update:filterString"],setup(e,{emit:i}){const t=e,l=[{id:"files",label:C("All files"),icon:A},{id:"recent",label:C("Recent"),icon:Mt},{id:"favorites",label:C("Favorites"),icon:Yt}],n=m(()=>l.filter(a=>a.id===t.currentView)[0]);return{__sfc:!0,allViews:l,props:t,emit:i,currentViewObject:n,updateFilterValue:a=>i("update:filterString",a),IconClose:Ot,IconMagnify:Jt,NcButton:ne,NcSelect:he,NcTextField:ye,t:C,Fragment:we}}});var ei=function(){var e=this,i=e._self._c,t=e._self._setupProxy;return i(t.Fragment,[i(t.NcTextField,{staticClass:"file-picker__filter-input",attrs:{value:e.filterString,label:t.t("Filter file list"),"show-trailing-button":!!e.filterString},on:{"update:value":t.updateFilterValue,"trailing-button-click":function(l){return t.updateFilterValue("")}},scopedSlots:e._u([{key:"trailing-button-icon",fn:function(){return[i(t.IconClose,{attrs:{size:16}})]},proxy:!0}])},[i(t.IconMagnify,{attrs:{size:16}})],1),e.isCollapsed?i(t.NcSelect,{attrs:{"aria-label":t.t("Current view selector"),clearable:!1,searchable:!1,options:t.allViews,value:t.currentViewObject},on:{input:l=>t.emit("update:currentView",l.id)}}):i("ul",{staticClass:"file-picker__side"},e._l(t.allViews,function(l){return i("li",{key:l.id},[i(t.NcButton,{attrs:{type:e.currentView===l.id?"primary":"tertiary",wide:!0},on:{click:function(n){return e.$emit("update:currentView",l.id)}},scopedSlots:e._u([{key:"icon",fn:function(){return[i(l.icon,{tag:"component",attrs:{size:20}})]},proxy:!0}],null,!0)},[e._v(" "+e._s(l.label)+" ")])],1)}),0)],1)},ti=[],ii=b(Qt,ei,ti,!1,null,"e96bec41",null,null);const li=ii.exports,ni=function(e,i){const t=Fe(),l=y([]),n=y(!0);async function a(v,s=M){const u=await t.stat("".concat(s).concat(v),{details:!0});return D(u.data)}async function o(){if(n.value=!0,e.value==="favorites")l.value=await Se(t,i.value);else if(e.value==="recent"){const v=Math.round(Date.now()/1e3)-1209600,{data:s}=await t.search("/",{details:!0,data:xe(v)});l.value=s.results.map(u=>D(u))}else{const v=await t.getDirectoryContents("".concat(M).concat(i.value),{details:!0,data:Ne()});l.value=v.data.map(s=>D(s))}n.value=!1}return le([e,i],()=>o()),H(()=>o()),{isLoading:n,files:l,loadFiles:o,getFile:a,client:t}},si=function(e){const i=m(()=>e.value.map(t=>t.split("/")));return{isSupportedMimeType:t=>{const l=t.split("/");return i.value.some(([n,a])=>(l[0]===n||n==="*")&&(l[1]===a||a==="*"))}}},ai={name:"FilePicker"},ri=I({...ai,props:{buttons:null,name:null,allowPickDirectory:{type:Boolean,default:!1},container:{default:"body"},filterFn:{default:void 0},mimetypeFilter:{default:()=>[]},multiselect:{type:Boolean,default:!0},path:{default:void 0}},emits:["close"],setup(e,{emit:i}){const t=e,l=y(!0),n=m(()=>({container:t.container,name:t.name,buttons:a.value,size:"large",contentClasses:["file-picker__content"],dialogClasses:["file-picker"],navigationClasses:["file-picker__navigation"]})),a=m(()=>(typeof t.buttons=="function"?t.buttons(c.value,h.value,s.value):t.buttons).map(r=>({...r,callback:()=>{o=!0,v(r.callback)}})));let o=!1;const v=async r=>{const d=c.value.length===0&&t.allowPickDirectory?[await N(h.value)]:c.value;r(d),i("close",d),o=!1},s=y("files"),u=m(()=>s.value==="favorites"?C("Favorites"):s.value==="recent"?C("Recent"):""),c=y([]),k=y((window==null?void 0:window.sessionStorage.getItem("NC.FilePicker.LastPath"))||"/"),f=y(),h=m({get:()=>s.value==="files"?f.value||t.path||k.value:"/",set:r=>{t.path===void 0&&window.sessionStorage.setItem("NC.FilePicker.LastPath",r),f.value=r,c.value=[]}}),F=y(""),{isSupportedMimeType:x}=si(ce(t,"mimetypeFilter")),{files:S,isLoading:V,loadFiles:L,getFile:N,client:p}=ni(s,h);H(()=>L());const{showHiddenFiles:w}=re(),_=m(()=>{let r=S.value;return w.value||(r=r.filter(d=>!d.basename.startsWith("."))),t.mimetypeFilter.length>0&&(r=r.filter(d=>d.type==="folder"||d.mime&&x(d.mime))),F.value&&(r=r.filter(d=>d.basename.toLowerCase().includes(F.value.toLowerCase()))),t.filterFn&&(r=r.filter(d=>t.filterFn(d))),r}),g=m(()=>s.value==="files"?C("Upload some content or sync with your devices!"):s.value==="recent"?C("Files and folders you recently modified will show up here."):C("Files and folders you mark as favorite will show up here."));return{__sfc:!0,props:t,emit:i,isOpen:l,dialogProps:n,dialogButtons:a,isHandlingCallback:o,handleButtonClick:v,currentView:s,viewHeadline:u,selectedFiles:c,savedPath:k,navigatedPath:f,currentPath:h,filterString:F,isSupportedMimeType:x,files:S,isLoading:V,loadFiles:L,getFile:N,client:p,showHiddenFiles:w,filteredFiles:_,noFilesDescription:g,onCreateFolder:async r=>{try{await p.createDirectory(Pe.join(M,h.value,r)),await L(),ue("files:node:created",S.value.filter(d=>d.basename===r)[0])}catch(d){console.warn("Could not create new folder",{name:r,error:d}),Le(C("Could not create the new folder"))}},handleClose:r=>{!r&&!o&&i("close")},IconFile:ae,FileList:gt,FilePickerBreadcrumbs:It,FilePickerNavigation:li,NcDialog:de,NcEmptyContent:pe,t:C}}});var oi=function(){var e=this,i=e._self._c,t=e._self._setupProxy;return i(t.NcDialog,e._b({attrs:{open:t.isOpen},on:{"update:open":[function(l){t.isOpen=l},t.handleClose]},scopedSlots:e._u([{key:"navigation",fn:function({isCollapsed:l}){return[i(t.FilePickerNavigation,{attrs:{"is-collapsed":l,"current-view":t.currentView,"filter-string":t.filterString},on:{"update:currentView":function(n){t.currentView=n},"update:current-view":function(n){t.currentView=n},"update:filterString":function(n){t.filterString=n},"update:filter-string":function(n){t.filterString=n}}})]}}])},"NcDialog",t.dialogProps,!1),[i("div",{staticClass:"file-picker__main"},[t.currentView==="files"?i(t.FilePickerBreadcrumbs,{attrs:{path:t.currentPath,"show-menu":e.allowPickDirectory},on:{"update:path":function(l){t.currentPath=l},"create-node":t.onCreateFolder}}):i("div",{staticClass:"file-picker__view"},[i("h3",[e._v(e._s(t.viewHeadline))])]),t.isLoading||t.filteredFiles.length>0?i(t.FileList,{attrs:{"allow-pick-directory":e.allowPickDirectory,"current-view":t.currentView,files:t.filteredFiles,multiselect:e.multiselect,loading:t.isLoading,path:t.currentPath,"selected-files":t.selectedFiles,name:t.viewHeadline},on:{"update:path":[function(l){t.currentPath=l},function(l){t.currentView="files"}],"update:selectedFiles":function(l){t.selectedFiles=l},"update:selected-files":function(l){t.selectedFiles=l}}}):t.filterString?i(t.NcEmptyContent,{attrs:{name:t.t("No matching files"),description:t.t("No files matching your filter were found.")},scopedSlots:e._u([{key:"icon",fn:function(){return[i(t.IconFile)]},proxy:!0}])}):i(t.NcEmptyContent,{attrs:{name:t.t("No files in here"),description:t.noFilesDescription},scopedSlots:e._u([{key:"icon",fn:function(){return[i(t.IconFile)]},proxy:!0}])})],1)])},ci=[],ui=b(ri,oi,ci,!1,null,"821451ce",null,null);const gi=ui.exports;export{gi as default};
