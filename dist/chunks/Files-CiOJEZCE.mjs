/*! third party licenses: dist/vendor.LICENSE.txt */
import{s as me,c as ye,y as ge,_ as be}from"./index-BLIV22dB.mjs";import{bU as y,bX as _,bF as N,cP as T,bJ as oe,bK as ne,bN as _e}from"../core-common.mjs";import{u as we,c as ve}from"./index-Biv1VH4I.mjs";import{i as ie}from"./util-Bowr8LpN.mjs";import{r as Te,a as Ee,b as Ce,c as Ae,d as Oe,e as Pe,f as Re,S as xe,h as Se}from"./hashUtils-eMmrAEPa.mjs";import{r as se}from"./url-84ru6Jh_.mjs";import{m as G}from"./headers-Irz06Lip.mjs";import{l as ke}from"./logger-CMIEMPjA.mjs";var j={},ae={exports:{}},I={};(function(t){t.fetch=n(y.fetch)&&n(y.ReadableStream),t.writableStream=n(y.WritableStream),t.abortController=n(y.AbortController);var e;function r(){if(e!==void 0)return e;if(y.XMLHttpRequest){e=new y.XMLHttpRequest;try{e.open("GET",y.XDomainRequest?"/":"https://example.com")}catch{e=null}}else e=null;return e}function o(c){var s=r();if(!s)return!1;try{return s.responseType=c,s.responseType===c}catch{}return!1}t.arraybuffer=t.fetch||o("arraybuffer"),t.msstream=!t.fetch&&o("ms-stream"),t.mozchunkedarraybuffer=!t.fetch&&o("moz-chunked-arraybuffer"),t.overrideMimeType=t.fetch||(r()?n(r().overrideMimeType):!1);function n(c){return typeof c=="function"}e=null})(I);var P={},M={exports:{}};(function(t,e){e=t.exports=Te(),e.Stream=e,e.Readable=e,e.Writable=Ee(),e.Duplex=Ce(),e.Transform=Ae(),e.PassThrough=Oe(),e.finished=Pe(),e.pipeline=Re()})(M,M.exports);var ce=M.exports,z=I,qe=ie,ue=ce,E=P.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},S=P.IncomingMessage=function(t,e,r,o){var n=this;if(ue.Readable.call(n),n._mode=r,n.headers={},n.rawHeaders=[],n.trailers={},n.rawTrailers=[],n.on("end",function(){N.nextTick(function(){n.emit("close")})}),r==="fetch"){let f=function(){s.read().then(function(a){if(!n._destroyed){if(o(a.done),a.done){n.push(null);return}n.push(_.from(a.value)),f()}}).catch(function(a){o(!0),n._destroyed||n.emit("error",a)})};if(n._fetchResponse=e,n.url=e.url,n.statusCode=e.status,n.statusMessage=e.statusText,e.headers.forEach(function(a,l){n.headers[l.toLowerCase()]=a,n.rawHeaders.push(l,a)}),z.writableStream){var c=new WritableStream({write:function(a){return o(!1),new Promise(function(l,x){n._destroyed?x():n.push(_.from(a))?l():n._resumeFetch=l})},close:function(){o(!0),n._destroyed||n.push(null)},abort:function(a){o(!0),n._destroyed||n.emit("error",a)}});try{e.body.pipeTo(c).catch(function(a){o(!0),n._destroyed||n.emit("error",a)});return}catch{}}var s=e.body.getReader();f()}else{n._xhr=t,n._pos=0,n.url=t.responseURL,n.statusCode=t.status,n.statusMessage=t.statusText;var i=t.getAllResponseHeaders().split(/\r?\n/);if(i.forEach(function(f){var a=f.match(/^([^:]+):\s*(.*)/);if(a){var l=a[1].toLowerCase();l==="set-cookie"?(n.headers[l]===void 0&&(n.headers[l]=[]),n.headers[l].push(a[2])):n.headers[l]!==void 0?n.headers[l]+=", "+a[2]:n.headers[l]=a[2],n.rawHeaders.push(a[1],a[2])}}),n._charset="x-user-defined",!z.overrideMimeType){var u=n.rawHeaders["mime-type"];if(u){var m=u.match(/;\s*charset=([^;])(;|$)/);m&&(n._charset=m[1].toLowerCase())}n._charset||(n._charset="utf-8")}}};qe(S,ue.Readable),S.prototype._read=function(){var t=this,e=t._resumeFetch;e&&(t._resumeFetch=null,e())},S.prototype._onXHRProgress=function(t){var e=this,r=e._xhr,o=null;switch(e._mode){case"text":if(o=r.responseText,o.length>e._pos){var n=o.substr(e._pos);if(e._charset==="x-user-defined"){for(var c=_.alloc(n.length),s=0;s<n.length;s++)c[s]=n.charCodeAt(s)&255;e.push(c)}else e.push(n,e._charset);e._pos=o.length}break;case"arraybuffer":if(r.readyState!==E.DONE||!r.response)break;o=r.response,e.push(_.from(new Uint8Array(o)));break;case"moz-chunked-arraybuffer":if(o=r.response,r.readyState!==E.LOADING||!o)break;e.push(_.from(new Uint8Array(o)));break;case"ms-stream":if(o=r.response,r.readyState!==E.LOADING)break;var i=new y.MSStreamReader;i.onprogress=function(){i.result.byteLength>e._pos&&(e.push(_.from(new Uint8Array(i.result.slice(e._pos)))),e._pos=i.result.byteLength)},i.onload=function(){t(!0),e.push(null)},i.readAsArrayBuffer(o);break}e._xhr.readyState===E.DONE&&e._mode!=="ms-stream"&&(t(!0),e.push(null))};var w=I,Le=ie,le=P,D=ce,Ne=le.IncomingMessage,W=le.readyStates;function Me(t,e){return w.fetch&&e?"fetch":w.mozchunkedarraybuffer?"moz-chunked-arraybuffer":w.msstream?"ms-stream":w.arraybuffer&&t?"arraybuffer":"text"}var p=ae.exports=function(t){var e=this;D.Writable.call(e),e._opts=t,e._body=[],e._headers={},t.auth&&e.setHeader("Authorization","Basic "+_.from(t.auth).toString("base64")),Object.keys(t.headers).forEach(function(n){e.setHeader(n,t.headers[n])});var r,o=!0;if(t.mode==="disable-fetch"||"requestTimeout"in t&&!w.abortController)o=!1,r=!0;else if(t.mode==="prefer-streaming")r=!1;else if(t.mode==="allow-wrong-content-type")r=!w.overrideMimeType;else if(!t.mode||t.mode==="default"||t.mode==="prefer-fast")r=!0;else throw new Error("Invalid value for opts.mode");e._mode=Me(r,o),e._fetchTimer=null,e._socketTimeout=null,e._socketTimer=null,e.on("finish",function(){e._onFinish()})};Le(p,D.Writable),p.prototype.setHeader=function(t,e){var r=this,o=t.toLowerCase();He.indexOf(o)===-1&&(r._headers[o]={name:t,value:e})},p.prototype.getHeader=function(t){var e=this._headers[t.toLowerCase()];return e?e.value:null},p.prototype.removeHeader=function(t){var e=this;delete e._headers[t.toLowerCase()]},p.prototype._onFinish=function(){var t=this;if(!t._destroyed){var e=t._opts;"timeout"in e&&e.timeout!==0&&t.setTimeout(e.timeout);var r=t._headers,o=null;e.method!=="GET"&&e.method!=="HEAD"&&(o=new Blob(t._body,{type:(r["content-type"]||{}).value||""}));var n=[];if(Object.keys(r).forEach(function(u){var m=r[u].name,f=r[u].value;Array.isArray(f)?f.forEach(function(a){n.push([m,a])}):n.push([m,f])}),t._mode==="fetch"){var c=null;if(w.abortController){var s=new AbortController;c=s.signal,t._fetchAbortController=s,"requestTimeout"in e&&e.requestTimeout!==0&&(t._fetchTimer=y.setTimeout(function(){t.emit("requestTimeout"),t._fetchAbortController&&t._fetchAbortController.abort()},e.requestTimeout))}y.fetch(t._opts.url,{method:t._opts.method,headers:n,body:o||void 0,mode:"cors",credentials:e.withCredentials?"include":"same-origin",signal:c}).then(function(u){t._fetchResponse=u,t._resetTimers(!1),t._connect()},function(u){t._resetTimers(!0),t._destroyed||t.emit("error",u)})}else{var i=t._xhr=new y.XMLHttpRequest;try{i.open(t._opts.method,t._opts.url,!0)}catch(u){N.nextTick(function(){t.emit("error",u)});return}"responseType"in i&&(i.responseType=t._mode),"withCredentials"in i&&(i.withCredentials=!!e.withCredentials),t._mode==="text"&&"overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),"requestTimeout"in e&&(i.timeout=e.requestTimeout,i.ontimeout=function(){t.emit("requestTimeout")}),n.forEach(function(u){i.setRequestHeader(u[0],u[1])}),t._response=null,i.onreadystatechange=function(){switch(i.readyState){case W.LOADING:case W.DONE:t._onXHRProgress();break}},t._mode==="moz-chunked-arraybuffer"&&(i.onprogress=function(){t._onXHRProgress()}),i.onerror=function(){t._destroyed||(t._resetTimers(!0),t.emit("error",new Error("XHR error")))};try{i.send(o)}catch(u){N.nextTick(function(){t.emit("error",u)});return}}}};function $e(t){try{var e=t.status;return e!==null&&e!==0}catch{return!1}}p.prototype._onXHRProgress=function(){var t=this;t._resetTimers(!1),!(!$e(t._xhr)||t._destroyed)&&(t._response||t._connect(),t._response._onXHRProgress(t._resetTimers.bind(t)))},p.prototype._connect=function(){var t=this;t._destroyed||(t._response=new Ne(t._xhr,t._fetchResponse,t._mode,t._resetTimers.bind(t)),t._response.on("error",function(e){t.emit("error",e)}),t.emit("response",t._response))},p.prototype._write=function(t,e,r){var o=this;o._body.push(t),r()},p.prototype._resetTimers=function(t){var e=this;y.clearTimeout(e._socketTimer),e._socketTimer=null,t?(y.clearTimeout(e._fetchTimer),e._fetchTimer=null):e._socketTimeout&&(e._socketTimer=y.setTimeout(function(){e.emit("timeout")},e._socketTimeout))},p.prototype.abort=p.prototype.destroy=function(t){var e=this;e._destroyed=!0,e._resetTimers(!0),e._response&&(e._response._destroyed=!0),e._xhr?e._xhr.abort():e._fetchAbortController&&e._fetchAbortController.abort(),t&&e.emit("error",t)},p.prototype.end=function(t,e,r){var o=this;typeof t=="function"&&(r=t,t=void 0),D.Writable.prototype.end.call(o,t,e,r)},p.prototype.setTimeout=function(t,e){var r=this;e&&r.once("timeout",e),r._socketTimeout=t,r._resetTimers(!1)},p.prototype.flushHeaders=function(){},p.prototype.setNoDelay=function(){},p.prototype.setSocketKeepAlive=function(){};var He=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],je=ae.exports,Ie=Ue,De=Object.prototype.hasOwnProperty;function Ue(){for(var t={},e=0;e<arguments.length;e++){var r=arguments[e];for(var o in r)De.call(r,o)&&(t[o]=r[o])}return t}var Fe={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"};(function(t){var e=je,r=P,o=Ie,n=Fe,c=se,s=t;s.request=function(i,u){typeof i=="string"?i=c.parse(i):i=o(i);var m=y.location.protocol.search(/^https?:$/)===-1?"http:":"",f=i.protocol||m,a=i.hostname||i.host,l=i.port,x=i.path||"/";a&&a.indexOf(":")!==-1&&(a="["+a+"]"),i.url=(a?f+"//"+a:"")+(l?":"+l:"")+x,i.method=(i.method||"GET").toUpperCase(),i.headers=i.headers||{};var B=new e(i);return u&&B.on("response",u),B},s.get=function(i,u){var m=s.request(i,u);return m.end(),m},s.ClientRequest=e,s.IncomingMessage=r.IncomingMessage,s.Agent=function(){},s.Agent.defaultMaxSockets=4,s.globalAgent=new s.Agent,s.STATUS_CODES=n,s.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]})(j);var fe={exports:{}};(function(t){var e=j,r=se,o=t.exports;for(var n in e)e.hasOwnProperty(n)&&(o[n]=e[n]);o.request=function(s,i){return s=c(s),e.request.call(this,s,i)},o.get=function(s,i){return s=c(s),e.get.call(this,s,i)};function c(s){if(typeof s=="string"&&(s=r.parse(s)),s.protocol||(s.protocol="https:"),s.protocol!=="https:")throw new Error('Protocol "'+s.protocol+'" not supported. Expected "https:"');return s}})(fe);var Be=fe.exports;const Ge=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,X=Ge?self:typeof window<"u"?window:globalThis,ze=X.fetch.bind(X);function We(...t){if(t.length===0)throw new Error("Failed creating sequence: No functions provided");return function(...e){let r=e;const o=this;for(;t.length>0;)r=[t.shift().apply(o,r)];return r[0]}}const K="@@HOTPATCHER",Xe=()=>{};function k(t){return{original:t,methods:[t],final:!1}}class Ke{constructor(){this._configuration={registry:{},getEmptyAction:"null"},this.__type__=K}get configuration(){return this._configuration}get getEmptyAction(){return this.configuration.getEmptyAction}set getEmptyAction(e){this.configuration.getEmptyAction=e}control(e,r=!1){if(!e||e.__type__!==K)throw new Error("Failed taking control of target HotPatcher instance: Invalid type or object");return Object.keys(e.configuration.registry).forEach(o=>{this.configuration.registry.hasOwnProperty(o)?r&&(this.configuration.registry[o]=Object.assign({},e.configuration.registry[o])):this.configuration.registry[o]=Object.assign({},e.configuration.registry[o])}),e._configuration=this.configuration,this}execute(e,...r){return(this.get(e)||Xe)(...r)}get(e){const r=this.configuration.registry[e];if(!r)switch(this.getEmptyAction){case"null":return null;case"throw":throw new Error("Failed handling method request: No method provided for override: ".concat(e));default:throw new Error("Failed handling request which resulted in an empty method: Invalid empty-action specified: ".concat(this.getEmptyAction))}return We(...r.methods)}isPatched(e){return!!this.configuration.registry[e]}patch(e,r,o={}){const{chain:n=!1}=o;if(this.configuration.registry[e]&&this.configuration.registry[e].final)throw new Error("Failed patching '".concat(e,"': Method marked as being final"));if(typeof r!="function")throw new Error("Failed patching '".concat(e,"': Provided method is not a function"));if(n)this.configuration.registry[e]?this.configuration.registry[e].methods.push(r):this.configuration.registry[e]=k(r);else if(this.isPatched(e)){const{original:c}=this.configuration.registry[e];this.configuration.registry[e]=Object.assign(k(r),{original:c})}else this.configuration.registry[e]=k(r);return this}patchInline(e,r,...o){return this.isPatched(e)||this.patch(e,r),this.execute(e,...o)}plugin(e,...r){return r.forEach(o=>{this.patch(e,o,{chain:!0})}),this}restore(e){if(this.isPatched(e)){if(typeof this.configuration.registry[e].original!="function")throw new Error("Failed restoring method: Original method not found or of invalid type for key: ".concat(e))}else throw new Error("Failed restoring method: No method present for key: ".concat(e));return this.configuration.registry[e].methods=[this.configuration.registry[e].original],this}setFinal(e){if(!this.configuration.registry.hasOwnProperty(e))throw new Error("Failed marking '".concat(e,"' as final: No method found for key"));return this.configuration.registry[e].final=!0,this}}let q=null;function Ve(){return q||(q=new Ke),q}function he(){return typeof WEB=="boolean"&&WEB===!0}function Ye(t,e,r,o,n,c,s){const i=s||T("".concat(e,":").concat(r,":").concat(o));return t&&t.toLowerCase()==="md5-sess"?T("".concat(i,":").concat(n,":").concat(c)):i}const V="abcdef0123456789",Je=32;function Y(t,e){const r=t.url.replace("//",""),o=r.indexOf("/")==-1?"/":r.slice(r.indexOf("/")),n=t.method?t.method.toUpperCase():"GET",c=/(^|,)\s*auth\s*($|,)/.test(e.qop)?"auth":!1,s="00000000".concat(e.nc).slice(-8),i=Ye(e.algorithm,e.username,e.realm,e.password,e.nonce,e.cnonce,e.ha1),u=T("".concat(n,":").concat(o)),m=c?T("".concat(i,":").concat(e.nonce,":").concat(s,":").concat(e.cnonce,":").concat(c,":").concat(u)):T("".concat(i,":").concat(e.nonce,":").concat(u)),f={username:e.username,realm:e.realm,nonce:e.nonce,uri:o,qop:c,response:m,nc:s,cnonce:e.cnonce,algorithm:e.algorithm,opaque:e.opaque},a=[];for(const l in f)f[l]&&(l==="qop"||l==="nc"||l==="algorithm"?a.push("".concat(l,"=").concat(f[l])):a.push("".concat(l,'="').concat(f[l],'"')));return"Digest ".concat(a.join(", "))}function Qe(){let t="";for(let e=0;e<Je;++e)t="".concat(t).concat(V[Math.floor(Math.random()*V.length)]);return t}function Ze(t,e){const r=t.headers&&t.headers.get("www-authenticate")||"";if(r.split(/\s/)[0].toLowerCase()!=="digest")return!1;const o=/([a-z0-9_-]+)=(?:"([^"]+)"|([a-z0-9_-]+))/gi;for(;;){const n=o.exec(r);if(!n)break;e[n[1]]=n[2]||n[3]}return e.nc+=1,e.cnonce=Qe(),!0}function $(t){return et(t)?Object.assign({},t):Object.setPrototypeOf(Object.assign({},t),Object.getPrototypeOf(t))}function et(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function J(...t){let e=null,r=[...t];for(;r.length>0;){const o=r.shift();e?e=de(e,o):e=$(o)}return e}function de(t,e){const r=$(t);return Object.keys(e).forEach(o=>{if(!r.hasOwnProperty(o)){r[o]=e[o];return}Array.isArray(e[o])?r[o]=Array.isArray(r[o])?[...r[o],...e[o]]:[...e[o]]:typeof e[o]=="object"&&e[o]?r[o]=typeof r[o]=="object"&&r[o]?de(r[o],e[o]):$(e[o]):r[o]=e[o]}),r}const tt=typeof ArrayBuffer=="function",{toString:rt}=Object.prototype;function ot(t){return tt&&(t instanceof ArrayBuffer||rt.call(t)==="[object ArrayBuffer]")}function nt(t){return t!=null&&t.constructor!=null&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}function it(t){if(!he()&&t instanceof xe.Readable)return[t,{}];if(typeof t=="string")return[t,{}];if(nt(t))return[t,{}];if(ot(t))return[t,{}];if(t&&typeof t=="object")return[JSON.stringify(t),{"content-type":"application/json"}];throw new Error("Unable to convert request body: Unexpected body type: ".concat(typeof t))}function L(t){const e=Ve();return e.patchInline("request",r=>e.patchInline("fetch",ze,r.url,st(r)),t)}function st(t){let e={};const r={method:t.method};if(t.headers&&(e=G(e,t.headers)),typeof t.data<"u"){const[o,n]=it(t.data);r.body=o,e=G(e,n)}return t.signal&&(r.signal=t.signal),t.withCredentials&&(r.credentials="include"),he()||(t.httpAgent||t.httpsAgent)&&(r.agent=o=>o.protocol==="http:"?t.httpAgent||new j.Agent:t.httpsAgent||new Be.Agent),r.headers=e,r}async function at(t){if(!t._digest)return L(t);const e=t._digest;delete t._digest,e.hasDigestAuth&&(t=J(t,{headers:{Authorization:Y(t,e)}}));const r=await L(t);if(r.status==401){if(e.hasDigestAuth=Ze(r,e),e.hasDigestAuth){t=J(t,{headers:{Authorization:Y(t,e)}});const o=await L(t);return o.status==401?e.hasDigestAuth=!1:e.nc++,o}}else e.nc++;return r}var Q;const H="/files/".concat((Q=oe())==null?void 0:Q.uid),ct=ne("dav"+H),ut=(t=ct)=>{const e=we(t,{headers:{requesttoken:_e()||""}});return ve().patch("request",r=>{var o;return(o=r.headers)!=null&&o.method&&(r.method=r.headers.method,delete r.headers.method),at(r)}),e};function b(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Z(t,e,r){lt(t,e),e.set(t,r)}function lt(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function h(t,e){var r=pe(t,e,"get");return ft(t,r)}function ft(t,e){return e.get?e.get.call(t):e.value}function ee(t,e,r){var o=pe(t,e,"set");return ht(t,o,r),r}function pe(t,e,r){if(!e.has(t))throw new TypeError("attempted to "+r+" private field on non-instance");return e.get(t)}function ht(t,e,r){if(e.set)e.set.call(t,r);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=r}}var dt=typeof Symbol<"u"?Symbol.toStringTag:"@@toStringTag",d=new WeakMap,v=new WeakMap;class R{constructor(e){var{executor:r=()=>{},internals:o=F(),promise:n=new Promise((c,s)=>r(c,s,i=>{o.onCancelList.push(i)}))}=e;Z(this,d,{writable:!0,value:void 0}),Z(this,v,{writable:!0,value:void 0}),b(this,dt,"CancelablePromise"),this.cancel=this.cancel.bind(this),ee(this,d,o),ee(this,v,n||new Promise((c,s)=>r(c,s,i=>{o.onCancelList.push(i)})))}then(e,r){return O(h(this,v).then(C(e,h(this,d)),C(r,h(this,d))),h(this,d))}catch(e){return O(h(this,v).catch(C(e,h(this,d))),h(this,d))}finally(e,r){return r&&h(this,d).onCancelList.push(e),O(h(this,v).finally(C(()=>{if(e)return r&&(h(this,d).onCancelList=h(this,d).onCancelList.filter(o=>o!==e)),e()},h(this,d))),h(this,d))}cancel(){h(this,d).isCanceled=!0;var e=h(this,d).onCancelList;h(this,d).onCancelList=[];for(var r of e)if(typeof r=="function")try{r()}catch(o){console.error(o)}}isCanceled(){return h(this,d).isCanceled===!0}}class g extends R{constructor(e){super({executor:e})}}b(g,"all",function(t){return A(t,Promise.all(t))}),b(g,"allSettled",function(t){return A(t,Promise.allSettled(t))}),b(g,"any",function(t){return A(t,Promise.any(t))}),b(g,"race",function(t){return A(t,Promise.race(t))}),b(g,"resolve",function(t){return te(Promise.resolve(t))}),b(g,"reject",function(t){return te(Promise.reject(t))}),b(g,"isCancelable",U);function te(t){return O(t,F())}function U(t){return t instanceof g||t instanceof R}function C(t,e){if(t)return r=>{if(!e.isCanceled){var o=t(r);return U(o)&&e.onCancelList.push(o.cancel),o}return r}}function O(t,e){return new R({internals:e,promise:t})}function A(t,e){var r=F();return r.onCancelList.push(()=>{for(var o of t)U(o)&&o.cancel()}),new R({internals:r,promise:e})}function F(){return{isCanceled:!1,onCancelList:[]}}const pt=ut(),re=function(t){var e;const r=(e=oe())==null?void 0:e.uid;if(!r)throw new Error("No user id found");const o=t.props,n=ye(o==null?void 0:o.permissions),c=(o["owner-id"]||r).toString(),s=ne("dav"+H+t.filename),i={id:(o==null?void 0:o.fileid)<0?Se(s):(o==null?void 0:o.fileid)||0,source:s,mtime:new Date(t.lastmod),mime:t.mime||"application/octet-stream",size:(o==null?void 0:o.size)||0,permissions:n,owner:c,root:H,attributes:{...t,...o,hasPreview:o==null?void 0:o["has-preview"],failed:(o==null?void 0:o.fileid)<0}};return delete i.attributes.props,t.type==="file"?new ge(i):new be(i)},Et=(t="/")=>{const e=new AbortController,r=me();return new g(async(o,n,c)=>{c(()=>e.abort());try{const s=await pt.getDirectoryContents(t,{details:!0,data:r,includeSelf:!0,signal:e.signal}),i=s.data[0],u=s.data.slice(1);if(i.filename!==t)throw new Error("Root node does not match requested path");o({folder:re(i),contents:u.map(m=>{try{return re(m)}catch(f){return ke.error("Invalid node detected '".concat(m.basename,"'"),{error:f}),null}}).filter(Boolean)})}catch(s){n(s)}})};export{Et as a,ut as g,re as r};
