/*! third party licenses: dist/vendor.LICENSE.txt */
import{_ as O,y as z,f as Y,g as c,Q as w,D as y,Z as G,N as T,i as b}from"./chunks/index-BLIV22dB.mjs";import{aG as M,bJ as m,bK as P,bQ as d,bD as u,bE as t,bP as A,bC as R,bR as k}from"./core-common.mjs";import{x as E,y as K,z as N,B as I,f as U,E as J,G as Q,J as V,K as Z}from"./chunks/icons-BxSPavMS.mjs";import{T as _}from"./chunks/index-YIotKjSS.mjs";import{a as q}from"./chunks/sidebarAction-TbC0yk8r.mjs";import"./chunks/index-Ca0QcE7e.mjs";import"./chunks/index-DgCiVkaQ.mjs";import"./chunks/index-Biv1VH4I.mjs";import"./chunks/logger-CMIEMPjA.mjs";const W=M.getLoggerBuilder().setApp("files_sharing").detectUser().build();var x;const S="/files/".concat((x=m())==null?void 0:x.uid),v={"Content-Type":"application/json"},X=function(e){var s;try{const i=(e==null?void 0:e.item_type)==="folder",a=(e==null?void 0:e.has_preview)===!0,n=i?O:z,r=e.file_source,o=(e==null?void 0:e.path)||e.file_target,l=P("dav/".concat(S,"/").concat(o).replaceAll(/\/\//gm,"/"));let h=e!=null&&e.item_mtime?new Date(e.item_mtime*1e3):void 0;return(e==null?void 0:e.stime)>((e==null?void 0:e.item_mtime)||0)&&(h=new Date(e.stime*1e3)),new n({id:r,source:l,owner:e==null?void 0:e.uid_owner,mime:e==null?void 0:e.mimetype,mtime:h,size:e==null?void 0:e.item_size,permissions:(e==null?void 0:e.item_permissions)||(e==null?void 0:e.permissions),root:S,attributes:{...e,"has-preview":a,"owner-id":e==null?void 0:e.uid_owner,"owner-display-name":e==null?void 0:e.displayname_owner,"share-types":e==null?void 0:e.share_type,favorite:(s=e==null?void 0:e.tags)!=null&&s.includes(window.OC.TAG_FAVORITE)?1:0}})}catch(i){return W.error("Error while parsing OCS entry",{error:i}),null}},B=function(e=!1){const s=d("apps/files_sharing/api/v1/shares");return u.get(s,{headers:v,params:{shared_with_me:e,include_tags:!0}})},$=function(){return B(!0)},ee=function(){return B()},se=function(){const e=d("apps/files_sharing/api/v1/remote_shares");return u.get(e,{headers:v,params:{include_tags:!0}})},ie=function(){const e=d("apps/files_sharing/api/v1/shares/pending");return u.get(e,{headers:v,params:{include_tags:!0}})},re=function(){const e=d("apps/files_sharing/api/v1/remote_shares/pending");return u.get(e,{headers:v,params:{include_tags:!0}})},te=function(){const e=d("apps/files_sharing/api/v1/deletedshares");return u.get(e,{headers:v,params:{include_tags:!0}})},ae=function(e,s){return Object.values(e.reduce(function(i,a){return(i[a[s]]=i[a[s]]||[]).push(a),i},{}))},g=async(e=!0,s=!0,i=!1,a=!1,n=[])=>{var r;const o=[];e&&o.push($(),se()),s&&o.push(ee()),i&&o.push(ie(),re()),a&&o.push(te());let l=(await Promise.all(o)).map(h=>h.data.ocs.data).flat().map(X).filter(h=>h!==null);return n.length>0&&(l=l.filter(h=>{var f;return n.includes((f=h.attributes)==null?void 0:f.share_type)})),l=ae(l,"source").map(h=>{const f=h[0];return f.attributes["share-types"]=h.map(j=>j.attributes["share-types"]),f}),{folder:new O({id:0,source:P("dav"+S),owner:((r=m())==null?void 0:r.uid)||null}),contents:l}},p="shareoverview",D="sharingin",L="sharingout",H="sharinglinks",F="deletedshares",C="pendingshares",ne=()=>{const e=Y();e.register(new c({id:p,name:t("files_sharing","Shares"),caption:t("files_sharing","Overview of shared files."),emptyTitle:t("files_sharing","No shares"),emptyCaption:t("files_sharing","Files and folders you shared or have been shared with you will show up here"),icon:E,order:20,columns:[],getContents:()=>g()})),e.register(new c({id:D,name:t("files_sharing","Shared with you"),caption:t("files_sharing","List of files that are shared with you."),emptyTitle:t("files_sharing","Nothing shared with you yet"),emptyCaption:t("files_sharing","Files and folders others shared with you will show up here"),icon:K,order:1,parent:p,columns:[],getContents:()=>g(!0,!1,!1,!1)})),e.register(new c({id:L,name:t("files_sharing","Shared with others"),caption:t("files_sharing","List of files that you shared with others."),emptyTitle:t("files_sharing","Nothing shared yet"),emptyCaption:t("files_sharing","Files and folders you shared will show up here"),icon:N,order:2,parent:p,columns:[],getContents:()=>g(!1,!0,!1,!1)})),e.register(new c({id:H,name:t("files_sharing","Shared by link"),caption:t("files_sharing","List of files that are shared by link."),emptyTitle:t("files_sharing","No shared links"),emptyCaption:t("files_sharing","Files and folders you shared by link will show up here"),icon:I,order:3,parent:p,columns:[],getContents:()=>g(!1,!0,!1,!1,[window.OC.Share.SHARE_TYPE_LINK])})),e.register(new c({id:F,name:t("files_sharing","Deleted shares"),caption:t("files_sharing","List of shares you left."),emptyTitle:t("files_sharing","No deleted shares"),emptyCaption:t("files_sharing","Shares you have left will show up here"),icon:U,order:4,parent:p,columns:[],getContents:()=>g(!1,!1,!1,!0)})),e.register(new c({id:C,name:t("files_sharing","Pending shares"),caption:t("files_sharing","List of unapproved shares."),emptyTitle:t("files_sharing","No pending shares"),emptyCaption:t("files_sharing","Shares you have received but not approved will show up here"),icon:J,order:5,parent:p,columns:[],getContents:()=>g(!1,!1,!0,!1)}))},oe=new w({id:"accept-share",displayName:e=>A("files_sharing","Accept share","Accept shares",e.length),iconSvgInline:()=>Q,enabled:(e,s)=>e.length>0&&s.id===C,async exec(e){try{const s=!!e.attributes.remote,i=d("apps/files_sharing/api/v1/{shareBase}/pending/{id}",{shareBase:s?"remote_shares":"shares",id:e.attributes.id});return await u.post(i),R("files:node:deleted",e),!0}catch{return!1}},async execBatch(e,s,i){return Promise.all(e.map(a=>this.exec(a,s,i)))},order:1,inline:()=>!0});y(oe);const le=new w({id:"open-in-files",displayName:()=>t("files","Open in Files"),iconSvgInline:()=>"",enabled:(e,s)=>[p,D,L,H].includes(s.id),async exec(e){return window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:e.fileid},{dir:e.dirname}),null},order:-1e3,default:G.HIDDEN});y(le);const he=new w({id:"reject-share",displayName:e=>A("files_sharing","Reject share","Reject shares",e.length),iconSvgInline:()=>V,enabled:(e,s)=>!(s.id!==C||e.length===0||e.some(i=>i.attributes.remote_id&&i.attributes.share_type===window.OC.Share.SHARE_TYPE_REMOTE_GROUP)),async exec(e){try{const s=!!e.attributes.remote,i=d("apps/files_sharing/api/v1/{shareBase}/{id}",{shareBase:s?"remote_shares":"shares",id:e.attributes.id});return await u.delete(i),R("files:node:deleted",e),!0}catch{return!1}},async execBatch(e,s,i){return Promise.all(e.map(a=>this.exec(a,s,i)))},order:2,inline:()=>!0});y(he);const de=new w({id:"restore-share",displayName:e=>A("files_sharing","Restore share","Restore shares",e.length),iconSvgInline:()=>Z,enabled:(e,s)=>e.length>0&&s.id===F,async exec(e){try{const s=d("apps/files_sharing/api/v1/deletedshares/{id}",{id:e.attributes.id});return await u.post(s),R("files:node:deleted",e),!0}catch{return!1}},async execBatch(e,s,i){return Promise.all(e.map(a=>this.exec(a,s,i)))},order:1,inline:()=>!0});y(de);const ue='<svg width="16" height="16" viewBox="0 0 21.33 21.33" xmlns="http://www.w3.org/2000/svg"><path d="M10.67 1.33a9.34 9.34 0 100 18.68 9.34 9.34 0 000-18.68zM6.93 15.8a2.33 2.33 0 110-4.67 2.33 2.33 0 010 4.67zm1.4-8.87a2.33 2.33 0 114.67 0 2.33 2.33 0 01-4.67 0zm6.07 8.87a2.33 2.33 0 110-4.67 2.33 2.33 0 010 4.67z"/></svg>\n',pe=e=>{const s=k("/avatar/{userId}/32",{userId:e});return'<svg width="32" height="32" viewBox="0 0 32 32"\n		xmlns="http://www.w3.org/2000/svg" class="sharing-status__avatar">\n		<image href="'.concat(s,'" height="32" width="32" />\n	</svg>')},ce=new w({id:"sharing-status",displayName(e){var s,i,a;const n=e[0],r=Object.values(((s=n==null?void 0:n.attributes)==null?void 0:s["share-types"])||{}).flat(),o=(i=n==null?void 0:n.attributes)==null?void 0:i["owner-id"];return r.length>0||o&&o!==((a=m())==null?void 0:a.uid)?t("files_sharing","Shared"):""},title(e){var s,i,a,n;const r=e[0],o=(s=r==null?void 0:r.attributes)==null?void 0:s["owner-id"],l=(i=r==null?void 0:r.attributes)==null?void 0:i["owner-display-name"];return Array.isArray((a=r.attributes)==null?void 0:a["share-types"])?t("files_sharing","Shared multiple times with different people"):o&&o!==((n=m())==null?void 0:n.uid)?t("files_sharing","Shared by {ownerDisplayName}",{ownerDisplayName:l}):t("files_sharing","Show sharing options")},iconSvgInline(e){var s,i,a,n;const r=e[0],o=Object.values(((s=r==null?void 0:r.attributes)==null?void 0:s["share-types"])||{}).flat();if(Array.isArray((i=r.attributes)==null?void 0:i["share-types"]))return E;if(o.includes(_.SHARE_TYPE_LINK)||o.includes(_.SHARE_TYPE_EMAIL))return I;if(o.includes(_.SHARE_TYPE_GROUP)||o.includes(_.SHARE_TYPE_REMOTE_GROUP))return N;if(o.includes(_.SHARE_TYPE_CIRCLE))return ue;const l=(a=r==null?void 0:r.attributes)==null?void 0:a["owner-id"];return l&&l!==((n=m())==null?void 0:n.uid)?pe(l):E},enabled(e){var s,i,a;if(e.length!==1)return!1;const n=e[0],r=(s=n==null?void 0:n.attributes)==null?void 0:s["owner-id"];return Array.isArray((i=n.attributes)==null?void 0:i["share-types"])||r&&r!==((a=m())==null?void 0:a.uid)?!0:(n.permissions&T.SHARE)!==0},async exec(e,s,i){var a,n,r,o;return e.permissions&T.READ?((o=(r=(n=(a=window.OCA)==null?void 0:a.Files)==null?void 0:n.Sidebar)==null?void 0:r.setActiveTab)==null||o.call(r,"sharing"),q.exec(e,s,i)):null},inline:()=>!0});y(ce);ne(),b("nc:share-attributes",{nc:"http://nextcloud.org/ns"}),b("oc:share-types",{oc:"http://owncloud.org/ns"}),b("ocs:share-permissions",{ocs:"http://open-collaboration-services.org/ns"});
