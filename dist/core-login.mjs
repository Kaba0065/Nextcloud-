/*! third party licenses: dist/vendor.LICENSE.txt */
import"./chunks/modulepreload-polyfill-DGCCkazm.mjs";import{F as w,a6 as _,aj as p,a5 as m,bW as b,bR as d,bD as c,bO as a,aH as f}from"./core-common.mjs";import{q as C}from"./chunks/base-_1FLyYdj.mjs";import{w as P,n,Q as L,U as k}from"./chunks/icons-BxSPavMS.mjs";import{N}from"./chunks/Nextcloud-DbcSkFZC.mjs";import"./chunks/jquery-CAX9BRLJ.mjs";import"./chunks/index-Ca0QcE7e.mjs";import"./chunks/toast-7xJhDYMn-BrG8uCqw.mjs";import"./chunks/index-DgCiVkaQ.mjs";import"./chunks/index-D0tJKDfW.mjs";import"./chunks/preload-helper-3Yr03P9X.mjs";import"./chunks/requesttoken-Db1tL2y3.mjs";import"./chunks/style-3JoZM1Ml.mjs";import"./chunks/moment-B1DRcIE-.mjs";import"./chunks/index-BLIV22dB.mjs";import"./chunks/index-Biv1VH4I.mjs";const A={name:"LoginButton",components:{ArrowRight:P,NcButton:w},props:{value:{type:String,default:t("core","Log in")},valueLoading:{type:String,default:t("core","Logging in â€¦")},loading:{type:Boolean,required:!0},invertedColors:{type:Boolean,default:!1}}};var x=function(){var e=this,s=e._self._c;return s("NcButton",{attrs:{type:"primary","native-type":"submit",wide:!0},on:{click:function(r){return e.$emit("click")}},scopedSlots:e._u([{key:"icon",fn:function(){return[e.loading?s("div",{staticClass:"submit-wrapper__icon icon-loading-small-dark"}):s("ArrowRight",{staticClass:"submit-wrapper__icon"})]},proxy:!0}])},[e._v(" "+e._s(e.loading?e.valueLoading:e.value)+" ")])},U=[],F=n(A,x,U,!1,null,"944b496d",null,null);const u=F.exports,B={name:"LoginForm",components:{LoginButton:u,NcPasswordField:_,NcTextField:p,NcNoteCard:m},props:{username:{type:String,default:""},redirectUrl:{type:[String,Boolean],default:!1},errors:{type:Array,default:()=>[]},messages:{type:Array,default:()=>[]},throttleDelay:{type:Number,default:0},autoCompleteAllowed:{type:Boolean,default:!0},directLogin:{type:Boolean,default:!1}},data(){var e,s;return{loading:!1,timezone:(s=(e=new Intl.DateTimeFormat)==null?void 0:e.resolvedOptions())==null?void 0:s.timeZone,timezoneOffset:-new Date().getTimezoneOffset()/60,headline:t("core","Log in to {productName}",{productName:OC.theme.name}),user:"",password:""}},computed:{isError(){return this.invalidPassword||this.userDisabled||this.throttleDelay>5e3},errorLabel(){if(this.invalidPassword)return t("core","Wrong username or password.");if(this.userDisabled)return t("core","User disabled");if(this.throttleDelay>5e3)return t("core","We have detected multiple invalid login attempts from your IP. Therefore your next login is throttled up to 30 seconds.")},apacheAuthFailed(){return this.errors.indexOf("apacheAuthFailed")!==-1},csrfCheckFailed(){return this.errors.indexOf("csrfCheckFailed")!==-1},internalException(){return this.errors.indexOf("internalexception")!==-1},invalidPassword(){return this.errors.indexOf("invalidpassword")!==-1},userDisabled(){return this.errors.indexOf("userdisabled")!==-1},loadingIcon(){return b("core","loading-dark.gif")},loginActionUrl(){return d("login")}},mounted(){this.username===""?this.$refs.user.$refs.inputField.$refs.input.focus():(this.user=this.username,this.$refs.password.$refs.inputField.$refs.input.focus())},methods:{updateUsername(){this.$emit("update:username",this.user)},submit(){this.loading=!0,this.$emit("submit")}}};var T=function(){var e=this,s=e._self._c;return s("form",{ref:"loginForm",staticClass:"login-form",attrs:{method:"post",name:"login",action:e.loginActionUrl},on:{submit:e.submit}},[s("fieldset",{staticClass:"login-form__fieldset",attrs:{"data-login-form":""}},[e.apacheAuthFailed?s("NcNoteCard",{attrs:{title:e.t("core","Server side authentication failed!"),type:"warning"}},[e._v(" "+e._s(e.t("core","Please contact your administrator."))+" ")]):e._e(),e.csrfCheckFailed?s("NcNoteCard",{attrs:{heading:e.t("core","Temporary error"),type:"error"}},[e._v(" "+e._s(e.t("core","Please try again."))+" ")]):e._e(),e.messages.length>0?s("NcNoteCard",e._l(e.messages,function(r,o){return s("div",{key:o},[e._v(" "+e._s(r)),s("br")])}),0):e._e(),e.internalException?s("NcNoteCard",{class:e.t("core","An internal error occurred."),attrs:{type:"warning"}},[e._v(" "+e._s(e.t("core","Please try again or contact your administrator."))+" ")]):e._e(),s("div",{staticClass:"hidden",attrs:{id:"message"}},[s("img",{staticClass:"float-spinner",attrs:{alt:"",src:e.loadingIcon}}),s("span",{attrs:{id:"messageText"}}),s("div",{staticStyle:{clear:"both"}})]),s("h2",{staticClass:"login-form__headline",attrs:{"data-login-form-headline":""},domProps:{innerHTML:e._s(e.headline)}}),s("NcTextField",{ref:"user",class:{shake:e.invalidPassword},attrs:{id:"user",label:e.t("core","Account name or email"),name:"user",value:e.user,autocapitalize:"none",spellchecking:!1,autocomplete:e.autoCompleteAllowed?"username":"off",required:"","data-login-form-input-user":""},on:{"update:value":function(r){e.user=r},change:e.updateUsername}}),s("NcPasswordField",{ref:"password",class:{shake:e.invalidPassword},attrs:{id:"password",name:"password",value:e.password,spellchecking:!1,autocapitalize:"none",autocomplete:e.autoCompleteAllowed?"current-password":"off",label:e.t("core","Password"),"helper-text":e.errorLabel,error:e.isError,"data-login-form-input-password":"",required:""},on:{"update:value":function(r){e.password=r}}}),s("LoginButton",{attrs:{"data-login-form-submit":"",loading:e.loading}}),e.redirectUrl?s("input",{attrs:{type:"hidden",name:"redirect_url"},domProps:{value:e.redirectUrl}}):e._e(),s("input",{attrs:{type:"hidden",name:"timezone"},domProps:{value:e.timezone}}),s("input",{attrs:{type:"hidden",name:"timezone_offset"},domProps:{value:e.timezoneOffset}}),s("input",{attrs:{type:"hidden",name:"requesttoken"},domProps:{value:e.OC.requestToken}}),e.directLogin?s("input",{attrs:{type:"hidden",name:"direct",value:"1"}}):e._e()],1)])},O=[],R=n(B,T,O,!1,null,"1930cb67",null,null);const D=R.exports;function I(e){const s=d("/login/webauthn/start");return c.post(s,{loginName:e}).then(r=>r.data)}function S(e){const s=d("/login/webauthn/finish");return c.post(s,{data:e}).then(r=>r.data)}class h extends Error{}const E={name:"PasswordLessLoginForm",components:{LoginButton:u,InformationIcon:L,LockOpenIcon:k,NcTextField:p},props:{username:{type:String,default:""},redirectUrl:{type:[String,Boolean],default:!1},autoCompleteAllowed:{type:Boolean,default:!0},isHttps:{type:Boolean,default:!1},isLocalhost:{type:Boolean,default:!1},hasPublicKeyCredential:{type:Boolean,default:!1}},data(){return{user:this.username,loading:!1,validCredentials:!0}},methods:{authenticate(){this.$refs.loginForm.checkValidity()&&(console.debug("passwordless login initiated"),this.getAuthenticationData(this.user).then(e=>(console.debug(e),e)).then(this.sign).then(this.completeAuthentication).catch(e=>{if(e instanceof h){this.validCredentials=!1;return}console.debug(e)}))},changeUsername(e){this.user=e,this.$emit("update:username",this.user)},getAuthenticationData(e){const s=function(r){r=r.replace(/-/g,"+").replace(/_/g,"/");const o=r.length%4;if(o){if(o===1)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");r+=new Array(5-o).join("=")}return window.atob(r)};return I(e).then(r=>{if(console.debug("Obtained PublicKeyCredentialRequestOptions"),console.debug(r),!Object.prototype.hasOwnProperty.call(r,"allowCredentials"))throw console.debug("No credentials found."),new h;return r.challenge=Uint8Array.from(s(r.challenge),o=>o.charCodeAt(0)),r.allowCredentials=r.allowCredentials.map(function(o){return{...o,id:Uint8Array.from(s(o.id),i=>i.charCodeAt(0))}}),console.debug("Converted PublicKeyCredentialRequestOptions"),console.debug(r),r}).catch(r=>{throw console.debug("Error while obtaining data"),r})},sign(e){const s=function(o){return window.btoa(String.fromCharCode(...o))},r=function(o){return String.fromCharCode(...o)};return navigator.credentials.get({publicKey:e}).then(o=>(console.debug(o),console.debug(new Uint8Array(o.rawId)),console.debug(s(new Uint8Array(o.rawId))),{id:o.id,type:o.type,rawId:s(new Uint8Array(o.rawId)),response:{authenticatorData:s(new Uint8Array(o.response.authenticatorData)),clientDataJSON:s(new Uint8Array(o.response.clientDataJSON)),signature:s(new Uint8Array(o.response.signature)),userHandle:o.response.userHandle?r(new Uint8Array(o.response.userHandle)):null}})).then(o=>(console.debug(o),o)).catch(o=>{console.debug("GOT AN ERROR!"),console.debug(o)})},completeAuthentication(e){console.debug("TIME TO COMPLETE");const s=this.redirectUrl;return S(JSON.stringify(e)).then(({defaultRedirectUrl:r})=>{console.debug("Logged in redirecting"),window.location.href=s||r}).catch(r=>{console.debug("GOT AN ERROR WHILE SUBMITTING CHALLENGE!"),console.debug(r)})},submit(){}}};var $=function(){var e=this,s=e._self._c;return(e.isHttps||e.isLocalhost)&&e.hasPublicKeyCredential?s("form",{ref:"loginForm",attrs:{method:"post",name:"login"},on:{submit:function(r){return r.preventDefault(),e.submit.apply(null,arguments)}}},[s("h2",[e._v(e._s(e.t("core","Log in with a device")))]),s("fieldset",[s("NcTextField",{attrs:{required:"",value:e.user,autocomplete:e.autoCompleteAllowed?"on":"off",error:!e.validCredentials,label:e.t("core","Username or email"),placeholder:e.t("core","Username or email"),"helper-text":e.validCredentials?"":e.t("core","Your account is not setup for passwordless login.")},on:{"update:value":e.changeUsername}}),e.validCredentials?s("LoginButton",{attrs:{loading:e.loading},on:{click:e.authenticate}}):e._e()],1)]):e.hasPublicKeyCredential?!e.isHttps&&!e.isLocalhost?s("div",{staticClass:"update"},[s("LockOpenIcon",{attrs:{size:"70"}}),s("h2",[e._v(e._s(e.t("core","Your connection is not secure")))]),s("p",{staticClass:"infogroup"},[e._v(" "+e._s(e.t("core","Passwordless authentication is only available over a secure connection."))+" ")])],1):e._e():s("div",{staticClass:"update"},[s("InformationIcon",{attrs:{size:"70"}}),s("h2",[e._v(e._s(e.t("core","Browser not supported")))]),s("p",{staticClass:"infogroup"},[e._v(" "+e._s(e.t("core","Passwordless authentication is not supported in your browser."))+" ")])],1)},q=[],z=n(E,$,q,!1,null,"cf175c9c",null,null);const H=z.exports,K={name:"ResetPassword",components:{LoginButton:u,NcNoteCard:m,NcTextField:p},props:{username:{type:String,required:!0},resetPasswordLink:{type:String,required:!0}},data(){return{error:!1,loading:!1,message:void 0,user:this.username}},watch:{username(e){this.user=e}},methods:{updateUsername(){this.$emit("update:username",this.user)},submit(){this.loading=!0,this.error=!1,this.message="";const e=d("/lostpassword/email"),s={user:this.user};return c.post(e,s).then(r=>r.data).then(r=>{if(r.status!=="success")throw new Error("got status ".concat(r.status));this.message="send-success"}).catch(r=>{console.error("could not send reset email request",r),this.error=!0,this.message="send-error"}).then(()=>{this.loading=!1})}}};var M=function(){var e=this,s=e._self._c;return s("form",{staticClass:"login-form",on:{submit:function(r){return r.preventDefault(),e.submit.apply(null,arguments)}}},[s("fieldset",{staticClass:"login-form__fieldset"},[s("NcTextField",{attrs:{id:"user",value:e.user,name:"user",autocapitalize:"off",label:e.t("core","Account name or email"),required:""},on:{"update:value":function(r){e.user=r},change:e.updateUsername}}),s("LoginButton",{attrs:{value:e.t("core","Reset password")}}),e.message==="send-success"?s("NcNoteCard",{attrs:{type:"success"}},[e._v(" "+e._s(e.t("core","If this account exists, a password reset message has been sent to its email address. If you do not receive it, verify your email address and/or account name, check your spam/junk folders or ask your local administration for help."))+" ")]):e.message==="send-error"?s("NcNoteCard",{attrs:{type:"error"}},[e._v(" "+e._s(e.t("core","Couldn't send reset email. Please contact your administrator."))+" ")]):e.message==="reset-error"?s("NcNoteCard",{attrs:{type:"error"}},[e._v(" "+e._s(e.t("core","Password cannot be changed. Please contact your administrator."))+" ")]):e._e(),s("a",{staticClass:"login-form__link",attrs:{href:"#"},on:{click:function(r){return r.preventDefault(),e.$emit("abort")}}},[e._v(" "+e._s(e.t("core","Back to login"))+" ")])],1)])},j=[],G=n(K,M,j,!1,null,"e656d13c",null,null);const W=G.exports,J={name:"UpdatePassword",components:{LoginButton:u},props:{username:{type:String,required:!0},resetPasswordTarget:{type:String,required:!0}},data(){return{error:!1,loading:!1,message:void 0,user:this.username,password:"",encrypted:!1,proceed:!1}},watch:{username(e){this.user=e}},methods:{async submit(){this.loading=!0,this.error=!1,this.message="";try{const{data:e}=await c.post(this.resetPasswordTarget,{password:this.password,proceed:this.proceed});if(e&&e.status==="success")this.message="send-success",this.$emit("update:username",this.user),this.$emit("done");else if(e&&e.encryption)this.encrypted=!0;else throw e&&e.msg?new Error(e.msg):new Error}catch(e){this.error=!0,this.message=e.message?e.message:t("core","Password cannot be changed. Please contact your administrator.")}finally{this.loading=!1}}}};var Y=function(){var e=this,s=e._self._c;return s("form",{on:{submit:function(r){return r.preventDefault(),e.submit.apply(null,arguments)}}},[s("fieldset",[s("p",[s("label",{staticClass:"infield",attrs:{for:"password"}},[e._v(e._s(e.t("core","New password")))]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{id:"password",type:"password",name:"password",autocomplete:"new-password",autocapitalize:"none",spellcheck:"false",required:"",placeholder:e.t("core","New password")},domProps:{value:e.password},on:{input:function(r){r.target.composing||(e.password=r.target.value)}}})]),e.encrypted?s("div",{staticClass:"update"},[s("p",[e._v(" "+e._s(e.t("core","Your files are encrypted. There will be no way to get your data back after your password is reset. If you are not sure what to do, please contact your administrator before you continue. Do you really want to continue?"))+" ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.proceed,expression:"proceed"}],staticClass:"checkbox",attrs:{id:"encrypted-continue",type:"checkbox"},domProps:{checked:Array.isArray(e.proceed)?e._i(e.proceed,null)>-1:e.proceed},on:{change:function(r){var o=e.proceed,i=r.target,y=!!i.checked;if(Array.isArray(o)){var g=null,l=e._i(o,g);i.checked?l<0&&(e.proceed=o.concat([g])):l>-1&&(e.proceed=o.slice(0,l).concat(o.slice(l+1)))}else e.proceed=y}}}),s("label",{attrs:{for:"encrypted-continue"}},[e._v(" "+e._s(e.t("core","I know what I'm doing"))+" ")])]):e._e(),s("LoginButton",{attrs:{loading:e.loading,value:e.t("core","Reset password"),"value-loading":e.t("core","Resetting password")}}),e.error&&e.message?s("p",{class:{warning:e.error}},[e._v(" "+e._s(e.message)+" ")]):e._e()],1)])},Q=[],V=n(J,Y,Q,!1,null,"ed90e0eb",null,null);const Z=V.exports,v=C.parse(location.search);if(v.clear==="1")try{window.localStorage.clear(),window.sessionStorage.clear(),console.debug("Browser storage cleared")}catch(e){console.error("Could not clear browser storage",e)}const X={name:"Login",components:{LoginForm:D,PasswordLessLoginForm:H,ResetPassword:W,UpdatePassword:Z,NcButton:w,NcNoteCard:m},data(){return{loading:!1,user:a("core","loginUsername",""),passwordlessLogin:!1,resetPassword:!1,errors:a("core","loginErrors",[]),messages:a("core","loginMessages",[]),redirectUrl:a("core","loginRedirectUrl",!1),throttleDelay:a("core","loginThrottleDelay",0),canResetPassword:a("core","loginCanResetPassword",!1),resetPasswordLink:a("core","loginResetPasswordLink",""),autoCompleteAllowed:a("core","loginAutocomplete",!0),resetPasswordTarget:a("core","resetPasswordTarget",""),resetPasswordUser:a("core","resetPasswordUser",""),directLogin:v.direct==="1",hasPasswordless:a("core","webauthn-available",!1),countAlternativeLogins:a("core","countAlternativeLogins",!1),alternativeLogins:a("core","alternativeLogins",[]),isHttps:window.location.protocol==="https:",isLocalhost:window.location.hostname==="localhost",hasPublicKeyCredential:typeof window.PublicKeyCredential<"u",hideLoginForm:a("core","hideLoginForm",!1)}},methods:{passwordResetFinished(){this.resetPasswordTarget="",this.directLogin=!0}}};var ee=function(){var e=this,s=e._self._c;return s("div",{staticClass:"guest-box login-box"},[!e.hideLoginForm||e.directLogin?[s("transition",{attrs:{name:"fade",mode:"out-in"}},[!e.passwordlessLogin&&!e.resetPassword&&e.resetPasswordTarget===""?s("div",[s("LoginForm",{attrs:{username:e.user,"redirect-url":e.redirectUrl,"direct-login":e.directLogin,messages:e.messages,errors:e.errors,"throttle-delay":e.throttleDelay,"auto-complete-allowed":e.autoCompleteAllowed},on:{"update:username":function(r){e.user=r},submit:function(r){e.loading=!0}}}),e.canResetPassword&&e.resetPasswordLink!==""?s("a",{staticClass:"login-box__link",attrs:{id:"lost-password",href:e.resetPasswordLink}},[e._v(" "+e._s(e.t("core","Forgot password?"))+" ")]):e.canResetPassword&&!e.resetPassword?s("a",{staticClass:"login-box__link",attrs:{id:"lost-password",href:e.resetPasswordLink},on:{click:function(r){r.preventDefault(),e.resetPassword=!0}}},[e._v(" "+e._s(e.t("core","Forgot password?"))+" ")]):e._e(),e.hasPasswordless?[e.countAlternativeLogins?s("div",{staticClass:"alternative-logins"},[e.hasPasswordless?s("a",{staticClass:"button",class:{"single-alt-login-option":e.countAlternativeLogins},attrs:{href:"#"},on:{click:function(r){r.preventDefault(),e.passwordlessLogin=!0}}},[e._v(" "+e._s(e.t("core","Log in with a device"))+" ")]):e._e()]):s("a",{attrs:{href:"#"},on:{click:function(r){r.preventDefault(),e.passwordlessLogin=!0}}},[e._v(" "+e._s(e.t("core","Log in with a device"))+" ")])]:e._e()],2):!e.loading&&e.passwordlessLogin?s("div",{key:"reset",staticClass:"login-additional login-passwordless"},[s("PasswordLessLoginForm",{attrs:{username:e.user,"redirect-url":e.redirectUrl,"auto-complete-allowed":e.autoCompleteAllowed,"is-https":e.isHttps,"is-localhost":e.isLocalhost,"has-public-key-credential":e.hasPublicKeyCredential},on:{"update:username":function(r){e.user=r},submit:function(r){e.loading=!0}}}),s("NcButton",{attrs:{type:"tertiary","aria-label":e.t("core","Back to login form"),wide:!0},on:{click:function(r){e.passwordlessLogin=!1}}},[e._v(" "+e._s(e.t("core","Back"))+" ")])],1):!e.loading&&e.canResetPassword?s("div",{key:"reset",staticClass:"login-additional"},[s("div",{staticClass:"lost-password-container"},[e.resetPassword?s("ResetPassword",{attrs:{username:e.user,"reset-password-link":e.resetPasswordLink},on:{"update:username":function(r){e.user=r},abort:function(r){e.resetPassword=!1}}}):e._e()],1)]):e.resetPasswordTarget!==""?s("div",[s("UpdatePassword",{attrs:{username:e.user,"reset-password-target":e.resetPasswordTarget},on:{"update:username":function(r){e.user=r},done:e.passwordResetFinished}})],1):e._e()])]:[s("transition",{attrs:{name:"fade",mode:"out-in"}},[s("NcNoteCard",{attrs:{type:"warning",title:e.t("core","Login form is disabled.")}},[e._v(" "+e._s(e.t("core","Please contact your administrator."))+" ")])],1)],s("div",{staticClass:"alternative-logins",attrs:{id:"alternative-logins"}},e._l(e.alternativeLogins,function(r,o){return s("NcButton",{key:o,class:[r.class],attrs:{type:"secondary",wide:!0,role:"link",href:r.href}},[e._v(" "+e._s(r.name)+" ")])}),1)],2)},te=[],se=n(X,ee,te,!1,null,null,null,null);const re=se.exports;f.mixin(N);const oe=f.extend(re);new oe().$mount("#login");
