{"version":3,"file":"comments-comments-app.mjs","sources":["../node_modules/vue-observe-visibility/dist/vue-observe-visibility.esm.js","../apps/comments/src/utils/cancelableRequest.js","../apps/comments/src/services/ReadComments.ts","../apps/comments/src/views/Comments.vue","../apps/comments/src/services/CommentsInstance.js","../apps/comments/src/comments-app.js"],"sourcesContent":["function _typeof(obj) {\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n    return arr2;\n  }\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction processOptions(value) {\n  var options;\n\n  if (typeof value === 'function') {\n    // Simple options (callback-only)\n    options = {\n      callback: value\n    };\n  } else {\n    // Options object\n    options = value;\n  }\n\n  return options;\n}\nfunction throttle(callback, delay) {\n  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var timeout;\n  var lastState;\n  var currentArgs;\n\n  var throttled = function throttled(state) {\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    currentArgs = args;\n    if (timeout && state === lastState) return;\n    var leading = options.leading;\n\n    if (typeof leading === 'function') {\n      leading = leading(state, lastState);\n    }\n\n    if ((!timeout || state !== lastState) && leading) {\n      callback.apply(void 0, [state].concat(_toConsumableArray(currentArgs)));\n    }\n\n    lastState = state;\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      callback.apply(void 0, [state].concat(_toConsumableArray(currentArgs)));\n      timeout = 0;\n    }, delay);\n  };\n\n  throttled._clear = function () {\n    clearTimeout(timeout);\n    timeout = null;\n  };\n\n  return throttled;\n}\nfunction deepEqual(val1, val2) {\n  if (val1 === val2) return true;\n\n  if (_typeof(val1) === 'object') {\n    for (var key in val1) {\n      if (!deepEqual(val1[key], val2[key])) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  return false;\n}\n\nvar VisibilityState =\n/*#__PURE__*/\nfunction () {\n  function VisibilityState(el, options, vnode) {\n    _classCallCheck(this, VisibilityState);\n\n    this.el = el;\n    this.observer = null;\n    this.frozen = false;\n    this.createObserver(options, vnode);\n  }\n\n  _createClass(VisibilityState, [{\n    key: \"createObserver\",\n    value: function createObserver(options, vnode) {\n      var _this = this;\n\n      if (this.observer) {\n        this.destroyObserver();\n      }\n\n      if (this.frozen) return;\n      this.options = processOptions(options);\n\n      this.callback = function (result, entry) {\n        _this.options.callback(result, entry);\n\n        if (result && _this.options.once) {\n          _this.frozen = true;\n\n          _this.destroyObserver();\n        }\n      }; // Throttle\n\n\n      if (this.callback && this.options.throttle) {\n        var _ref = this.options.throttleOptions || {},\n            _leading = _ref.leading;\n\n        this.callback = throttle(this.callback, this.options.throttle, {\n          leading: function leading(state) {\n            return _leading === 'both' || _leading === 'visible' && state || _leading === 'hidden' && !state;\n          }\n        });\n      }\n\n      this.oldResult = undefined;\n      this.observer = new IntersectionObserver(function (entries) {\n        var entry = entries[0];\n\n        if (entries.length > 1) {\n          var intersectingEntry = entries.find(function (e) {\n            return e.isIntersecting;\n          });\n\n          if (intersectingEntry) {\n            entry = intersectingEntry;\n          }\n        }\n\n        if (_this.callback) {\n          // Use isIntersecting if possible because browsers can report isIntersecting as true, but intersectionRatio as 0, when something very slowly enters the viewport.\n          var result = entry.isIntersecting && entry.intersectionRatio >= _this.threshold;\n          if (result === _this.oldResult) return;\n          _this.oldResult = result;\n\n          _this.callback(result, entry);\n        }\n      }, this.options.intersection); // Wait for the element to be in document\n\n      vnode.context.$nextTick(function () {\n        if (_this.observer) {\n          _this.observer.observe(_this.el);\n        }\n      });\n    }\n  }, {\n    key: \"destroyObserver\",\n    value: function destroyObserver() {\n      if (this.observer) {\n        this.observer.disconnect();\n        this.observer = null;\n      } // Cancel throttled call\n\n\n      if (this.callback && this.callback._clear) {\n        this.callback._clear();\n\n        this.callback = null;\n      }\n    }\n  }, {\n    key: \"threshold\",\n    get: function get() {\n      return this.options.intersection && typeof this.options.intersection.threshold === 'number' ? this.options.intersection.threshold : 0;\n    }\n  }]);\n\n  return VisibilityState;\n}();\n\nfunction bind(el, _ref2, vnode) {\n  var value = _ref2.value;\n  if (!value) return;\n\n  if (typeof IntersectionObserver === 'undefined') {\n    console.warn('[vue-observe-visibility] IntersectionObserver API is not available in your browser. Please install this polyfill: https://github.com/w3c/IntersectionObserver/tree/master/polyfill');\n  } else {\n    var state = new VisibilityState(el, value, vnode);\n    el._vue_visibilityState = state;\n  }\n}\n\nfunction update(el, _ref3, vnode) {\n  var value = _ref3.value,\n      oldValue = _ref3.oldValue;\n  if (deepEqual(value, oldValue)) return;\n  var state = el._vue_visibilityState;\n\n  if (!value) {\n    unbind(el);\n    return;\n  }\n\n  if (state) {\n    state.createObserver(value, vnode);\n  } else {\n    bind(el, {\n      value: value\n    }, vnode);\n  }\n}\n\nfunction unbind(el) {\n  var state = el._vue_visibilityState;\n\n  if (state) {\n    state.destroyObserver();\n    delete el._vue_visibilityState;\n  }\n}\n\nvar ObserveVisibility = {\n  bind: bind,\n  update: update,\n  unbind: unbind\n};\n\nfunction install(Vue) {\n  Vue.directive('observe-visibility', ObserveVisibility);\n  /* -- Add more components here -- */\n}\n/* -- Plugin definition & Auto-install -- */\n\n/* You shouldn't have to modify the code below */\n// Plugin\n\nvar plugin = {\n  // eslint-disable-next-line no-undef\n  version: \"1.0.0\",\n  install: install\n};\n\nvar GlobalVue = null;\n\nif (typeof window !== 'undefined') {\n  GlobalVue = window.Vue;\n} else if (typeof global !== 'undefined') {\n  GlobalVue = global.Vue;\n}\n\nif (GlobalVue) {\n  GlobalVue.use(plugin);\n}\n\nexport default plugin;\nexport { ObserveVisibility, install };\n","/**\n * @copyright Copyright (c) 2020 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\n/**\n * Creates a cancelable axios 'request object'.\n *\n * @param {Function} request the axios promise request\n * @return {object}\n */\nconst cancelableRequest = function(request) {\n\tconst controller = new AbortController()\n\tconst signal = controller.signal\n\n\t/**\n\t * Execute the request\n\t *\n\t * @param {string} url the url to send the request to\n\t * @param {object} [options] optional config for the request\n\t */\n\tconst fetch = async function(url, options) {\n\t\tconst response = await request(\n\t\t\turl,\n\t\t\tObject.assign({ signal }, options)\n\t\t)\n\t\treturn response\n\t}\n\n\treturn {\n\t\trequest: fetch,\n\t\tabort: () => controller.abort(),\n\t}\n}\n\nexport default cancelableRequest\n","/**\n * @copyright 2023 Christopher Ng <chrng8@gmail.com>\n *\n * @author Christopher Ng <chrng8@gmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport client from './DavClient.js'\n\nimport type { Response } from 'webdav'\n\n/**\n * Mark comments older than the date timestamp as read\n *\n * @param resourceType the resource type\n * @param resourceId the resource ID\n * @param date the date object\n */\nexport const markCommentsAsRead = (\n\tresourceType: string,\n\tresourceId: number,\n\tdate: Date,\n): Promise<Response> => {\n\tconst resourcePath = ['', resourceType, resourceId].join('/')\n\tconst readMarker = date.toUTCString()\n\n\treturn client.customRequest(resourcePath, {\n\t\tmethod: 'PROPPATCH',\n\t\tdata: `<?xml version=\"1.0\"?>\n\t\t\t<d:propertyupdate\n\t\t\t\txmlns:d=\"DAV:\"\n\t\t\t\txmlns:oc=\"http://owncloud.org/ns\">\n\t\t\t<d:set>\n\t\t\t\t<d:prop>\n\t\t\t\t\t<oc:readMarker>${readMarker}</oc:readMarker>\n\t\t\t\t</d:prop>\n\t\t\t</d:set>\n\t\t\t</d:propertyupdate>`,\n\t})\n}\n","<!--\n  - @copyright Copyright (c) 2020 John Molakvoæ <skjnldsv@protonmail.com>\n  -\n  - @author John Molakvoæ <skjnldsv@protonmail.com>\n  - @author Richard Steinmetz <richard@steinmetz.cloud>\n  -\n  - @license GNU AGPL version 3 or any later version\n  -\n  - This program is free software: you can redistribute it and/or modify\n  - it under the terms of the GNU Affero General Public License as\n  - published by the Free Software Foundation, either version 3 of the\n  - License, or (at your option) any later version.\n  -\n  - This program is distributed in the hope that it will be useful,\n  - but WITHOUT ANY WARRANTY; without even the implied warranty of\n  - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n  - GNU Affero General Public License for more details.\n  -\n  - You should have received a copy of the GNU Affero General Public License\n  - along with this program. If not, see <http://www.gnu.org/licenses/>.\n  -\n  -->\n\n<template>\n\t<div v-observe-visibility=\"onVisibilityChange\"\n\t\tclass=\"comments\"\n\t\t:class=\"{ 'icon-loading': isFirstLoading }\">\n\t\t<!-- Editor -->\n\t\t<Comment v-bind=\"editorData\"\n\t\t\t:auto-complete=\"autoComplete\"\n\t\t\t:resource-type=\"resourceType\"\n\t\t\t:editor=\"true\"\n\t\t\t:user-data=\"userData\"\n\t\t\t:resource-id=\"resourceId\"\n\t\t\tclass=\"comments__writer\"\n\t\t\t@new=\"onNewComment\" />\n\n\t\t<template v-if=\"!isFirstLoading\">\n\t\t\t<NcEmptyContent v-if=\"!hasComments && done\"\n\t\t\t\tclass=\"comments__empty\"\n\t\t\t\t:name=\"t('comments', 'No comments yet, start the conversation!')\">\n\t\t\t\t<template #icon>\n\t\t\t\t\t<MessageReplyTextIcon />\n\t\t\t\t</template>\n\t\t\t</NcEmptyContent>\n\t\t\t<ul v-else>\n\t\t\t\t<!-- Comments -->\n\t\t\t\t<Comment v-for=\"comment in comments\"\n\t\t\t\t\t:key=\"comment.props.id\"\n\t\t\t\t\ttag=\"li\"\n\t\t\t\t\tv-bind=\"comment.props\"\n\t\t\t\t\t:auto-complete=\"autoComplete\"\n\t\t\t\t\t:resource-type=\"resourceType\"\n\t\t\t\t\t:message.sync=\"comment.props.message\"\n\t\t\t\t\t:resource-id=\"resourceId\"\n\t\t\t\t\t:user-data=\"genMentionsData(comment.props.mentions)\"\n\t\t\t\t\tclass=\"comments__list\"\n\t\t\t\t\t@delete=\"onDelete\" />\n\t\t\t</ul>\n\n\t\t\t<!-- Loading more message -->\n\t\t\t<div v-if=\"loading && !isFirstLoading\" class=\"comments__info icon-loading\" />\n\n\t\t\t<div v-else-if=\"hasComments && done\" class=\"comments__info\">\n\t\t\t\t{{ t('comments', 'No more messages') }}\n\t\t\t</div>\n\n\t\t\t<!-- Error message -->\n\t\t\t<template v-else-if=\"error\">\n\t\t\t\t<NcEmptyContent class=\"comments__error\" :name=\"error\">\n\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t<AlertCircleOutlineIcon />\n\t\t\t\t\t</template>\n\t\t\t\t</NcEmptyContent>\n\t\t\t\t<NcButton class=\"comments__retry\" @click=\"getComments\">\n\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t<RefreshIcon />\n\t\t\t\t\t</template>\n\t\t\t\t\t{{ t('comments', 'Retry') }}\n\t\t\t\t</NcButton>\n\t\t\t</template>\n\t\t</template>\n\t</div>\n</template>\n\n<script>\nimport { showError } from '@nextcloud/dialogs'\nimport { translate as t } from '@nextcloud/l10n'\nimport VTooltip from 'v-tooltip'\nimport Vue from 'vue'\nimport VueObserveVisibility from 'vue-observe-visibility'\n\nimport NcEmptyContent from '@nextcloud/vue/dist/Components/NcEmptyContent.js'\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\nimport RefreshIcon from 'vue-material-design-icons/Refresh.vue'\nimport MessageReplyTextIcon from 'vue-material-design-icons/MessageReplyText.vue'\nimport AlertCircleOutlineIcon from 'vue-material-design-icons/AlertCircleOutline.vue'\n\nimport Comment from '../components/Comment.vue'\nimport { getComments, DEFAULT_LIMIT } from '../services/GetComments.ts'\nimport cancelableRequest from '../utils/cancelableRequest.js'\nimport { markCommentsAsRead } from '../services/ReadComments.ts'\nimport CommentView from '../mixins/CommentView'\n\nVue.use(VTooltip)\nVue.use(VueObserveVisibility)\n\nexport default {\n\tname: 'Comments',\n\n\tcomponents: {\n\t\tComment,\n\t\tNcEmptyContent,\n\t\tNcButton,\n\t\tRefreshIcon,\n\t\tMessageReplyTextIcon,\n\t\tAlertCircleOutlineIcon,\n\t},\n\n\tmixins: [CommentView],\n\n\tdata() {\n\t\treturn {\n\t\t\terror: '',\n\t\t\tloading: false,\n\t\t\tdone: false,\n\n\t\t\tresourceId: null,\n\t\t\toffset: 0,\n\t\t\tcomments: [],\n\n\t\t\tcancelRequest: () => {},\n\n\t\t\tComment,\n\t\t\tuserData: {},\n\t\t}\n\t},\n\n\tcomputed: {\n\t\thasComments() {\n\t\t\treturn this.comments.length > 0\n\t\t},\n\t\tisFirstLoading() {\n\t\t\treturn this.loading && this.offset === 0\n\t\t},\n\t},\n\n\tmethods: {\n\t\tt,\n\n\t\tasync onVisibilityChange(isVisible) {\n\t\t\tif (isVisible) {\n\t\t\t\ttry {\n\t\t\t\t\tawait markCommentsAsRead(this.resourceType, this.resourceId, new Date())\n\t\t\t\t} catch (e) {\n\t\t\t\t\tshowError(e.message || t('comments', 'Failed to mark comments as read'))\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Update current resourceId and fetch new data\n\t\t *\n\t\t * @param {number} resourceId the current resourceId (fileId...)\n\t\t */\n\t\tasync update(resourceId) {\n\t\t\tthis.resourceId = resourceId\n\t\t\tthis.resetState()\n\t\t\tthis.getComments()\n\t\t},\n\n\t\t/**\n\t\t * Ran when the bottom of the tab is reached\n\t\t */\n\t\tonScrollBottomReached() {\n\t\t\t/**\n\t\t\t * Do not fetch more if we:\n\t\t\t * - are showing an error\n\t\t\t * - already fetched everything\n\t\t\t * - are currently loading\n\t\t\t */\n\t\t\tif (this.error || this.done || this.loading) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tthis.getComments()\n\t\t},\n\n\t\t/**\n\t\t * Get the existing shares infos\n\t\t */\n\t\tasync getComments() {\n\t\t\t// Cancel any ongoing request\n\t\t\tthis.cancelRequest('cancel')\n\n\t\t\ttry {\n\t\t\t\tthis.loading = true\n\t\t\t\tthis.error = ''\n\n\t\t\t\t// Init cancellable request\n\t\t\t\tconst { request, abort } = cancelableRequest(getComments)\n\t\t\t\tthis.cancelRequest = abort\n\n\t\t\t\t// Fetch comments\n\t\t\t\tconst { data: comments } = await request({\n\t\t\t\t\tresourceType: this.resourceType,\n\t\t\t\t\tresourceId: this.resourceId,\n\t\t\t\t}, { offset: this.offset }) || { data: [] }\n\n\t\t\t\tthis.logger.debug(`Processed ${comments.length} comments`, { comments })\n\n\t\t\t\t// We received less than the requested amount,\n\t\t\t\t// we're done fetching comments\n\t\t\t\tif (comments.length < DEFAULT_LIMIT) {\n\t\t\t\t\tthis.done = true\n\t\t\t\t}\n\n\t\t\t\t// Insert results\n\t\t\t\tthis.comments.push(...comments)\n\n\t\t\t\t// Increase offset for next fetch\n\t\t\t\tthis.offset += DEFAULT_LIMIT\n\t\t\t} catch (error) {\n\t\t\t\tif (error.message === 'cancel') {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tthis.error = t('comments', 'Unable to load the comments list')\n\t\t\t\tconsole.error('Error loading the comments list', error)\n\t\t\t} finally {\n\t\t\t\tthis.loading = false\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Add newly created comment to the list\n\t\t *\n\t\t * @param {object} comment the new comment\n\t\t */\n\t\tonNewComment(comment) {\n\t\t\tthis.comments.unshift(comment)\n\t\t},\n\n\t\t/**\n\t\t * Remove deleted comment from the list\n\t\t *\n\t\t * @param {number} id the deleted comment\n\t\t */\n\t\tonDelete(id) {\n\t\t\tconst index = this.comments.findIndex(comment => comment.props.id === id)\n\t\t\tif (index > -1) {\n\t\t\t\tthis.comments.splice(index, 1)\n\t\t\t} else {\n\t\t\t\tconsole.error('Could not find the deleted comment in the list', id)\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Reset the current view to its default state\n\t\t */\n\t\tresetState() {\n\t\t\tthis.error = ''\n\t\t\tthis.loading = false\n\t\t\tthis.done = false\n\t\t\tthis.offset = 0\n\t\t\tthis.comments = []\n\t\t},\n\t},\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.comments {\n\tmin-height: 100%;\n\tdisplay: flex;\n\tflex-direction: column;\n\n\t&__empty,\n\t&__error {\n\t\tflex: 1 0;\n\t}\n\n\t&__retry {\n\t\tmargin: 0 auto;\n\t}\n\n\t&__info {\n\t\theight: 60px;\n\t\tcolor: var(--color-text-maxcontrast);\n\t\ttext-align: center;\n\t\tline-height: 60px;\n\t}\n}\n</style>\n","/**\n * @copyright Copyright (c) 2020 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport { translate as t, translatePlural as n } from '@nextcloud/l10n'\nimport Vue from 'vue'\nimport CommentsApp from '../views/Comments.vue'\nimport logger from '../logger.js'\n\n// Add translates functions\nVue.mixin({\n\tdata() {\n\t\treturn {\n\t\t\tlogger,\n\t\t}\n\t},\n\tmethods: {\n\t\tt,\n\t\tn,\n\t},\n})\n\nexport default class CommentInstance {\n\n\t/**\n\t * Initialize a new Comments instance for the desired type\n\t *\n\t * @param {string} resourceType the comments endpoint type\n\t * @param  {object} options the vue options (propsData, parent, el...)\n\t */\n\tconstructor(resourceType = 'files', options = {}) {\n\t\t// Merge options and set `resourceType` property\n\t\toptions = {\n\t\t\t...options,\n\t\t\tpropsData: {\n\t\t\t\t...(options.propsData ?? {}),\n\t\t\t\tresourceType,\n\t\t\t},\n\t\t}\n\t\t// Init Comments component\n\t\tconst View = Vue.extend(CommentsApp)\n\t\treturn new View(options)\n\t}\n\n}\n","/**\n * @copyright Copyright (c) 2020 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport CommentsInstance from './services/CommentsInstance.js'\n\n// Init Comments\nif (window.OCA && !window.OCA.Comments) {\n\tObject.assign(window.OCA, { Comments: {} })\n}\n\n// Init Comments App view\nObject.assign(window.OCA.Comments, { View: CommentsInstance })\nconsole.debug('OCA.Comments.View initialized')\n"],"names":["_typeof","obj","_classCallCheck","instance","Constructor","_defineProperties","target","props","i","descriptor","_createClass","protoProps","staticProps","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","arr2","iter","processOptions","value","options","throttle","callback","delay","timeout","lastState","currentArgs","throttled","state","_len","args","_key","leading","deepEqual","val1","val2","key","VisibilityState","el","vnode","_this","result","entry","_ref","_leading","entries","intersectingEntry","e","bind","_ref2","update","_ref3","oldValue","unbind","ObserveVisibility","install","Vue","plugin","GlobalVue","global","cancelableRequest","request","controller","signal","url","markCommentsAsRead","resourceType","resourceId","date","resourcePath","readMarker","client","VTooltip","VueObserveVisibility","_sfc_main","Comment","NcEmptyContent","NcButton","RefreshIcon","MessageReplyTextIcon","AlertCircleOutlineIcon","CommentView","t","isVisible","showError","abort","getComments","comments","DEFAULT_LIMIT","error","comment","id","index","logger","n","CommentInstance","View","CommentsApp","CommentsInstance"],"mappings":"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","x_google_ignoreList":[0]}